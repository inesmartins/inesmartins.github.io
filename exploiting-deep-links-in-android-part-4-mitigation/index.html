<!DOCTYPE html>
<html lang="en">
<head>

    <title>Exploiting Deep Links in Android - Part 4 (Mitigation)</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=c944e349e5.css" />

    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Exploiting Deep Links in Android - Part 4 (Mitigation)" />
    <meta property="og:description" content="Preventing Deep Link HijackingWhen it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs. [If you&#x27;re lost maybe you should go back to Part 1] As of August 2021 only about 6% of Android devices" />
    <meta property="og:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/" />
    <meta property="og:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" />
    <meta property="article:published_time" content="2021-09-23T20:10:50.000Z" />
    <meta property="article:modified_time" content="2021-09-29T19:15:20.000Z" />
    <meta property="article:tag" content="deep links" />
    <meta property="article:tag" content="android" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Exploiting Deep Links in Android - Part 4 (Mitigation)" />
    <meta name="twitter:description" content="Preventing Deep Link HijackingWhen it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs. [If you&#x27;re lost maybe you should go back to Part 1] As of August 2021 only about 6% of Android devices" />
    <meta name="twitter:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/" />
    <meta name="twitter:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Inês Martins" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="deep links, android" />
    <meta property="og:image:width" content="1000" />
    <meta property="og:image:height" content="563" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "",
        "url": "inesmartins.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "image": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png",
            "width": 592,
            "height": 572
        },
        "url": "inesmartins.github.io/author/ines/",
        "sameAs": []
    },
    "headline": "Exploiting Deep Links in Android - Part 4 (Mitigation)",
    "url": "inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/",
    "datePublished": "2021-09-23T20:10:50.000Z",
    "dateModified": "2021-09-29T19:15:20.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg",
        "width": 1000,
        "height": 563
    },
    "keywords": "deep links, android",
    "description": "Preventing Deep Link Hijacking\nWhen it comes to preventing Deep Link Hijacking, the message is simple: stop\nusing Scheme URLs and start using (properly verified) App Links or Intent URLs.\n\n[If you&#x27;re lost maybe you should go back to Part 1\n[https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html]\n]\n\nAs of August 2021 only about 6% of Android devices\n[https://www.appbrain.com/stats/top-android-sdk-versions] were still using\nAndroid 5 (Lollipop) or earlier versions of the O",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "inesmartins.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.7" />
    <link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~1.5.1/umd/portal.min.js" data-ghost="inesmartins.github.io/"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180659126-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-180659126-1');
</script>
<script>
    window.onload = function(e){ 
	    var copyrightElement = document.getElementsByClassName('copyright')[0];
    	copyrightElement.innerHTML = '<p>Inês Martins © 2021</p>'
        copyrightElement.innerHTML += '<p>Contact: <a href="mailto:inesmartins.github.io@pm.me">inesmartins.github.io@pm.me</a></p>'
	    copyrightElement.innerHTML += '<p>Banner by Josan Gonzalez aka <a href="https://www.artstation.com/josan">Death Burger</a>'
        var footerNav = document.getElementsByClassName('site-footer-nav')[0];
        footerNav.innerHTML = '<img src="http://www.hackthebox.eu/badge/image/172261" alt="Hack The Box">'
	}
</script>
<!-- Styles -->
<style>
    .gh-head-actions,
    .footer-cta, 
    .gh-head-button {
        display: none;
    }
    .article-image img {
        max-height: 400px;
        object-fit: contain;
    }
    .site-footer-nav {
        display: block;
    }
    @media (max-width: 800px) {    
	    .site-footer-nav {
    	    margin: 20px auto;
	    }
    }
</style><style>:root {--ghost-accent-color: #000000;}</style>

</head>
<body class="post-template tag-deep-links tag-android">
<div class="viewport">

    <header id="gh-head" class="gh-head has-cover">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-deep-links tag-android">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="../tag/deep-links/index.html">deep links</a>
        </section>

        <h1 class="article-title">Exploiting Deep Links in Android - Part 4 (Mitigation)</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../author/ines/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../author/ines/index.html">Inês Martins</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-09-23">Sep 23, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                    </div>
                </div>
            </section>
        </div>

        <figure class="article-image">
            <img
                srcset="../content/images/size/w300/2021/09/maxresdefault-1-1.jpeg 300w,
                       ../content/images/size/w600/2021/09/maxresdefault-1-1.jpeg 600w,
                      ../content/images/size/w1000/2021/09/maxresdefault-1-1.jpeg 1000w,
                     ../content/images/size/w2000/2021/09/maxresdefault-1-1.jpeg 2000w"
                sizes="(min-width: 1400px) 1400px, 92vw"
                src="../content/images/size/w2000/2021/09/maxresdefault-1-1.jpeg"
                alt="Exploiting Deep Links in Android - Part 4 (Mitigation)"
            />
        </figure>
    </header>

    <section class="gh-content gh-canvas">
        <h2 id="preventing-deep-link-hijacking">Preventing Deep Link Hijacking</h2><p>When it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs.</p><p>[If you're lost maybe you should go back to <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>]</p><p>As of August 2021 <a href="https://www.appbrain.com/stats/top-android-sdk-versions">only about 6% of Android devices</a> were still using Android 5 (Lollipop) or earlier versions of the OS, which don’t support App Links. So at this point, there are not a lot of excuses to still use Scheme URLs, which are insecure by design.</p><p>However, as discussed on <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>, App Links can be tricky to verify correctly. Luckily, there are some tools that can help with this task.</p><p>Google provides a <a href="https://support.google.com/google-ads/answer/10710301?hl=en">Deep Link Validator</a> in their Ads platform as well as a <a href="https://developers.google.com/digital-asset-links/tools/generator">Statement List Generator and Tester</a>. This tools enables you to test if a given site domain grants app deep linking to the app with the specified name and <code>SHA256</code> fingerprint:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2021/09/Screenshot-2021-09-23-at-20.36.11.png" class="kg-image" alt loading="lazy"></figure><p>I found this tool to be insufficient, and couldn't find any other tool that gave me all of the information I needed about an application's App Links.</p><p>As such, I ended up developing <a href="https://github.com/inesmartins/Android-App-Link-Verification-Tester">an open source tool</a> that, among other things, can help you check if the App Links registered on the application are correctly verified:</p><pre><code>~ python3 Android-Deep-Link-Analyser/deeplink_analyser.py \
-apk com.twitter.android.apk \
-p com.twitter.android \
-op verify-applinks</code></pre><p>The output looks something like:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2021/09/Screenshot-2021-09-23-at-20.40.32.png" class="kg-image" alt loading="lazy"></figure><p>This tool has a lot of other features that might interested you. <br>Also, if you have any ideas, corrections or suggestions I would love to receive them on Github!</p><hr><h2 id="validating-untrusted-data">Validating Untrusted Data</h2><p>As a general rule, you should treat all data received via deep link as being potentially malicious. As such, this data should be properly <strong>validated</strong>, <strong>sanitized </strong>and <strong>encoded</strong>.</p><p>If you remember, a lot of the vulnerabilities we explored on the previous posts could have been prevented if the developers checked a given URL against an allowlist.</p><p>However, when parsing and checking URLs we should keep in mind that a lot of <a href="https://hackerone.com/reports/431002">popular URL parsers have known vulnerabilities</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://lh5.googleusercontent.com/KTZM2xQgLFfena7OJJakPkLnvyX3lcAdQVdinLeaIxuCVskdMO3g2es-7UT8u6kzU2532AjrJiCFFZtu2aEFl8y7ph7TyprwHTsDgYJJrcO6KN_CborYhhSlOZLTWfVTlwVc5wK7Qyw=s0" class="kg-image" alt loading="lazy"></figure><p>Note that this issue is now fixed for API 28 - triggering a deep links with a malformed URL loads the attacker's scripts in Chrome rather than the app’s <code>WebView</code> - but this is still valid for older APIs.</p><hr><h2 id="webview-hardening">WebView Hardening</h2><p>As we saw on the previous posts, <code>WebViews</code> can potentially lead to <strong>local file exfiltration,</strong> they can allow a malicious user to <strong>access data</strong> created by other applications, and they're vulnerable to common web vulnerabilities.</p><p>So, when it comes to <code>WebViews</code> we should first ask ourselves: "could we replace it with a native Android UI component?" </p><p>If the answer is "Yes" we should go with the native approach.</p><p>If the answer is "No" we should enforce the following settings:</p><pre><code>setJavaScriptEnabled(false); // disables JavaScript;

setAllowFileAccess(false); // disables file system access;

setAllowContentAccess(false); // blocks WebViews from loading content from a content provider installed in the system;

setAllowFileAccessFromFileURLs(false); // deprecated in API 30, this setting prevents malicious scripts loaded in a file:// context to access arbitrary local files including WebView cookies and app private data.

setAllowUniversalAccessFromFileURLs(false); // deprecated in API 30, this setting prevents malicious scripts loaded in a file:// context to launch cross-site scripting attacks, either accessing arbitrary local files including WebView cookies, app private data or even credentials used on arbitrary web sites.</code></pre><p>Note that these settings are safe by default on "modern" Android APIs, but you should verify if the app developer has not explicitly set an insecure configuration.</p><p>Finally, if your app directs users to URLs outside your domain, consider using <a href="https://developer.chrome.com/docs/android/custom-tabs/overview/">Chrome Custom Tabs</a> instead of a <code>WebView</code>:</p><blockquote>CCT opens faster than a browser and, if preloaded via its warm-up call, is potentially even faster than a WebView. While it still runs Javascript, it is in its own process, which prevents apps from running malicious code. Furthermore, the CCT UI provides an action bar which shows the URL of the page being loaded, along with an SSL verification lock icon for secure pages.</blockquote><hr><p>Hopefully, you're now better equipped to protect your application.<br>On the next post we'll explore Testing methodologies.</p>
    </section>


</article>

<section class="footer-cta">
    <div class="inner">
        <h2>Sign up for more like this.</h2>
        <a class="footer-cta-button" href="index.html#/portal">
            <div>Enter your email</div>
            <span>Subscribe</span>
        </a>
    </div>
</section>


<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../htb-write-up-monitors/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/09/Screenshot-2021-09-12-at-17.10.05.png 300w,
                   ../content/images/size/w600/2021/09/Screenshot-2021-09-12-at-17.10.05.png 600w,
                  ../content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-17.10.05.png 1000w,
                 ../content/images/size/w2000/2021/09/Screenshot-2021-09-12-at-17.10.05.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/09/Screenshot-2021-09-12-at-17.10.05.png"
            alt="HTB Write-up | Monitors"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../htb-write-up-monitors/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">HTB Write-up | Monitors</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Retired machine can be found here.ScanningLet's start the same as always, with a basic nmap scan: ~ nmap -sC -sV -A 10.10.10.238 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-01 11:15 WEST Nmap scan report for 10.10.10.238 Host is up (0.32s</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-10-09">Oct 9, 2021</time> <span class="bull">&bull;</span> 10 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../how-to-deploy-your-website-to-webdav-web-disk-using-github-actions/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/10/Screenshot-2021-10-05-at-18.36.41.png 300w,
                   ../content/images/size/w600/2021/10/Screenshot-2021-10-05-at-18.36.41.png 600w,
                  ../content/images/size/w1000/2021/10/Screenshot-2021-10-05-at-18.36.41.png 1000w,
                 ../content/images/size/w2000/2021/10/Screenshot-2021-10-05-at-18.36.41.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/10/Screenshot-2021-10-05-at-18.36.41.png"
            alt="Automatic Web Disk deployment with Github Actions"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../how-to-deploy-your-website-to-webdav-web-disk-using-github-actions/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Automatic Web Disk deployment with Github Actions</h2>
            </header>
            <section class="post-card-excerpt">
                <p>A Web Disk (aka: WebDav) is a protocol that provides a simple interface to manage files stored on a server - it's basically an alternative to FTP that is provided by some hosting services. Some time ago I was given the task to deploy a website using a WebDisk and</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-10-05">Oct 5, 2021</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../exploiting-deep-links-in-android-part-3/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/09/maxresdefault-1.jpeg 300w,
                   ../content/images/size/w600/2021/09/maxresdefault-1.jpeg 600w,
                  ../content/images/size/w1000/2021/09/maxresdefault-1.jpeg 1000w,
                 ../content/images/size/w2000/2021/09/maxresdefault-1.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/09/maxresdefault-1.jpeg"
            alt="Exploiting Deep Links in Android - Part 3"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../exploiting-deep-links-in-android-part-3/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Exploiting Deep Links in Android - Part 3</h2>
            </header>
            <section class="post-card-excerpt">
                <p>So .. what else can we do with deep links? Local File Inclusion (LFI)In part 2 we saw how to achieve LFI via the WebView.loadUrl method. In this part we'll explore an alternative that doesn't require the application to contain a WebView.  Let's continue using the ABC Bank Android</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-09-04">Sep 4, 2021</time> <span class="bull">&bull;</span> 4 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html"></a> &copy; 2021</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=c944e349e5"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
