<!DOCTYPE html>
<html lang="en">
<head>

    <title>Exploiting Deep Links in Android - Part 3</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=9f31058e11.css" />

    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Exploiting Deep Links in Android - Part 3" />
    <meta property="og:description" content="So .. what else can we do with deep links? Local File Inclusion (LFI)On part 2 we saw how to achieve LFI via the WebView.loadUrl method, now let&#x27;s see an alternative that doesn&#x27;t require the application to contain a WebView.  Imagine an application that receives a parameter via deep" />
    <meta property="og:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-3/" />
    <meta property="og:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" />
    <meta property="article:published_time" content="2021-09-04T20:07:17.000Z" />
    <meta property="article:modified_time" content="2021-09-04T20:42:54.000Z" />
    <meta property="article:tag" content="android" />
    <meta property="article:tag" content="deep links" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Exploiting Deep Links in Android - Part 3" />
    <meta name="twitter:description" content="So .. what else can we do with deep links? Local File Inclusion (LFI)On part 2 we saw how to achieve LFI via the WebView.loadUrl method, now let&#x27;s see an alternative that doesn&#x27;t require the application to contain a WebView.  Imagine an application that receives a parameter via deep" />
    <meta name="twitter:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-3/" />
    <meta name="twitter:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Inês Martins" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="android, deep links" />
    <meta property="og:image:width" content="1000" />
    <meta property="og:image:height" content="563" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "",
        "url": "inesmartins.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "image": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png",
            "width": 592,
            "height": 572
        },
        "url": "inesmartins.github.io/author/ines/",
        "sameAs": [
            "https://gist.github.com/inesmartins/"
        ]
    },
    "headline": "Exploiting Deep Links in Android - Part 3",
    "url": "inesmartins.github.io/exploiting-deep-links-in-android-part-3/",
    "datePublished": "2021-09-04T20:07:17.000Z",
    "dateModified": "2021-09-04T20:42:54.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg",
        "width": 1000,
        "height": 563
    },
    "keywords": "android, deep links",
    "description": "So .. what else can we do with deep links?\n\nLocal File Inclusion (LFI)\nOn part 2\n[https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html] \nwe saw how to achieve LFI via the WebView.loadUrl method, now let&#x27;s see an\nalternative that doesn&#x27;t require the application to contain a WebView. \n\nImagine an application that receives a parameter via deep link, which indicates\na file path. If a local file with that path exists, the application reads its\ndata and outputs it to a Text",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "inesmartins.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.7" />
    <link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~1.5.1/umd/portal.min.js" data-ghost="inesmartins.github.io/"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180659126-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-180659126-1');
</script>
<script>
    window.onload = function(e){ 
	    var copyrightElement = document.getElementsByClassName('copyright')[0];
    	copyrightElement.innerHTML = '<p>Inês Martins © 2021</p>'
	    copyrightElement.innerHTML += '<p>Banner by Josan Gonzalez aka <a href="https://www.artstation.com/josan">Death Burger</a>'
	}
</script>
<!-- Styles -->
<style>
    .gh-head-actions,
    .footer-cta, 
    .gh-head-button {
        display: none;
    }
    .article-image img {
        max-height: 400px;
        object-fit: contain;
    }
</style><style>:root {--ghost-accent-color: #000000;}</style>

</head>
<body class="post-template tag-android tag-deep-links">
<div class="viewport">

    <header id="gh-head" class="gh-head has-cover">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-android tag-deep-links">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="../tag/android/index.html">android</a>
        </section>

        <h1 class="article-title">Exploiting Deep Links in Android - Part 3</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../author/ines/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../author/ines/index.html">Inês Martins</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-09-04">Sep 4, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                    </div>
                </div>
            </section>
        </div>

        <figure class="article-image">
            <img
                srcset="../content/images/size/w300/2021/09/maxresdefault-1.jpeg 300w,
                       ../content/images/size/w600/2021/09/maxresdefault-1.jpeg 600w,
                      ../content/images/size/w1000/2021/09/maxresdefault-1.jpeg 1000w,
                     ../content/images/size/w2000/2021/09/maxresdefault-1.jpeg 2000w"
                sizes="(min-width: 1400px) 1400px, 92vw"
                src="../content/images/size/w2000/2021/09/maxresdefault-1.jpeg"
                alt="Exploiting Deep Links in Android - Part 3"
            />
        </figure>
    </header>

    <section class="gh-content gh-canvas">
        <p>So .. what else can we do with deep links?</p><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>On <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method, now let's see an alternative that doesn't require the application to contain a <code>WebView</code>. </p><p>Imagine an application that receives a parameter via deep link, which indicates a file path. If a local file with that path exists, the application reads its data and outputs it to a <code>TextView</code> element, as shown below:</p><pre><code class="language-Android">String file_to_read = getIntent().getData().getQueryParameter('file-to-read');

AssetManager am = getAssets()
InputStream is = am.open(file_to_read);
BufferedReader r = new BufferedReader(new InputStreamReader(is));
StringBuilder str_to_display = "";

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append('\n');
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>So, what is the danger here? Surely if an Android user sees their <em>own</em> information displayed on the screen that's not much of an issue.</p><figure class="kg-card kg-image-card"><img src="../content/images/2021/09/Screenshot-2021-09-03-at-19.14.14.png" class="kg-image" alt loading="lazy" width="1429" height="799" srcset="../content/images/size/w600/2021/09/Screenshot-2021-09-03-at-19.14.14.png 600w, ../content/images/size/w1000/2021/09/Screenshot-2021-09-03-at-19.14.14.png 1000w, ../content/images/2021/09/Screenshot-2021-09-03-at-19.14.14.png 1429w" sizes="(min-width: 720px) 720px"></figure><p>Well, the danger mostly lies in chaining this LFI with another vulnerability that allows for data exfiltration, and the impact has a lot to do with the files that you can access via the app.</p><p>Note, for example, that if the application includes the <a href="https://developer.android.com/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a> permission, it has access to the user's pictures stored under <code>/sdcard/DCIM</code> and to any other file created by any other application which is stored under <code>/sdcard</code>. </p><p>The attack surface can also be expanded if the application has access to <a href="https://developer.android.com/guide/topics/providers/content-providers">Content Providers</a>, which are interfaces that allow multiple apps to share data.</p><p>So, LFIs can be a way to access a lot of sensitive data, you just need to find a way to take it out of the device.</p><h2 id="remote-code-execution-rce">Remote Code Execution (RCE)</h2><p>Achieving RCE is theoretically possible, but very unlikely and, in short, would require very poor judgement on the part of the application's developers.</p><p>Let's take the same application from the previous example, but in this case the deep link contains a <code>cmd</code> parameter that is executed using <code>Runtime.getRuntime().exec()</code>:</p><pre><code>String command = getIntent().getData().getQueryParameter('cmd');
Process process = Runtime.getRuntime().exec(command)

InputStreamReader isr = InputStreamReader(process.inputStream);
BufferedReader r = new BufferedReader(isr);
StringBuilder str_to_display = "";

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append('\n');
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>In the example shown above, it would be possible for an attacker to remotely execute commands on the device by simply tricking a victim into clicking a deep link such as:</p><pre><code>deeplink://cmd=&lt;the-evil-command&gt;</code></pre><p>But, again, it would be a sign of very poor judgement to allow a user to specify commands directly via deep link, particularly without any additional validations, and as far as I could find, there aren't any real examples of this reported in the wild.</p><h2 id="cross-site-request-forgery">Cross-Site Request Forgery</h2><p>Usually, when we talk about CSRF we're exploiting some Cookie (mis)configuration in order to trick a user into performing some sort of unintended action. A typical scenario would be a phishing link that performs a <code>GET</code> request that does some sort of account state change.</p><p>The same scenario is possible in Android if the application registers a deep link that "automatically" performs an action without any additional confirmation from the user.</p><p>A simple example was <a href="https://hackerone.com/reports/583987">reported in 2019</a> for the Periscope app. In short, it was possible to trick a victim user of the Periscope application into following another user of the app, simply by tricking the victim into clicking on a deep link similar to:</p><pre><code>pscp://user/&lt;any-user-id&gt;/follow
</code></pre><hr><p>And that's it for now!</p><p>I think I'll fit it one more part describing common exploitation techniques before getting into mitigation and, finally, testing methodologies.</p>
    </section>


</article>

<section class="footer-cta">
    <div class="inner">
        <h2>Sign up for more like this.</h2>
        <a class="footer-cta-button" href="index.html#/portal">
            <div>Enter your email</div>
            <span>Subscribe</span>
        </a>
    </div>
</section>


<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../mobsf-ipa-binary-analysis-step-by-step/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/08/Screenshot-2021-08-22-at-10.17.13.png 300w,
                   ../content/images/size/w600/2021/08/Screenshot-2021-08-22-at-10.17.13.png 600w,
                  ../content/images/size/w1000/2021/08/Screenshot-2021-08-22-at-10.17.13.png 1000w,
                 ../content/images/size/w2000/2021/08/Screenshot-2021-08-22-at-10.17.13.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/08/Screenshot-2021-08-22-at-10.17.13.png"
            alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../mobsf-ipa-binary-analysis-step-by-step/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">MobSF &quot;IPA Binary Analysis&quot; | Step by Step</h2>
            </header>
            <section class="post-card-excerpt">
                <p>MobSF is an open source static and dynamic analysis tool for Android and iOS, which can be used to quickly detect major issues on your mobile application. When scanning an .ipa, the "IPA Binary Analysis" section can report multiple issues that can be hard to interpret.  Hopefully this article will</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-08-21">Aug 21, 2021</time> <span class="bull">&bull;</span> 9 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../exploiting-deep-links-in-android-part-2/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/08/maxresdefault-1.jpeg 300w,
                   ../content/images/size/w600/2021/08/maxresdefault-1.jpeg 600w,
                  ../content/images/size/w1000/2021/08/maxresdefault-1.jpeg 1000w,
                 ../content/images/size/w2000/2021/08/maxresdefault-1.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/08/maxresdefault-1.jpeg"
            alt="Exploiting Deep Links in Android - Part 2"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../exploiting-deep-links-in-android-part-2/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Exploiting Deep Links in Android - Part 2</h2>
            </header>
            <section class="post-card-excerpt">
                <p>In this part, we're going to start to answer the question: "What can you do if you can trick a user into clicking a malicious deep link?" Let's go back to the ABC Bank example. ABC Bank has both a web and an Android application, and they use deep links</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-08-15">Aug 15, 2021</time> <span class="bull">&bull;</span> 3 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../exploiting-deep-links-in-android-part1/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2021/08/maxresdefault.jpeg 300w,
                   ../content/images/size/w600/2021/08/maxresdefault.jpeg 600w,
                  ../content/images/size/w1000/2021/08/maxresdefault.jpeg 1000w,
                 ../content/images/size/w2000/2021/08/maxresdefault.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2021/08/maxresdefault.jpeg"
            alt="Exploiting Deep Links in Android - Part 1"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../exploiting-deep-links-in-android-part1/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Exploiting Deep Links in Android - Part 1</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Deep links are an often overlooked way to exploit Android applications. In this series I hope to do a deep dive into their history, common vulnerabilities with real-life examples, possible mitigations, and testing techniques for pentesters and researchers. In this first part, we do a quick overview of the supported</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2021/08/Screenshot-2021-08-22-at-21.31.59.png" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2021-08-13">Aug 13, 2021</time> <span class="bull">&bull;</span> 6 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html"></a> &copy; 2021</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=9f31058e11"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
