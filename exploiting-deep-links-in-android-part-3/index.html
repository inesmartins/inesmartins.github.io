<!DOCTYPE html>
<html lang="en">
<head>

    <title>Exploiting Deep Links in Android - Part 3</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=5edf1fe643.css" />

    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Exploiting Deep Links in Android - Part 3" />
    <meta property="og:description" content="So .. what else can we do with deep links? Local File Inclusion (LFI)In part 2 we saw how to achieve LFI via the WebView.loadUrl method. In this part we&#x27;ll explore an alternative that doesn&#x27;t require the application to contain a WebView.  Let&#x27;s continue using the ABC Bank Android" />
    <meta property="og:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-3/" />
    <meta property="og:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" />
    <meta property="article:published_time" content="2021-09-04T20:07:17.000Z" />
    <meta property="article:modified_time" content="2021-11-13T13:12:21.000Z" />
    <meta property="article:tag" content="android" />
    <meta property="article:tag" content="deep links" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Exploiting Deep Links in Android - Part 3" />
    <meta name="twitter:description" content="So .. what else can we do with deep links? Local File Inclusion (LFI)In part 2 we saw how to achieve LFI via the WebView.loadUrl method. In this part we&#x27;ll explore an alternative that doesn&#x27;t require the application to contain a WebView.  Let&#x27;s continue using the ABC Bank Android" />
    <meta name="twitter:url" content="inesmartins.github.io/exploiting-deep-links-in-android-part-3/" />
    <meta name="twitter:image" content="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Inês Martins" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="android, deep links" />
    <meta property="og:image:width" content="1000" />
    <meta property="og:image:height" content="563" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "",
        "url": "inesmartins.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "image": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/content/images/2022/08/1658857349956.jpeg",
            "width": 420,
            "height": 420
        },
        "url": "inesmartins.github.io/author/ines/",
        "sameAs": [
            "https://www.linkedin.com/in/ines-af-martins/"
        ]
    },
    "headline": "Exploiting Deep Links in Android - Part 3",
    "url": "inesmartins.github.io/exploiting-deep-links-in-android-part-3/",
    "datePublished": "2021-09-04T20:07:17.000Z",
    "dateModified": "2021-11-13T13:12:21.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg",
        "width": 1000,
        "height": 563
    },
    "keywords": "android, deep links",
    "description": "So .. what else can we do with deep links?\n\n\n--------------------------------------------------------------------------------\n\nLocal File Inclusion (LFI)\nIn part 2\n[https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html] \nwe saw how to achieve LFI via the WebView.loadUrl method. In this part we&#x27;ll\nexplore an alternative that doesn&#x27;t require the application to contain a WebView\n. \n\nLet&#x27;s continue using the ABC Bank Android application as an example, and imagine\nthat thei",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "inesmartins.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.7" />
    <link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~1.5.1/umd/portal.min.js" data-ghost="inesmartins.github.io/"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180659126-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-180659126-1');
</script>
<!-- Injects copyright and footer -->
<script>
    window.onload = function(e){ 
	    var copyrightElement = document.getElementsByClassName('copyright')[0];
    	copyrightElement.innerHTML = '<p>Inês Martins © 2021</p>'
        copyrightElement.innerHTML += '<p>Contact: <a href="mailto:inesmartins.github.io@pm.me">inesmartins.github.io@pm.me</a></p>'
	    copyrightElement.innerHTML += '<p>Banner by Josan Gonzalez aka <a href="https://www.artstation.com/josan">Death Burger</a>'
        var footerNav = document.getElementsByClassName('site-footer-nav')[0];
        footerNav.innerHTML = '<img src="http://www.hackthebox.eu/badge/image/172261" alt="Hack The Box">'
	}
</script>
<!-- Styles -->
<style>
    .gh-head-actions,
    .footer-cta, 
    .gh-head-button {
        display: none;
    }
    .article-image img {
        max-height: 400px;
        object-fit: contain;
    }
    .site-footer-nav {
        display: block;
    }
    @media (max-width: 800px) {    
	    .site-footer-nav {
    	    margin: 20px auto;
	    }
    }
</style><style>:root {--ghost-accent-color: #000000;}</style>

</head>
<body class="post-template tag-android tag-deep-links">
<div class="viewport">

    <header id="gh-head" class="gh-head has-cover">
        <nav class="gh-head-inner inner gh-container">

            <div class="gh-head-brand">
                <a class="gh-head-logo" href="../index.html">
                        
                </a>
                <a class="gh-burger" role="button">
                    <div class="gh-burger-box">
                        <div class="gh-burger-inner"></div>
                    </div>
                </a>
            </div>
            <div class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-about"><a href="../about-me/index.html">About</a></li>
</ul>

            </div>
            <div class="gh-head-actions">
                <div class="gh-social">
                </div>

                    <a class="gh-head-button" href="index.html#/portal/signup">Subscribe</a>
            </div>
        </nav>
    </header>

    <main>
        



<article class="article post tag-android tag-deep-links">

    <header class="article-header gh-canvas">

        <section class="article-tag">
            <a href="../tag/android/index.html">android</a>
        </section>

        <h1 class="article-title">Exploiting Deep Links in Android - Part 3</h1>


        <div class="article-byline">
            <section class="article-byline-content">
                <ul class="author-list">
                    <li class="author-list-item">
                        <a href="../author/ines/index.html" class="author-avatar">
                            <img class="author-profile-image" src="../content/images/size/w100/2022/08/1658857349956.jpeg" alt="Inês Martins" />
                        </a>
                    </li>
                </ul>
                <div class="article-byline-meta">
                    <h4 class="author-name"><a href="../author/ines/index.html">Inês Martins</a></h4>
                    <div class="byline-meta-content">
                        <time class="byline-meta-date" datetime="2021-09-04">Sep 4, 2021</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 4 min read</span>
                    </div>
                </div>
            </section>
        </div>

        <figure class="article-image">
            <img
                srcset="../content/images/size/w300/2021/09/maxresdefault-1.jpeg 300w,
                       ../content/images/size/w600/2021/09/maxresdefault-1.jpeg 600w,
                      ../content/images/size/w1000/2021/09/maxresdefault-1.jpeg 1000w,
                     ../content/images/size/w2000/2021/09/maxresdefault-1.jpeg 2000w"
                sizes="(min-width: 1400px) 1400px, 92vw"
                src="../content/images/size/w2000/2021/09/maxresdefault-1.jpeg"
                alt="Exploiting Deep Links in Android - Part 3"
            />
        </figure>
    </header>

    <section class="gh-content gh-canvas">
        <p>So .. what else can we do with deep links?</p><hr><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>In <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method. In this part we'll explore an alternative that doesn't require the application to contain a <code>WebView</code>. </p><p>Let's continue using the <code>ABC Bank</code> Android application as an example, and imagine that their customer support team uses deep links to help customers see important information displayed inside the app.</p><p>But in this case, instead of a parameter that specifies a web page, the deep link contains the path to a local file, e.g.:</p><pre><code>abcbank://help?file=how-to-enable-mfa.txt</code></pre><p>When the application receives this deep link, it opens the local file, reads its contents and displays in inside a <code>TextView</code>, as shown below:</p><pre><code class="language-Android">String file = getIntent().getData().getQueryParameter('file');

AssetManager am = getAssets()
InputStream is = am.open(file);
BufferedReader r = new BufferedReader(new InputStreamReader(is));
StringBuilder str_to_display = "";

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append('\n');
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>So, what's the danger here? Surely if a user sees their <em>own</em> local data displayed on the screen that's not much of an issue.</p><figure class="kg-card kg-image-card"><img src="../content/images/2021/09/Screenshot-2021-09-05-at-10.59.34.png" class="kg-image" alt loading="lazy"></figure><p>Well, for starters it depends on whether or not the application enforces any validations when it comes to the files that can be specified via deep link. If there aren't any validations, then it all comes down to the data can be accessed from the application.</p><p>Note, for example, that if the application includes the <a href="https://developer.android.com/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a> permission, it can access files stored in shared directories, including those generated by other apps (note that since API 29 this is not possible since all storage is scoped).</p><p>So, it's not much of a leap to imagine that a malicious application could write a file to a shared directory that would then be read by the victim app. </p><p>Depending on the <code>WebView</code> configurations, this local file could then read all of the application files and exfiltrate them to an attacker-controlled server.</p><p>The attack surface can also be expanded if the application has access to <a href="https://developer.android.com/guide/topics/providers/content-providers">Content Providers</a>, which are interfaces that allow multiple apps to share data.</p><h2 id="cross-site-request-forgery-csrf">Cross-Site Request Forgery (CSRF)</h2><p>Usually, when we talk about CSRF, we're exploiting some Cookie (mis)configuration in order to trick a user into performing an unintended action. A typical scenario would be a phishing link that performs a <code>GET</code> request that does some sort of account state change.</p><p>The same scenario is possible in Android if the application registers a deep link that "automatically" performs an action without any additional confirmation from the user.</p><p>A very straightforward example of this was <a href="https://hackerone.com/reports/583987">reported in 2019</a> on the Periscope app: in short, it was possible to trick a user of the Periscope application into following another user of the app, simply by tricking the victim into clicking on a deep link similar to:</p><pre><code>pscp://user/&lt;any-user-id&gt;/follow
</code></pre><figure class="kg-card kg-image-card"><img src="../content/images/2021/09/Screenshot-2021-09-05-at-11.11.37-1.png" class="kg-image" alt loading="lazy" width="443" height="650"></figure><p>The application, in essence, behaves as the browser by authenticating and sending the request without confirming with the user if they want to perform said action. And the impact is basically whatever feature is supported by the app itself.</p><h2 id="remote-code-execution-rce">Remote Code Execution (RCE)</h2><p>Achieving RCE is theoretically possible, but very unlikely, since it would require very poor judgement on the part of the application's developers.</p><p>Let's go back to the <code>ABC Bank</code> Android app. Their customer support team knows that some OS versions have specific bugs, but their clients are not tech-savvy enough to check the OS by themselves, so they send them a deep link such as this one:</p><pre><code>abcbank://help?cmd=cat%20/system/build.prop</code></pre><p>When the application receives this deep link, it executes the <code>cat /system/build.prop</code> command using <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html">Runtime.getRuntime().exec()</a>, and then the output is displayed on a <code>TextView</code>, just as before:</p><pre><code>String command = getIntent().getData().getQueryParameter('cmd');
Process process = Runtime.getRuntime().exec(command)

InputStreamReader isr = InputStreamReader(process.inputStream);
BufferedReader r = new BufferedReader(isr);
StringBuilder str_to_display = "";

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append('\n');
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>The client then simply reads the output to the customer support agent, which can then take that info into account when supporting the user.</p><p>In this scenario and without any additional validations, it would be possible for an attacker to remotely execute commands on the device by simply tricking a victim into clicking a deep link such as:</p><pre><code>deeplink://path?cmd=&lt;the-evil-command&gt;</code></pre><p>But, again, it would be a sign of very poor judgement to allow a user to specify commands directly via deep link, particularly without any additional validations, and proof of that is the fact that I couldn't find any actual examples of RCE reported in the wild.</p><hr><p>And that's it for now! On the next post I'll look into <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/index.html">Mitigation</a>.</p>
    </section>


</article>

<section class="footer-cta">
    <div class="inner">
        <h2>Sign up for more like this.</h2>
        <a class="footer-cta-button" href="index.html#/portal">
            <div>Enter your email</div>
            <span>Subscribe</span>
        </a>
    </div>
</section>


<aside class="read-more-wrap">
    <div class="read-more inner">


                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../removing-files-or-dirs-from-git-history/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2022/11/23b7dc80-a4ec-11e9-91f9-fb886e0df297.png 300w,
                   ../content/images/size/w600/2022/11/23b7dc80-a4ec-11e9-91f9-fb886e0df297.png 600w,
                  ../content/images/size/w1000/2022/11/23b7dc80-a4ec-11e9-91f9-fb886e0df297.png 1000w,
                 ../content/images/size/w2000/2022/11/23b7dc80-a4ec-11e9-91f9-fb886e0df297.png 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/11/23b7dc80-a4ec-11e9-91f9-fb886e0df297.png"
            alt="Another post about erasing files/directories from git history"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../removing-files-or-dirs-from-git-history/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Another post about erasing files/directories from git history</h2>
            </header>
            <section class="post-card-excerpt">
                <p>~ brew install git-filter-repo ~ git filter-repo --invert-paths --path 'path-to-file-or-directory' ~ git remote remove origin ~ git remote add origin git@github.com:&lt;path-to-repository&gt;.git ~ git push origin --force 'refs/heads/*'Note that I'm using brew to install git-filter-repo, you may need to look for alternative installation methods, depending on your OS.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2022/08/1658857349956.jpeg" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2022-11-15">Nov 15, 2022</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../exfiltrating-data-via-webview-takeover/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2022/10/maxresdefault-1-1.jpeg 300w,
                   ../content/images/size/w600/2022/10/maxresdefault-1-1.jpeg 600w,
                  ../content/images/size/w1000/2022/10/maxresdefault-1-1.jpeg 1000w,
                 ../content/images/size/w2000/2022/10/maxresdefault-1-1.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/10/maxresdefault-1-1.jpeg"
            alt="Exfiltrating data from Android applications via WebView Takeover (Open Redirect)"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../exfiltrating-data-via-webview-takeover/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Exfiltrating data from Android applications via WebView Takeover (Open Redirect)</h2>
            </header>
            <section class="post-card-excerpt">
                <p>In this article, I go through the scenarios in which I've been able to exfiltrate data from real Android applications, after detecting a WebView takeover (aka "Open Redirect") vulnerability.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2022/08/1658857349956.jpeg" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2022-10-06">Oct 6, 2022</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>
                    
<article class="post-card post ">

    <a class="post-card-image-link" href="../when-not-to-use-jetpack-datastore/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2022/09/3.jpeg 300w,
                   ../content/images/size/w600/2022/09/3.jpeg 600w,
                  ../content/images/size/w1000/2022/09/3.jpeg 1000w,
                 ../content/images/size/w2000/2022/09/3.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="../content/images/size/w600/2022/09/3.jpeg"
            alt="DataStore is the new SharedPreferences, old vulns still apply"
            loading="lazy"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../when-not-to-use-jetpack-datastore/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">DataStore is the new SharedPreferences, old vulns still apply</h2>
            </header>
            <section class="post-card-excerpt">
                <p>Neither DataStore nor SharedPreferences should be used to persist sensitive data ... but as we know, Insecure Data Storage is one of the most common vulnerabilities found in mobile applications.</p>
            </section>
        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <a href="../author/ines/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2022/08/1658857349956.jpeg" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/ines/index.html">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2022-09-15">Sep 15, 2022</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>

    </div>
</aside>


    </main>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="../index.html"></a> &copy; 2023</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="../assets/built/casper.js%3Fv=5edf1fe643"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
