<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>ØxOPOSɆC Crypto Challenge 2019</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=906b0e7667" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://inesmartins.github.io//0xoposec/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://inesmartins.github.io//0xoposec/amp/" />
    
    <meta property="og:site_name" content="Inês Martins" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ØxOPOSɆC Crypto Challenge 2019" />
    <meta property="og:description" content="Write-up for ØxOPOSɆC crypto challenge that involves AES in CTR mode." />
    <meta property="og:url" content="https://inesmartins.github.io//0xoposec/" />
    <meta property="og:image" content="https://inesmartins.github.io//content/images/2020/06/highres_471963990.jpeg" />
    <meta property="article:published_time" content="2020-06-07T22:48:24.000Z" />
    <meta property="article:modified_time" content="2020-12-08T09:32:42.000Z" />
    <meta property="article:tag" content="cryptography" />
    <meta property="article:tag" content="ctf" />
    <meta property="article:tag" content="aes" />
    <meta property="article:tag" content="aes-ctr" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ØxOPOSɆC Crypto Challenge 2019" />
    <meta name="twitter:description" content="Write-up for ØxOPOSɆC crypto challenge that involves AES in CTR mode." />
    <meta name="twitter:url" content="https://inesmartins.github.io//0xoposec/" />
    <meta name="twitter:image" content="https://inesmartins.github.io//content/images/2020/06/highres_471963990.jpeg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Inês Martins" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="cryptography, ctf, aes, aes-ctr" />
    <meta property="og:image:width" content="504" />
    <meta property="og:image:height" content="105" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Inês Martins",
        "url": "https://inesmartins.github.io//",
        "logo": {
            "@type": "ImageObject",
            "url": "https://inesmartins.github.io//favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "image": {
            "@type": "ImageObject",
            "url": "https://inesmartins.github.io//content/images/2020/07/0PFUtbOg_400x400.jpg",
            "width": 400,
            "height": 400
        },
        "url": "https://inesmartins.github.io//author/ines/",
        "sameAs": []
    },
    "headline": "ØxOPOSɆC Crypto Challenge 2019",
    "url": "https://inesmartins.github.io//0xoposec/",
    "datePublished": "2020-06-07T22:48:24.000Z",
    "dateModified": "2020-12-08T09:32:42.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://inesmartins.github.io//content/images/2020/06/highres_471963990.jpeg",
        "width": 504,
        "height": 105
    },
    "keywords": "cryptography, ctf, aes, aes-ctr",
    "description": "Write-up for ØxOPOSɆC crypto challenge that involves AES in CTR mode.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://inesmartins.github.io//"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.18" />
    <link rel="alternate" type="application/rss+xml" title="Inês Martins" href="https://inesmartins.github.io//rss/" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180659126-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-180659126-1');
</script>

</head>
<body class="post-template tag-cryptography tag-ctf tag-aes tag-aes-ctr">

    <div class="site-wrapper">

        

<header class="site-header">
    <div class="outer site-nav-main">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
                <a class="site-nav-logo" href="https://inesmartins.github.io/">Inês Martins</a>
            <div class="site-nav-content">
                    <ul class="nav">
    <li class="nav-home"><a href="https://inesmartins.github.io//">Home</a></li>
</ul>

                    <span class="nav-post-title dash">ØxOPOSɆC Crypto Challenge 2019</span>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
            <div class="social-links">
            </div>
                <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://inesmartins.github.io//rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>

    </div>
</nav>
    </div>
</div></header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-cryptography tag-ctf tag-aes tag-aes-ctr ">

            <header class="post-full-header">

                <section class="post-full-tags">
                    <a href="/tag/cryptography/">cryptography</a>
                </section>

                <h1 class="post-full-title">ØxOPOSɆC Crypto Challenge 2019</h1>

                <p class="post-full-custom-excerpt">Write-up for ØxOPOSɆC crypto challenge that involves AES in CTR mode.</p>

                <div class="post-full-byline">

                    <section class="post-full-byline-content">

                        <ul class="author-list">
                            <li class="author-list-item">

                                <div class="author-card">
                                    <img class="author-profile-image" src="/content/images/size/w100/2020/07/0PFUtbOg_400x400.jpg" alt="Inês Martins" />
                                    <div class="author-info">
                                        <h2>Inês Martins</h2>
                                        <p>Read <a href="/author/ines/">more posts</a> by this author.</p>
                                    </div>
                                </div>

                                <a href="/author/ines/" class="author-avatar">
                                    <img class="author-profile-image" src="/content/images/size/w100/2020/07/0PFUtbOg_400x400.jpg" alt="Inês Martins" />
                                </a>

                            </li>
                        </ul>

                        <section class="post-full-byline-meta">
                            <h4 class="author-name"><a href="/author/ines/">Inês Martins</a></h4>
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-06-07">7 Jun 2020</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="/content/images/size/w300/2020/06/highres_471963990.jpeg 300w,
                            /content/images/size/w600/2020/06/highres_471963990.jpeg 600w,
                            /content/images/size/w1000/2020/06/highres_471963990.jpeg 1000w,
                            /content/images/size/w2000/2020/06/highres_471963990.jpeg 2000w"
                    sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px"
                    src="/content/images/size/w2000/2020/06/highres_471963990.jpeg"
                    alt="ØxOPOSɆC Crypto Challenge 2019"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <h2 id="level-1">Level 1 </h2><p>This first level is an example of how the <a href="https://en.wikipedia.org/wiki/Known-plaintext_attack">known-plaintext attack</a> can be used against the AES-CTR algorithm, if incorrectly implemented.</p><p>We're given a ciphered text (C1):</p><!--kg-card-begin: markdown--><p><code>5/KIDoW4XvtTCLZQSQl9GYBmdSC+vj2wDxP4Bbg=</code></p>
<!--kg-card-end: markdown--><p>and its plaintext equivalent (P1):</p><!--kg-card-begin: markdown--><p><code>this data is indeed important</code></p>
<!--kg-card-end: markdown--><p>And we're asked to decipher a second cipher (C2):</p><!--kg-card-begin: markdown--><p><code>9faAGt62D79tSa1GNhR2FbpgY3mnpyKAEVfrD7E=</code></p>
<!--kg-card-end: markdown--><p>We also know that this is an implementation of the AES block cipher in CTR mode, where both plaintexts where encrypted with the same key and IV. In these conditions we know that:</p><!--kg-card-begin: markdown--><pre><code>C1 XOR C2 = P1 XOR P2
</code></pre>
<!--kg-card-end: markdown--><p>and as such:</p><!--kg-card-begin: markdown--><pre><code>P2 = P1 XOR (C1 XOR C2)
</code></pre>
<!--kg-card-end: markdown--><p>To find P2 I created a simple Python script:</p><pre><code class="language-python">import base64

c1 = "5/KIDoW4XvtTCLZQSQl9GYBmdSC+vj2wDxP4Bbg="
c2 = "9faAGt62D79tSa1GNhR2FbpgY3mnpyKAEVfrD7E="
p1 = "this data is indeed important"

decoded_c1 = c1.decode("base64")
c1_byte_arr = bytearray(decoded_c1)
decoded_c2 = c2.decode("base64")
c2_byte_arr = bytearray(decoded_c2)
p1_byte_arr = bytearray(p1)
c1_xor_c2 = []
p2 = []

for i in range(len(c1_byte_arr)):
    xored = c1_byte_arr[i] ^ c2_byte_arr[i]
    c1_xor_c2.append(xored)

print("c1 XOR c2 = " + " ".join(map(str, c1_xor_c2)))
print("\n")

for j in range(len(c1_xor_c2)):
    xored2 = p1_byte_arr[j] ^ c1_xor_c2[j]
    p2.append(xored2)

print("p1 XOR (c1 XOR c2) = " + " ".join(map(str, p2)))</code></pre><hr><h2 id="level-2">Level 2</h2><p>On this level, we're  provided with an example of a valid cipher but not its plaintext equivalent:</p><!--kg-card-begin: markdown--><pre><code>22jBDaecKR9Sn4JXzJkxXwY/cAgC9/Gg5JImfEgQLC0=
</code></pre>
<!--kg-card-end: markdown--><p>We also have access to a server which confirms or denies the validity of any given cipher, but it also let's us know when the error is due to invalid padding, which makes it vulnerable to <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">padding oracle attacks</a>.</p><p>Instead of creating a custom Python script, I simply adapted the following PoC: <a href="https://github.com/mpgn/Padding-oracle-attack">https://github.com/mpgn/Padding-oracle-attack</a>:</p><pre><code class="language-python">import os
import sys

url = [SERVER_URL]
flag_hex = [KNOWN_VALID_FLAG_IN_HEX]
base64_error = [INVALID_BASE64_ERROR_MSG]
len_error = [INVALID_LENGTH_ERROR_MSG]
padding_error = [WRONG_PADDING_ERROR_MSG]
success_msg = [SUCCESS_MSG]

import argparse
import httplib, urllib
import re
import binascii
import os
import sys
import time
from binascii import unhexlify, hexlify
from itertools import cycle, izip

def call_oracle(hex_cipher):
    unencoded = hex_cipher.decode("hex")
    test_flag = unencoded.encode("base64")
    request = "curl -X POST -F 'encrypted=" + test_flag + "' --url " + url
    print(request)
    result = os.popen(request).read()
    if padding_error in str(result) or len_error in str(result):  #or base64_error in str(result) 
        return 0
    else:
        return 1

# the exploit don't need to touch this part
# split the cipher in len of size_block
def split_len(seq, length):
    return [seq[i:i+length] for i in range(0, len(seq), length)]

''' create custom block for the byte we search'''
def block_search_byte(size_block, i, pos, l):
    hex_char = hex(pos).split('0x')[1]
    return "00"*(size_block-(i+1)) + ("0" if len(hex_char)%2 != 0 else '') + hex_char + ''.join(l)   

''' create custom block for the padding'''
def block_padding(size_block, i):
    l = []
    for t in range(0,i+1):
        l.append(("0" if len(hex(i+1).split('0x')[1])%2 != 0 else '') + (hex(i+1).split('0x')[1]))
    return "00"*(size_block-(i+1)) + ''.join(l)

def hex_xor(s1,s2):
    return hexlify(''.join(chr(ord(c1) ^ ord(c2)) for c1, c2 in zip(unhexlify(s1), cycle(unhexlify(s2)))))

def run():
    cipher       = flag_hex
    size_block   = 16
    found        = False
    valide_value = []
    result       = []
    len_block    = size_block*2
    cipher_block = split_len(cipher, len_block)

    if len(cipher_block) == 1:
        print "[-] Abort there is only one block"
        sys.exit() 
    #for each cipher_block
    for block in reversed(range(1,len(cipher_block))):
        if len(cipher_block[block]) != len_block:
            print "[-] Abort length block doesn't match the size_block"
            break
        print "[+] Search value block : ", block, "\n"
        #for each byte of the block
        for i in range(0,size_block):
            # test each byte max 255
            for ct_pos in range(0,256):
                # 1 xor 1 = 0 or valide padding need to be checked
                if ct_pos != i+1 or (len(valide_value) &gt; 0  and int(valide_value[-1],16) == ct_pos):

                    bk = block_search_byte(size_block, i, ct_pos, valide_value) 
                    bp = cipher_block[block-1]
                    bc = block_padding(size_block, i) 

                    tmp = hex_xor(bk,bp)
                    cb  = hex_xor(tmp,bc).upper()

                    up_cipher  = cb + cipher_block[block]
                    #time.sleep(0.5)

                    # we call the oracle, our god
                    valid = call_oracle(up_cipher)

                    if valid == 1:

                        found = True

                        # data analyse and insert in rigth order
                        value = re.findall('..',bk)
                        valide_value.insert(0,value[size_block-(i+1)])
                        bytes_found = ''.join(valide_value)
                        if i == 0 and bytes_found.decode("hex") &gt; hex(size_block) and block == len(cipher_block)-1:
                            print "[-] Error decryption failed the padding is &gt; "+str(size_block)
                            sys.exit()

                        print '\033[36m' + '\033[1m' + "[+]" + '\033[0m' + " Found", i+1,  "bytes :", bytes_found
                        print ''

                        break 
            if found == False:
                # lets say padding is 01 for the last byte of the last block (the padding block)
                if len(cipher_block)-1 == block and i == 0:
                    value = re.findall('..',bk)
                    valide_value.insert(0,"01")
                else:
                    print "\n[-] Error decryption failed"
                    result.insert(0, ''.join(valide_value))
                    hex_r = ''.join(result)
                    print "[+] Partial Decrypted value (HEX):", hex_r.upper()
                    padding = int(hex_r[len(hex_r)-2:len(hex_r)],16)
                    print "[+] Partial Decrypted value (ASCII):", hex_r[0:-(padding*2)].decode("hex")
                    sys.exit()
            found = False

        result.insert(0, ''.join(valide_value))
        valide_value = []

    print ''
    hex_r = ''.join(result)
    print "[+] Decrypted value (HEX):", hex_r.upper()
    padding = int(hex_r[len(hex_r)-2:len(hex_r)],16)
    print "[+] Decrypted value (ASCII):", hex_r[0:-(padding*2)].decode("hex")

if __name__ == '__main__':                           
    run()</code></pre><p></p>
                </div>
            </section>



        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card">
                    <header class="read-next-card-header">
                        <h3><span>More in</span> <a href="/tag/cryptography/">cryptography</a></h3>
                    </header>
                    <div class="read-next-card-content">
                        <ul>
                            <li>
                                <h4><a href="/oposec-baby-challenge/">ØxOPOSɆC | Underground Leaks (Crypto) - Part II</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2020-12-09">9 Dec 2020</time> –
                                        1 min read</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="/htb-crypto-challenge/">HTB Crypto Challenge | Bank Heist</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2020-10-22">22 Oct 2020</time> –
                                        1 min read</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="/decrypting-the-ghost-in-the-wires-ciphers/">Solving the &#x27;Ghost in the Wires&#x27; ciphers</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2020-06-07">7 Jun 2020</time> –
                                        8 min read</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="/tag/cryptography/">See all 3 posts
                            →</a>
                    </footer>
                </article>

                <article class="post-card post tag-steg tag-steganography tag-oposec tag-volatility ">

    <a class="post-card-image-link" href="/oxopos-c-steg-challenge/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2020/06/highres_471963990-1.jpeg 300w,
                    /content/images/size/w600/2020/06/highres_471963990-1.jpeg 600w,
                    /content/images/size/w1000/2020/06/highres_471963990-1.jpeg 1000w,
                    /content/images/size/w2000/2020/06/highres_471963990-1.jpeg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            loading="lazy"
            src="/content/images/size/w600/2020/06/highres_471963990-1.jpeg"
            alt="ØxOPOSɆC Steg Challenge 2019"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/oxopos-c-steg-challenge/">

            <header class="post-card-header">
                    <div class="post-card-primary-tag">steg</div>
                <h2 class="post-card-title">ØxOPOSɆC Steg Challenge 2019</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>Write-up for ØxOPOSɆC steganography challenge that involves the analysis of a volatile memory dump.</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Inês Martins
                    </div>
            
                    <a href="/author/ines/" class="static-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2020/07/0PFUtbOg_400x400.jpg" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="/author/ines/">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2020-06-07">7 Jun 2020</time> <span class="bull">&bull;</span> 1 min read</span>
            </div>
        </footer>

    </div>

</article>

                <article class="post-card post tag-cryptography tag-ghost-in-the-wires tag-book ">

    <a class="post-card-image-link" href="/decrypting-the-ghost-in-the-wires-ciphers/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2020/06/buy-ghost.png-width-600-name-buy-ghost.png 300w,
                    /content/images/size/w600/2020/06/buy-ghost.png-width-600-name-buy-ghost.png 600w,
                    /content/images/size/w1000/2020/06/buy-ghost.png-width-600-name-buy-ghost.png 1000w,
                    /content/images/size/w2000/2020/06/buy-ghost.png-width-600-name-buy-ghost.png 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            loading="lazy"
            src="/content/images/size/w600/2020/06/buy-ghost.png-width-600-name-buy-ghost.png"
            alt="Solving the &#x27;Ghost in the Wires&#x27; ciphers"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/decrypting-the-ghost-in-the-wires-ciphers/">

            <header class="post-card-header">
                    <div class="post-card-primary-tag">cryptography</div>
                <h2 class="post-card-title">Solving the &#x27;Ghost in the Wires&#x27; ciphers</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>Before I was even done reading Ghost in the Wires, I had to start solving the little ciphers that introduce each chapter. I know there are probably hundreds of solutions</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Inês Martins
                    </div>
            
                    <a href="/author/ines/" class="static-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2020/07/0PFUtbOg_400x400.jpg" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="/author/ines/">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2020-06-07">7 Jun 2020</time> <span class="bull">&bull;</span> 8 min read</span>
            </div>
        </footer>

    </div>

</article>
        </div>
    </div>
</aside>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://inesmartins.github.io/">Inês Martins</a> &copy; 2021</section>
                <nav class="site-footer-nav">
                    <a href="https://inesmartins.github.io/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="/assets/built/casper.js?v=906b0e7667"></script>

    <script>
        // Parse the URL parameter
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Give the parameter a variable name
        var action = getParameterByName('action');

        $(document).ready(function () {
            if (action == 'subscribe') {
                $('body').addClass("subscribe-success");
            }

            $('.subscribe-success-message .subscribe-close').click(function () {
                $('.subscribe-success-message').addClass('close');
            });

            // Reset form on opening subscrion overlay
            $('.subscribe-button').click(function() {
                $('.subscribe-overlay form').removeClass();
                $('.subscribe-email').val('');
            });
        });
    </script>

    <script>
    $(document).ready(function () {
        // FitVids - start
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // FitVids - end

        // Replace nav with title on scroll - start
        Casper.stickyNavTitle({
            navSelector: '.site-nav-main',
            titleSelector: '.post-full-title',
            activeClass: 'nav-post-title-active'
        });
        // Replace nav with title on scroll - end

        // Hover on avatar
        var hoverTimeout;
        $('.author-list-item').hover(function () {
            var $this = $(this);

            clearTimeout(hoverTimeout);

            $('.author-card').removeClass('hovered');
            $(this).children('.author-card').addClass('hovered');

        }, function () {
            var $this = $(this);

            hoverTimeout = setTimeout(function () {
                $this.children('.author-card').removeClass('hovered');
            }, 800);
        });
    });
</script>


    <div class="site-footer outer" style="background:#090a0b;margin-top:-60px;">
    <div class="site-footer-content footer inner" style="margin-bottom:-20px">
        <script src="https://www.hackthebox.eu/badge/172261"></script>
    </div>
</div>

</body>
</html>
