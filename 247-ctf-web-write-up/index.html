<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>247/CTF Write-up | Web Challenges</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=c74203a698" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://inesmartins.github.io//247-ctf-web-write-up/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://inesmartins.github.io//247-ctf-web-write-up/amp/" />
    
    <meta property="og:site_name" content="Inês Martins" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="247/CTF Write-up | Web Challenges" />
    <meta property="og:description" content="This post will be updated as I solve more of the 247/CTF platform&#x27;s web challenges. 1. Trusted ClientDevelopers don&#x27;t always have time to setup a backend service when prototyping code. Storing credentials on the client side should be fine as long as it&#x27;s obfuscated right?snapshot from the source" />
    <meta property="og:url" content="https://inesmartins.github.io//247-ctf-web-write-up/" />
    <meta property="og:image" content="https://inesmartins.github.io//content/images/2020/06/ctf.png" />
    <meta property="article:published_time" content="2020-06-28T10:47:34.000Z" />
    <meta property="article:modified_time" content="2020-06-30T19:25:04.000Z" />
    <meta property="article:tag" content="247ctf" />
    <meta property="article:tag" content="ctf" />
    <meta property="article:tag" content="jwt" />
    <meta property="article:tag" content="jsfuck" />
    <meta property="article:tag" content="javascript" />
    <meta property="article:tag" content="md5" />
    <meta property="article:tag" content="php" />
    <meta property="article:tag" content="magic hashes" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="247/CTF Write-up | Web Challenges" />
    <meta name="twitter:description" content="This post will be updated as I solve more of the 247/CTF platform&#x27;s web challenges. 1. Trusted ClientDevelopers don&#x27;t always have time to setup a backend service when prototyping code. Storing credentials on the client side should be fine as long as it&#x27;s obfuscated right?snapshot from the source" />
    <meta name="twitter:url" content="https://inesmartins.github.io//247-ctf-web-write-up/" />
    <meta name="twitter:image" content="https://inesmartins.github.io//content/images/2020/06/ctf.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Inês Martins" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="247ctf, ctf, jwt, jsfuck, javascript, md5, php, magic hashes" />
    <meta name="twitter:site" content="@inesmartns" />
    <meta property="og:image:width" content="1155" />
    <meta property="og:image:height" content="225" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Inês Martins",
        "url": "https://inesmartins.github.io//",
        "logo": {
            "@type": "ImageObject",
            "url": "https://inesmartins.github.io//favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/eb3d21b5088ac4be0cd6c7c24fee6a3f?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://inesmartins.github.io//author/ines/",
        "sameAs": []
    },
    "headline": "247/CTF Write-up | Web Challenges",
    "url": "https://inesmartins.github.io//247-ctf-web-write-up/",
    "datePublished": "2020-06-28T10:47:34.000Z",
    "dateModified": "2020-06-30T19:25:04.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://inesmartins.github.io//content/images/2020/06/ctf.png",
        "width": 1155,
        "height": 225
    },
    "keywords": "247ctf, ctf, jwt, jsfuck, javascript, md5, php, magic hashes",
    "description": "This post will be updated as I solve more of the 247/CTF platform\n[https://247ctf.com/dashboard]&#x27;s web challenges.\n\n1. Trusted Client\n&gt; Developers don&#x27;t always have time to setup a backend service when prototyping\ncode. Storing credentials on the client side should be fine as long as it&#x27;s\nobfuscated right?\nsnapshot from the source codeYup, this is JSFuck [https://en.wikipedia.org/wiki/JSFuck]. I used an online\ndecoder [http://codertab.com/jsunfuck] to get the original JS code:\n\nfunction anonymou",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://inesmartins.github.io//"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.18" />
    <link rel="alternate" type="application/rss+xml" title="Inês Martins" href="https://inesmartins.github.io//rss/" />

</head>
<body class="post-template tag-247ctf tag-ctf tag-jwt tag-jsfuck tag-javascript tag-md5 tag-php tag-magic-hashes">

    <div class="site-wrapper">

        

<header class="site-header">
    <div class="outer site-nav-main">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
                <a class="site-nav-logo" href="https://inesmartins.github.io/">Inês Martins</a>
            <div class="site-nav-content">
                    <ul class="nav">
    <li class="nav-home"><a href="https://inesmartins.github.io//">Home</a></li>
</ul>

                    <span class="nav-post-title dash">247/CTF Write-up | Web Challenges</span>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
            <div class="social-links">
                    <a class="social-link social-link-tw" href="https://twitter.com/inesmartns" title="Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            </div>
                <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://inesmartins.github.io//rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>

    </div>
</nav>
    </div>
</div></header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-247ctf tag-ctf tag-jwt tag-jsfuck tag-javascript tag-md5 tag-php tag-magic-hashes ">

            <header class="post-full-header">

                <section class="post-full-tags">
                    <a href="/tag/247ctf/">247ctf</a>
                </section>

                <h1 class="post-full-title">247/CTF Write-up | Web Challenges</h1>


                <div class="post-full-byline">

                    <section class="post-full-byline-content">

                        <ul class="author-list">
                            <li class="author-list-item">

                                <div class="author-card">
                                    <img class="author-profile-image" src="//www.gravatar.com/avatar/eb3d21b5088ac4be0cd6c7c24fee6a3f?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Inês Martins" />
                                    <div class="author-info">
                                        <h2>Inês Martins</h2>
                                        <p>Read <a href="/author/ines/">more posts</a> by this author.</p>
                                    </div>
                                </div>

                                <a href="/author/ines/" class="author-avatar">
                                    <img class="author-profile-image" src="//www.gravatar.com/avatar/eb3d21b5088ac4be0cd6c7c24fee6a3f?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Inês Martins" />
                                </a>

                            </li>
                        </ul>

                        <section class="post-full-byline-meta">
                            <h4 class="author-name"><a href="/author/ines/">Inês Martins</a></h4>
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-06-28">28 Jun 2020</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="/content/images/size/w300/2020/06/ctf.png 300w,
                            /content/images/size/w600/2020/06/ctf.png 600w,
                            /content/images/size/w1000/2020/06/ctf.png 1000w,
                            /content/images/size/w2000/2020/06/ctf.png 2000w"
                    sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px"
                    src="/content/images/size/w2000/2020/06/ctf.png"
                    alt="247/CTF Write-up | Web Challenges"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p>This post will be updated as I solve more of the <a href="https://247ctf.com/dashboard">247/CTF platform</a>'s web challenges.</p><h2 id="1-trusted-client">1. Trusted Client</h2><blockquote>Developers don't always have time to setup a backend service when prototyping code<em>.</em> Storing credentials on the client side should be fine as long as it's obfuscated right?</blockquote><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://inesmartins.github.io//content/images/2020/06/jsfuck.png" class="kg-image"><figcaption>snapshot from the source code</figcaption></figure><p>Yup, this is <a href="https://en.wikipedia.org/wiki/JSFuck">JSFuck</a>. I used an <a href="http://codertab.com/jsunfuck">online decoder</a> to get the original JS code:</p><pre><code class="language-javascript">function anonymous() {
	if (this.username.value == 'the_flag_is' &amp;&amp; this.password.value == '247CTF{6c91b7f7f12c852f892293d16dba0148}') { 
        alert('Valid username and password!');
    } else { alert('Invalid username and password!'); }
}</code></pre><p>Note that some of the online decoders out there are a little buggy, take a look at the console, it might help.</p><hr><h2 id="2-secured-session">2. Secured Session</h2><blockquote>If you can guess our random secret key, we will tell you the flag securely stored in your session.</blockquote><pre><code class="language-python">import os
from flask import Flask, request, session
from flag import flag

app = Flask(__name__)
app.config['SECRET_KEY'] = os.urandom(24)

def secret_key_to_int(s):
    try:
        secret_key = int(s)
    except ValueError:
        secret_key = 0
    return secret_key

@app.route("/flag")
def index():
    secret_key = secret_key_to_int(request.args['secret_key']) if 'secret_key' in request.args else None
    session['flag'] = flag
    if secret_key == app.config['SECRET_KEY']:
      return session['flag']
    else:
      return "Incorrect secret key!"

@app.route('/')
def source():
    return "
%s
" % open(__file__).read()

if __name__ == "__main__":
    app.run()</code></pre><p>So, it seems that as long as we send a non-null <code>secret_key</code> parameter, the flag is written to the <code>flag</code> property of the <code>session</code> cookie. Let's confirm this:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/size.png" class="kg-image"></figure><p>As you can see, the <code>session</code> cookie is a <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">JWT</a>, which we can <a href="https://jwt.io/">reverse</a>:</p><pre><code>{
  "flag": {
    " b": "MjQ3Q1RGe2RhODA3OTVmOGE1Y2FiMmUwMzdkNzM4NTgwN2I5YTkxfQ=="
  }
}</code></pre><p>Decoding the base64 string we get: <code>247CTF{da80795f8a5cab2e037d7385807b9a91}</code>.</p><hr><h2 id="3-compare-the-pair">3. Compare the pair</h2><blockquote>Can you identify a way to bypass our login logic? MD5 is supposed to be a one-way function right?</blockquote><pre><code class="language-php">&lt;?php
  require_once('flag.php');
  $password_hash = "0e902564435691274142490923013038";
  $salt = "f789bbc328a3d1a3";
  if(isset($_GET['password']) &amp;&amp; md5($salt . $_GET['password']) == $password_hash) {
    echo $flag;
  }
  echo highlight_file(__FILE__, true);
?&gt;</code></pre><p>Whenever I find a <code>MD5</code> hash in the wild I google it just in case someone already found the plaintext in another context, however, with this one the only matches that came up were related to this CTF.</p><p>Since the <code>MD5</code> algorithm is not reversible, it's clear that we're not supposed to try and extract the original password logically. After some research I realised that the solution lies in exploiting the "<a href="https://www.whitehatsec.com/blog/magic-hashes/">Magic hashes</a>" vulnerability that has long been identified in PHP.</p><blockquote>Password hashes in PHP are base16 encoded and can come in the form of “0e812389…”. The problem is in <code>==</code> comparison the <code>0e</code> means that if the following characters are all digits the whole string gets treated as a float. [<a href="https://www.whitehatsec.com/blog/magic-hashes/">Source</a>]</blockquote><p>Even more strange:</p><blockquote>If PHP decides that both operands look like numbers, even if they are actually strings, it will convert them both and perform a numeric comparison:<br> <code>TRUE: "0e12345" == "0e54321"</code><br>[<a href="https://owasp.org/www-pdf-archive/PHPMagicTricks-TypeJuggling.pdf">Source</a>]</blockquote><p>So, all we have to do is find the group of characters that when concatenated with the salt and hashed is equal to <code>0e902564435691274142490923013038</code>. Let's create a script that does exactly that:</p><pre><code class="language-php">&lt;?php

$password_hash = "0e902564435691274142490923013038";
$salt = "f789bbc328a3d1a3";

for ($i = 0; $i &lt; 1000000000; $i++) {
    $tmp_pwd = $salt . $i;
    $tmp_pwd_hash = md5($tmp_pwd);
    if ($tmp_pwd_hash == $password_hash) {
    	echo "Match!: " . $tmp_pwd . "\n";
        return;
    }
}

?&gt;</code></pre><p>And we find a match! <code>f789bbc328a3d1a3237701818</code>. </p><p>If we remove the salt - <code>f789bbc328a3d1a3</code> we get a password that works: <code>237701818</code>. </p><p>Let's try it out!</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/final.png" class="kg-image"></figure><hr>
                </div>
            </section>



        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">


                <article class="post-card post tag-ctf tag-javascript ">

    <a class="post-card-image-link" href="/ringzer0-javascript-challenges-write-up-part-ii/">
        <img class="post-card-image"
            srcset="/content/images/size/w300/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg 300w,
                    /content/images/size/w600/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg 600w,
                    /content/images/size/w1000/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg 1000w,
                    /content/images/size/w2000/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            loading="lazy"
            src="/content/images/size/w600/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg"
            alt="RingZer0 JavaScript Challenges Write-up | Part II"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/ringzer0-javascript-challenges-write-up-part-ii/">

            <header class="post-card-header">
                    <div class="post-card-primary-tag">ctf</div>
                <h2 class="post-card-title">RingZer0 JavaScript Challenges Write-up | Part II</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>Click here for Part I. 5 - Valid Key RequiredOn this level instead of user/password form we see an input field where we're supposed to enter a key: The</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Inês Martins
                    </div>
            
                    <a href="/author/ines/" class="static-avatar">
                        <img class="author-profile-image" src="//www.gravatar.com/avatar/eb3d21b5088ac4be0cd6c7c24fee6a3f?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x" alt="Inês Martins" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="/author/ines/">Inês Martins</a></span>
                <span class="post-card-byline-date"><time datetime="2020-06-24">24 Jun 2020</time> <span class="bull">&bull;</span> 2 min read</span>
            </div>
        </footer>

    </div>

</article>
        </div>
    </div>
</aside>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://inesmartins.github.io/">Inês Martins</a> &copy; 2020</section>
                <nav class="site-footer-nav">
                    <a href="https://inesmartins.github.io/">Latest Posts</a>
                    
                    <a href="https://twitter.com/inesmartns" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="/assets/built/casper.js?v=c74203a698"></script>

    <script>
        // Parse the URL parameter
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Give the parameter a variable name
        var action = getParameterByName('action');

        $(document).ready(function () {
            if (action == 'subscribe') {
                $('body').addClass("subscribe-success");
            }

            $('.subscribe-success-message .subscribe-close').click(function () {
                $('.subscribe-success-message').addClass('close');
            });

            // Reset form on opening subscrion overlay
            $('.subscribe-button').click(function() {
                $('.subscribe-overlay form').removeClass();
                $('.subscribe-email').val('');
            });
        });
    </script>

    <script>
    $(document).ready(function () {
        // FitVids - start
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // FitVids - end

        // Replace nav with title on scroll - start
        Casper.stickyNavTitle({
            navSelector: '.site-nav-main',
            titleSelector: '.post-full-title',
            activeClass: 'nav-post-title-active'
        });
        // Replace nav with title on scroll - end

        // Hover on avatar
        var hoverTimeout;
        $('.author-list-item').hover(function () {
            var $this = $(this);

            clearTimeout(hoverTimeout);

            $('.author-card').removeClass('hovered');
            $(this).children('.author-card').addClass('hovered');

        }, function () {
            var $this = $(this);

            hoverTimeout = setTimeout(function () {
                $this.children('.author-card').removeClass('hovered');
            }, 800);
        });
    });
</script>


    

</body>
</html>
